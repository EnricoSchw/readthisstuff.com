!function t(e,n,o){function r(s,a){if(!n[s]){if(!e[s]){var p="function"==typeof require&&require;if(!a&&p)return p(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){var n=e[s][1][t];return r(n?n:t)},u,u.exports,t,e,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(t,e,n){},{}],2:[function(t,e,n){(function(e){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function r(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function i(t,e){return e={exports:{}},t(e,e.exports),e.exports}function s(t,e){return e.priority-t.priority}function a(t,e,n,o){var r;return u(e,n),r=this.__events__.hasOwnProperty(t)?this.__events__[t]:this.__events__[t]=[],r.push({method:e,context:n||null,priority:o}),this}function p(t,e,n){var o,r;if(1===arguments.length)return delete this.__events__[t],this;if(u(e,n),!(t in this.__events__&&this.__events__[t].length))return this;for(arguments.length<3&&(n=null),r=this.__events__[t],o=r.length;o--;)r[o].method===e&&r[o].context===n&&r.splice(o,1);return 0===r.length&&delete this.__events__[t],this}function c(t){return va(this.__events__,function(e,n){for(var o=this,r=e.length-1;r>=0;r--)e[r]&&e[r].context===t&&p.call(o,n,e[r].method,t)}.bind(this)),this}function u(t,e){if("string"==typeof t){if(void 0===e||null===e)throw new Error('Method name "'+t+'" has no context.');if(!(t in e))throw new Error('Method not found: "'+t+'"');if("function"!=typeof e[t])throw new Error('Property "'+t+'" is not a function')}else if("function"!=typeof t)throw new Error("Invalid callback. Function or method name expected.")}function h(t,e){t&&"-"!==t[t.length-1]&&(t=t.concat("-"));var n,o="0123456789abcdefghijklmnopqrstuvwxyz".split(""),r=[],i=16;if(e=e||32)for(n=0;n<e;n++)r[n]=o[0|Math.random()*i];else{var s;for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",n=0;n<36;n++)r[n]||(s=0|16*Math.random(),r[n]=o[19===n?3&s|8:s])}return(t?t:"")+r.join("")}function f(t,e){if(t.type===Ou&&e.type===Ou)return t.pos===e.pos;if(t.type===Eu&&e.type===Eu)return!(t.pos>=e.pos+e.str.length||e.pos>=t.pos+t.str.length);var n,o;return t.type===Eu?(n=t,o=e):(n=e,o=t),o.pos>=n.pos&&o.pos<n.pos+n.str.length}function l(t,e){t.pos===e.pos?e.pos+=t.str.length:t.pos<e.pos?e.pos+=t.str.length:t.pos+=e.str.length}function d(t,e,n){if(t.pos>e.pos)return d(e,t,!n);if(t.pos===e.pos&&t.str.length>e.str.length)return d(e,t,!n);if(e.pos<t.pos+t.str.length){var o=e.pos-t.pos,r=t.str.length-o,i=o+e.str.length;t.str=t.str.slice(0,o)+t.str.slice(i),e.str=e.str.slice(r),e.pos-=o}else e.pos-=t.str.length}function y(t,e){if(t.type===Eu)return y(e,t);if(t.pos<=e.pos)e.pos+=t.str.length;else if(t.pos>=e.pos+e.str.length)t.pos-=e.str.length;else{var n=t.pos-e.pos;e.str=e.str.slice(0,n)+t.str+e.str.slice(n),t.str=""}}function g(t,e){t.pos===e.pos?e.pos+=1:t.pos<e.pos?e.pos+=1:t.pos+=1}function m(t,e){return t.pos===e.pos?(e.type=Pu,void(t.type=Pu)):void(t.pos<e.pos?e.pos-=1:t.pos-=1)}function v(t,e){if(t.type===Tu){var n=t;t=e,e=n}t.pos<=e.pos?e.pos+=1:t.pos-=1}function _(t,e,n){var o=new Sh(t.containerId,e.path,e.offset,n.path,n.offset,(!1),t.surfaceId),r=t._internal.doc;return r&&o.attach(r),o}function b(t){if(!t)return uh.nullSelection;var e=t.type;switch(e){case"property":return vh.fromJSON(t);case"container":return Sh.fromJSON(t);case"node":return xh.fromJSON(t);case"custom":return Oh.fromJSON(t);default:return uh.nullSelection}}function w(t,e){for(var n=0;n<t.ops.length;n++)for(var o=t.ops[n],r=0;r<e.ops.length;r++){var i=e.ops[r];Bu.transform(o,i,{inplace:!0})}t.before&&S(t.before.selection,e),t.after&&S(t.after.selection,e),e.before&&S(e.before.selection,t),e.after&&S(e.after.selection,t)}function C(t,e){mn(t)||(t=[t]),mn(e)||(e=[e]);for(var n=0;n<t.length;n++)for(var o=t[n],r=0;r<e.length;r++){var i=e[r];w(o,i)}}function S(t,e){if(!t||!t.isPropertySelection()&&!t.isContainerSelection())return!1;for(var n=e.ops,o=!1,r=t.isCollapsed(),i=0;i<n.length;i++){var s=n[i];o|=x(t.start,s),r?(t.isContainerSelection()&&(t.endPath=t.startPath),t.endOffset=t.startOffset):o|=x(t.end,s)}return o}function x(t,e){if(!Op(e.path,t.path))return!1;var n=!1;if("update"===e.type&&"string"===e.propertyType){var o,r=e.diff;r.isInsert()&&r.pos<=t.offset?(o=t.offset+r.str.length,t.offset=o,n=!0):r.isDelete()&&r.pos<=t.offset&&(o=Math.max(r.pos,t.offset-r.str.length),t.offset=o,n=!0)}return n}function O(t,e){for(var n=0;n<t.length;n++)t[n]===e&&(t.splice(n,1),n--)}function E(){var t,e,n,o,r,i=this;if(1===arguments.length&&null===arguments[0])return uh.nullSelection;if(arguments[0]instanceof ph)return t=arguments[0],t.isNodeCoordinate()?xh._createFromCoordinate(t):new vh(t.path,t.offset,t.offset);if(arguments[0]instanceof gh){e=arguments[0];var s=Op(e.start.path,e.end.path);return s?e.start.isNodeCoordinate()?xh._createFromRange(e):new vh(e.start.path,e.start.offset,e.end.offset,e.reverse,e.containerId):new Sh(e.containerId,e.start.path,e.start.offset,e.end.path,e.end.offset,e.reverse)}return 1===arguments.length&&Xe(arguments[0])?N(i,arguments[0]):2===arguments.length&&mn(arguments[0])?(n=arguments[0],o=arguments[1],new vh(n,o,o)):3===arguments.length&&mn(arguments[0])?(n=arguments[0],o=arguments[1],r=arguments[2],new vh(n,o,r,o>r)):5===arguments.length&&bn(arguments[0])?N(i,{type:"container",containerId:arguments[0],startPath:arguments[1],startOffset:arguments[2],endPath:arguments[3],endOffset:arguments[4]}):(console.error("Illegal arguments for Selection.create().",arguments),uh.nullSelection)}function N(t,e){var n;if("property"===e.type)return null!==e.endOffset&&void 0!==e.endOffset||(e.endOffset=e.startOffset),e.hasOwnProperty("reverse")||(e.startOffset>e.endOffset?(n=e.startOffset,e.startOffset=e.endOffset,e.endOffset=n,e.reverse=!0):e.reverse=!1),new vh(e.path,e.startOffset,e.endOffset,e.reverse,e.containerId,e.surfaceId);if("container"===e.type){var o=t.get(e.containerId,"strict"),r=new ph(e.startPath,e.startOffset),i=new ph(e.endPath,e.endOffset),s=o.getAddress(r),a=o.getAddress(i),p=e.reverse;if(!s)throw new Error("Invalid arguments for ContainerSelection: ",r.toString());if(!a)throw new Error("Invalid arguments for ContainerSelection: ",i.toString());return e.hasOwnProperty("reverse")||(p=a.isBefore(s,"strict"),p&&(n=r,r=i,i=n)),I(t,r,!0),I(t,i,!1),new Sh(o.id,r.path,r.offset,i.path,i.offset,p,e.surfaceId)}if("node"===e.type)return xh.fromJSON(e);if("custom"===e.type)return Oh.fromJSON(e);throw new Error("Illegal selection type",e)}function I(t,e,n){if(!e.isNodeCoordinate()){var o=e.getNodeId(),r=t.get(o);r.isText()||(console.warn("Selecting a non-textish node partially is not supported. Select the full node."),e.path=[o],e.offset=n?0:1)}}function P(t,e,n,o){var r=new XMLHttpRequest;r.open(t,e,!0),r.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r.onload=function(){if(!(r.status>=200&&r.status<400))return o(new Error("Request failed. Returned status: "+r.status));var t=r.responseText;T(t)&&(t=JSON.parse(t)),o(null,t)},n?r.send(JSON.stringify(n)):r.send()}function T(t){try{JSON.parse(t)}catch(t){return!1}return!0}function j(t,e,n){if(n){var o=t.getIndex("annotations"),r=o.get(e.path);va(r,function(o){var r=e.offset,i=o.startOffset,s=o.endOffset,a=i,p=s;(r<i||r===i)&&(a+=n),(r<s||r===s&&!o.isInline())&&(p+=n),a!==i&&t.set([o.id,"startOffset"],a),p!==s&&t.set([o.id,"endOffset"],p)}),o=t.getIndex("container-annotation-anchors");var i=o.get(e.path);va(i,function(o){var r=e.offset,i=o.offset,s=!1;if((r<i||r===i&&!e.after)&&(i+=n,s=!0),s){var a=o.isStart?"startOffset":"endOffset";t.set([o.id,a],i)}})}}function D(t,e,n,o){if(n!==o){var r=t.getIndex("annotations"),i=r.get(e),s=o-n;va(i,function(e){var r=n,i=o,a=e.startOffset,p=e.endOffset,c=a,u=p;i<=a?(c-=s,u-=s,t.set([e.id,"startOffset"],c),t.set([e.id,"endOffset"],u)):(r<=a&&(c=a-Math.min(i-r,a-r)),r<=p&&(u=p-Math.min(i-r,p-r)),a!==p&&c===u?t.delete(e.id):(a!==c&&t.set([e.id,"startOffset"],c),p!==u&&t.set([e.id,"endOffset"],u)))}),r=t.getIndex("container-annotation-anchors");var a=r.get(e),p=[];va(a,function(e){p.push(e.id);var r=n,i=o,a=e.offset,c=!1;if(i<=a)a-=s,c=!0;else if(r<=a){var u=a-Math.min(i-r,a-r);a!==u&&(a=u,c=!0)}if(c){var h=e.isStart?"startOffset":"endOffset";t.set([e.id,h],a)}}),va(el(p),function(e){var n=t.get(e),o=n.getSelection();o.isCollapsed()&&t.delete(e)})}}function A(t,e,n,o,r){var i=t.getIndex("annotations"),s=i.get(e,n);va(s,function(e){var i,s,a=n>e.startOffset&&n<e.endOffset,p=e.startOffset,c=e.endOffset;if(a){if(e.canSplit()){var u=e.toJSON();u.id=h(e.type+"_"),u.startOffset=r,u.endOffset=r+e.endOffset-n,u.path=o,t.create(u)}i=e.startOffset,s=n,s===i?t.delete(e.id):(i!==p&&t.set([e.id,"startOffset"],i),s!==c&&t.set([e.id,"endOffset"],s))}else e.startOffset>=n&&(i=r+e.startOffset-n,s=r+e.endOffset-n,t.set([e.id,"path"],o),t.set([e.id,"startOffset"],i),t.set([e.id,"endOffset"],s))}),i=t.getIndex("container-annotation-anchors");var a=i.get(e),p=[];va(a,function(e){p.push(e.id);var i=e.offset;if(n<=i){var s=e.isStart?"startPath":"endPath",a=e.isStart?"startOffset":"endOffset";t.set([e.id,s],o),t.set([e.id,a],r+e.offset-n)}}),va(el(p),function(e){var n=t.get(e),o=n.getSelection();o.isCollapsed()&&t.delete(e)})}function M(t,e){e.type&&(t.type=e.type);var n=k(e);t.schema=R(t,n),t.defaultProps=z(t)}function k(t){var e={};return Bh(t,function(t,n){"type"!==n&&((bn(t)||mn(t))&&(t={type:t}),t=L(t),t.name=n,e[n]=t)}),e}function L(t){var e=t;return mn(t.type)&&"array"!==t[0]?t.type=["array",t.type[0]]:"text"===t.type&&(e={type:"string",default:""}),e}function R(t,e){for(var n=[e],o=t;o;){var r=Object.getPrototypeOf(o.prototype);if(!r)break;o=r.constructor,o&&o.schema&&n.unshift(o.schema)}return n.unshift({}),Object.assign.apply(null,n)}function z(t){var e=t.unfoldedSchema,n={};return Bh(e,function(t,e){t.hasOwnProperty("default")&&(n[e]=t.default)}),n}function F(t,e){var n;if(n=mn(t.type)?"array":t.type,null===e){if(t.notNull)throw new Error("Value for property "+t.name+" is null.");return e}if(void 0===e)throw new Error("Value for property "+t.name+" is undefined.");if("string"===n&&!bn(e)||"boolean"===n&&!rl(e)||"number"===n&&!eu(e)||"array"===n&&!mn(e)||"id"===n&&!bn(e)||"object"===n&&!Xe(e))throw new Error("Illegal value type for property "+t.name+": expected "+n+", was "+typeof e);return e}function B(t){return/([a-zA-Z_0-9]+):changed/.exec(t)}function H(t){var e=[],n=[];Bh(t,function(t){var o=!!t.isAnchor&&t.isAnchor();if(o)e.push({mode:bl,pos:t.offset,id:t.id,level:wl.ALWAYS_ON_TOP,type:"anchor",node:t,counter:-1,length:0});else{var r=wl.NORMAL,i=!!t.isInline&&t.isInline();i?r=Number.MAX_VALUE:t.constructor.hasOwnProperty("fragmentation")?r=t.constructor.fragmentation:t.hasOwnProperty("fragmentationHint")&&(r=t.fragmentationHint);var s=Math.min(t.startOffset,t.endOffset),a=Math.max(t.startOffset,t.endOffset),p={pos:s,mode:vl,level:r,id:t.id,type:t.type,node:t,length:0,counter:-1};e.push(p),n.push({pos:a,mode:_l,level:r,id:t.id,type:t.type,node:t,opener:p})}}),e.sort(U);for(var o=e.length-1;o>=0;o--)e[o].idx=o;n.sort(V);for(var r=new Array(e.length+n.length),i=0,s=0,a=0,p=e[s],c=n[a];p||c;)p&&c?c.pos<=p.pos&&c.opener!==p?(r[i]=c,a++):(r[i]=p,s++):p?(r[i]=p,s++):c&&(r[i]=c,a++),p=e[s],c=n[a],i++;return r}function U(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===e.mode){if(t.level<e.level)return-1;if(t.level>e.level)return 1}return 0}function V(t,e){return t.pos<e.pos?-1:t.pos>e.pos?1:t.pos===t.opener.pos&&e.pos===e.opener.pos?t.opener.idx<e.opener.idx?-1:1:t.opener.idx>e.opener.idx?-1:t.opener.idx<e.opener.idx?1:0}function q(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function J(){var t={};return function(e){t.hasOwnProperty(e)||(t[e]=1);var n=[e,"-",t[e]++].join("");return n}}function $(t,e){return function(n){e(n),t._el.removeEventListener(t)}}function W(t,e,n){this.owner=t,this.target=e,this.originalEvent=n}function K(t,e){var n=window.Element.prototype,o=n.matches||n.matchesSelector||n.msMatchesSelector||n.webkitMatchesSelector;return o.call(t,e)}function X(t,e){var n=e.nodeId;if(!n)throw new Error("Parameter `nodeId` is mandatory.");var o=t.get(n);if(!o)throw new Error("Invalid 'nodeId'. Node does not exist.");var r,i,s=e.containerId,a=t.getIndex("annotations").get(n);for(i=0;i<a.length;i++)t.delete(a[i].id);var p=t.getIndex("container-annotation-anchors").get(n);for(i=0;i<p.length;i++){var c=p[i];if(r=t.get(c.containerId),t.get(c.id)){var u=r.getPosition(c.path[0]),h=void 0,f=void 0;if(c.isStart)if(u<r.getLength()-1){var l=r.getChildAt(u+1);h=l.isText()?[l.id,"content"]:[l.id],t.set([c.id,"startPath"],h),t.set([c.id,"startOffset"],0)}else t.delete(c.id);else if(u>0){var d=r.getChildAt(u-1);d.isText()?(h=[d.id,"content"],f=t.get(h).length):(h=[d.id],f=1),t.set([c.id,"endPath"],h),t.set([c.id,"endOffset"],f)}else t.delete(c.id)}}return s&&(r=t.get(s),r.hide(n)),o.hasChildren()&&o.getChildren().forEach(function(e){X(t,{nodeId:e.id})}),t.delete(n),e}function G(t,e){var n=e.firstNodeId,o=e.secondNodeId,r=t.get(n),i=t.get(o),s=Q(e.editingBehavior,r,i);return s?s(t,Sp({},e,{containerId:e.containerId,first:r,second:i})):e}function Q(t,e,n){if(t){if(t.canMerge(e.type,n.type))return t.getMerger(e.type,n.type);if(e.isInstanceOf("text")&&t.canMerge("textish",n.type))return t.getMerger("textish",n.type);if(n.isInstanceOf("text")&&t.canMerge(e.type,"textish"))return t.getMerger(e.type,"textish")}return e.isInstanceOf("text")&&n.isInstanceOf("text")?Y:(console.info("No merge behavior defined for %s <- %s",e.type,n.type),null)}function Y(t,e){var n,o=e.containerId,r=e.first,i=e.second,s=t.get(o),a=r.getTextPath(),p=r.getText(),c=p.length,u=i.getTextPath(),h=i.getText();return 0===c?(s.hide(a[0]),t.delete(a[0]),n=t.createSelection({type:"property",path:u,startOffset:0})):(t.update(a,{insert:{offset:c,value:h}}),nl.transferAnnotations(t,u,0,a,c),s.hide(u[0]),t.delete(u[0]),n=t.createSelection({type:"property",path:a,startOffset:c})),e.selection=n,e}function Z(t,e){var n=e.op;if(!n.isUpdate())throw new Error("Only text updates are supported.");var o=n.diff;return o.isInsert()?tt(t,e):o.isDelete()?et(t,e):e}function tt(t,e){var n=e.op,o=n.diff;return nl.insertedText(t,new ph(n.path,o.pos),o.getLength(),e.ignoredAnnotations),e}function et(t,e){var n=e.op,o=n.diff;return nl.deletedText(t,n.path,o.pos,o.pos+o.getLength(),e.replaceTextSupport),e}function nt(t,e){var n=e.selection;return n.isCollapsed()||(n.isPropertySelection()?e=ot(t,e):n.isContainerSelection()?e=rt(t,e):n.isNodeSelection()&&(e=it(t,e))),e}function ot(t,e){var n=e.selection,o=n.path,r=n.startOffset,i=n.endOffset,s=t.update(o,{delete:{start:r,end:i}});return Z(t,{op:s}),e.selection=t.createSelection(o,r),e}function rt(t,e){var n=e.selection,o=n.containerId,r=t.get(o),i=r.getPosition(n.start.path[0]),s=n.getFragments();if(0===s.length)return e;for(var a,p,c=null,u=0;u<s.length;u++){var f=s[u];if(f.isPropertyFragment())if(f.isPartial())c||(c={path:f.path,offset:f.startOffset}),ot(t,{selection:f});else{var l=f.path[0];X(t,Sp({},e,{nodeId:l,containerId:r.id}))}else f.isNodeFragment()&&X(t,Sp({},e,{nodeId:f.nodeId,containerId:r.id}))}return c?e.selection=t.createSelection(c.path,c.offset):(p=t.getSchema().getDefaultTextType(),a={type:p,id:h(p),content:""},t.create(a),r.show(a.id,i),e.selection=t.createSelection([a.id,"content"],0)),s.length>1&&s[0].isPartial()&&pu(s).isPartial()&&dd(t,Sp({},e,{selection:e.selection,containerId:o,path:n.endPath,direction:"left"})),0===r.nodes.length&&(p=t.getSchema().getDefaultTextType(),a={type:p,id:h(p),content:""},t.create(a),r.show(a.id,0),e.selection=t.createSelection([a.id,"content"],0)),e}function it(t,e){var n=e.selection;if(!n||!n.isNodeSelection())throw new Error("'sel' must be a NodeSelection");if(!n.isFull())return e;var o=n.getNodeId(),r=n.containerId,i=t.get(r),s=i.getPosition(o);X(t,{nodeId:o,containerId:r});var a=t.create({type:t.getSchema().getDefaultTextType(),content:""});return i.show(a.id,s),{selection:t.createSelection([a.id,"content"],0)}}function st(t,e){if(!e.selection)throw new Error("Argument 'selection' is mandatory.");if(!e.containerId)throw new Error("Argument 'containerId' is mandatory.");e.selection.isCollapsed()||(e=nt(t,e));var n=e.selection;if(n.isNodeSelection())return n.isFull()?e:pt(t,e);var o=t.get(n.start.path[0]),r=e.editingBehavior;if(r&&r.canBreak(o.type)){var i=r.getBreaker(o.type);return i.call(i,t,e)}return o.isText()?at(t,e):(console.info("Breaking is not supported for node type %s.",o.type),e)}function at(t,e){var n=e.selection,o=e.containerId;if(!n.isPropertySelection())throw new Error("Expected property selection.");var r,i=n.path,s=n.startOffset,a=t.get(i[0]),p=a.getText(),c=t.get(o),u=c.getPosition(a.id),f=h(a.type),l=[f,"content"];return 0===s?(r=t.create({id:f,type:a.type,content:""}),c.show(f,u),n=t.createSelection(i,0)):(r=a.toJSON(),r.id=f,r.content=p.substring(s),s===p.length&&(r.type=t.getSchema().getDefaultTextType()),t.create(r),s<p.length&&(nl.transferAnnotations(t,i,s,[f,"content"],0),t.update(i,{delete:{start:s,end:p.length}})),c.show(f,u+1),n=t.createSelection(l,0)),e.selection=n,e.node=r,e}function pt(t,e){var n=e.selection,o=e.containerId;if(!n)throw new Error("Illegal argument: selection is mandatory.");if(!o)throw new Error("Illegal argument: containerId is mandatory.");if(!n.isNodeSelection())throw new Error("Illegal argument: selection should be a NodeSelection");var r,i=t.get(o),s=n.getNodeId(),a=i.getPosition(s),p=t.getSchema().getDefaultTextType(),c=t.create({type:p,content:""});return n.isBefore()?(i.show(c.id,a),r=n):(i.show(c.id,a+1),r=t.createSelection([c.id,"content"],0)),e.selection=r,e.node=c,e}function ct(t,e){var n=e.selection;if(!n||!n._isSelection)throw new Error("'selection' is mandatory.");return n.isNull()||n.isCollapsed()?e.doc=null:n.isPropertySelection()?e.doc=ut(t,n):n.isContainerSelection()?e.doc=ht(t,n):n.isNodeSelection()?e.doc=ft(t,n):(console.error("Copy is not yet supported for selection type."),e.doc=null),e}function ut(t,e){var n=e.start.path,o=e.start.offset,r=e.end.offset,i=t.get(n),s=t.createSnippet(),a=s.getContainer();s.create({type:t.schema.getDefaultTextType(),id:df.TEXT_SNIPPET_ID,content:i.substring(o,r)}),a.show(df.TEXT_SNIPPET_ID);var p=t.getIndex("annotations").get(n,o,r);return Bh(p,function(t){var e=Zc(t.toJSON());e.path=[df.TEXT_SNIPPET_ID,"content"],e.startOffset=Math.max(o,t.startOffset)-o,e.endOffset=Math.min(r,t.endOffset)-o,s.create(e)}),s}function ht(t,e){var n=t.get(e.containerId),o=t.createSnippet(),r=o.getContainer(),i=e.getFragments();if(0===i.length)return o;for(var s={},a=0;a<i.length;a++){var p=i[a],c=p.getNodeId(),u=t.get(c);s[c]||(lt(o,u,n,s),r.show(c))}var h,f,l,d=i[0],y=pu(i);return d.isPropertyFragment()&&(h=d.path,f=d.startOffset,l=t.get(h),o.update(h,{delete:{start:0,end:f}}),nl.deletedText(o,h,0,f)),y.isPropertyFragment()&&(h=y.path,f=y.endOffset,l=t.get(h),o.update(h,{delete:{start:f,end:l.length}}),nl.deletedText(o,h,f,l.length)),o}function ft(t,e){var n=t.get(e.containerId),o=t.createSnippet(),r=o.getContainer(),i=e.getNodeId(),s=t.get(i);return lt(o,s,n,{}),r.show(s.id),o}function lt(t,e,n,o){if(e.hasChildren()){var r=e.getChildren();r.forEach(function(e){lt(t,e,n,o)})}o[e.id]=t.create(e.toJSON());var i=t.getIndex("annotations"),s=i.get([e.id]);Bh(s,function(e){t.create(Zc(e.toJSON()))})}function dt(t,e){var n=e.selection;if(!n)throw new Error("selection is required.");var o=e.node;if(!o)throw new Error("node is required");if(!n.isPropertySelection()&&!n.isContainerSelection()||n.isCollapsed())throw new Error("Invalid selection for createAnnotation");if(n.isContainerSelection()&&e.splitContainerSelections)return yt(t,e);if(uf.isContainerAnnotation(t,o.type))o.startPath=n.startPath,o.endPath=n.endPath,o.containerId=n.containerId;else{if(!n.isPropertySelection())throw new Error("Illegal state: can not apply ContainerSelection");o.path=n.path}return o.startOffset=n.startOffset,o.endOffset=n.endOffset,e.result=t.create(o),e}function yt(t,e){var n,o=e.selection,r=e.node;o.isPropertySelection()?n=[]:o.isContainerSelection()&&(n=o.splitIntoPropertySelections());for(var i=0;i<n.length;i++){var s={id:h(r.type)};Sp(s,r),s.path=n[i].getPath(),s.startOffset=n[i].startOffset,s.endOffset=n[i].endOffset,t.create(s)}}function gt(t,e){var n=e.selection;if(!n.isPropertySelection())throw new Error("Expecting a property selection.");var o,r,i=e.direction,s=e.containerId,a=n.path,p=t.get(a);if(0===n.startOffset&&"left"===i||n.startOffset===p.length&&"right"===i){if(s){var c=dd(t,Sp({},e,{selection:n,containerId:s,path:n.path,direction:i}));e.selection=c.selection}}else{o="left"===i?n.startOffset-1:n.startOffset,r=o+1;var u=t.update(n.path,{delete:{start:o,end:r}});Z(t,{op:u}),e.selection=t.createSelection(n.path,o)}return e}function mt(t,e){var n=e.selection;if(!n.isNodeSelection())throw new Error("Expecting a node selection.");var o,r,i=e.direction,s=e.containerId,a=n.getNodeId(),p=t.get(s);if(n.isFull()||n.isBefore()&&"right"===i||n.isAfter()&&"left"===i)return X(t,{nodeId:a,containerId:s});if(n.isBefore()&&"left"===i){if(o=p.getPosition(a),o>0){var c=p.getNodeAt(o-1);c.isText()&&(r=c.getText(),0===r.length?X(t,{nodeId:c.id,containerId:s}):n=t.createSelection(c.getTextPath(),r.length))}}else if(n.isAfter()&&"right"===i&&(o=p.getPosition(a),o<p.getLength()-1)){var u=p.getNodeAt(o+1);u.isText()&&u.isEmpty()&&X(t,{nodeId:u.id,containerId:s})}return{selection:n}}function vt(t,e){var n=e.selection,o=e.anno;if(!n||!n._isSelection)throw new Error('Argument "selection" is required.');if(!o||!o._isAnnotation)throw new Error('Argument "anno" is required.');var r=o.getSelection(),i=r.expand(n);return o.updateRange(t,i),e.result=o,e}function _t(t,e){var n=e.annos;if(!mn(n)||n.length<2)throw new Error("fuseAnnotation(): at least two annotations are necessary.");var o,r;return n.forEach(function(t,e){if(0===e)o=t.getSelection(),r=t.type;else{if(t.type!==r)throw new Error("fuseAnnotation(): all annotations must be of the same type.");o=o.expand(t.getSelection())}}),Bh(n,function(e){t.delete(e.id)}),e.selection=o,e.node={type:r},dt(t,e)}function bt(t,e){return wt(t,e)}function wt(t,e){var n=nt(t,Sp({},e,{direction:"right"})),o=n.selection;if(!o.isPropertySelection())throw new Error("Invalid state.");var r=e.text,i=t.update(o.path,{insert:{offset:o.startOffset,value:r}});return Z(t,{op:i}),e.selection=t.createSelection(o.path,o.startOffset+r.length),e}function Ct(t,e){var n=gd(t,{selection:e.selection,text:"\ufeff"}),o=t.createSelection({type:"property",path:n.selection.path,startOffset:n.selection.startOffset-1,endOffset:n.selection.endOffset});return e.node=e.node,e.selection=o,e=dt(t,e)}function St(t,e){var n=e.selection,o=e.node;if(!e.containerId)throw new Error("containerId is mandatory");if(!e.selection)throw new Error("selection is mandatory");if(!e.node)throw new Error("node is mandatory");var r,i=e.containerId,s=t.get(i);n.isCollapsed()||(r=nt(t,e),n=r.selection),r=st(t,e),n=r.selection,o.id||(o.id=h(o.type)),t.get(o.id)||(o=t.create(o)),o=t.get(o.id);var a=s.getPosition(n.start.getNodeId());return s.show(o.id,a),o.isText()?e.selection=t.createSelection({type:"property",path:[o.id,"content"],startOffset:0}):e.selection=t.createSelection({type:"container",containerId:i,startPath:[o.id],startOffset:0,endPath:[o.id],endOffset:1}),e}function xt(t,e){var n,o=t.getSchema().getDefaultTextType(),r=e.text.split(/\s*\n\s*\n/),i=t.newInstance(),s=i.create({type:"container",id:df.SNIPPET_ID,nodes:[]});if(1===r.length)n=i.create({id:df.TEXT_SNIPPET_ID,type:o,content:r[0]}),s.show(n.id);else for(var a=0;a<r.length;a++)n=i.create({id:h(o),type:o,content:r[a]}),s.show(n.id);return i}function Ot(t,e){var n=e.doc,o=e.selection,r=n.get(df.SNIPPET_ID).nodes,i=[r[0],"content"],s=n.get(i),a=n.getIndex("annotations").get(i),p=o.start.path,c=o.start.offset;return t.update(p,{insert:{offset:c,value:s}}),nl.insertedText(t,o.start,s.length),o=t.createSelection({type:"property",path:o.start.path,startOffset:o.start.offset+s.length}),Bh(a,function(e){var n=e.toJSON();n.path=p.slice(0),n.startOffset+=c,n.endOffset+=c,t.get(n.id)&&(n.id=h(n.type)),t.create(n)}),e.selection=o,e}function Et(t,e){var n,o=e.doc,r=e.containerId,i=e.selection,s=t.get(r),a=i.start.path,p=s.getPosition(i.start.getNodeId()),c=t.get(a);if(c.length===i.start.offset)n=p+1;else{var u=st(t,e);i=u.selection,n=p+1}n<0&&console.error("Could not find insertion position in ContainerNode.");for(var f=o.get(df.SNIPPET_ID).nodes,l=o.getIndex("annotations"),d=[],y=0;y<f.length;y++){var g=f[y],m=Nt(t,o.get(g));s.show(m.id,n++),d.push(m);for(var v=l.get(g),_=0;_<v.length;_++){var b=v[_].toJSON();m.id!==g&&(b.path[0]=m.id),t.get(b.id)&&(b.id=h(b.type)),t.create(b)}}if(0===d.length)return e;var w=d[0],C=pu(d);return e.selection=t.createSelection({type:"container",containerId:r,startPath:[w.id],startOffset:0,endPath:[C.id],endOffset:1}),e}function Nt(t,e){var n=e.id,o=e.toJSON();if(t.get(n)&&(o.id=h(e.type)),e.hasChildren())for(var r=e.getChildren(),i=o[e.getChildrenProperty()],s=0;s<r.length;s++){var a=Nt(t,r[s]);i[s]=a.id}return t.create(o)}function It(t,e){var n=e.selection;if(!n.isPropertySelection())return console.error("Selection must be a PropertySelection."),e;var o=n.path,r=o[0],i=e.data,s=t.get(r);if(!s.isInstanceOf("text"))return console.warn("Trying to use switchTextType on a non text node. Skipping."),e;var a=Sp({id:h(i.type),type:i.type,content:s.content},i),p=[a.id,"content"];a=t.create(a),nl.transferAnnotations(t,o,0,p,0);var c=t.get(e.containerId),u=c.getPosition(r);return u>=0&&(c.hide(r),c.show(a.id,u)),X(t,{nodeId:s.id}),e.selection=t.createSelection(p,n.startOffset,n.endOffset),e.node=a,e}function Pt(t,e){var n=e.selection,o=e.anno;if(!n||!n._isSelection)throw new Error('Argument "selection" is required.');if(!o||!o._isAnnotation)throw new Error('Argument "anno" is required.');var r=o.getSelection(),i=r.truncateWith(n);return o.updateRange(t,i),e.result=o,e}function Tt(t,e){var n=e._comp;console.assert(!n,"Component instance should not exist when this method is used.");var o=e.parent._comp;return o||(o=Tt(t,e.parent)),e._isVirtualComponent?(console.assert(o,"A Component should have a parent."),n=new e.ComponentClass(o,e.props),n.__htmlConfig__=e._copyHTMLConfig()):e._isVirtualHTMLElement?n=new Ny.Element(o,e):e._isVirtualTextNode&&(n=new Ny.TextNode(o,e)),e._ref&&(n._ref=e._ref),e._owner&&(n._owner=e._owner._comp),e._comp=n,n}function jt(t,e,n){if(t.isCaptured(e))return e;var o=e._comp;if(o||(o=Tt(t,e),t.setNew(e)),e._isVirtualComponent){var r;if(n?r=!0:(r=!o.el||o.shouldRerender(e.props),o.__htmlConfig__=e._copyHTMLConfig(),t.setOldProps(e,o.props),t.setOldState(e,o.state),o._setProps(e.props),t.isNew(e)||t.setUpdated(e)),r){var i=new xy(e),s=o.render(i.$$);if(!s||!s._isVirtualHTMLElement)throw new Error("Component.render must return VirtualHTMLElement");if(o.__htmlConfig__&&s._mergeHTMLConfig(o.__htmlConfig__),s._comp=o,e._content=s,!t.isNew(e)&&o.isMounted()&&t.setUpdated(e),Ft(t,o,s),Hd.DEBUG_RENDERING){for(var a=s.children.slice(0);a.length;){var p=a.shift();t.isCaptured(p)||p._isVirtualComponent||(p._comp||Tt(t,p),p._isVirtualHTMLElement&&p.children.length>0&&(a=a.concat(p.children)),t.setCaptured(p))}t.setCaptured(s);for(var c=new Sy(t,i);c.hasPendingCaptures();)c.reset(),o.render(c.$$)}else jt(t,e._content)}else t.setSkipped(e)}else if(e._isVirtualHTMLElement)for(var u=0;u<e.children.length;u++)jt(t,e.children[u]);return t.setCaptured(e),e}function Dt(t,e){if(!t.isSkipped(e)){console.assert(t.isCaptured(e),"VirtualElement must be captured before rendering");var n=e._comp;if(console.assert(n&&n._isComponent,"A captured VirtualElement must have a component instance attached."),e._isVirtualComponent)return void Dt(t,e._content);if(n.el||(n.el=Ut(e),n.el._comp=n),Vt(n,e),e._isVirtualHTMLElement&&!e.hasInnerHTML()){var o,r,i,s=e.children,a=0,p=0,c=[];for(n.el.getChildNodes().forEach(function(e){var o=e._comp;!o||t.isRelocated(o)?n.el.removeChild(e):c.push(o)});a<c.length||p<s.length;){do o=c[a++];while(o&&t.isDetached(o));if(r=s[p++],o&&!r){for(;o;)Rt(t,n,o),o=c[a++];break}o&&o.el.isTextNode()&&r&&r._isVirtualTextNode&&o.el.textContent===r.text||(t.isRendered(r)||Dt(t,r),i=r._comp,t.isRelocated(i)&&i._setParent(n),console.assert(i,"Component instance should now be available."),!r||o?t.isMapped(r)?i===o||(t.setDetached(o),Rt(t,n,o),p--):t.isMapped(o)?(Lt(t,n,i,o),a--):kt(t,n,o,i):Mt(t,n,i))}}var u={},h={};e._context&&(Bh(e._context.refs,function(t,e){u[e]=t._comp}),Bh(e._context.foreignRefs,function(t,e){h[e]=t._comp})),n.refs=u,n.__foreignRefs__=h,t.setRendered(e)}}function At(t,e){e._isVirtualComponent?(t.isSkipped(e)||e._content.children.forEach(At.bind(null,t)),t.isUpdated(e)&&e._comp.didUpdate(t.getOldProps(e),t.getOldState(e))):e._isVirtualHTMLElement&&e.children.forEach(At.bind(null,t))}function Mt(t,e,n){e.el.appendChild(n.el),zt(t,e,n)}function kt(t,e,n,o){e.el.replaceChild(n.el,o.el),t.isDetached(n)||n.triggerDispose(),zt(t,e,o)}function Lt(t,e,n,o){e.el.insertBefore(n.el,o.el),zt(t,e,n)}function Rt(t,e,n){e.el.removeChild(n.el),t.isDetached(n)||n.triggerDispose()}function zt(t,e,n){t.isDetached(n)||!e.isMounted()||n.isMounted()||n.triggerDidMount(!0)}function Ft(t,e,n){var o={},r={};n._context&&(o=n._context.refs,r=n._context.foreignRefs);var i=e.refs,s=e.__foreignRefs__;Bh(o,function(e,n){var o=i[n];o&&Bt(t,o,e)}),Bh(r,function(e,n){var o=s[n];o&&Bt(t,o,e)})}function Bt(t,e,n){if(!e&&!n)return!0;if(!e||!n)return!1;if(t.isMapped(n)||t.isMapped(e))return n._comp===e;if(n._comp)return n._comp===e&&(t.setMapped(n),t.setMapped(e),!0);if(!Ht(e,n))return!1;n._comp=e,t.setMapped(n),t.setMapped(e);var o,r=e.getParent();if(n.parent)o=Bt(t,r,n.parent);else if(n._preliminaryParent){for(;r&&r._isElementComponent;)r=r.getParent();o=Bt(t,r,n._preliminaryParent)}return o||(t.setRelocated(n),t.setRelocated(e)),o}function Ht(t,e){return t._isElementComponent&&e._isVirtualHTMLElement||t._isComponent&&e._isVirtualComponent&&t.constructor===e.ComponentClass||t._isTextNodeComponent&&e._isVirtualTextNode}function Ut(t){var e;return e=t._isVirtualTextNode?nd.createTextNode(t.text):nd.createElement(t.tagName)}function Vt(t,e){if(t._isTextNodeComponent)return void t.setTextContent(e.text);var n=t.el;console.assert(n,"Component's element should exist at this point.");var o=n.getTagName();if(e.tagName.toLowerCase()!==o&&n.setTagName(e.tagName),qt({oldHash:n.getAttributes(),newHash:e.getAttributes(),update:function(t,e){n.setAttribute(t,e)},remove:function(t){n.removeAttribute(t)}}),qt({oldHash:n.htmlProps,newHash:e.htmlProps,update:function(t,e){n.setProperty(t,e)},remove:function(t){n.removeProperty(t)}}),Jt({el:n,oldListeners:n.getEventListeners(),newListeners:e.getEventListeners()}),e.hasInnerHTML()){if(n._hasInnerHTML){var r=n.getInnerHTML(),i=e.getInnerHTML();r!==i&&n.setInnerHTML(i)}else n.empty(),n.setInnerHTML(e.getInnerHTML());n._hasInnerHTML=!0}}function qt(t){var e,n=t.newHash,o=t.oldHash||{},r={},i=t.update,s=t.remove;for(e in n)if(n.hasOwnProperty(e)){var a=o[e],p=n[e];r[e]=!0,a!==p&&i(e,p)}for(e in o)o.hasOwnProperty(e)&&!r[e]&&s(e)}function Jt(t){var e=t.el,n=t.newListeners||[];e.removeAllEventListeners();for(var o=0;o<n.length;o++)e.addEventListener(n[o])}function $t(t){var e=new my.Component(t.constructor);return e._comp=t,t.__htmlConfig__&&e._mergeHTMLConfig(t.__htmlConfig__),e}function Wt(t){t.triggerDispose(),t._owner&&t._ref&&(console.assert(t._owner.refs[t._ref]===t,"Owner's ref should point to this child instance."),delete t._owner.refs[t._ref])}function Kt(t,e){t.isMounted()&&e.triggerDidMount(!0),e._owner&&e._ref&&(e._owner.refs[e._ref]=e)}function Xt(t){if(t)return t._comp}function Gt(t){return console.assert(t._comp,"Expecting a back-link to the component instance."),
Xt(t)}function Qt(t){return t}function Yt(t){var e={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:Number.NaN,height:Number.NaN};return va(t,function(t){t.left<e.left&&(e.left=t.left),t.top<e.top&&(e.top=t.top),t.left+t.width>e.right&&(e.right=t.left+t.width),t.top+t.height>e.bottom&&(e.bottom=t.top+t.height)}),e.width=e.right-e.left,e.height=e.bottom-e.top,e}function Zt(t,e){var n=e.getBoundingClientRect(),o=Yt(t.getClientRects()),r=o.left-n.left,i=o.top-n.top;return{left:r,top:i,right:n.width-r-o.width,bottom:n.height-i-o.height,width:o.width,height:o.height}}function te(t,e){void 0===t.length&&(t=[t]);var n=Aa(t,function(t){return Zt(t,e)}),o=Yt(n),r=e.getBoundingClientRect();return{left:o.left,top:o.top,right:r.width-o.left-o.width,bottom:r.height-o.top-o.height,width:o.width,height:o.height}}function ee(t){var e=t._getSurfaceParent();return e?e.getId()+"/"+t.name:t.name}function ne(t,e,n){for(var o={el:null,path:null,node:e,offset:n};e&&e!==t;){if(e.isElementNode()){var r=e.getAttribute("data-path");if(r)return o.el=e,o.path=r.split("."),o;e.getAttribute("data-inline")&&(o.node=e,n>0&&(o.offset=1))}e=e.getParent()}return null}function oe(t,e){var n,o,r=e;if(n=t.getParent(),t.isTextNode())if(t===n.firstChild){var i=n.getAttribute("data-path"),s=n.getAttribute("data-offset");r=i?e:s?parseInt(s,10)+e:oe(n,0)+e}else o=n.getChildIndex(t),r=oe(n,o)+e;else{if(!t.isElementNode())return null;var a=t.getAttribute("data-path"),p=t.getAttribute("data-offset");a?r=re(t,e):p?(o=n.getChildIndex(t),r=parseInt(p,10)+re(t,e)):(o=n.getChildIndex(t),r=oe(n,o)+re(t,e))}return r}function re(t,e){var n=0;if(t.getAttribute("data-inline"))return 0===e?0:1;var o=t.getChildCount();1===arguments.length&&(e=o),e=Math.min(o,e);for(var r=0,i=t.getFirstChild();r<e;i=i.getNextSibling(),r++)if(i.isTextNode())n+=i.getTextContent().length;else if(i.isElementNode()){var s=i.getAttribute("data-length");n+=i.getAttribute("data-inline")?1:s?parseInt(s,10):re(i)}return n}function ie(t){return String(Math.floor(100*t*100)/100)+" %"}function se(t){var e=t.dataTransfer;if(e)return{types:e.types,items:Array.prototype.slice.call(e.items),files:Array.prototype.slice.call(e.files)}}function ae(t){var e={element:nd.wrapNativeElement(t.target)},n=Ny.getComponentFromNativeElement(t.target);if(n=pe(n)){if(e.comp=n,e._isSurface?e.surface=n:n.context.surface&&(e.surface=n.context.surface),e.surface){var o=e.surface.getSelectionFromEvent(t);o&&(e.selection=o)}var r=n.props.node;r&&(e.node=r),n._isTextPropertyComponent&&(e.path=n.props.path)}return e}function pe(t){return t._isTextNodeComponent||t._isElementComponent?pe(t.getParent()):t}function ce(t){if(t._isDOMElement||(t=nd.wrapNativeElement(t)),t.isElementNode()){var e=t.getAttribute("data-path");return e.split(".")}throw new Error("Can't get path from element:"+t.outerHTML)}function ue(t,e,n,o){if(n){var r=t;t=e,e=r}return new gh(t,e,n,o)}function he(t,e){return new gh(new ph([t],0),new ph([t],1),(!1),e)}function fe(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}function le(t,e){if(!t._isDocument||!Ye(e))throw new Error("Illegal arguments");var n=new bf(t),o=n.transaction(e);return[o.toJSON()]}function de(t,e){var n=e.path;if(!mn(n))throw new Error("args.path is mandatory");var o=e.pos;if(!eu(o))throw new Error("args.pos is mandatory");var r=e.text;if(!bn(r))throw new Error("args.text is mandatory");var i=t.createSelection({type:"property",path:n,startOffset:o,endOffset:o});gd(t,{selection:i,text:r||"$$$"})}function ye(t){var e=new Wv;return t&&t(e),e}function ge(){return{createDocument:function(){return ye()},createChangeset:function(){var t=ye();return le(t)}}}Object.defineProperty(n,"__esModule",{value:!0});var me=o(t("substance-cheerio")),ve=function(t){function e(n,o){t.call(this,n,o),this.name=n,this.message=o.message,this.info=o.info,this.errorCode=o.errorCode,this.cause=o.cause,t.captureStackTrace&&t.captureStackTrace(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.inspect=function(){var t=[];return t.push(this.stack),this.info&&t.push(this.info+". "),this.cause&&(t.push("\nCaused by: "),this.cause.inspect?t.push(this.cause.inspect()):t.push(this.cause.toString())),t.join("")},e}(Error);ve.fromJSON=function(t){if(!t)return null;var e=new ve(t.name,{message:t.message,info:t.info,errorCode:t.errorCode,cause:ve.fromJSON(t.cause)});return e};var _e=function(t){this.config=t};_e.prototype.getChanges=function(t,e){var n=this._getChanges(t.documentId);if(t.sinceVersion||(t.sinceVersion=0),t.sinceVersion<0)return e(new ve("ChangeStore.ReadError",{message:'Illegal argument "sinceVersion":'+t.sinceVersion}));if(t.toVersion<0)return e(new ve("ChangeStore.ReadError",{message:'Illegal argument "toVersion":'+t.toVersion}));if(t.sinceVersion>=t.toVersion)return e(new ve("ChangeStore.ReadError",{message:'Illegal version arguments "sinceVersion":'+t.sinceVersion+', toVersion":'+t.toVersion}));var o,r=this._getVersion(t.documentId);0===t.sinceVersion?(o={version:r,changes:n.slice(0,t.toVersion)},e(null,o)):t.sinceVersion>0&&(o={version:r,changes:n.slice(t.sinceVersion,t.toVersion)},e(null,o))},_e.prototype.addChange=function(t,e){if(!t.documentId)return e(new ve("ChangeStore.CreateError",{message:"No documentId provided"}));if(!t.change)return e(new ve("ChangeStore.CreateError",{message:"No change provided"}));this._addChange(t.documentId,t.change);var n=this._getVersion(t.documentId);e(null,n)},_e.prototype.deleteChanges=function(t,e){var n=this._deleteChanges(t);e(null,n.length)},_e.prototype.getVersion=function(t,e){e(null,this._getVersion(t))},_e.prototype.seed=function(t,e){return this._changes=t,e&&e(null),this},_e.prototype._deleteChanges=function(t){var e=this._getChanges(t);return delete this._changes[t],e},_e.prototype._getVersion=function(t){var e=this._changes[t];return e?e.length:0},_e.prototype._getChanges=function(t){return this._changes[t]||[]},_e.prototype._addChange=function(t,e){this._changes[t]||(this._changes[t]=[]),this._changes[t].push(e)};var be="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:{},we=i(function(t){function e(t,e){for(var n=-1,o=t?t.length:0;++n<o&&e(t[n],n,t)!==!1;);return t}t.exports=e}),Ce=r(we),Se=Object.freeze({default:Ce}),xe=i(function(t){function e(t){return function(e,n,o){for(var r=-1,i=Object(e),s=o(e),a=s.length;a--;){var p=s[t?a:++r];if(n(i[p],p,i)===!1)break}return e}}t.exports=e}),Oe=r(xe),Ee=Object.freeze({default:Oe}),Ne=i(function(t){var e=r(Ee),n=e();t.exports=n}),Ie=r(Ne),Pe=Object.freeze({default:Ie}),Te=i(function(t){function e(t){return n(Object(t))}var n=Object.getPrototypeOf;t.exports=e}),je=r(Te),De=Object.freeze({default:je}),Ae=i(function(t){function e(t,e){return null!=t&&(i.call(t,e)||"object"==typeof t&&e in t&&null===n(t))}var n=r(De),o=Object.prototype,i=o.hasOwnProperty;t.exports=e}),Me=r(Ae),ke=Object.freeze({default:Me}),Le=i(function(t){function e(t){return n(Object(t))}var n=Object.keys;t.exports=e}),Re=r(Le),ze=Object.freeze({default:Re}),Fe=i(function(t){function e(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}t.exports=e}),Be=r(Fe),He=Object.freeze({default:Be}),Ue=i(function(t){function e(t){return function(e){return null==e?void 0:e[t]}}t.exports=e}),Ve=r(Ue),qe=Object.freeze({default:Ve}),Je=i(function(t){var e=r(qe),n=e("length");t.exports=n}),$e=r(Je),We=Object.freeze({default:$e}),Ke=i(function(t){function e(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=e}),Xe=r(Ke),Ge=Object.freeze({default:Xe}),Qe=i(function(t){function e(t){var e=n(t)?a.call(t):"";return e==o||e==i}var n=r(Ge),o="[object Function]",i="[object GeneratorFunction]",s=Object.prototype,a=s.toString;t.exports=e}),Ye=r(Qe),Ze=Object.freeze({default:Ye}),tn=i(function(t){function e(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}var n=9007199254740991;t.exports=e}),en=r(tn),nn=Object.freeze({default:en}),on=i(function(t){function e(t){return null!=t&&i(n(t))&&!o(t)}var n=r(We),o=r(Ze),i=r(nn);t.exports=e}),rn=r(on),sn=Object.freeze({default:rn}),an=i(function(t){function e(t){return!!t&&"object"==typeof t}t.exports=e}),pn=r(an),cn=Object.freeze({default:pn}),un=i(function(t){function e(t){return o(t)&&n(t)}var n=r(sn),o=r(cn);t.exports=e}),hn=r(un),fn=Object.freeze({default:hn}),ln=i(function(t){function e(t){return n(t)&&s.call(t,"callee")&&(!p.call(t,"callee")||a.call(t)==o)}var n=r(fn),o="[object Arguments]",i=Object.prototype,s=i.hasOwnProperty,a=i.toString,p=i.propertyIsEnumerable;t.exports=e}),dn=r(ln),yn=Object.freeze({default:dn}),gn=i(function(t){var e=Array.isArray;t.exports=e}),mn=r(gn),vn=Object.freeze({default:mn}),_n=i(function(t){function e(t){return"string"==typeof t||!n(t)&&o(t)&&a.call(t)==i}var n=r(vn),o=r(cn),i="[object String]",s=Object.prototype,a=s.toString;t.exports=e}),bn=r(_n),wn=Object.freeze({default:bn}),Cn=i(function(t){function e(t){var e=t?t.length:void 0;return s(e)&&(i(t)||a(t)||o(t))?n(e,String):null}var n=r(He),o=r(yn),i=r(vn),s=r(nn),a=r(wn);t.exports=e}),Sn=r(Cn),xn=Object.freeze({default:Sn}),On=i(function(t){function e(t,e){return e=null==e?n:e,!!e&&("number"==typeof t||o.test(t))&&t>-1&&t%1==0&&t<e}var n=9007199254740991,o=/^(?:0|[1-9]\d*)$/;t.exports=e}),En=r(On),Nn=Object.freeze({default:En}),In=i(function(t){function e(t){var e=t&&t.constructor,o="function"==typeof e&&e.prototype||n;return t===o}var n=Object.prototype;t.exports=e}),Pn=r(In),Tn=Object.freeze({default:Pn}),jn=i(function(t){function e(t){var e=p(t);if(!e&&!s(t))return o(t);var r=i(t),c=!!r,u=r||[],h=u.length;for(var f in t)!n(t,f)||c&&("length"==f||a(f,h))||e&&"constructor"==f||u.push(f);return u}var n=r(ke),o=r(ze),i=r(xn),s=r(sn),a=r(Nn),p=r(Tn);t.exports=e}),Dn=r(jn),An=Object.freeze({default:Dn}),Mn=i(function(t){function e(t,e){return t&&n(t,e,o)}var n=r(Pe),o=r(An);t.exports=e}),kn=r(Mn),Ln=Object.freeze({default:kn}),Rn=i(function(t){function e(t,e){return function(o,r){if(null==o)return o;if(!n(o))return t(o,r);for(var i=o.length,s=e?i:-1,a=Object(o);(e?s--:++s<i)&&r(a[s],s,a)!==!1;);return o}}var n=r(sn);t.exports=e}),zn=r(Rn),Fn=Object.freeze({default:zn}),Bn=i(function(t){var e=r(Ln),n=r(Fn),o=n(e);t.exports=o}),Hn=r(Bn),Un=Object.freeze({default:Hn}),Vn=i(function(t){function e(){this.__data__=[]}t.exports=e}),qn=r(Vn),Jn=Object.freeze({default:qn}),$n=i(function(t){function e(t,e){return t===e||t!==t&&e!==e}t.exports=e}),Wn=r($n),Kn=Object.freeze({default:Wn}),Xn=i(function(t){function e(t,e){for(var o=t.length;o--;)if(n(t[o][0],e))return o;return-1}var n=r(Kn);t.exports=e}),Gn=r(Xn),Qn=Object.freeze({default:Gn}),Yn=i(function(t){function e(t){var e=this.__data__,o=n(e,t);if(o<0)return!1;var r=e.length-1;return o==r?e.pop():i.call(e,o,1),!0}var n=r(Qn),o=Array.prototype,i=o.splice;t.exports=e}),Zn=r(Yn),to=Object.freeze({default:Zn}),eo=i(function(t){function e(t){var e=this.__data__,o=n(e,t);return o<0?void 0:e[o][1]}var n=r(Qn);t.exports=e}),no=r(eo),oo=Object.freeze({default:no}),ro=i(function(t){function e(t){return n(this.__data__,t)>-1}var n=r(Qn);t.exports=e}),io=r(ro),so=Object.freeze({default:io}),ao=i(function(t){function e(t,e){var o=this.__data__,r=n(o,t);return r<0?o.push([t,e]):o[r][1]=e,this}var n=r(Qn);t.exports=e}),po=r(ao),co=Object.freeze({default:po}),uo=i(function(t){function e(t){var e=this,n=-1,o=t?t.length:0;for(this.clear();++n<o;){var r=t[n];e.set(r[0],r[1])}}var n=r(Jn),o=r(to),i=r(oo),s=r(so),a=r(co);e.prototype.clear=n,e.prototype.delete=o,e.prototype.get=i,e.prototype.has=s,e.prototype.set=a,t.exports=e}),ho=r(uo),fo=Object.freeze({default:ho}),lo=i(function(t){function e(){this.__data__=new n}var n=r(fo);t.exports=e}),yo=r(lo),go=Object.freeze({default:yo}),mo=i(function(t){function e(t){return this.__data__.delete(t)}t.exports=e}),vo=r(mo),_o=Object.freeze({default:vo}),bo=i(function(t){function e(t){return this.__data__.get(t)}t.exports=e}),wo=r(bo),Co=Object.freeze({default:wo}),So=i(function(t){function e(t){return this.__data__.has(t)}t.exports=e}),xo=r(So),Oo=Object.freeze({default:xo}),Eo=i(function(t){function e(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}t.exports=e}),No=r(Eo),Io=Object.freeze({default:No}),Po=i(function(t){function e(t){return t&&t.Object===Object?t:null}t.exports=e}),To=r(Po),jo=Object.freeze({default:To}),Do=i(function(t){var e=r(jo),n=e("object"==typeof be&&be),o=e("object"==typeof self&&self),i=e("object"==typeof be&&be),s=n||o||i||Function("return this")();t.exports=s}),Ao=r(Do),Mo=Object.freeze({default:Ao}),ko=i(function(t){var e=r(Mo),n=e["__core-js_shared__"];t.exports=n}),Lo=r(ko),Ro=Object.freeze({default:Lo}),zo=i(function(t){function e(t){return!!o&&o in t}var n=r(Ro),o=function(){var t=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();t.exports=e}),Fo=r(zo),Bo=Object.freeze({default:Fo}),Ho=i(function(t){function e(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var n=Function.prototype.toString;t.exports=e}),Uo=r(Ho),Vo=Object.freeze({default:Uo}),qo=i(function(t){function e(t){if(!s(t)||i(t))return!1;var e=n(t)||o(t)?l:c;return e.test(a(t))}var n=r(Ze),o=r(Io),i=r(Bo),s=r(Ge),a=r(Vo),p=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,u=Object.prototype,h=Function.prototype.toString,f=u.hasOwnProperty,l=RegExp("^"+h.call(f).replace(p,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=e}),Jo=r(qo),$o=Object.freeze({default:Jo}),Wo=i(function(t){function e(t,e){return null==t?void 0:t[e]}t.exports=e}),Ko=r(Wo),Xo=Object.freeze({default:Ko}),Go=i(function(t){function e(t,e){var r=o(t,e);return n(r)?r:void 0}var n=r($o),o=r(Xo);t.exports=e}),Qo=r(Go),Yo=Object.freeze({default:Qo}),Zo=i(function(t){var e=r(Yo),n=e(Object,"create");t.exports=n}),tr=r(Zo),er=Object.freeze({default:tr}),nr=i(function(t){function e(){this.__data__=n?n(null):{}}var n=r(er);t.exports=e}),or=r(nr),rr=Object.freeze({default:or}),ir=i(function(t){function e(t){return this.has(t)&&delete this.__data__[t]}t.exports=e}),sr=r(ir),ar=Object.freeze({default:sr}),pr=i(function(t){function e(t){var e=this.__data__;if(n){var r=e[t];return r===o?void 0:r}return s.call(e,t)?e[t]:void 0}var n=r(er),o="__lodash_hash_undefined__",i=Object.prototype,s=i.hasOwnProperty;t.exports=e}),cr=r(pr),ur=Object.freeze({default:cr}),hr=i(function(t){function e(t){var e=this.__data__;return n?void 0!==e[t]:i.call(e,t)}var n=r(er),o=Object.prototype,i=o.hasOwnProperty;t.exports=e}),fr=r(hr),lr=Object.freeze({default:fr}),dr=i(function(t){function e(t,e){var r=this.__data__;return r[t]=n&&void 0===e?o:e,this}var n=r(er),o="__lodash_hash_undefined__";t.exports=e}),yr=r(dr),gr=Object.freeze({default:yr}),mr=i(function(t){function e(t){var e=this,n=-1,o=t?t.length:0;for(this.clear();++n<o;){var r=t[n];e.set(r[0],r[1])}}var n=r(rr),o=r(ar),i=r(ur),s=r(lr),a=r(gr);e.prototype.clear=n,e.prototype.delete=o,e.prototype.get=i,e.prototype.has=s,e.prototype.set=a,t.exports=e}),vr=r(mr),_r=Object.freeze({default:vr}),br=i(function(t){var e=r(Yo),n=r(Mo),o=e(n,"Map");t.exports=o}),wr=r(br),Cr=Object.freeze({default:wr}),Sr=i(function(t){function e(){this.__data__={hash:new n,map:new(i||o),string:new n}}var n=r(_r),o=r(fo),i=r(Cr);t.exports=e}),xr=r(Sr),Or=Object.freeze({default:xr}),Er=i(function(t){function e(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}t.exports=e}),Nr=r(Er),Ir=Object.freeze({default:Nr}),Pr=i(function(t){function e(t,e){var o=t.__data__;return n(e)?o["string"==typeof e?"string":"hash"]:o.map}var n=r(Ir);t.exports=e}),Tr=r(Pr),jr=Object.freeze({default:Tr}),Dr=i(function(t){function e(t){return n(this,t).delete(t)}var n=r(jr);t.exports=e}),Ar=r(Dr),Mr=Object.freeze({default:Ar}),kr=i(function(t){function e(t){return n(this,t).get(t)}var n=r(jr);t.exports=e}),Lr=r(kr),Rr=Object.freeze({default:Lr}),zr=i(function(t){function e(t){return n(this,t).has(t)}var n=r(jr);t.exports=e}),Fr=r(zr),Br=Object.freeze({default:Fr}),Hr=i(function(t){function e(t,e){return n(this,t).set(t,e),this}var n=r(jr);t.exports=e}),Ur=r(Hr),Vr=Object.freeze({default:Ur}),qr=i(function(t){function e(t){var e=this,n=-1,o=t?t.length:0;for(this.clear();++n<o;){var r=t[n];e.set(r[0],r[1])}}var n=r(Or),o=r(Mr),i=r(Rr),s=r(Br),a=r(Vr);e.prototype.clear=n,e.prototype.delete=o,e.prototype.get=i,e.prototype.has=s,e.prototype.set=a,t.exports=e}),Jr=r(qr),$r=Object.freeze({default:Jr}),Wr=i(function(t){function e(t,e){var r=this.__data__;return r instanceof n&&r.__data__.length==i&&(r=this.__data__=new o(r.__data__)),r.set(t,e),this}var n=r(fo),o=r($r),i=200;t.exports=e}),Kr=r(Wr),Xr=Object.freeze({default:Kr}),Gr=i(function(t){function e(t){this.__data__=new n(t)}var n=r(fo),o=r(go),i=r(_o),s=r(Co),a=r(Oo),p=r(Xr);e.prototype.clear=o,e.prototype.delete=i,e.prototype.get=s,e.prototype.has=a,e.prototype.set=p,t.exports=e}),Qr=r(Gr),Yr=Object.freeze({default:Qr}),Zr=i(function(t){function e(t){return this.__data__.set(t,n),this}var n="__lodash_hash_undefined__";t.exports=e}),ti=r(Zr),ei=Object.freeze({default:ti}),ni=i(function(t){function e(t){return this.__data__.has(t)}t.exports=e}),oi=r(ni),ri=Object.freeze({default:oi}),ii=i(function(t){function e(t){var e=this,o=-1,r=t?t.length:0;for(this.__data__=new n;++o<r;)e.add(t[o])}var n=r($r),o=r(ei),i=r(ri);e.prototype.add=e.prototype.push=o,e.prototype.has=i,t.exports=e}),si=r(ii),ai=Object.freeze({default:si}),pi=i(function(t){function e(t,e){for(var n=-1,o=t?t.length:0;++n<o;)if(e(t[n],n,t))return!0;return!1}t.exports=e}),ci=r(pi),ui=Object.freeze({default:ci}),hi=i(function(t){function e(t,e,r,a,p,c){var u=p&s,h=t.length,f=e.length;if(h!=f&&!(u&&f>h))return!1;var l=c.get(t);if(l)return l==e;var d=-1,y=!0,g=p&i?new n:void 0;for(c.set(t,e);++d<h;){var m=t[d],v=e[d];if(a)var _=u?a(v,m,d,e,t,c):a(m,v,d,t,e,c);if(void 0!==_){if(_)continue;y=!1;break}if(g){if(!o(e,function(t,e){if(!g.has(e)&&(m===t||r(m,t,a,p,c)))return g.add(e)})){y=!1;break}}else if(m!==v&&!r(m,v,a,p,c)){y=!1;break}}return c.delete(t),y}var n=r(ai),o=r(ui),i=1,s=2;t.exports=e}),fi=r(hi),li=Object.freeze({default:fi}),di=i(function(t){var e=r(Mo),n=e.Symbol;t.exports=n}),yi=r(di),gi=Object.freeze({default:yi}),mi=i(function(t){var e=r(Mo),n=e.Uint8Array;t.exports=n}),vi=r(mi),_i=Object.freeze({default:vi}),bi=i(function(t){function e(t){var e=-1,n=Array(t.size);return t.forEach(function(t,o){n[++e]=[o,t]}),n}t.exports=e}),wi=r(bi),Ci=Object.freeze({default:wi}),Si=i(function(t){function e(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}t.exports=e}),xi=r(Si),Oi=Object.freeze({default:xi}),Ei=i(function(t){function e(t,e,n,r,w,S,x){switch(n){case b:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case _:return!(t.byteLength!=e.byteLength||!r(new o(t),new o(e)));case u:case h:return+t==+e;case f:return t.name==e.name&&t.message==e.message;case d:return t!=+t?e!=+e:t==+e;case y:case m:return t==e+"";case l:var O=s;case g:var E=S&c;if(O||(O=a),t.size!=e.size&&!E)return!1;var N=x.get(t);return N?N==e:(S|=p,x.set(t,e),i(O(t),O(e),r,w,S,x));case v:if(C)return C.call(t)==C.call(e)}return!1}var n=r(gi),o=r(_i),i=r(li),s=r(Ci),a=r(Oi),p=1,c=2,u="[object Boolean]",h="[object Date]",f="[object Error]",l="[object Map]",d="[object Number]",y="[object RegExp]",g="[object Set]",m="[object String]",v="[object Symbol]",_="[object ArrayBuffer]",b="[object DataView]",w=n?n.prototype:void 0,C=w?w.valueOf:void 0;t.exports=e}),Ni=r(Ei),Ii=Object.freeze({default:Ni}),Pi=i(function(t){function e(t,e,r,s,a,p){var c=a&i,u=o(t),h=u.length,f=o(e),l=f.length;if(h!=l&&!c)return!1;for(var d=h;d--;){var y=u[d];if(!(c?y in e:n(e,y)))return!1}var g=p.get(t);if(g)return g==e;var m=!0;p.set(t,e);for(var v=c;++d<h;){y=u[d];var _=t[y],b=e[y];if(s)var w=c?s(b,_,y,e,t,p):s(_,b,y,t,e,p);if(!(void 0===w?_===b||r(_,b,s,a,p):w)){m=!1;break}v||(v="constructor"==y)}if(m&&!v){var C=t.constructor,S=e.constructor;C!=S&&"constructor"in t&&"constructor"in e&&!("function"==typeof C&&C instanceof C&&"function"==typeof S&&S instanceof S)&&(m=!1)}return p.delete(t),m}var n=r(ke),o=r(An),i=2;t.exports=e}),Ti=r(Pi),ji=Object.freeze({default:Ti}),Di=i(function(t){var e=r(Yo),n=r(Mo),o=e(n,"DataView");t.exports=o}),Ai=r(Di),Mi=Object.freeze({default:Ai}),ki=i(function(t){var e=r(Yo),n=r(Mo),o=e(n,"Promise");t.exports=o}),Li=r(ki),Ri=Object.freeze({default:Li}),zi=i(function(t){var e=r(Yo),n=r(Mo),o=e(n,"Set");t.exports=o}),Fi=r(zi),Bi=Object.freeze({default:Fi}),Hi=i(function(t){var e=r(Yo),n=r(Mo),o=e(n,"WeakMap");t.exports=o}),Ui=r(Hi),Vi=Object.freeze({default:Ui}),qi=i(function(t){function e(t){return g.call(t)}var n=r(Mi),o=r(Cr),i=r(Ri),s=r(Bi),a=r(Vi),p=r(Vo),c="[object Map]",u="[object Object]",h="[object Promise]",f="[object Set]",l="[object WeakMap]",d="[object DataView]",y=Object.prototype,g=y.toString,m=p(n),v=p(o),_=p(i),b=p(s),w=p(a);(n&&e(new n(new ArrayBuffer(1)))!=d||o&&e(new o)!=c||i&&e(i.resolve())!=h||s&&e(new s)!=f||a&&e(new a)!=l)&&(e=function(t){var e=g.call(t),n=e==u?t.constructor:void 0,o=n?p(n):void 0;if(o)switch(o){case m:return d;case v:return c;case _:return h;case b:return f;case w:return l}return e}),t.exports=e}),Ji=r(qi),$i=Object.freeze({default:Ji}),Wi=i(function(t){function e(t){return o(t)&&n(t.length)&&!!P[j.call(t)]}var n=r(nn),o=r(cn),i="[object Arguments]",s="[object Array]",a="[object Boolean]",p="[object Date]",c="[object Error]",u="[object Function]",h="[object Map]",f="[object Number]",l="[object Object]",d="[object RegExp]",y="[object Set]",g="[object String]",m="[object WeakMap]",v="[object ArrayBuffer]",_="[object DataView]",b="[object Float32Array]",w="[object Float64Array]",C="[object Int8Array]",S="[object Int16Array]",x="[object Int32Array]",O="[object Uint8Array]",E="[object Uint8ClampedArray]",N="[object Uint16Array]",I="[object Uint32Array]",P={};P[b]=P[w]=P[C]=P[S]=P[x]=P[O]=P[E]=P[N]=P[I]=!0,P[i]=P[s]=P[v]=P[a]=P[_]=P[p]=P[c]=P[u]=P[h]=P[f]=P[l]=P[d]=P[y]=P[g]=P[m]=!1;var T=Object.prototype,j=T.toString;t.exports=e}),Ki=r(Wi),Xi=Object.freeze({default:Ki}),Gi=i(function(t){function e(t,e,r,y,m,v){var _=p(t),b=p(e),w=l,C=l;_||(w=a(t),w=w==f?d:w),b||(C=a(e),C=C==f?d:C);var S=w==d&&!c(t),x=C==d&&!c(e),O=w==C;if(O&&!S)return v||(v=new n),_||u(t)?o(t,e,r,y,m,v):i(t,e,w,r,y,m,v);if(!(m&h)){var E=S&&g.call(t,"__wrapped__"),N=x&&g.call(e,"__wrapped__");if(E||N){var I=E?t.value():t,P=N?e.value():e;return v||(v=new n),r(I,P,y,m,v)}}return!!O&&(v||(v=new n),s(t,e,r,y,m,v))}var n=r(Yr),o=r(li),i=r(Ii),s=r(ji),a=r($i),p=r(vn),c=r(Io),u=r(Xi),h=2,f="[object Arguments]",l="[object Array]",d="[object Object]",y=Object.prototype,g=y.hasOwnProperty;t.exports=e}),Qi=r(Gi),Yi=Object.freeze({default:Qi}),Zi=i(function(t){function e(t,r,s,a,p){return t===r||(null==t||null==r||!o(t)&&!i(r)?t!==t&&r!==r:n(t,r,e,s,a,p))}var n=r(Yi),o=r(Ge),i=r(cn);t.exports=e}),ts=r(Zi),es=Object.freeze({default:ts}),ns=i(function(t){function e(t,e,r,a){var p=r.length,c=p,u=!a;if(null==t)return!c;for(t=Object(t);p--;){var h=r[p];if(u&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++p<c;){h=r[p];var f=h[0],l=t[f],d=h[1];if(u&&h[2]){if(void 0===l&&!(f in t))return!1}else{var y=new n;if(a)var g=a(l,d,f,t,e,y);if(!(void 0===g?o(d,l,a,i|s,y):g))return!1}}return!0}var n=r(Yr),o=r(es),i=1,s=2;t.exports=e}),os=r(ns),rs=Object.freeze({default:os}),is=i(function(t){function e(t){return t===t&&!n(t)}var n=r(Ge);t.exports=e}),ss=r(is),as=Object.freeze({default:ss}),ps=i(function(t){function e(t){for(var e=o(t),r=e.length;r--;){var i=e[r],s=t[i];e[r]=[i,s,n(s)]}return e}var n=r(as),o=r(An);t.exports=e}),cs=r(ps),us=Object.freeze({default:cs}),hs=i(function(t){function e(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}t.exports=e}),fs=r(hs),ls=Object.freeze({default:fs}),ds=i(function(t){function e(t){var e=o(t);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(o){return o===t||n(o,t,e)}}var n=r(rs),o=r(us),i=r(ls);t.exports=e}),ys=r(ds),gs=Object.freeze({default:ys}),ms=i(function(t){function e(t,r){if("function"!=typeof t||r&&"function"!=typeof r)throw new TypeError(o);var i=function(){var e=arguments,n=r?r.apply(this,e):e[0],o=i.cache;if(o.has(n))return o.get(n);var s=t.apply(this,e);return i.cache=o.set(n,s),s};return i.cache=new(e.Cache||n),i}var n=r($r),o="Expected a function";e.Cache=n,t.exports=e}),vs=r(ms),_s=Object.freeze({default:vs}),bs=i(function(t){function e(t){return"symbol"==typeof t||n(t)&&s.call(t)==o}var n=r(cn),o="[object Symbol]",i=Object.prototype,s=i.toString;t.exports=e}),ws=r(bs),Cs=Object.freeze({default:ws}),Ss=i(function(t){function e(t){if("string"==typeof t)return t;if(o(t))return a?a.call(t):"";var e=t+"";return"0"==e&&1/t==-i?"-0":e}var n=r(gi),o=r(Cs),i=1/0,s=n?n.prototype:void 0,a=s?s.toString:void 0;t.exports=e}),xs=r(Ss),Os=Object.freeze({default:xs}),Es=i(function(t){function e(t){return null==t?"":n(t)}var n=r(Os);t.exports=e}),Ns=r(Es),Is=Object.freeze({default:Ns}),Ps=i(function(t){var e=r(_s),n=r(Is),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,i=/\\(\\)?/g,s=e(function(t){var e=[];return n(t).replace(o,function(t,n,o,r){e.push(o?r.replace(i,"$1"):n||t)}),e});t.exports=s}),Ts=r(Ps),js=Object.freeze({default:Ts}),Ds=i(function(t){function e(t){return n(t)?t:o(t)}var n=r(vn),o=r(js);t.exports=e}),As=r(Ds),Ms=Object.freeze({default:As}),ks=i(function(t){function e(t,e){if(n(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!o(t))||(s.test(t)||!i.test(t)||null!=e&&t in Object(e))}var n=r(vn),o=r(Cs),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;t.exports=e}),Ls=r(ks),Rs=Object.freeze({default:Ls}),zs=i(function(t){function e(t){if("string"==typeof t||n(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}var n=r(Cs),o=1/0;t.exports=e}),Fs=r(zs),Bs=Object.freeze({default:Fs}),Hs=i(function(t){function e(t,e){e=o(e,t)?[e]:n(e);for(var r=0,s=e.length;null!=t&&r<s;)t=t[i(e[r++])];return r&&r==s?t:void 0}var n=r(Ms),o=r(Rs),i=r(Bs);t.exports=e}),Us=r(Hs),Vs=Object.freeze({default:Us}),qs=i(function(t){function e(t,e,o){var r=null==t?void 0:n(t,e);return void 0===r?o:r}var n=r(Vs);t.exports=e}),Js=r(qs),$s=Object.freeze({default:Js}),Ws=i(function(t){function e(t,e){return null!=t&&e in Object(t)}t.exports=e}),Ks=r(Ws),Xs=Object.freeze({default:Ks}),Gs=i(function(t){function e(t,e,r){e=a(e,t)?[e]:n(e);for(var h,f=-1,l=e.length;++f<l;){var d=u(e[f]);if(!(h=null!=t&&r(t,d)))break;t=t[d]}if(h)return h;var l=t?t.length:0;return!!l&&p(l)&&s(d,l)&&(i(t)||c(t)||o(t))}var n=r(Ms),o=r(yn),i=r(vn),s=r(Nn),a=r(Rs),p=r(nn),c=r(wn),u=r(Bs);t.exports=e}),Qs=r(Gs),Ys=Object.freeze({default:Qs}),Zs=i(function(t){function e(t,e){return null!=t&&o(t,e,n)}var n=r(Xs),o=r(Ys);t.exports=e}),ta=r(Zs),ea=Object.freeze({default:ta}),na=i(function(t){function e(t,e){return s(t)&&a(e)?p(c(t),e):function(r){var s=o(r,t);return void 0===s&&s===e?i(r,t):n(e,s,void 0,u|h)}}var n=r(es),o=r($s),i=r(ea),s=r(Rs),a=r(as),p=r(ls),c=r(Bs),u=1,h=2;t.exports=e}),oa=r(na),ra=Object.freeze({default:oa}),ia=i(function(t){function e(t){return t}t.exports=e}),sa=r(ia),aa=Object.freeze({default:sa}),pa=i(function(t){function e(t){return function(e){return n(e,t)}}var n=r(Vs);t.exports=e}),ca=r(pa),ua=Object.freeze({default:ca}),ha=i(function(t){function e(t){return i(t)?n(s(t)):o(t)}var n=r(qe),o=r(ua),i=r(Rs),s=r(Bs);t.exports=e}),fa=r(ha),la=Object.freeze({default:fa}),da=i(function(t){function e(t){return"function"==typeof t?t:null==t?i:"object"==typeof t?s(t)?o(t[0],t[1]):n(t):a(t)}var n=r(gs),o=r(ra),i=r(aa),s=r(vn),a=r(la);t.exports=e}),ya=r(da),ga=Object.freeze({default:ya}),ma=i(function(t){function e(t,e){var r=s(t)?n:o;return r(t,i(e,3))}var n=r(Se),o=r(Un),i=r(ga),s=r(vn);t.exports=e}),va=r(ma),_a=Object.freeze({default:va}),ba=function(){};ba.prototype.emit=function(t){if(t in this.__events__){for(var e=this.__events__[t].slice(),n=Array.prototype.slice.call(arguments,1),o=0,r=e.length;o<r;o++){var i=e[o];i.method.apply(i.context,n)}return!0}return!1},ba.prototype.on=function(t,e,n,o){var r=0;4===arguments.length&&(r=o.priority||r),a.call(this,t,e,n,r),this.__events__[t].sort(s)},ba.prototype.off=function(t,e,n){1===arguments.length&&Xe(arguments[0])?c.call(this,arguments[0]):p.apply(this,arguments)},ba.prototype._debugEvents=function(){console.log("### EventEmitter: ",this),va(this.__events__,function(t,e){console.log("- %s listeners for %s: ",t.length,e,t)})};var wa={get:function(){return this.___events___||(this.___events___={}),this.___events___},configurable:!0,enumerable:!1};Object.defineProperty(ba.prototype,"__events__",wa),ba.mixin=function(t){var e=Object.getOwnPropertyNames(ba.prototype);e.forEach(function(e){"constructor"!==e&&"__events__"!==e&&(t.prototype[e]=ba.prototype[e])}),Object.defineProperty(t.prototype,"__events__",wa)};var Ca=0,Sa=function(t){function e(e){t.call(this),this.__id__=Ca++,this.config=e,this._onMessage=this._onMessage.bind(this),this._onConnectionOpen=this._onConnectionOpen.bind(this),this._onConnectionClose=this._onConnectionClose.bind(this),this._connect()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._createWebSocket=function(){throw ve("AbstractMethodError")},e.prototype._connect=function(){this.ws=this._createWebSocket(),this.ws.addEventListener("open",this._onConnectionOpen),this.ws.addEventListener("close",this._onConnectionClose),this.ws.addEventListener("message",this._onMessage)},e.prototype._disconnect=function(){this.ws.removeEventListener("message",this._onMessage),this.ws.removeEventListener("open",this._onConnectionOpen),this.ws.removeEventListener("close",this._onConnectionClose),this.ws=null},e.prototype._onConnectionOpen=function(){this.emit("open")},e.prototype._onConnectionClose=function(){this._disconnect(),this.emit("close"),console.info("websocket connection closed. Attempting to reconnect in 5s."),setTimeout(function(){this._connect()}.bind(this),5e3)},e.prototype._onMessage=function(t){t=this.deserializeMessage(t.data),this.emit("message",t)},e.prototype.send=function(t){return this.isOpen()?void this.ws.send(this.serializeMessage(t)):void console.warn("Message could not be sent. Connection is not open.",t)},e.prototype.isOpen=function(){return this.ws&&1===this.ws.readyState},e.prototype.serializeMessage=function(t){return JSON.stringify(t)},e.prototype.deserializeMessage=function(t){return JSON.parse(t)},e}(ba),xa=0,Oa=function(t){function e(e){t.call(this),this.__id__=xa++,this.config=e,this.connection=e.connection,this.scope="substance/collab",this._onMessage=this._onMessage.bind(this),this._onConnectionOpen=this._onConnectionOpen.bind(this),this._onConnectionClose=this._onConnectionClose.bind(this),this.connection.on("open",this._onConnectionOpen),this.connection.on("close",this._onConnectionClose),this.connection.on("message",this._onMessage)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._onConnectionClose=function(){this.emit("disconnected")},e.prototype._onConnectionOpen=function(){this.emit("connected")},e.prototype._onMessage=function(t){t.scope===this.scope?this.emit("message",t):"_internal"!==t.scope&&console.info("Message ignored. Not sent in hub scope",t)},e.prototype.send=function(t){return this.connection.isOpen()?(t.scope=this.scope,this.config.enhanceMessage&&(t=this.config.enhanceMessage(t)),void this.connection.send(t)):void console.warn("Message could not be sent. Connection not open.",t)},e.prototype.isConnected=function(){return this.connection.isOpen()},e.prototype.dispose=function(){this.connection.off(this)},e}(ba),Ea=i(function(t){function e(t,e){for(var n=-1,o=t?t.length:0,r=Array(o);++n<o;)r[n]=e(t[n],n,t);return r}t.exports=e}),Na=r(Ea),Ia=Object.freeze({
default:Na}),Pa=i(function(t){function e(t,e){var r=-1,i=o(t)?Array(t.length):[];return n(t,function(t,n,o){i[++r]=e(t,n,o)}),i}var n=r(Un),o=r(sn);t.exports=e}),Ta=r(Pa),ja=Object.freeze({default:Ta}),Da=i(function(t){function e(t,e){var r=s(t)?n:i;return r(t,o(e,3))}var n=r(Ia),o=r(ga),i=r(ja),s=r(vn);t.exports=e}),Aa=r(Da),Ma=i(function(t){function e(t,e,o){var r=t[e];i.call(t,e)&&n(r,o)&&(void 0!==o||e in t)||(t[e]=o)}var n=r(Kn),o=Object.prototype,i=o.hasOwnProperty;t.exports=e}),ka=r(Ma),La=Object.freeze({default:ka}),Ra=i(function(t){function e(t,e,o,r){o||(o={});for(var i=-1,s=e.length;++i<s;){var a=e[i],p=r?r(o[a],t[a],a,o,t):t[a];n(o,a,p)}return o}var n=r(La);t.exports=e}),za=r(Ra),Fa=Object.freeze({default:za}),Ba=i(function(t){function e(t,e,r){if(!s(r))return!1;var a=typeof e;return!!("number"==a?o(r)&&i(e,r.length):"string"==a&&e in r)&&n(r[e],t)}var n=r(Kn),o=r(sn),i=r(Nn),s=r(Ge);t.exports=e}),Ha=r(Ba),Ua=Object.freeze({default:Ha}),Va=i(function(t){function e(t,e,n){var o=n.length;switch(o){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}t.exports=e}),qa=r(Va),Ja=Object.freeze({default:qa}),$a=i(function(t){function e(t){if("number"==typeof t)return t;if(i(t))return s;if(o(t)){var e=n(t.valueOf)?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var r=c.test(t);return r||u.test(t)?h(t.slice(2),r?2:8):p.test(t)?s:+t}var n=r(Ze),o=r(Ge),i=r(Cs),s=NaN,a=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,u=/^0o[0-7]+$/i,h=parseInt;t.exports=e}),Wa=r($a),Ka=Object.freeze({default:Wa}),Xa=i(function(t){function e(t){if(!t)return 0===t?t:0;if(t=n(t),t===o||t===-o){var e=t<0?-1:1;return e*i}return t===t?t:0}var n=r(Ka),o=1/0,i=1.7976931348623157e308;t.exports=e}),Ga=r(Xa),Qa=Object.freeze({default:Ga}),Ya=i(function(t){function e(t){var e=n(t),o=e%1;return e===e?o?e-o:e:0}var n=r(Qa);t.exports=e}),Za=r(Ya),tp=Object.freeze({default:Za}),ep=i(function(t){function e(t,e){if("function"!=typeof t)throw new TypeError(i);return e=s(void 0===e?t.length-1:o(e),0),function(){for(var o=arguments,r=-1,i=s(o.length-e,0),a=Array(i);++r<i;)a[r]=o[e+r];switch(e){case 0:return t.call(this,a);case 1:return t.call(this,o[0],a);case 2:return t.call(this,o[0],o[1],a)}var p=Array(e+1);for(r=-1;++r<e;)p[r]=o[r];return p[e]=a,n(t,this,p)}}var n=r(Ja),o=r(tp),i="Expected a function",s=Math.max;t.exports=e}),np=r(ep),op=Object.freeze({default:np}),rp=i(function(t){function e(t){return o(function(e,o){var r=-1,i=o.length,s=i>1?o[i-1]:void 0,a=i>2?o[2]:void 0;for(s=t.length>3&&"function"==typeof s?(i--,s):void 0,a&&n(o[0],o[1],a)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var p=o[r];p&&t(e,p,r,s)}return e})}var n=r(Ua),o=r(op);t.exports=e}),ip=r(rp),sp=Object.freeze({default:ip}),ap=i(function(t){var e=r(Mo),n=e.Reflect;t.exports=n}),pp=r(ap),cp=Object.freeze({default:pp}),up=i(function(t){function e(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}t.exports=e}),hp=r(up),fp=Object.freeze({default:hp}),lp=i(function(t){function e(t){t=null==t?t:Object(t);var e=[];for(var n in t)e.push(n);return e}var n=r(cp),o=r(fp),i=Object.prototype,s=n?n.enumerate:void 0,a=i.propertyIsEnumerable;s&&!a.call({valueOf:1},"valueOf")&&(e=function(t){return o(s(t))}),t.exports=e}),dp=r(lp),yp=Object.freeze({default:dp}),gp=i(function(t){function e(t){for(var e=-1,r=s(t),a=n(t),c=a.length,u=o(t),h=!!u,f=u||[],l=f.length;++e<c;){var d=a[e];h&&("length"==d||i(d,l))||"constructor"==d&&(r||!p.call(t,d))||f.push(d)}return f}var n=r(yp),o=r(xn),i=r(Nn),s=r(Tn),a=Object.prototype,p=a.hasOwnProperty;t.exports=e}),mp=r(gp),vp=Object.freeze({default:mp}),_p=i(function(t){var e=r(La),n=r(Fa),o=r(sp),i=r(sn),s=r(Tn),a=r(vp),p=Object.prototype,c=p.propertyIsEnumerable,u=!c.call({valueOf:1},"valueOf"),h=o(function(t,o){if(u||s(o)||i(o))return void n(o,a(o),t);for(var r in o)e(t,r,o[r])});t.exports=h}),bp=r(_p),wp=Object.freeze({default:bp}),Cp=i(function(t){t.exports=r(wp)}),Sp=r(Cp),xp=i(function(t){function e(t,e){return n(t,e)}var n=r(es);t.exports=e}),Op=r(xp),Ep=i(function(t){function e(t,e){return t&&n(e,o(e),t)}var n=r(Fa),o=r(An);t.exports=e}),Np=r(Ep),Ip=Object.freeze({default:Np}),Pp=i(function(t){function e(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}t.exports=e}),Tp=r(Pp),jp=Object.freeze({default:Tp}),Dp=i(function(t){function e(t,e){var n=-1,o=t.length;for(e||(e=Array(o));++n<o;)e[n]=t[n];return e}t.exports=e}),Ap=r(Dp),Mp=Object.freeze({default:Ap}),kp=i(function(t){function e(){return[]}t.exports=e}),Lp=r(kp),Rp=Object.freeze({default:Lp}),zp=i(function(t){function e(t){return o(Object(t))}var n=r(Rp),o=Object.getOwnPropertySymbols;o||(e=n),t.exports=e}),Fp=r(zp),Bp=Object.freeze({default:Fp}),Hp=i(function(t){function e(t,e){return n(t,o(t),e)}var n=r(Fa),o=r(Bp);t.exports=e}),Up=r(Hp),Vp=Object.freeze({default:Up}),qp=i(function(t){function e(t,e){for(var n=-1,o=e.length,r=t.length;++n<o;)t[r+n]=e[n];return t}t.exports=e}),Jp=r(qp),$p=Object.freeze({default:Jp}),Wp=i(function(t){function e(t,e,r){var i=e(t);return o(t)?i:n(i,r(t))}var n=r($p),o=r(vn);t.exports=e}),Kp=r(Wp),Xp=Object.freeze({default:Kp}),Gp=i(function(t){function e(t){return n(t,i,o)}var n=r(Xp),o=r(Bp),i=r(An);t.exports=e}),Qp=r(Gp),Yp=Object.freeze({default:Qp}),Zp=i(function(t){function e(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&o.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var n=Object.prototype,o=n.hasOwnProperty;t.exports=e}),tc=r(Zp),ec=Object.freeze({default:tc}),nc=i(function(t){function e(t){var e=new t.constructor(t.byteLength);return new n(e).set(new n(t)),e}var n=r(_i);t.exports=e}),oc=r(nc),rc=Object.freeze({default:oc}),ic=i(function(t){function e(t,e){var o=e?n(t.buffer):t.buffer;return new t.constructor(o,t.byteOffset,t.byteLength)}var n=r(rc);t.exports=e}),sc=r(ic),ac=Object.freeze({default:sc}),pc=i(function(t){function e(t,e){return t.set(e[0],e[1]),t}t.exports=e}),cc=r(pc),uc=Object.freeze({default:cc}),hc=i(function(t){function e(t,e,n,o){var r=-1,i=t?t.length:0;for(o&&i&&(n=t[++r]);++r<i;)n=e(n,t[r],r,t);return n}t.exports=e}),fc=r(hc),lc=Object.freeze({default:fc}),dc=i(function(t){function e(t,e,r){var s=e?r(i(t),!0):i(t);return o(s,n,new t.constructor)}var n=r(uc),o=r(lc),i=r(Ci);t.exports=e}),yc=r(dc),gc=Object.freeze({default:yc}),mc=i(function(t){function e(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}var n=/\w*$/;t.exports=e}),vc=r(mc),_c=Object.freeze({default:vc}),bc=i(function(t){function e(t,e){return t.add(e),t}t.exports=e}),wc=r(bc),Cc=Object.freeze({default:wc}),Sc=i(function(t){function e(t,e,r){var s=e?r(i(t),!0):i(t);return o(s,n,new t.constructor)}var n=r(Cc),o=r(lc),i=r(Oi);t.exports=e}),xc=r(Sc),Oc=Object.freeze({default:xc}),Ec=i(function(t){function e(t){return i?Object(i.call(t)):{}}var n=r(gi),o=n?n.prototype:void 0,i=o?o.valueOf:void 0;t.exports=e}),Nc=r(Ec),Ic=Object.freeze({default:Nc}),Pc=i(function(t){function e(t,e){var o=e?n(t.buffer):t.buffer;return new t.constructor(o,t.byteOffset,t.length)}var n=r(rc);t.exports=e}),Tc=r(Pc),jc=Object.freeze({default:Tc}),Dc=i(function(t){function e(t,e,r,P){var T=t.constructor;switch(e){case v:return n(t);case u:case h:return new T((+t));case _:return o(t,P);case b:case w:case C:case S:case x:case O:case E:case N:case I:return c(t,P);case f:return i(t,P,r);case l:case g:return new T(t);case d:return s(t);case y:return a(t,P,r);case m:return p(t)}}var n=r(rc),o=r(ac),i=r(gc),s=r(_c),a=r(Oc),p=r(Ic),c=r(jc),u="[object Boolean]",h="[object Date]",f="[object Map]",l="[object Number]",d="[object RegExp]",y="[object Set]",g="[object String]",m="[object Symbol]",v="[object ArrayBuffer]",_="[object DataView]",b="[object Float32Array]",w="[object Float64Array]",C="[object Int8Array]",S="[object Int16Array]",x="[object Int32Array]",O="[object Uint8Array]",E="[object Uint8ClampedArray]",N="[object Uint16Array]",I="[object Uint32Array]";t.exports=e}),Ac=r(Dc),Mc=Object.freeze({default:Ac}),kc=i(function(t){function e(t){return n(t)?o(t):{}}var n=r(Ge),o=Object.create;t.exports=e}),Lc=r(kc),Rc=Object.freeze({default:Lc}),zc=i(function(t){function e(t){return"function"!=typeof t.constructor||i(t)?{}:n(o(t))}var n=r(Rc),o=r(De),i=r(Tn);t.exports=e}),Fc=r(zc),Bc=Object.freeze({default:Fc}),Hc=i(function(t){function e(){return!1}t.exports=e}),Uc=r(Hc),Vc=Object.freeze({default:Uc}),qc=i(function(t,e){var n=r(Mo),o=r(Vc),i="object"==typeof e&&e,s=i&&"object"==typeof t&&t,a=s&&s.exports===i,p=a?n.Buffer:void 0,c=p?function(t){return t instanceof p}:o;t.exports=c}),Jc=r(qc),$c=Object.freeze({default:Jc}),Wc=i(function(t){function e(t,r,w,C,S,x,N){var I;if(C&&(I=x?C(t,S,x,N):C(t)),void 0!==I)return I;if(!v(t))return t;var T=y(t);if(T){if(I=f(t),!r)return p(t,I)}else{var j=h(t),D=j==O||j==E;if(g(t))return a(t,r);if(j==P||j==b||D&&!x){if(m(t))return x?t:{};if(I=d(D?{}:t),!r)return c(t,s(I,t))}else{if(!$[j])return x?t:{};I=l(t,j,e,r)}}N||(N=new n);var A=N.get(t);if(A)return A;if(N.set(t,I),!T)var M=w?u(t):_(t);return o(M||t,function(n,o){M&&(o=n,n=t[o]),i(I,o,e(n,r,w,C,o,t,N))}),I}var n=r(Yr),o=r(Se),i=r(La),s=r(Ip),a=r(jp),p=r(Mp),c=r(Vp),u=r(Yp),h=r($i),f=r(ec),l=r(Mc),d=r(Bc),y=r(vn),g=r($c),m=r(Io),v=r(Ge),_=r(An),b="[object Arguments]",w="[object Array]",C="[object Boolean]",S="[object Date]",x="[object Error]",O="[object Function]",E="[object GeneratorFunction]",N="[object Map]",I="[object Number]",P="[object Object]",T="[object RegExp]",j="[object Set]",D="[object String]",A="[object Symbol]",M="[object WeakMap]",k="[object ArrayBuffer]",L="[object DataView]",R="[object Float32Array]",z="[object Float64Array]",F="[object Int8Array]",B="[object Int16Array]",H="[object Int32Array]",U="[object Uint8Array]",V="[object Uint8ClampedArray]",q="[object Uint16Array]",J="[object Uint32Array]",$={};$[b]=$[w]=$[k]=$[L]=$[C]=$[S]=$[R]=$[z]=$[F]=$[B]=$[H]=$[N]=$[I]=$[P]=$[T]=$[j]=$[D]=$[A]=$[U]=$[V]=$[q]=$[J]=!0,$[x]=$[O]=$[M]=!1,t.exports=e}),Kc=r(Wc),Xc=Object.freeze({default:Kc}),Gc=i(function(t){function e(t){return n(t,!1,!0)}var n=r(Xc);t.exports=e}),Qc=r(Gc),Yc=i(function(t){function e(t){return n(t,!0,!0)}var n=r(Xc);t.exports=e}),Zc=r(Yc),tu=i(function(t){function e(t){return"number"==typeof t||n(t)&&s.call(t)==o}var n=r(cn),o="[object Number]",i=Object.prototype,s=i.toString;t.exports=e}),eu=r(tu),nu=i(function(t){function e(t,e,r,c){e=s(e,t)?[e]:o(e);for(var u=-1,h=e.length,f=h-1,l=t;null!=l&&++u<h;){var d=p(e[u]);if(a(l)){var y=r;if(u!=f){var g=l[d];y=c?c(g,d,l):void 0,void 0===y&&(y=null==g?i(e[u+1])?[]:{}:g)}n(l,d,y)}l=l[d]}return t}var n=r(La),o=r(Ms),i=r(Nn),s=r(Rs),a=r(Ge),p=r(Bs);t.exports=e}),ou=r(nu),ru=Object.freeze({default:ou}),iu=i(function(t){function e(t,e,o,r){return r="function"==typeof r?r:void 0,null==t?t:n(t,e,o,r)}var n=r(ru);t.exports=e}),su=r(iu),au=i(function(t){function e(t){var e=t?t.length:0;return e?t[e-1]:void 0}t.exports=e}),pu=r(au),cu=Object.freeze({default:pu}),uu=i(function(t){function e(t,e,n){var o=-1,r=t.length;e<0&&(e=-e>r?0:r+e),n=n>r?r:n,n<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(r);++o<r;)i[o]=t[o+e];return i}t.exports=e}),hu=r(uu),fu=Object.freeze({default:hu}),lu=i(function(t){function e(t,e){return 1==e.length?t:n(t,o(e,0,-1))}var n=r(Vs),o=r(fu);t.exports=e}),du=r(lu),yu=Object.freeze({default:du}),gu=i(function(t){function e(t,e){e=i(e,t)?[e]:o(e),t=a(t,e);var r=p(s(e));return!(null!=t&&n(t,r))||delete t[r]}var n=r(ke),o=r(Ms),i=r(Rs),s=r(cu),a=r(yu),p=r(Bs);t.exports=e}),mu=r(gu),vu=Object.freeze({default:mu}),_u=i(function(t){function e(t,e){return null==t||n(t,e)}var n=r(vu);t.exports=e}),bu=r(_u),wu=function(t){t&&(this.__root__=t)};wu.prototype.contains=function(t){return Boolean(this.getRoot()[t])},wu.prototype.getRoot=function(){return this.__root__?this.__root__:this},wu.prototype.get=function(t){if(t){if(bn(t))return this.getRoot()[t];if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),!mn(t))throw new Error("Illegal argument for DataObject.get()");return Js(this.getRoot(),t)}},wu.prototype.set=function(t,e){if(!t)throw new Error("Illegal argument: DataObject.set(>path<, value) - path is mandatory.");bn(t)?this.getRoot()[t]=e:su(this.getRoot(),t,e)},wu.prototype.delete=function(t){if(bn(t))delete this.getRoot()[t];else if(1===t.length)delete this.getRoot()[t[0]];else{var e=bu(this.getRoot(),t);if(!e)throw new Error("Could not delete property at path"+t)}},wu.prototype.clear=function(){var t=this.getRoot();for(var e in t)t.hasOwnProperty(e)&&delete t[e]},wu.prototype._isDataObject=!0;var Cu=function(){},Su={_isOperation:{}};Su._isOperation.get=function(){return!0},Object.defineProperties(Cu.prototype,Su);var xu=function(t){function e(e,n){t.call(this,"Conflict: "+JSON.stringify(e)+" vs "+JSON.stringify(n)),this.a=e,this.b=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Ou="insert",Eu="delete",Nu=function(t){function e(e){if(t.call(this),!e||void 0===e.type||void 0===e.pos||void 0===e.str)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.pos=e.pos,this.str=e.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!bn(this.str))throw new Error("Illegal argument: expecting string.");if(!eu(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isTextOperation:{}};return n._isTextOperation.get=function(){return!0},e.prototype.apply=function(t){if(this.isEmpty())return t;if(this.type===Ou){if(t.length<this.pos)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,0,this.str):t.slice(0,this.pos).concat(this.str).concat(t.slice(this.pos))}if(t.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,this.str.length):t.slice(0,this.pos).concat(t.slice(this.pos+this.str.length))},e.prototype.clone=function(){return new e(this)},e.prototype.isNOP=function(){return"NOP"===this.type||0===this.str.length},e.prototype.isInsert=function(){return this.type===Ou},e.prototype.isDelete=function(){return this.type===Eu},e.prototype.getLength=function(){return this.str.length},e.prototype.invert=function(){var t={type:this.isInsert()?Eu:Ou,pos:this.pos,str:this.str};return new e(t)},e.prototype.hasConflict=function(t){return f(this,t)},e.prototype.isEmpty=function(){return 0===this.str.length},e.prototype.toJSON=function(){return{type:this.type,pos:this.pos,str:this.str}},e.prototype.toString=function(){return["(",this.isInsert()?Ou:Eu,",",this.pos,",'",this.str,"')"].join("")},Object.defineProperties(e.prototype,n),e}(Cu),Iu=function(t,e,n){if(n=n||{},n["no-conflict"]&&f(t,e))throw new xu(t,e);return n.inplace||(t=t.clone(),e=e.clone()),t.type===Ou&&e.type===Ou?l(t,e):t.type===Eu&&e.type===Eu?d(t,e,!0):y(t,e),[t,e]};Nu.transform=function(){return Iu.apply(null,arguments)},Nu.Insert=function(t,e){return new Nu({type:Ou,pos:t,str:e})},Nu.Delete=function(t,e){return new Nu({type:Eu,pos:t,str:e})},Nu.INSERT=Ou,Nu.DELETE=Eu,Nu.fromJSON=function(t){return new Nu(t)};var Pu="NOP",Tu="delete",ju="insert",Du=function(t){function e(e){if(t.call(this),!e||!e.type)throw new Error("Illegal argument: insufficient data.");if(this.type=e.type,this.type!==Pu){if(this.type!==ju&&this.type!==Tu)throw new Error("Illegal type.");if(this.pos=e.pos,this.val=e.val,!eu(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isArrayOperation:{}};return n._isArrayOperation.get=function(){return!0},e.prototype.apply=function(t){if(this.type===Pu)return t;if(this.type===ju){if(t.length<this.pos)throw new Error("Provided array is too small.");return t.splice(this.pos,0,this.val),t}if(t.length<this.pos)throw new Error("Provided array is too small.");if(!Op(t[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+t[this.pos]);return t.splice(this.pos,1),t},e.prototype.clone=function(){var t={type:this.type,pos:this.pos,val:Zc(this.val)};return new e(t)},e.prototype.invert=function(){var t=this.toJSON();return this.type===Pu?t.type=Pu:this.type===ju?t.type=Tu:t.type=ju,new e(t)},e.prototype.hasConflict=function(t){return e.hasConflict(this,t)},e.prototype.toJSON=function(){var t={type:this.type};return this.type===Pu?t:(t.pos=this.pos,t.val=Zc(this.val),t)},e.prototype.isInsert=function(){return this.type===ju},e.prototype.isDelete=function(){return this.type===Tu},e.prototype.getOffset=function(){return this.pos},e.prototype.getValue=function(){return this.val},e.prototype.isNOP=function(){return this.type===Pu},e.prototype.toString=function(){return["(",this.isInsert()?ju:Tu,",",this.getOffset(),",'",this.getValue(),"')"].join("")},Object.defineProperties(e.prototype,n),e}(Cu),Au=function(t,e){return t.type!==Pu&&e.type!==Pu&&(t.type===ju&&e.type===ju&&t.pos===e.pos)},Mu=function(t,e,n){if(n=n||{},n["no-conflict"]&&Au(t,e))throw new xu(t,e);return n.inplace||(t=t.clone(),e=e.clone()),t.type===Pu||e.type===Pu||(t.type===ju&&e.type===ju?g(t,e):t.type===Tu&&e.type===Tu?m(t,e):v(t,e)),[t,e]};Du.transform=Mu,Du.hasConflict=Au,Du.Insert=function(t,e){return new Du({type:ju,pos:t,val:e})},Du.Delete=function(t,e){return new Du({type:Tu,pos:t,val:e})},Du.fromJSON=function(t){return new Du(t)},Du.NOP=Pu,Du.DELETE=Tu,Du.INSERT=ju;var ku="NOP",Lu="create",Ru="delete",zu="update",Fu="set",Bu=function(t){function e(e){if(t.call(this),!e)throw new Error("Data of ObjectOperation is missing.");if(!e.type)throw new Error("Invalid data: type is mandatory.");if(this.type=e.type,e.type!==ku){if(this.path=e.path,!e.path)throw new Error("Invalid data: path is mandatory.");if(this.type===Lu||this.type===Ru){if(!e.val)throw new Error("Invalid data: value is missing.");this.val=e.val}else if(this.type===zu){if(!e.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=e.diff,e.diff._isTextOperation)this.propertyType="string";else{if(!e.diff._isArrayOperation)throw new Error("Invalid data: diff must be a TextOperation or an ArrayOperation.");this.propertyType="array"}}else{if(this.type!==Fu)throw new Error("Invalid type: "+e.type);this.val=e.val,this.original=e.original}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isObjectOperation:{}};return n._isObjectOperation.get=function(){return!0},e.prototype.apply=function(t){if(this.type===ku)return t;var e;if(e=t._isDataObject?t:new wu(t),this.type===Lu)return e.set(this.path,Zc(this.val)),t;if(this.type===Ru)e.delete(this.path,"strict");else if(this.type===zu){var n,o=this.diff,r=e.get(this.path);n=o._isArrayOperation?o.apply(r):o.apply(r),e.set(this.path,n)}else e.set(this.path,Zc(this.val));return t},e.prototype.clone=function(){var t={type:this.type,path:this.path};return this.val&&(t.val=Zc(this.val)),this.diff&&(t.diff=this.diff.clone()),new e(t)},e.prototype.isNOP=function(){return this.type===ku||(this.type===zu?this.diff.isNOP():void 0)},e.prototype.isCreate=function(){return this.type===Lu},e.prototype.isDelete=function(){return this.type===Ru},e.prototype.isUpdate=function(t){return t?this.type===zu&&this.propertyType===t:this.type===zu},e.prototype.isSet=function(){return this.type===Fu},e.prototype.invert=function(){if(this.type===ku)return new e({type:ku});var t=new e(this);if(this.type===Lu)t.type=Ru;else if(this.type===Ru)t.type=Lu;else if(this.type===zu){var n;n=this.diff._isTextOperation?Nu.fromJSON(this.diff.toJSON()).invert():Du.fromJSON(this.diff.toJSON()).invert(),t.diff=n}else t.val=this.original,t.original=this.val;return t},e.prototype.hasConflict=function(t){return e.hasConflict(this,t)},e.prototype.toJSON=function(){if(this.type===ku)return{type:ku};var t={type:this.type,path:this.path};return this.type===Lu||this.type===Ru?t.val=this.val:this.type===zu?(this.diff._isArrayOperation?t.propertyType="array":t.propertyType="string",t.diff=this.diff.toJSON()):(t.val=this.val,t.original=this.original),t},e.prototype.getType=function(){return this.type},e.prototype.getPath=function(){return this.path},e.prototype.getValue=function(){return this.val},e.prototype.getOldValue=function(){return this.original},e.prototype.getValueOp=function(){return this.diff},e.prototype.toString=function(){switch(this.type){case Lu:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case Ru:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case zu:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case Fu:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("");case ku:return"NOP";default:throw new Error("Invalid type")}},Object.defineProperties(e.prototype,n),e}(Cu),Hu=function(t,e){return t.type!==ku&&e.type!==ku&&Op(t.path,e.path)},Uu=function(t,e){t.type=ku,e.type=ku},Vu=function(){throw new Error("Can not transform two concurring creates of the same property")},qu=function(){throw new Error("Illegal state: can not create and delete a value at the same time.")},Ju=function(t,e,n){if(t.type!==Ru)return Ju(e,t,!0);var o;o="string"===e.propertyType?Nu.fromJSON(e.diff):Du.fromJSON(e.diff),n?(t.val=o.apply(t.val),e.type=ku):(t.type=ku,e.type=Lu,e.val=o.apply(t.val))},$u=function(){throw new Error("Can not transform a concurring create and update of the same property")},Wu=function(t,e){var n,o,r;"string"===e.propertyType?(n=Nu.fromJSON(t.diff),o=Nu.fromJSON(e.diff),r=Nu.transform(n,o,{inplace:!0})):(n=Du.fromJSON(t.diff),o=Du.fromJSON(e.diff),r=Du.transform(n,o,{inplace:!0})),t.diff=r[0],e.diff=r[1]},Ku=function(){throw new Error("Illegal state: can not create and set a value at the same time.")},Xu=function(t,e,n){return t.type!==Ru?Xu(e,t,!0):void(n?(t.val=e.val,e.type=ku):(t.type=ku,e.type=Lu,e.original=void 0))},Gu=function(){throw new Error("Unresolvable conflict: update + set.")},Qu=function(t,e){t.type=ku,e.original=t.val},Yu=0,Zu=1,th=2,eh=4,nh=8,oh={};oh[ku]=Yu,oh[Lu]=Zu,oh[Ru]=th,oh[zu]=eh,oh[Fu]=nh;var rh=[];rh[th|th]=Uu,rh[th|Zu]=qu,rh[th|eh]=Ju,rh[Zu|Zu]=Vu,rh[Zu|eh]=$u,rh[eh|eh]=Wu,rh[Zu|nh]=Ku,rh[th|nh]=Xu,rh[eh|nh]=Gu,rh[nh|nh]=Qu;var ih=function(t,e,n){if(n=n||{},n["no-conflict"]&&Hu(t,e))throw new xu(t,e);if(n.inplace||(t=t.clone(),e=e.clone()),t.isNOP()||e.isNOP())return[t,e];var o=Op(t.path,e.path);return o&&rh[oh[t.type]|oh[e.type]](t,e),[t,e]};Bu.transform=ih,Bu.hasConflict=Hu,Bu.Create=function(t,e){var n;return n=bn(t)?[t]:t,new Bu({type:Lu,path:n,val:e})},Bu.Delete=function(t,e){var n;return n=bn(t)?[t]:t,new Bu({type:Ru,path:n,val:e})},Bu.Update=function(t,e){return new Bu({type:zu,path:t,diff:e})},Bu.Set=function(t,e,n){return new Bu({type:Fu,path:t,val:Zc(n),original:Zc(e)})},Bu.fromJSON=function(t){if(t=Zc(t),"update"===t.type)switch(t.propertyType){case"string":t.diff=Nu.fromJSON(t.diff);break;case"array":t.diff=Du.fromJSON(t.diff);break;default:throw new Error("Unsupported update diff:"+JSON.stringify(t.diff))}var e=new Bu(t);return e},Bu.NOP=ku,Bu.CREATE=Lu,Bu.DELETE=Ru,Bu.UPDATE=zu,Bu.SET=Fu;var sh=function(){this.SEPARATOR="\t"};sh.prototype.serialize=function(t){var e=[];switch(t.type){case"create":e.push("c"),e.push(t.val.id),e.push(t.val);break;case"delete":e.push("d"),e.push(t.val.id),e.push(t.val);break;case"set":e.push("s"),e.push(t.path.join(".")),e.push(t.val),e.push(t.original);break;case"update":e.push("u"),e.push(t.path.join(".")),Array.prototype.push.apply(e,this.serializePrimitiveOp(t.diff));break;default:throw new Error("Unsupported operation type.")}return e},sh.prototype.serializePrimitiveOp=function(t){var e=[];if(t._isTextOperation)t.isInsert()?e.push("t+"):t.isDelete()&&e.push("t-"),e.push(t.pos),e.push(t.str);else{if(!t._isArrayOperation)throw new Error("Unsupported operation type.");t.isInsert()?e.push("a+"):t.isDelete()&&e.push("a-"),e.push(t.pos),e.push(t.val)}return e},sh.prototype.deserialize=function(t,e){e||(e=new ah(t,this.SEPARATOR));var n,o,r,i,s,a=e.getString();switch(a){case"c":o=e.getPath(),r=e.getObject(),n=Bu.Create(o,r);break;case"d":o=e.getPath(),r=e.getObject(),n=Bu.Delete(o,r);break;case"s":o=e.getPath(),r=e.getAny(),i=e.getAny(),n=Bu.Set(o,i,r);break;case"u":o=e.getPath(),s=this.deserializePrimitiveOp(t,e),n=Bu.Update(o,s);break;default:throw new Error("Illegal type for ObjectOperation: "+a)}return n},sh.prototype.deserializePrimitiveOp=function(t,e){e||(e=new ah(t,this.SEPARATOR));var n,o,r,i=e.getString();switch(i){case"t+":o=e.getNumber(),r=e.getString(),n=Nu.Insert(o,r);break;case"t-":o=e.getNumber(),r=e.getString(),n=Nu.Delete(o,r);break;case"a+":o=e.getNumber(),r=e.getAny(),n=Du.Insert(o,r);break;case"a-":o=e.getNumber(),r=e.getAny(),n=Du.Delete(o,r);break;default:throw new Error("Unsupported operation type: "+i)}return n};var ah=function(t,e){mn(arguments[0])?this.tokens=arguments[0]:this.tokens=t.split(e),this.pos=-1};ah.prototype.error=function(t){throw new Error("Parsing error: "+t+"\n"+this.tokens[this.pos])},ah.prototype.getString=function(){this.pos++;var t=this.tokens[this.pos];return'"'===t[0]&&(t=t.slice(1,-1)),t},ah.prototype.getNumber=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=eu(e)?e:parseInt(this.tokens[this.pos],10)}catch(t){this.error("expected number")}},ah.prototype.getObject=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=Xe(e)?e:JSON.parse(this.tokens[this.pos])}catch(t){this.error("expected object")}},ah.prototype.getAny=function(){this.pos++;var t=this.tokens[this.pos];return t},ah.prototype.getPath=function(){var t=this.getString();return t.split(".")},sh.Tokenizer=ah;var ph=function(t){function e(e,n,o){if(t.call(this),"SKIP"!==arguments[0]){if(this.path=e,this.offset=n,this.after=o,!mn(e))throw new Error("Invalid arguments: path should be an array.");if(!eu(n)||n<0)throw new Error("Invalid arguments: offset must be a positive number.");Object.isFrozen(e)||Object.freeze(e)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isCoordinate:{}};return n._isCoordinate.get=function(){return!0},e.prototype.equals=function(t){return t===this||Op(t.path,this.path)&&t.offset===this.offset},e.prototype.withCharPos=function(t){return new e(this.path,t)},e.prototype.getNodeId=function(){return this.path[0]},e.prototype.getPath=function(){return this.path},e.prototype.getOffset=function(){return this.offset},e.prototype.toJSON=function(){return{path:this.path,offset:this.offset,after:this.after}},e.prototype.toString=function(){return"("+this.path.join(".")+", "+this.offset+")"},e.prototype.isPropertyCoordinate=function(){return this.path.length>1},e.prototype.isNodeCoordinate=function(){return 1===this.path.length},Object.defineProperties(e.prototype,n),e}(ba),ch=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isAnchor=function(){return!0},e}(ph),uh=function(){var t={};Object.defineProperty(this,"_internal",{enumerable:!1,value:t}),t.doc=null},hh={_isSelection:{}};hh._isSelection.get=function(){return!0},uh.prototype.clone=function(){var t=this._clone();return this._internal.doc&&t.attach(this._internal.doc),t},uh.prototype.getDocument=function(){var t=this._internal.doc;if(!t)throw new Error("Selection is not attached to a document.");return t},uh.prototype.isAttached=function(){return Boolean(this._internal.doc)},uh.prototype.attach=function(t){return this._internal.doc=t,this},uh.prototype.isNull=function(){return!1},uh.prototype.isPropertySelection=function(){return!1},uh.prototype.isContainerSelection=function(){return!1},uh.prototype.isNodeSelection=function(){return!1},uh.prototype.isCustomSelection=function(){return!1},uh.prototype.isCollapsed=function(){return!0},uh.prototype.isReverse=function(){return!1},uh.prototype.getType=function(){throw new Error("Selection.getType() is abstract.")},uh.prototype.equals=function(t){return this===t||!!t&&(this.isNull()===t.isNull()&&this.getType()===t.getType())},uh.prototype.toString=function(){return"null"},uh.prototype.toJSON=function(){throw new Error("This method is abstract.")},uh.prototype.getFragments=function(){return[]},Object.defineProperties(uh.prototype,hh);var fh=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNull=function(){return!0},e.prototype.getType=function(){return"null"},e.prototype.toJSON=function(){return null},e.prototype.clone=function(){return this},e}(uh);uh.nullSelection=Object.freeze(new fh);var lh=function(t){function e(e,n,o,r){t.call(this),this.type="selection-fragment",this.path=e,this.startOffset=n,this.endOffset=o||n,this.full=Boolean(r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isAnchor=function(){return!1},e.prototype.isInline=function(){return!1},e.prototype.isPropertyFragment=function(){return!0},e.prototype.isNodeFragment=function(){return!1},e.prototype.isFull=function(){return this.full},e.prototype.isPartial=function(){return!this.full},e.prototype.getNodeId=function(){return this.path[0]},e}(ba);uh.Fragment=lh;var dh=function(t){function e(e){t.call(this),this.type="node-fragment",this.nodeId=e,this.path=[e]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isAnchor=function(){return!1},e.prototype.isInline=function(){return!1},e.prototype.isPropertyFragment=function(){return!1},e.prototype.isNodeFragment=function(){return!0},e.prototype.isFull=function(){return!0},e.prototype.isPartial=function(){return!1},e.prototype.getNodeId=function(){return this.nodeId},e}(ba);uh.NodeFragment=dh;var yh=function(t){function e(e,n){t.call(this,e,n),this.type="cursor"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isPropertyFragment=function(){return!1},e.prototype.isNodeFragment=function(){return!1},e}(ch);uh.Cursor=yh;var gh=function(t,e,n,o){"SKIP"!==arguments[0]&&(this.start=t,this.end=e,this.reverse=Boolean(n),this.containerId=o)},mh={_isRange:{}};mh._isRange.get=function(){return!0},gh.prototype.isCollapsed=function(){return this.start.equals(this.end)},gh.prototype.equals=function(t){return this===t||this.containerId===t.containerId&&this.start.equals(t.start)&&this.end.equals(t.end)},gh.prototype.isReverse=function(){return this.reverse},gh.prototype.toString=function(){var t=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&t.push("(reverse)"),t.join("")},Object.defineProperties(gh.prototype,mh);var vh=function(t){function e(e,n,o,r,i,s){if(t.call(this),this.path=e,this.startOffset=n,this.endOffset=o,this.reverse=Boolean(r),this.containerId=i,this.surfaceId=s,!e||!eu(n))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this._internal.start=new _h(this,"path","startOffset"),this._internal.end=new _h(this,"path","endOffset"),this._internal.range=new bh(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return{type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset,reverse:this.reverse,containerId:this.containerId,surfaceId:this.surfaceId}},e.prototype.isPropertySelection=function(){return!0},e.prototype.getType=function(){return"property"},e.prototype.isNull=function(){return!1},e.prototype.isCollapsed=function(){return this.startOffset===this.endOffset},e.prototype.isReverse=function(){return this.reverse},e.prototype.equals=function(e){return t.prototype.equals.call(this,e)&&this.start.equals(e.start)&&this.end.equals(e.end);
},e.prototype.toString=function(){return["PropertySelection(",JSON.stringify(this.path),", ",this.startOffset," -> ",this.endOffset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},e.prototype.collapse=function(t){var e;return e="left"===t?this.startOffset:this.endOffset,this.createWithNewRange(e,e)},e.prototype.getRange=function(){return this.range},e.prototype.getPath=function(){return this.path},e.prototype.getNodeId=function(){return this.path[0]},e.prototype.getStartOffset=function(){return this.startOffset},e.prototype.getEndOffset=function(){return this.endOffset},e.prototype.isInsideOf=function(t,e){return!t.isNull()&&(t.isContainerSelection()?t.contains(this,e):e?Op(this.path,t.path)&&this.startOffset>t.startOffset&&this.endOffset<t.endOffset:Op(this.path,t.path)&&this.startOffset>=t.startOffset&&this.endOffset<=t.endOffset)},e.prototype.contains=function(t,e){return!t.isNull()&&t.isInsideOf(this,e)},e.prototype.overlaps=function(t,e){return!t.isNull()&&(t.isContainerSelection()?t.overlaps(this):!!Op(this.path,t.path)&&(e?!(this.startOffset>=t.endOffset||this.endOffset<=t.startOffset):!(this.startOffset>t.endOffset||this.endOffset<t.startOffset)))},e.prototype.isRightAlignedWith=function(t){return!t.isNull()&&(t.isContainerSelection()?t.isRightAlignedWith(this):Op(this.path,t.path)&&this.endOffset===t.endOffset)},e.prototype.isLeftAlignedWith=function(t){return!t.isNull()&&(t.isContainerSelection()?t.isLeftAlignedWith(this):Op(this.path,t.path)&&this.startOffset===t.startOffset)},e.prototype.expand=function(t){if(t.isNull())return this;if(t.isContainerSelection())return t.expand(this);if(!Op(this.path,t.path))throw new Error("Can not expand PropertySelection to a different property.");var e=Math.min(this.startOffset,t.startOffset),n=Math.max(this.endOffset,t.endOffset);return this.createWithNewRange(e,n)},e.prototype.truncateWith=function(e){if(e.isNull())return this;if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;var n,o;if(e.isPropertySelection())n=e.startOffset,o=e.endOffset;else{if(!e.isContainerSelection())return this;n=Op(e.startPath,this.path)?e.startOffset:this.startOffset,o=Op(e.endPath,this.path)?e.endOffset:this.endOffset}var r,i;if(this.startOffset>n&&this.endOffset>o)r=o,i=this.endOffset;else if(this.startOffset<n&&this.endOffset<o)r=this.startOffset,i=n;else if(this.startOffset===n){if(this.endOffset<=o)return t.nullSelection;r=o,i=this.endOffset}else{if(this.endOffset!==o){if(e.contains(this))return t.nullSelection;throw new Error("Illegal state.")}if(this.startOffset>=n)return t.nullSelection;r=this.startOffset,i=n}return this.createWithNewRange(r,i)},e.prototype.createWithNewRange=function(t,n){var o=new e(this.path,t,n,(!1),this.containerId,this.surfaceId),r=this._internal.doc;return r&&o.attach(r),o},e.prototype.getFragments=function(){if(this._internal.fragments)return this._internal.fragments;var e;return e=this.isCollapsed()?[new t.Cursor(this.path,this.startOffset)]:[new t.Fragment(this.path,this.startOffset,this.endOffset)],this._internal.fragments=e,e},e.prototype._clone=function(){return new e(this.path,this.startOffset,this.endOffset,this.reverse,this.containerId,this.surfaceId)},e}(uh);Object.defineProperties(vh.prototype,{start:{get:function(){return this._internal.start},set:function(){throw new Error("PropertySelection.prototype.start is read-only.")},enumerable:!1},end:{get:function(){return this._internal.end},set:function(){throw new Error("PropertySelection.prototype.end is read-only.")},enumerable:!1},range:{get:function(){return this._internal.range},set:function(){throw new Error("PropertySelection.prototype.range is read-only.")},enumerable:!1},startPath:{get:function(){return this.path},set:function(){throw new Error("immutable.")},enumerable:!1},endPath:{get:function(){return this.path},set:function(){throw new Error("immutable.")},enumerable:!1}}),vh.fromJSON=function(t){var e=t.path,n=t.startOffset,o=t.hasOwnProperty("endOffset")?t.endOffset:t.startOffset,r=t.reverse,i=t.containerId,s=t.surfaceId;return new vh(e,n,o,r,i,s)};var _h=function(t){function e(e,n,o){t.call(this,"SKIP"),this._sel=e,this._pathProp=n,this._offsetProp=o,Object.freeze(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ph);Object.defineProperties(_h.prototype,{path:{get:function(){return this._sel[this._pathProp]},set:function(t){this._sel[this._pathProp]=t}},offset:{get:function(){return this._sel[this._offsetProp]},set:function(t){this._sel[this._offsetProp]=t}}}),vh.CoordinateAdapter=_h;var bh=function(t){function e(e){t.call(this,"SKIP"),this._sel=e,this.start=e.start,this.end=e.end,Object.freeze(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(gh);Object.defineProperties(bh.prototype,{reverse:{get:function(){return this._sel.reverse},set:function(t){this._sel.reverse=t}},containerId:{get:function(){return this._sel.containerId},set:function(t){this._sel.containerId=t}},surfaceId:{get:function(){return this._sel.surfaceId},set:function(t){this._sel.surfaceId=t}}}),vh.RangeAdapter=bh;var wh=vh.CoordinateAdapter,Ch=vh.RangeAdapter,Sh=function(t){function e(e,n,o,r,i,s,a){if(t.call(this),this.containerId=e,this.startPath=n,this.startOffset=o,this.endPath=r,this.endOffset=i,this.reverse=Boolean(s),this.surfaceId=a,!(this.containerId&&this.startPath&&eu(this.startOffset)&&this.endPath&&eu(this.endOffset)))throw new Error("Invalid arguments: `containerId`, `startPath`, `startOffset`, `endPath`, and `endOffset` are mandatory");this._internal.start=new wh(this,"startPath","startOffset"),this._internal.end=new wh(this,"endPath","endOffset"),this._internal.range=new Ch(this)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isContainerSelection:{}};return n._isContainerSelection.get=function(){return!0},e.prototype.toJSON=function(){return{type:"container",containerId:this.containerId,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset,reverse:this.reverse,surfaceId:this.surfaceId}},e.prototype.isContainerSelection=function(){return!0},e.prototype.getType=function(){return"container"},e.prototype.isNull=function(){return!1},e.prototype.isCollapsed=function(){return this.start.equals(this.end)},e.prototype.isReverse=function(){return this.reverse},e.prototype.equals=function(e){return t.prototype.equals.call(this,e)&&this.containerId===e.containerId&&this.start.equals(e.start)&&this.end.equals(e.end)},e.prototype.toString=function(){return["ContainerSelection(",this.containerId,", ",JSON.stringify(this.startPath),", ",this.startOffset," -> ",JSON.stringify(this.startPath),", ",this.endOffset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},e.prototype.getContainer=function(){return this._internal.container||(this._internal.container=this.getDocument().get(this.containerId)),this._internal.container},e.prototype.isInsideOf=function(t,e){if(t.isNull())return!1;e=Boolean(e);var n=this._range(this),o=this._range(t);return o.start.isBefore(n.start,e)&&n.end.isBefore(o.end,e)},e.prototype.contains=function(t,e){if(t.isNull())return!1;e=Boolean(e);var n=this._range(this),o=this._range(t);return n.start.isBefore(o.start,e)&&o.end.isBefore(n.end,e)},e.prototype.containsNodeFragment=function(t,e){var n=this.getContainer(),o=new ph([t],0),r=n.getAddress(o),i=this._range(this),s=i.start.isBefore(r,e);return s&&(r.offset=1,s=i.end.isAfter(r,e)),s},e.prototype.overlaps=function(t){var e=this._range(this),n=this._range(t);return!(e.end.isBefore(n.start,!1)||n.end.isBefore(e.start,!1))},e.prototype.isLeftAlignedWith=function(t){var e=this._range(this),n=this._range(t);return e.start.isEqual(n.start)},e.prototype.isRightAlignedWith=function(t){var e=this._range(this),n=this._range(t);return e.end.isEqual(n.end)},e.prototype.containsNode=function(t){var e=this.getContainer(),n=e.getPosition(this.startPath[0]),o=e.getPosition(this.endPath[0]),r=e.getPosition(t);return!(n>r||o<r||n===r&&1===this.startPath.length&&this.startOffset>0||o===r&&1===this.endPath.length&&this.endOffset<1)},e.prototype.collapse=function(t){var e;return e="left"===t?this.start:this.end,_(this,e,e)},e.prototype.expand=function(t){var e,n,o=this._range(this),r=this._range(t);return e=o.start.isEqual(r.start)?new ph(this.start.path,Math.min(this.start.offset,t.start.offset)):o.start.isAfter(r.start)?new ph(t.start.path,t.start.offset):this.start,n=o.end.isEqual(r.end)?new ph(this.end.path,Math.max(this.end.offset,t.end.offset)):o.end.isBefore(r.end,!1)?new ph(t.end.path,t.end.offset):this.end,_(this,e,n)},e.prototype.truncateWith=function(e){if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;var n,o,r=this._range(this),i=this._range(e);if(i.start.isBefore(r.start,"strict")&&i.end.isBefore(r.end,"strict"))n=e.end,o=this.end;else if(r.start.isBefore(i.start,"strict")&&r.end.isBefore(i.end,"strict"))n=this.start,o=e.start;else if(r.start.isEqual(i.start)){if(!i.end.isBefore(r.end,"strict"))return t.nullSelection;n=e.end,o=this.end}else{if(!r.end.isEqual(i.end)){if(this.isInsideOf(e))return t.nullSelection;throw new Error("Could not determine coordinates for truncate. Check input")}if(!r.start.isBefore(i.start,"strict"))return t.nullSelection;n=this.start,o=e.start}return _(this,n,o)},e.prototype.getFragments=function(){if(this._internal.fragments)return this._internal.fragments;var e,n,o,r,i,s,a,p=[],c=this.getDocument(),u=this.getContainer(),h=u.getPosition(this.startPath[0]),f=u.getPosition(this.endPath[0]);if(h!==f){if(e=this.start,i=e.path,s=e.offset,o=i[0],n=c.get(o),!n)throw new Error("Node does not exist:"+o);e.isPropertyCoordinate()?(a=c.get(i),r=new t.Fragment(i,s,a.length,0===s),p.push(r)):e.isNodeCoordinate()&&0===s&&p.push(new t.NodeFragment(n.id));for(var l=h+1;l<f;l++)n=u.getChildAt(l),n.isText()?(i=[n.id,"content"],a=c.get(i),p.push(new t.Fragment(i,0,a.length,(!0)))):p.push(new t.NodeFragment(u.nodes[l]));if(e=this.end,i=e.path,s=e.offset,o=i[0],n=c.get(o),!n)throw new Error("Node does not exist:"+o);e.isPropertyCoordinate()?(a=c.get(i),r=new t.Fragment(i,0,s,s===a.length),p.push(r)):e.isNodeCoordinate()&&s>0&&p.push(new t.NodeFragment(n.id))}else{i=this.start.path,o=i[0],n=c.get(o);var d=this.start.isNodeCoordinate(),y=this.end.isNodeCoordinate();n.isText()?d&&y&&this.startOffset<this.endOffset?p.push(new t.NodeFragment(o)):!d&&y&&this.endOffset>0?(a=c.get(this.startPath),p.push(new t.Fragment(i,this.startOffset,a.length,0===this.startOffset))):d&&!y&&0===this.startOffset?(a=c.get(this.endPath),p.push(new t.Fragment(i,0,this.endOffset,this.endOffset===a.length))):d||y||(a=c.get(this.startPath),p.push(new t.Fragment(i,this.startOffset,this.endOffset,0===this.startOffset&&this.endOffset===a.length))):p.push(new t.NodeFragment(o))}return this._internal.fragments=p,p},e.prototype.splitIntoPropertySelections=function(){var e=[],n=this.getFragments();return n.forEach(function(n){n instanceof t.Fragment&&e.push(new vh(n.path,n.startOffset,n.endOffset,(!1),this.containerId,this.surfaceId))}.bind(this)),e},e.prototype._clone=function(){return new e(this.containerId,this.startPath,this.startOffset,this.endPath,this.endOffset,this.reverse,this.surfaceId)},e.prototype._range=function(t){if(t._internal.addressRange)return t._internal.addressRange;var e,n=this.getContainer(),o=n.getAddress(t.start);e=t.isCollapsed()?o:n.getAddress(t.end);var r={start:o,end:e};return t._isContainerSelection&&(t._internal.addressRange=r),r},Object.defineProperties(e.prototype,n),e}(uh);Object.defineProperties(Sh.prototype,{path:{get:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")},set:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead.")}},start:{get:function(){return this._internal.start},set:function(){throw new Error("ContainerSelection.prototype.start is read-only.")}},end:{get:function(){return this._internal.end},set:function(){throw new Error("ContainerSelection.prototype.end is read-only.")}},range:{get:function(){return this._internal.range},set:function(){throw new Error("ContainerSelection.prototype.range is read-only.")}}}),Sh.fromJSON=function(t){var e=t.containerId,n=t.startPath,o=t.endPath||t.startPath,r=t.startOffset,i=t.endOffset,s=Boolean(t.reverse),a=t.surfaceId,p=new Sh(e,n,r,o,i,s,a);return p};var xh=function(t){function e(e,n,o,r,i){if(t.call(this),!bn(e))throw new Error("'containerId' is mandatory.");if(!bn(n))throw new Error("'nodeId' is mandatory.");if(["full","before","after"].indexOf(o)<0)throw new Error("'mode' is mandatory.");this.containerId=e,this.nodeId=n,this.mode=o,this.reverse=Boolean(r),this.surfaceId=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isNodeSelection:{}};return n._isNodeSelection.get=function(){return!0},e.prototype.equals=function(e){return t.prototype.equals.call(this,e)&&this.nodeId===e.nodeId&&this.mode===e.mode},e.prototype.isNodeSelection=function(){return!0},e.prototype.getType=function(){return"node"},e.prototype.getNodeId=function(){return this.nodeId},e.prototype.isFull=function(){return"full"===this.mode},e.prototype.isBefore=function(){return"before"===this.mode},e.prototype.isAfter=function(){return"after"===this.mode},e.prototype.isCollapsed=function(){return"full"!==this.mode},e.prototype.toJSON=function(){return{containerId:this.containerId,nodeId:this.nodeId,mode:this.mode,reverse:this.reverse,surfaceId:this.surfaceId}},e.prototype.toString=function(){return["NodeSelection(",this.containerId,".",this.nodeId,", ",this.mode,", ",this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},e.prototype.collapse=function(t){if("left"===t)return this.isBefore()?this:new e(this.containerId,this.nodeId,"before",this.reverse,this.surfaceId);if("right"===t)return this.isAfter()?this:new e(this.containerId,this.nodeId,"after",this.reverse,this.surfaceId);throw new Error("'direction' must be either 'left' or 'right'")},e.prototype._getCoordinate=function(){return"before"===this.mode?new ph([this.nodeId],0):"after"===this.mode?new ph([this.nodeId],1):void 0},e.prototype._clone=function(){return new e(this.containerId,this.nodeId,this.mode,this.reverse,this.surfaceId)},Object.defineProperties(e.prototype,n),e}(uh);xh.fromJSON=function(t){return new xh(t.containerId,t.nodeId,t.mode,t.reverse)},xh._createFromRange=function(t){var e,n=t.containerId,o=t.start.getNodeId(),r=t.start.offset,i=t.end.offset,s=t.reverse;return e=r===i?0===r?"before":"after":"full",new xh(n,o,e,s)},xh._createFromCoordinate=function(t){var e=t.containerId,n=t.getNodeId(),o=0===t.offset?"before":"after";return new xh(e,n,o,(!1))};var Oh=function(t){function e(e,n,o){t.call(this),this.customType=e,this.data=n,this.surfaceId=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isCustomSelection=function(){return!0},e.prototype.getType=function(){return"custom"},e.prototype.getCustomType=function(){return this.customType},e.prototype.toJSON=function(){return{type:"custom",customType:this.customType,data:Zc(this.data),surfaceId:this.surfaceId}},e.prototype.toString=function(){return["CustomSelection(",this.customType,", ",JSON.stringify(this.data),")"].join("")},e.prototype.equals=function(e){return t.prototype.equals.call(this,e)&&e.isCustomSelection()&&Op(this.data,e.data)},e.prototype._clone=function(){return new e(this.customType,this.data,this.surfaceId)},e}(uh);Oh.fromJSON=function(t){return new Oh(t.customType,t.data||{},t.surfaceId)};var Eh=function(t,e,n){if(1===arguments.length&&Xe(arguments[0])){var o=arguments[0];this.sha=o.sha,this.timestamp=o.timestamp,this.before=o.before,this.ops=o.ops,this.info=o.info,this.after=o.after}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=h(),this.info={},this.timestamp=Date.now(),this.ops=t.slice(0),this.before=e,this.after=n}this.updated=null,this.created=null,this.deleted=null};Eh.prototype._extractInformation=function(t){function e(e){var n,o,a=e.val;switch(e.type){case"create":case"delete":a.hasOwnProperty("startOffset")&&(n=a.path||a.startPath,i[n]=!0),a.hasOwnProperty("endPath")&&(n=a.endPath,i[n]=!0);break;case"update":case"set":a=t.get(e.path[0]),a&&(o=e.path[1],a.isPropertyAnnotation()?"path"!==o&&"startOffset"!==o&&"endOffset"!==o||r[a.path[0]]||(i[a.path]=!0):a.isContainerAnnotation()&&("startPath"!==o&&"startOffset"!==o&&"endPath"!==o&&"endOffset"!==o||s.push(a)));break;default:throw new Error("Illegal state")}}for(var n=this.ops,o={},r={},i={},s=[],a=0;a<n.length;a++){var p=n[a];"create"===p.type&&(o[p.val.id]=p.val,delete r[p.val.id]),"delete"===p.type&&(delete o[p.val.id],r[p.val.id]=p.val),"set"!==p.type&&"update"!==p.type||(i[p.path]=!0),e(p)}s.forEach(function(e){for(var n=t.get(e.containerId,"strict"),o=n.getPosition(e.startPath[0]),s=n.getPosition(e.endPath[0]),a=o;a<=s;a++){var p,c=n.getChildAt(a);p=c.isText()?[c.id,"content"]:[c.id],r[c.id]||(i[p]=!0)}}),Object.keys(r).length>0&&va(i,function(t,e){var n=e.split(",")[0];r[n]&&delete i[e]}),this.created=o,this.deleted=r,this.updated=i},Eh.prototype.invert=function(){var t=this,e=this.toJSON();e.ops=[];var n=e.before;e.before=e.after,e.after=n;for(var o=Eh.fromJSON(e),r=[],i=this.ops.length-1;i>=0;i--)r.push(t.ops[i].invert());return o.ops=r,o},Eh.prototype.isAffected=function(t){return this.updated[t]},Eh.prototype.isUpdated=function(t){return this.isAffected(t)},Eh.prototype.serialize=function(){var t=new sh,e=this.toJSON();return e.ops=this.ops.map(function(e){return t.serialize(e)}),JSON.stringify(e)},Eh.prototype.clone=function(){return Eh.fromJSON(this.toJSON())},Eh.prototype.toJSON=function(){var t={sha:this.sha,before:Qc(this.before),ops:Aa(this.ops,function(t){return t.toJSON()}),info:this.info,after:Qc(this.after)};t.after.selection=void 0,t.before.selection=void 0;var e=this.before.selection;return e&&e._isSelection&&(t.before.selection=e.toJSON()),e=this.after.selection,e&&e._isSelection&&(t.after.selection=e.toJSON()),t},Eh.deserialize=function(t){var e=new sh,n=JSON.parse(t);return n.ops=n.ops.map(function(t){return e.deserialize(t)}),n.before.selection&&(n.before.selection=b(n.before.selection)),n.after.selection&&(n.after.selection=b(n.after.selection)),new Eh(n)},Eh.fromJSON=function(t){var e=Zc(t);return e.ops=t.ops.map(function(t){return Bu.fromJSON(t)}),e.before.selection=b(t.before.selection),e.after.selection=b(t.after.selection),new Eh(e)},Eh.transformInplace=function(t,e){C(t,e)},Eh.transformSelection=function(t,e){var n=t.clone(),o=S(n,e);return o?n:t};var Nh=function(t){function e(e){t.call(this),this.documentEngine=e,this._collaborators={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._register=function(t,e,n,o){var r=this._collaborators[t];r||(r=this._collaborators[t]={collaboratorId:t,documents:{}}),r.info=o,r.documents[e]={selection:n}},e.prototype._unregister=function(t,e){var n=this._collaborators[t];delete n.documents[e];var o=Object.keys(n.documents).length;0===o&&delete this._collaborators[t]},e.prototype._updateSelection=function(t,e,n){var o=this._collaborators[t].documents[e];o.selection=n},e.prototype.getDocumentIds=function(t){var e=this._collaborators[t];return e?Object.keys(e.documents):[]},e.prototype.getCollaborators=function(t,e){var n={};return va(this._collaborators,function(o){var r=o.documents[t];if(r&&o.collaboratorId!==e){var i={selection:r.selection,collaboratorId:o.collaboratorId};i=Sp({},o.info,i),n[o.collaboratorId]=i}}),n},e.prototype.getCollaboratorIds=function(t,e){var n=this.getCollaborators(t,e);return Aa(n,function(t){return t.collaboratorId})},e.prototype.sync=function(t,e){this._sync(t,function(n,o){return n?e(n):(this._register(t.collaboratorId,t.documentId,o.change.after.selection,t.collaboratorInfo),void e(null,o))}.bind(this))},e.prototype._sync=function(t,e){this.documentEngine.getVersion(t.documentId,function(n,o){o===t.version?this._syncFF(t,e):o>t.version?this._syncRB(t,e):e(new ve("InvalidVersionError",{message:"Client version greater than server version"}))}.bind(this))},e.prototype._updateCollaboratorSelections=function(t,e){var n=this.getCollaborators(t);va(n,function(n){if(n.selection){var o=b(n.selection);e=this.deserializeChange(e),o=Eh.transformSelection(o,e),this._updateSelection(n.collaboratorId,t,o.toJSON())}}.bind(this))},e.prototype._syncFF=function(t,e){return this._updateCollaboratorSelections(t.documentId,t.change),0===t.change.ops.length?e(null,{change:t.change,serverChange:null,version:t.version}):void this.documentEngine.addChange({documentId:t.documentId,change:t.change,documentInfo:t.documentInfo},function(n,o){return n?e(n):void e(null,{change:t.change,serverChange:null,version:o})})},e.prototype._syncRB=function(t,e){this._rebaseChange({documentId:t.documentId,change:t.change,version:t.version},function(n,o){return n?e(n):(this._updateCollaboratorSelections(t.documentId,o.change),0===t.change.ops.length?e(null,{change:o.change,serverChange:o.serverChange,version:o.version}):void this.documentEngine.addChange({documentId:t.documentId,change:o.change,documentInfo:t.documentInfo},function(t,n){return t?e(t):void e(null,{change:o.change,serverChange:o.serverChange,version:n})}))}.bind(this))},e.prototype._rebaseChange=function(t,e){this.documentEngine.getChanges({documentId:t.documentId,sinceVersion:t.version},function(n,o){var r=o.changes.map(this.deserializeChange),i=this.deserializeChange(t.change);Eh.transformInplace(i,r);var s=r.reduce(function(t,e){return t.concat(e.ops)},[]),a=new Eh(s,{},{});e(null,{change:this.serializeChange(i),serverChange:this.serializeChange(a),version:o.version})}.bind(this))},e.prototype.disconnect=function(t){this._unregister(t.collaboratorId,t.documentId)},e.prototype.serializeChange=function(t){return t.toJSON()},e.prototype.deserializeChange=function(t){var e=Eh.fromJSON(t);return e},e}(ba),Ih=function(t){function e(e){t.call(this),this.config=e,this._onConnection=this._onConnection.bind(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.bind=function(t){if(this.wss)throw new Error("Server is already bound to a websocket");this.wss=t,this._connections=new WeakMap,this._collaborators={},this.wss.on("connection",this._onConnection);var e=this.config.heartbeat;e&&(this._heartbeat=setInterval(this._sendHeartbeat.bind(this),e)),this._bound=!0},e.prototype.unbind=function(){if(!this._bound)throw new Error("Server is not yet bound to a websocket.");this.wss.off("connection",this._onConnection)},e.prototype.onConnection=function(){},e.prototype.onDisconnect=function(){},e.prototype.authenticate=function(t,e){t.setAuthenticated(),this.next(t,e)},e.prototype.authorize=function(t,e){t.setAuthorized(),this.next(t,e)},e.prototype.enhanceRequest=function(t,e){t.setEnhanced(),this.next(t,e)},e.prototype.execute=function(){throw new Error("This method needs to be specified")},e.prototype.enhanceResponse=function(t,e){e.setEnhanced(),this.next(t,e)},e.prototype._onConnection=function(t){var e=h(),n={collaboratorId:e};this._connections.set(t,n),this._collaborators[e]={connection:t},t.on("message",this._onMessage.bind(this,t)),t.on("close",this._onClose.bind(this,t))},e.prototype._onClose=function(t){var e=this._connections.get(t),n=e.collaboratorId;this.onDisconnect(n),delete this._collaborators[n],this._connections.delete(t)},e.prototype.__initial=function(t,e){return!t.isAuthenticated&&!t.isAuthorized&&!e.isReady},e.prototype.__authenticated=function(t,e){return t.isAuthenticated&&!t.isAuthorized&&!e.isReady},e.prototype.__authorized=function(t,e){return t.isAuthenticated&&t.isAuthorized&&!t.isEnhanced&&!e.isReady},e.prototype.__requestEnhanced=function(t,e){return t.isAuthenticated&&t.isAuthorized&&t.isEnhanced&&!e.isReady},e.prototype.__executed=function(t,e){return t.isAuthenticated&&t.isAuthorized&&e.isReady&&e.data&&!e.isEnhanced},e.prototype.__enhanced=function(t,e){return e.isReady&&e.isEnhanced&&!e.isSent},e.prototype.__error=function(t,e){return e.err&&!e.isSent},e.prototype.__done=function(t,e){return e.isSent},e.prototype.next=function(t,e){this.__initial(t,e)?this.authenticate(t,e):this.__authenticated(t,e)?this.authorize(t,e):this.__authorized(t,e)?this.enhanceRequest(t,e):this.__requestEnhanced(t,e)?this.execute(t,e):this.__executed(t,e)?this.enhanceResponse(t,e):this.__enhanced(t,e)?this.sendResponse(t,e):this.__error(t,e)?this.sendError(t,e):this.__done(t,e)},e.prototype.sendError=function(t,e){var n=t.message.collaboratorId,o=e.err;this.send(n,o),e.setSent(),this.next(t,e)},e.prototype._sendHeartbeat=function(){Object.keys(this._collaborators).forEach(function(t){this.send(t,{type:"highfive",scope:"_internal"})}.bind(this))},e.prototype.sendResponse=function(t,e){var n=t.message.collaboratorId;this.send(n,e.data),e.setSent(),this.next(t,e)},e.prototype._isWebsocketOpen=function(t){return t&&1===t.readyState},e.prototype.send=function(t,e){!e.scope&&this.config.scope&&(e.scope=this.config.scope);var n=this._collaborators[t].connection;this._isWebsocketOpen(n)?n.send(this.serializeMessage(e)):console.error("Server#send: Websocket for collaborator",t,"is no longer open",e)},e.prototype.broadCast=function(t,e){t.forEach(function(t){this.send(t,e)}.bind(this))},e.prototype._processRequest=function(t){var e=new Th;this.next(t,e)},e.prototype._onMessage=function(t,e){var n=this._connections.get(t);if(e=this.deserializeMessage(e),e.scope===this.scope){e.collaboratorId=n.collaboratorId;var o=new Ph(e,t);this._processRequest(o)}},e.prototype.serializeMessage=function(t){return JSON.stringify(t)},e.prototype.deserializeMessage=function(t){return JSON.parse(t)},e}(ba),Ph=function(t,e){this.message=t,this.ws=e,this.isAuthenticated=!1,this.isAuhorized=!1};Ph.prototype.setAuthenticated=function(t){this.isAuthenticated=!0,this.session=t},Ph.prototype.setAuthorized=function(t){this.isAuthorized=!0,this.authorizationData=t},Ph.prototype.setEnhanced=function(){this.isEnhanced=!0};var Th=function(){this.isReady=!1,this.isEnhanced=!1,this.isSent=!1,this.err=null,this.data=null};Th.prototype.error=function(t){this.err=t,this.isReady=!0},Th.prototype.send=function(t){this.data=t,this.isReady=!0},Th.prototype.setEnhanced=function(){this.isEnhanced=!0},Th.prototype.setSent=function(){this.isSent=!0};var jh=function(t){function e(e){t.call(this,e),this.scope="substance/collab",this.documentEngine=e.documentEngine,this.collabEngine=new Nh(this.documentEngine)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._error=function(t,e,n){e.error({type:"error",error:{name:t.message.type+"Error",cause:{name:n.name}},documentId:t.message.documentId}),this.next(t,e)},e.prototype.authenticate=function(e,n){this.config.authenticate?this.config.authenticate(e,function(t,o){return t?(console.error(t),void this._error(e,n,new ve("AuthenticationError",{cause:t}))):(e.setAuthenticated(o),void this.next(e,n))}.bind(this)):t.prototype.authenticate.apply(this,arguments)},e.prototype.enhanceRequest=function(e,n){this.config.enhanceRequest?this.config.enhanceRequest(e,function(t){return t?(console.error("enhanceRequest returned an error",t),void this._error(e,n,t)):(e.setEnhanced(),void this.next(e,n))}.bind(this)):t.prototype.enhanceRequest.apply(this,arguments)},e.prototype.onDisconnect=function(t){var e=this.collabEngine.getDocumentIds(t);e.forEach(function(e){this._disconnectDocument(t,e)}.bind(this))},e.prototype.execute=function(t,e){var n=t.message,o=this[n.type];o?o.call(this,t,e):console.error("Method",n.type,"not implemented for CollabServer")},e.prototype.sync=function(t,e){var n=t.message;this.collabEngine.sync(n,function(o,r){if(o)return void this._error(t,e,o);var i=this.collabEngine.getCollaborators(n.documentId,n.collaboratorId);e.send({scope:this.scope,type:"syncDone",documentId:n.documentId,version:r.version,serverChange:r.serverChange,collaborators:i}),va(i,function(t){this.send(t.collaboratorId,{scope:this.scope,type:"update",documentId:n.documentId,version:r.version,change:r.change,collaborators:this.collabEngine.getCollaborators(n.documentId,t.collaboratorId)})}.bind(this)),this.next(t,e)}.bind(this))},e.prototype.disconnect=function(t,e){var n=t.message,o=n.collaboratorId,r=n.documentId;this._disconnectDocument(o,r),e.send({scope:this.scope,type:"disconnectDone",documentId:n.documentId}),this.next(t,e)},e.prototype._disconnectDocument=function(t,e){var n=this.collabEngine.getCollaboratorIds(e,t),o={};o[t]=null,this.broadCast(n,{scope:this.scope,type:"update",documentId:e,collaborators:o}),this.collabEngine.disconnect({documentId:e,collaboratorId:t})},e}(Ih),Dh=i(function(t){function e(){return Date.now()}t.exports=e}),Ah=r(Dh),Mh=Object.freeze({default:Ah}),kh=i(function(t){function e(t,e,r){function c(e){var n=v,o=_;return v=_=void 0,x=e,w=t.apply(o,n)}function u(t){return x=t,C=setTimeout(l,e),O?c(t):w}function h(t){var n=t-S,o=t-x,r=e-n;return E?p(r,b-o):r}function f(t){var n=t-S,o=t-x;return void 0===S||n>=e||n<0||E&&o>=b}function l(){var t=o();return f(t)?d(t):void(C=setTimeout(l,h(t)))}function d(t){return C=void 0,N&&v?c(t):(v=_=void 0,w)}function y(){x=0,v=S=_=C=void 0}function g(){return void 0===C?w:d(o())}function m(){var t=o(),n=f(t);if(v=arguments,_=this,S=t,n){if(void 0===C)return u(S);if(E)return C=setTimeout(l,e),c(S)}return void 0===C&&(C=setTimeout(l,e)),w}var v,_,b,w,C,S,x=0,O=!1,E=!1,N=!0;if("function"!=typeof t)throw new TypeError(s);return e=i(e)||0,n(r)&&(O=!!r.leading,E="maxWait"in r,b=E?a(i(r.maxWait)||0,e):b,N="trailing"in r?!!r.trailing:N),m.cancel=y,m.flush=g,m}var n=r(Ge),o=r(Mh),i=r(Ka),s="Expected a function",a=Math.max,p=Math.min;t.exports=e}),Lh=r(kh),Rh=i(function(t){function e(t){if(!i(t)||h.call(t)!=s||o(t))return!1;var e=n(t);if(null===e)return!0;var r=c.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&p.call(r)==u}var n=r(De),o=r(Io),i=r(cn),s="[object Object]",a=Object.prototype,p=Function.prototype.toString,c=a.hasOwnProperty,u=p.call(Object),h=a.toString;t.exports=e}),zh=r(Rh),Fh=i(function(t){t.exports=r(_a)}),Bh=r(Fh),Hh=function(){},Uh=function(){};Uh.prototype.get=function(t){return arguments.length>1&&(t=Array.prototype.slice(arguments,0)),bn(t)&&(t=[t]),Js(this,t)},Uh.prototype.getAll=function(t){if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),bn(t)&&(t=[t]),!mn(t))throw new Error("Illegal argument for TreeIndex.get()");var e=Js(this,t);return this._collectValues(e)},Uh.prototype.set=function(t,e){bn(t)&&(t=[t]),su(this,t,e,function(t){if(!t)return new Hh})},Uh.prototype.delete=function(t){if(bn(t))delete this[t];else if(1===t.length)delete this[t[0]];else{var e=t[t.length-1];t=t.slice(0,-1);var n=Js(this,t);n&&delete n[e]}},Uh.prototype.clear=function(){var t=this;for(var e in t)t.hasOwnProperty(e)&&delete t[e]},Uh.prototype.traverse=function(t){this._traverse(this,[],t)},Uh.prototype.forEach=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];(n=this).traverse.apply(n,t);var n},Uh.prototype._traverse=function(t,e,n){var o,r=this;for(o in t)if(t.hasOwnProperty(o)){var i=t[o],s=e.concat([o]);i instanceof Hh?r._traverse(i,s,n):n(i,s)}},Uh.prototype._collectValues=function(t){var e={};return this._traverse(t,[],function(t,n){var o=n[n.length-1];e[o]=t}),e};var Vh=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(e){var n=t.prototype.get.call(this,e);return n instanceof Hh&&(n=n.__values__||[]),n},e.prototype.set=function(){throw new Error("TreeIndex.set() is not supported for array type.");
},e.prototype.add=function(t,e){if(bn(t)&&(t=[t]),!mn(t))throw new Error("Illegal arguments.");var n;su(this,t.concat(["__values__","__dummy__"]),void 0,function(t,e){return"__values__"===e?(t||(t=[]),n=t):t||(t=new Hh),t}),delete n.__dummy__,n.push(e)},e.prototype.remove=function(t,e){var n=Js(this,t);n instanceof Hh&&O(n.__values__,e)},e.prototype._collectValues=function(t){var e=[];return this._traverse(t,[],function(t){e.push(t)}),e=Array.prototype.concat.apply([],e)},e}(Uh);Uh.Arrays=Vh;var qh=function(){this.index=new Uh,this._property="id"},Jh={property:{}};qh.prototype.get=function(t){return this.index.get(t)||{}},qh.prototype.getAll=function(t){return this.index.getAll(t)},Jh.property.get=function(){return this._property},Jh.property.set=function(t){this._property=t},qh.prototype.select=function(t){return!this.type||t.isInstanceOf(this.type)},qh.prototype.create=function(t){var e=t[this.property];mn(e)||(e=[e]),Bh(e,function(e){this.index.set([e,t.id],t)}.bind(this))},qh.prototype.delete=function(t){var e=t[this.property];mn(e)||(e=[e]),Bh(e,function(e){this.index.delete([e,t.id])}.bind(this))},qh.prototype.update=function(t,e,n,o){if(this.select(t)&&e[1]===this.property){var r=o;mn(r)||(r=[r]),Bh(r,function(e){this.index.delete([e,t.id])}.bind(this)),r=n,mn(r)||(r=[r]),Bh(r,function(e){this.index.set([e,t.id],t)}.bind(this))}},qh.prototype.set=function(t,e,n,o){this.update(t,e,n,o)},qh.prototype.reset=function(t){this.index.clear(),this._initialize(t)},qh.prototype.clone=function t(){var e=this.constructor,t=new e;return t},qh.prototype._initialize=function(t){Bh(t.getNodes(),function(t){this.select(t)&&this.create(t)}.bind(this))},Object.defineProperties(qh.prototype,Jh),qh.create=function(t){var e=Object.assign(new qh,t);return e.clone=function(){return qh.create(t)},e},qh.filterByType=function(t){return function(e){return e.isInstanceOf(t)}};var $h=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(qh),Wh=i(function(t){function e(t,e){for(var n=-1,o=t?t.length:0,r=0,i=[];++n<o;){var s=t[n];e(s,n,t)&&(i[r++]=s)}return i}t.exports=e}),Kh=r(Wh),Xh=Object.freeze({default:Kh}),Gh=i(function(t){function e(t,e){var o=[];return n(t,function(t,n,r){e(t,n,r)&&o.push(t)}),o}var n=r(Un);t.exports=e}),Qh=r(Gh),Yh=Object.freeze({default:Qh}),Zh=i(function(t){function e(t,e){var r=s(t)?n:o;return r(t,i(e,3))}var n=r(Xh),o=r(Yh),i=r(ga),s=r(vn);t.exports=e}),tf=r(Zh),ef=function(t){function e(){t.call(this),this.byPath=new Uh,this.byType=new Uh}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={property:{}};return n.property.get=function(){return"path"},e.prototype.select=function(t){return Boolean(t._isPropertyAnnotation)},e.prototype.reset=function(t){this.byPath.clear(),this.byType.clear(),this._initialize(t)},e.prototype.get=function(n,o,r,i){var s;return s=bn(n)||1===n.length?this.byPath.getAll(n)||{}:this.byPath.get(n),s=Aa(s),eu(o)&&(s=tf(s,e.filterByRange(o,r))),i&&(s=tf(s,t.filterByType(i))),s},e.prototype.create=function(t){this.byType.set([t.type,t.id],t),this.byPath.set(t.path.concat([t.id]),t)},e.prototype.delete=function(t){this.byType.delete([t.type,t.id]),this.byPath.delete(t.path.concat([t.id]))},e.prototype.update=function(t,e,n,o){this.select(t)&&e[1]===this.property&&(this.delete({id:t.id,type:t.type,path:o}),this.create(t))},Object.defineProperties(e.prototype,n),e}($h);ef.filterByRange=function(t,e){return function(n){var o=n.startOffset,r=n.endOffset,i=r>=t;return eu(e)&&(i=i&&o<=e),i}};var nf=function(t){function e(){t.call(this),this.byId=new Uh}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.select=function(t){return Boolean(t._isContainerAnnotation)},e.prototype.reset=function(t){this.byId.clear(),this._initialize(t)},e.prototype.get=function(e,n){var o=Aa(this.byId.get(e));return bn(n)&&(o=tf(o,t.filterByType)),o},e.prototype.create=function(t){this.byId.set([t.containerId,t.id],t)},e.prototype.delete=function(t){this.byId.delete([t.containerId,t.id])},e.prototype.update=function(t,e,n,o){},e}($h),of=function(t){function e(e){t.call(this),this.doc=e,this.byPath=new Uh.Arrays,this.byId={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.select=function(t){return t._isContainerAnnotation},e.prototype.reset=function(t){this.byPath.clear(),this.byId={},this._initialize(t)},e.prototype.get=function(t,e){var n=this.byPath.getAll(t);return e?tf(n,function(t){return t.containerId===e}):n.slice(0)},e.prototype.create=function(t){var e=t.getStartAnchor(),n=t.getEndAnchor();this.byPath.add(e.path,e),this.byPath.add(n.path,n),this.byId[t.id]=t},e.prototype.delete=function(t){var e=t.getStartAnchor(),n=t.getEndAnchor();this.byPath.remove(e.path,e),this.byPath.remove(n.path,n),delete this.byId[t.id]},e.prototype.update=function(t,e,n,o){if(this.select(t)){var r=null;if("startPath"===e[1])r=t.getStartAnchor();else{if("endPath"!==e[1])return;r=t.getEndAnchor()}this.byPath.remove(o,r),this.byPath.add(r.path,r)}},e}($h),rf=function(t){this.listeners=new Uh.Arrays,this._list=[],this.doc=t};rf.prototype.on=function(t,e,n){this._add(n,t,e)},rf.prototype.off=function(t,e,n){this._remove(t,e,n)},rf.prototype.connect=function(t,e,n){console.warn("DEPRECATED: use proxy.on(path, this.onPropertyChange, this) instead"),this.on(e,n,t)},rf.prototype.disconnect=function(t){console.warn("DEPRECATED: use proxy.off(this) instead"),this.off(t)},rf.prototype.onDocumentChanged=function(t,e,n){if(0!==this._list.length){var o=this.listeners;va(t.updated,function(r,i){var s=o.get(i.split(","));mn(s)&&(s=s.slice(0)),va(s,function(o){o.method.call(o.listener,t,e,n)})})}},rf.prototype._add=function(t,e,n){if(!n)throw new Error("Invalid argument: expected function but got "+n);var o={listener:t,path:e,method:n};this.listeners.add(e,o),this._list.push(o)},rf.prototype._remove=function(t,e,n){for(var o=this,r=0;r<this._list.length;r++){var i=o._list[r],s=(!e||Op(i.path,e))&&(!t||i.listener===t)&&(!n||i.method!==n);if(s){var a=o._list[r];o._list.splice(r,1),o.listeners.remove(a.path,a)}}};var sf=function(t){this.nodeRegistry=t};sf.prototype.create=function(t,e){var n=this.nodeRegistry.get(t);if(!n)throw new Error("No Node registered by that name: "+t);return new n(e)};var af=function(t){function e(e,n){t.call(this),n=n||{},this.schema=e,this.nodes=new wu,this.indexes={},this.options=n||{},this.nodeFactory=n.nodeFactory||new sf(e.nodeRegistry),this.__QUEUE_INDEXING__=!1,this.queue=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){return this.nodes.contains(t)},e.prototype.get=function(t,e){if(!t)throw new Error("Path or id required");var n=this.nodes.get(t);if(e&&void 0===n)throw bn(t)?new Error("Could not find node with id '"+t+"'."):new Error("Property for path '"+t+"' us undefined.");return n},e.prototype.getNodes=function(){return this.nodes},e.prototype.create=function(t){var e=this.nodeFactory.create(t.type,t);if(!e)throw new Error("Illegal argument: could not create node for data:",t);if(this.contains(e.id))throw new Error("Node already exists: "+e.id);if(!e.id||!e.type)throw new Error("Node id and type are mandatory.");this.nodes[e.id]=e;var n={type:"create",node:e};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),e},e.prototype.delete=function(t){var e=this.nodes[t];e.dispose(),delete this.nodes[t];var n={type:"delete",node:e};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),e},e.prototype.set=function(t,e){var n=this.get(t[0]),o=this.nodes.get(t);this.nodes.set(t,e);var r={type:"set",node:n,path:t,newValue:e,oldValue:o};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),o},e.prototype.update=function(t,e){var n,o=this.nodes.get(t);if(e.isOperation)n=e.apply(o);else{var r,i,s,a;if(bn(o))if(e.delete)r=e.delete.start,i=e.delete.end,n=o.split("").splice(r,i-r).join("");else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));s=e.insert.offset,a=e.insert.value,n=[o.substring(0,s),a,o.substring(s)].join("")}else{if(!mn(o))throw new Error("Diff is not supported:",JSON.stringify(e));if(n=o.slice(0),e.delete)s=e.delete.offset,n.splice(s,1);else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));s=e.insert.offset,a=e.insert.value,n.splice(s,0,a)}}}this.nodes.set(t,n);var p=this.get(t[0]),c={type:"update",node:p,path:t,newValue:n,oldValue:o};return this.__QUEUE_INDEXING__?this.queue.push(c):this._updateIndexes(c),o},e.prototype.toJSON=function(){return{schema:[this.schema.id,this.schema.version],nodes:Zc(this.nodes)}},e.prototype.reset=function(){this.nodes.clear()},e.prototype.addIndex=function(t,e){return this.indexes[t]&&console.error("Index with name %s already exists.",t),e.reset(this),this.indexes[t]=e,e},e.prototype.getIndex=function(t){return this.indexes[t]},e.prototype._updateIndexes=function(t){t&&!this.__QUEUE_INDEXING__&&Bh(this.indexes,function(e){e.select(t.node)&&(e[t.type]||console.error("Contract: every NodeIndex must implement "+t.type),e[t.type](t.node,t.path,t.newValue,t.oldValue))})},e.prototype._stopIndexing=function(){this.__QUEUE_INDEXING__=!0},e.prototype._startIndexing=function(){var t=this;for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var e=t.queue.shift();t._updateIndexes(e)}},e}(ba),pf=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.create=function(t){var e=Bu.Create([t.id],t);return this.apply(e),e},e.prototype.delete=function(t){var e=null,n=this.get(t);if(n){var o=n.toJSON();e=Bu.Delete([t],o),this.apply(e)}return e},e.prototype.update=function(t,e){var n=this._getDiffOp(t,e),o=Bu.Update(t,n);return this.apply(o),o},e.prototype.set=function(t,e){var n=this.get(t),o=Bu.Set(t,n,e);return this.apply(o),o},e.prototype.apply=function(e){if(e.type!==Bu.NOP){if(e.type===Bu.CREATE)t.prototype.create.call(this,Zc(e.val));else if(e.type===Bu.DELETE)t.prototype.delete.call(this,e.val.id);else if(e.type===Bu.UPDATE){var n=this.get(e.path),o=e.diff;if("array"===e.propertyType)o._isArrayOperation||(o=Du.fromJSON(o)),o.apply(n);else{if("string"!==e.propertyType)throw new Error("Unsupported type for operational update.");o._isTextOperation||(o=Nu.fromJSON(o));var r=o.apply(n);t.prototype.set.call(this,e.path,r)}}else{if(e.type!==Bu.SET)throw new Error("Illegal state.");t.prototype.set.call(this,e.path,e.val)}this.emit("operation:applied",e,this)}},e.prototype._getDiffOp=function(t,e){var n=null;if(e.isOperation)n=e;else{var o,r,i,s,a=this.get(t);if(null===a||void 0===a)throw new Error("Property has not been initialized: "+JSON.stringify(t));bn(a)?e.delete?(o=e.delete.start,r=e.delete.end,n=Nu.Delete(o,a.substring(o,r))):e.insert&&(i=e.insert.offset,s=e.insert.value,n=Nu.Insert(i,s)):mn(a)&&(e.delete?(i=e.delete.offset,n=Du.Delete(i,a[i])):e.insert&&(i=e.insert.offset,s=e.insert.value,n=Du.Insert(i,s)))}if(!n)throw new Error("Unsupported diff: "+JSON.stringify(e));return n},e}(af),cf=function(t){this.doc=t};cf.prototype.create=function(t,e){var n=this.doc.schema.getNodeClass(t);if(!n)throw new Error("No node registered by that name: "+t);return new n(this.doc,e)};var uf={};uf.isContainerAnnotation=function(t,e){var n=t.getSchema();return n.isInstanceOf(e,"container-annotation")},uf.getPropertyAnnotationsForSelection=function(t,e,n){if(n=n||{},!e.isPropertySelection())return[];var o=t.getIndex("annotations").get(e.path,e.startOffset,e.endOffset);return n.type&&(o=tf(o,$h.filterByType(n.type))),o},uf.getContainerAnnotationsForSelection=function(t,e,n,o){if(!n)throw new Error("'containerId' is required.");o=o||{};var r=t.getIndex("container-annotations"),i=r.get(n,o.type);return i=tf(i,function(t){return e.overlaps(t.getSelection())})},uf.getAnnotationsForSelection=function(t,e,n,o){var r,i=uf.isContainerAnnotation(t,n);if(i){var s=t.get(o,"strict");r=uf.getContainerAnnotationsForSelection(t,e,s,{type:n})}else r=uf.getPropertyAnnotationsForSelection(t,e,{type:n});return r},uf.getTextForSelection=function(t,e){var n;if(!e||e.isNull())return"";if(e.isPropertySelection())return n=t.get(e.start.path),n.substring(e.start.offset,e.end.offset);if(e.isContainerSelection()){var o=[],r=e.getFragments();return r.forEach(function(e){if(e instanceof uh.Fragment){var n=t.get(e.path);bn(n)&&o.push(n.substring(e.startOffset,e.endOffset))}}),o.join("\n")}};var hf=function(){};hf.prototype.importDocument=function(t,e){if(!e.schema||!mn(e.nodes))throw new Error("Invalid JSON format.");var n=t.getSchema();if(n.name!==e.schema.name)throw new Error("Incompatible schema.");n.version!==e.schema.version&&console.error("Different schema version. Conversion might be problematic.");var o=e.nodes;return t.import(function(t){va(o,function(e){t.get(e.id)&&t.delete(e.id),t.create(e)})}),t},hf.prototype.exportDocument=function(t){var e=t.getSchema(),n={schema:{name:e.name,version:e.version},nodes:[]};return va(t.getNodes(),function(t){t._isDocumentNode&&n.nodes.push(t.toJSON())}),n};var ff=new hf,lf=0,df=function(t){function e(e){if(t.call(this),"SKIP"!==arguments[0]){if(this.__id__=lf++,!e)throw new Error("A document needs a schema for reflection.");this.schema=e,this.nodeFactory=new cf(this),this.data=new pf(e,{nodeFactory:this.nodeFactory}),this.addIndex("type",$h.create({property:"type"})),this.addIndex("annotations",new ef),this.addIndex("container-annotations",new nf),this.addIndex("container-annotation-anchors",new of),this.eventProxies={path:new rf(this)},this.on("document:changed",this._updateEventProxies,this)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isDocument:{}};return n._isDocument.get=function(){return!0},e.prototype.getSchema=function(){return this.schema},e.prototype.contains=function(t){return this.data.contains(t)},e.prototype.get=function(t,e){return this.data.get(t,e)},e.prototype.getNodes=function(){return this.data.getNodes()},e.prototype.import=function(t){try{this.data._stopIndexing(),t(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}},e.prototype.create=function(t){t.id||(t.id=h(t.type));var e=this._create(t),n=new Eh([e],{},{});return n._extractInformation(this),this._notifyChangeListeners(n),this.data.get(t.id)},e.prototype.delete=function(t){var e=this.get(t),n=this._delete(t),o=new Eh([n],{},{});return o._extractInformation(this),this._notifyChangeListeners(o),e},e.prototype.set=function(t,e){var n=this.get(t),o=this._set(t,e),r=new Eh([o],{},{});return r._extractInformation(this),this._notifyChangeListeners(r),n},e.prototype.update=function(t,e){var n=this._update(t,e),o=new Eh([n],{},{});return o._extractInformation(this),this._notifyChangeListeners(o),n},e.prototype.addIndex=function(t,e){return this.data.addIndex(t,e)},e.prototype.getIndex=function(t){return this.data.getIndex(t)},e.prototype.createSelection=function(){var t=E.apply(this,arguments);return t.isNull()||t.attach(this),t},e.prototype.getEventProxy=function(t){return this.eventProxies[t]},e.prototype.newInstance=function(){var t=this.constructor;return new t(this.schema)},e.prototype.createSnippet=function(){var t=this.newInstance(),n=t.create({type:"container",id:e.SNIPPET_ID});return t.getContainer=function(){return n},t.show=function(){n.show.apply(n,arguments)},t},e.prototype.fromSnapshot=function(t){var e=this.newInstance();return e.loadSeed(t),e},e.prototype.getDocumentMeta=function(){return this.get("document")},e.prototype._apply=function(t){Bh(t.ops,function(t){this.data.apply(t),this.emit("operation:applied",t)}.bind(this)),t._extractInformation(this)},e.prototype._notifyChangeListeners=function(t,e){e=e||{},this.emit("document:changed",t,e,this)},e.prototype._updateEventProxies=function(t,e){Bh(this.eventProxies,function(n){n.onDocumentChanged(t,e,this)}.bind(this))},e.prototype.loadSeed=function(t){Bh(this.data.nodes,function(t){this.delete(t.id)}.bind(this)),Bh(t.nodes,function(t){this.create(t)}.bind(this))},e.prototype.toJSON=function(){return ff.exportDocument(this)},e.prototype.getTextForSelection=function(t){return console.warn("DEPRECATED: use docHelpers.getTextForSelection() instead."),uf.getTextForSelection(this,t)},e.prototype.setText=function(t,e,n){var o,r=this,i=this.getIndex("annotations").get(t);for(o=0;o<i.length;o++)r.delete(i[o].id);for(this.set(t,e),o=0;o<n.length;o++)r.create(n[o])},e.prototype._create=function(t){var e=this.data.create(t);return e},e.prototype._delete=function(t){var e=this.data.delete(t);return e},e.prototype._update=function(t,e){var n=this.data.update(t,e);return n},e.prototype._set=function(t,e){var n=this.data.set(t,e);return n},Object.defineProperties(e.prototype,n),e}(ba);df.SNIPPET_ID="snippet",df.TEXT_SNIPPET_ID="text-snippet";var yf=0,gf=function(t){function e(e,n){t.call(this,"SKIP"),this.__id__="TX_"+yf++,this.schema=e.schema,this.nodeFactory=new cf(this),this.data=new pf(this.schema,{nodeFactory:this.nodeFactory}),this.document=e,this.session=n,this.ops=[],this.before={},Bh(e.data.indexes,function(t,e){this.data.addIndex(e,t.clone())}.bind(this)),this.loadSeed(e.toJSON())}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={isTransactionDocument:{}};return n.isTransactionDocument.get=function(){return!0},e.prototype.reset=function(){this.ops=[],this.before={}},e.prototype.create=function(t){if(t.id||(t.id=h(t.type)),!t.type)throw new Error("No node type provided");var e=this.data.create(t);if(e)return this.ops.push(e),this.data.get(t.id)},e.prototype.delete=function(t){var e=this.data.delete(t);if(e)return this.ops.push(e),e},e.prototype.set=function(t,e){var n=this.data.set(t,e);if(n)return this.ops.push(n),n},e.prototype.update=function(t,e){var n=this.data.update(t,e);if(n)return this.ops.push(n),n},e.prototype.cancel=function(){this._cancelTransaction()},e.prototype.getOperations=function(){return this.ops},e.prototype._apply=function(t){t.ops.forEach(function(t){this.data.apply(t)}.bind(this))},e.prototype._transaction=function(t){if(!Ye(t))throw new Error("Document.transaction() requires a transformation function.");this._startTransaction();try{if(t(this,{}),!this._isCancelled)return this._saveTransaction()}finally{this._isSaved||this.cancel(),this.session.isTransacting=!1}},e.prototype._startTransaction=function(){this.before={},this.after={},this.info={},this._isCancelled=!1,this._isSaved=!1,this.document.emit("transaction:started",this)},e.prototype._saveTransaction=function(){if(!this._isCancelled){var t,e=this.before,n=Sp({},e,this.after),o=this.ops;return o.length>0&&(t=new Eh(o,e,n)),this._isSaved=!0,this.reset(),t}},e.prototype._cancelTransaction=function(){for(var t=this,e=this.ops.length-1;e>=0;e--)t.data.apply(t.ops[e].invert());this._isCancelled=!0,this.reset()},e.prototype.newInstance=function(){return this.document.newInstance()},Object.defineProperties(e.prototype,n),e}(df),mf=function(){};mf.prototype.shouldMerge=function(t,e){return!1},mf.prototype.merge=function(t,e){var n=t.ops[0],o=e.ops[0],r=n.diff,i=o.diff,s=!1;return r.isInsert()?r.pos+r.getLength()===i.pos&&(s=n.toJSON(),s.diff.str+=i.str):r.isDelete()&&(r.pos===i.pos?(s=n.toJSON(),s.diff.str+=i.str):i.pos+i.getLength()===r.pos&&(s=n.toJSON(),s.diff=i,s.diff.str+=r.str)),!!s&&(t.ops[0]=Bu.fromJSON(s),t.ops.length>1&&(t.ops=t.ops.concat(e.ops.slice(1)),t.after=e.after),!0)};var vf=function(t){this.document=t,this.selection=uh.nullSelection,this._state={},this._resetState()};vf.prototype.setSelection=function(t){return t?t.attach(this.document):t=uh.nullSelection,this._deriveState(t),this.selection=t,!0},vf.prototype.getSelection=function(){return this.selection},vf.prototype.getAnnotationsForType=function(t){var e=this._state;return e.annosByType?e.annosByType.get(t)||[]:[]},vf.prototype.isInlineNodeSelection=function(){return this._state.isInlineNodeSelection},vf.prototype._deriveState=function(t){var e=this.document;this._resetState();var n=this._state,o=new Uh.Arrays,r=uf.getPropertyAnnotationsForSelection(e,t);r.forEach(function(t){o.add(t.type,t)}),1===r.length&&r[0].isInline()&&(n.isInlineNodeSelection=r[0].getSelection().equals(t));var i=t.containerId;if(i){var s=uf.getContainerAnnotationsForSelection(e,t,i);s.forEach(function(t){o.add(t.type,t)})}n.annosByType=o},vf.prototype._resetState=function(){return this._state={annosByType:null,isNodeSelection:!1,nodeId:null,nodeSelectionMode:"",isInlineNodeSelection:!1},this._state};var _f=0,bf=function(t){function e(e,n){t.call(this),this.__id__=_f++,n=n||{},this.doc=e,this.selectionState=new vf(e),this.stage=new gf(this.doc,this),this.isTransacting=!1,this.doneChanges=[],this.undoneChanges=[],this._lastChange=null,this.compressor=n.compressor||new mf,this.saveHandler=n.saveHandler,this.doc.on("document:changed",this.onDocumentChange,this,{priority:1e3})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDocument=function(){return this.doc},e.prototype.getSelection=function(){return this.selectionState.getSelection()},e.prototype.setSelection=function(t){t&&zh(t)&&(t=this.doc.createSelection(t));var e=this._setSelection(t);e&&this._triggerUpdateEvent({selection:t})},e.prototype.createSelection=function(){return this.doc.createSelection.apply(this.doc,arguments)},e.prototype.getSelectionState=function(){return this.selectionState},e.prototype.setSaveHandler=function(t){this.saveHandler=t},e.prototype.getCollaborators=function(){return null},e.prototype.canUndo=function(){return this.doneChanges.length>0},e.prototype.canRedo=function(){return this.undoneChanges.length>0},e.prototype.undo=function(){this._undoRedo("undo")},e.prototype.redo=function(){this._undoRedo("redo")},e.prototype._undoRedo=function(t){var e,n;"redo"===t?(e=this.undoneChanges,n=this.doneChanges):(e=this.doneChanges,n=this.undoneChanges);var o=e.pop();if(o){this.stage._apply(o),this.doc._apply(o);var r=o.after.selection;r&&r.attach(this.doc);var i=this._setSelection(r);n.push(o.invert());var s={change:o};i&&(s.selection=r),this._triggerUpdateEvent(s,{replay:!0})}else console.warn("No change can be %s.","undo"===t?"undone":"redone")},e.prototype.transaction=function(t,e){if(this.isTransacting)throw new Error("Nested transactions are not supported.");this.isTransacting=!0,this.stage.reset();var n=this.getSelection();e=e||{};var o=n.surfaceId,r=this.stage._transaction(function(r){r.before.selection=n;var i={selection:n},s=t(r,i)||{};n=s.selection||n,!n._isSelection||n.isNull()||n.surfaceId||(n.surfaceId=o),r.after.selection=n,Sp(e,r.info)});return r?(this.isTransacting=!1,this._commit(r,e),r):void(this.isTransacting=!1)},e.prototype.onDocumentChange=function(t,e){if(e&&e.session!==this){this.stage._apply(t),this._transformLocalChangeHistory(t,e);var n={change:t},o=this._transformSelection(t,e),r=this._setSelection(o);r&&(n.selection=o)}},e.prototype._setSelection=function(t){return this.selectionState.setSelection(t)},e.prototype._transformLocalChangeHistory=function(t){var e={ops:t.ops.map(function(t){return t.clone()})};Eh.transformInplace(e,this.doneChanges),Eh.transformInplace(e,this.undoneChanges)},e.prototype._transformSelection=function(t){var e=this.getSelection(),n=Eh.transformSelection(e,t);return n},e.prototype._commit=function(t,e){var n=this._commitChange(t),o={change:t};n&&(o.selection=this.getSelection()),this._triggerUpdateEvent(o,e)},e.prototype._commitChange=function(t){t.timestamp=Date.now(),this.doc._apply(t);var e=this._currentChange,n=!1;e&&this.compressor.shouldMerge(e,t)&&(n=this.compressor.merge(e,t)),n||(this._currentChange=t,this.doneChanges.push(t.invert())),this.undoneChanges=[];var o=t.after.selection||uh.nullSelection,r=this._setSelection(o);return o.isNull()||(o.surfaceId=t.after.surfaceId),r},e.prototype.isDirty=function(){return this._dirty},e.prototype.save=function(){var t=this.getDocument(),e=this.saveHandler;if(this._dirty&&!this._isSaving)if(this._isSaving=!0,e){var n=[];e.saveDocument(t,n,function(t){this._isSaving=!1,t?console.error("Error during save"):(this._dirty=!1,this._triggerUpdateEvent({},{force:!0}))}.bind(this))}else console.error("Document saving is not handled at the moment. Make sure saveHandler instance provided to documentSession")},e.prototype._triggerUpdateEvent=function(t,e){e=e||{},e.session=this,t.change&&t.change.ops.length>0?(this.doc._notifyChangeListeners(t.change,e),this._dirty=!0):delete t.change,(Object.keys(t).length>0||e.force)&&(this.emit("update",t,e),this.emit("didUpdate",t,e))},e}(ba),wf=function(t){function e(e,n){if(t.call(this,e,n),n=n||{},this.config=n,this.collabClient=n.collabClient,n.docVersion&&console.warn("config.docVersion is deprecated: Use config.version instead"),n.docVersion&&console.warn("config.docId is deprecated: Use config.documentId instead"),this.version=n.version,this.documentId=n.documentId||n.docId,void 0!==n.autoSync?this.autoSync=n.autoSync:this.autoSync=!0,!this.documentId)throw new ve("InvalidArgumentsError",{message:"documentId is mandatory"});if(void 0===typeof this.version)throw new ve("InvalidArgumentsError",{message:"version is mandatory"});this._connected=!1,this._nextChange=null,this._pendingChange=null,this._error=null,this.doc.on("document:changed",this.afterDocumentChange,this,{priority:-10}),this._broadCastSelectionUpdateDebounced=Lh(this._broadCastSelectionUpdate,250),this.collaborators={},this.collabClient.on("connected",this.onCollabClientConnected,this),this.collabClient.on("disconnected",this.onCollabClientDisconnected,this),this.__maxColors=5,this.__nextColorIndex=0,this.collabClient.on("message",this._onMessage.bind(this)),this.collabClient.isConnected()&&this.autoSync&&this.sync()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){this.disconnect(),this.collabClient.off(this)},e.prototype.disconnect=function(){var t={type:"disconnect",documentId:this.documentId};this._abortSync(),this._send(t)},e.prototype.sync=function(){if(this.__canSync()){var t=this._getNextChange(),e={type:"sync",documentId:this.documentId,version:this.version,change:this.serializeChange(t)};this._send(e),this._pendingChange=t,this.emit("sync"),this._nextChange=null,this._error=null}else console.error("Can not sync. Either collabClient is not connected or we are already syncing")},e.prototype.setSelection=function(e){var n=this.selection;t.prototype.setSelection.call(this,e),this._broadCastSelectionUpdateDebounced(n,e)},e.prototype.getCollaborators=function(){return this.collaborators},e.prototype.isConnected=function(){return this._connected},e.prototype.serializeChange=function(t){return t.toJSON()},e.prototype.deserializeChange=function(t){return Eh.fromJSON(t)},e.prototype._onMessage=function(t){if(t.documentId!==this.documentId)return!1;switch(t=Zc(t),t.type){case"syncDone":this.syncDone(t);break;case"syncError":this.syncError(t);break;case"update":this.update(t);break;case"disconnectDone":this.disconnectDone(t);break;case"error":this.error(t);break;default:return console.error("CollabSession: unsupported message",t.type,t),!1}return!0},e.prototype._send=function(t){return this.collabClient.isConnected()?(this.collabClient.send(t),!0):(console.warn("Try not to call _send when disconnected. Skipping message",t),!1)},e.prototype.update=function t(e){var n=e.change,o=e.collaborators,r=e.version;if(!this._nextChange&&!this._pendingChange){var i=this.selection;n&&(n=this.deserializeChange(n),this._applyRemoteChange(n));var s=this.selection;r&&(this.version=r);var t={change:n};s!==i&&(t.selection=s);var a=this._updateCollaborators(o);a&&(t.collaborators=a,this.emit("collaborators:changed")),this._triggerUpdateEvent(t,{remote:!0})}},e.prototype.syncDone=function(t){var e=t.serverChange,n=t.collaborators,o=t.version;e&&(e=this.deserializeChange(e),this._applyRemoteChange(e)),this.version=o;var r=this._updateCollaborators(n);this._nextChange&&this._transformCollaboratorSelections(this._nextChange),this._pendingChange=null,this._error=null,this._connected=!0;var i={change:e};r&&(i.collaborators=r),this._triggerUpdateEvent(i,{remote:!0}),this.emit("connected"),this._requestSync()},e.prototype.syncError=function(t){t("Sync error:",t),this._abortSync()},e.prototype.disconnectDone=function(){this._afterDisconnected()},e.prototype.error=function t(e){var t=e.error,n=this[t.name],o=ve.fromJSON(t);return n?(this.emit("error",o),n=n.bind(this),void n(o)):(t("CollabSession: unsupported error",t.name),!1)},e.prototype.afterDocumentChange=function(t,e){e.remote||this._recordChange(t)},e.prototype.onCollabClientConnected=function(){this.autoSync&&this.sync()},e.prototype.onCollabClientDisconnected=function(){this._abortSync(),this._connected&&this._afterDisconnected()},e.prototype._commit=function(t,e){var n=this._commitChange(t),o=null;va(this.getCollaborators(),function(e){var n=e.collaboratorId,r=e.selection,i=Eh.transformSelection(r,t);r!==i&&(o=o||{},e=Qc(e),e.selection=i,o[n]=e)});var r={change:t};n&&(r.selection=this.getSelection()),o&&(r.collaborators=o),this._triggerUpdateEvent(r,e)},e.prototype._applyRemoteChange=function(t){t.ops.length>0&&(this.stage._apply(t),this.doc._apply(t),this._transformLocalChangeHistory(t),this.selection=this._transformSelection(t))},e.prototype._recordChange=function(t){this._nextChange?(this._nextChange.ops=this._nextChange.ops.concat(t.ops),this._nextChange.after=t.after):this._nextChange=t,this._requestSync()},e.prototype._getNextChange=function(){var t=this._nextChange;return t||(t=this._getChangeForSelection(this.selection,this.selection)),t},e.prototype._broadCastSelectionUpdate=function(t,e){this._nextChange?this._nextChange.after.selection=e:this._nextChange=this._getChangeForSelection(t,e),this._requestSync()},e.prototype.__canSync=function(){return this.collabClient.isConnected()&&!this._pendingChange},e.prototype._requestSync=function(){this._nextChange&&this.__canSync()&&this.sync()},e.prototype._abortSync=function(){var t=this._nextChange;this._pendingChange&&(t=this._pendingChange,this._nextChange&&(t.ops=t.ops.concat(this._nextChange.ops),t.after=this._nextChange.after),this._pendingChange=null),this._error=null,this._nextChange=t},e.prototype._transformCollaboratorSelections=function(t){var e=this.getCollaborators();e&&va(e,function(e){Eh.transformSelection(e.selection,t)})},e.prototype._updateCollaborators=function(t){var e={};if(va(t,function(t,n){if(t){var o,r=this.collaborators[n];r&&(o=r.selection);var i=b(t.selection);i.attach(this.doc),t.colorIndex=r?r.colorIndex:this._getNextColorIndex(),t.selection=i,this.collaborators[n]=t,i.equals(o)||(e[n]=t)}else e[n]=null,delete this.collaborators[n]}.bind(this)),Object.keys(e).length>0)return e},e.prototype._afterDisconnected=function(){var t=this.collaborators;this.collaborators={};var e=Object.keys(t);if(e.length>0){var n={};e.forEach(function(t){n[t]=null}),this._triggerUpdateEvent({collaborators:n})}this._connected=!1,this.emit("disconnected")},e.prototype._getChangeForSelection=function(t,e){var n=new Eh([],{selection:t},{selection:e});return n},e.prototype._hasLocalChanges=function(){return this._nextChange&&this._nextChange.ops.length>0},e.prototype._getNextColorIndex=function(){var t=this.__nextColorIndex;return this.__nextColorIndex=(this.__nextColorIndex+1)%this.__maxColors,t+1},e}(bf),Cf=function(t){this.config=t};Cf.prototype.createDocument=function(t,e){P("POST",this.config.httpUrl,t,e)},Cf.prototype.getDocument=function(t,e){P("GET",this.config.httpUrl+t,null,e)},Cf.prototype.deleteDocument=function(t,e){P("DELETE",this.config.httpUrl+t,null,e)};var Sf=new hf,xf=function(t){this.configurator=t.configurator,this.changeStore=t.changeStore,this.documentStore=t.documentStore,
this.snapshotStore=t.snapshotStore,this.frequency=t.frequency||1};xf.prototype.getSnapshot=function(t,e){return t&&t.documentId?void this._computeSnapshot(t,e):e(new ve("InvalidArgumentsError",{message:"args requires a documentId"}))},xf.prototype.requestSnapshot=function(t,e,n){this.snapshotStore&&e%this.frequency===0?this.createSnapshot({documentId:t},n):n(null)},xf.prototype.createSnapshot=function(t,e){if(!this.snapshotStore)throw new ve("SnapshotStoreRequiredError",{message:"You must provide a snapshot store to be able to create snapshots"});this._computeSnapshot(t,function(t,n){return t?e(t):void this.snapshotStore.saveSnapshot(n,e)}.bind(this))},xf.prototype._computeSnapshot=function(t,e){this.documentStore.getDocument(t.documentId,function(n,o){return n?e(n):(void 0===t.version&&(t.version=o.version),t.docRecord=o,void(this.snapshotStore&&0!==t.version?this._computeSnapshotSmart(t,e):this._computeSnapshotDumb(t,e)))}.bind(this))},xf.prototype._computeSnapshotSmart=function(t,e){var n,o=t.documentId,r=t.version,i=t.docRecord;this.snapshotStore.getSnapshot({documentId:o,version:r,findClosest:!0},function(t,s){if(t)return e(t);if(s&&r===s.version)return e(null,s);var a;a=s?s.version:0,n=this._createDocumentInstance(i.schemaName),s&&(n=Sf.importDocument(n,s.data)),this.changeStore.getChanges({documentId:o,sinceVersion:a,toVersion:r},function(t,i){t&&e(t),this._applyChanges(n,i.changes);var s={documentId:o,version:r,data:Sf.exportDocument(n)};e(null,s)}.bind(this))}.bind(this))},xf.prototype._computeSnapshotDumb=function(t,e){var n,o=t.documentId,r=t.version,i=t.docRecord;this.changeStore.getChanges({documentId:o,sinceVersion:0},function(t,s){t&&e(t),n=this._createDocumentInstance(i.schemaName),this._applyChanges(n,s.changes);var a={documentId:o,version:r,data:Sf.exportDocument(n)};e(null,a)}.bind(this))},xf.prototype._createDocumentInstance=function(t){var e=this.configurator.getSchema();if(e.name!==t)throw new ve("SnapshotEngine.SchemaNotFoundError",{message:"Schema "+t+" not found"});var n=this.configurator.createArticle();return n},xf.prototype._applyChanges=function(t,e){Bh(e,function(e){Bh(e.ops,function(e){t.data.apply(e)})})};var Of=function(t){function e(e){t.call(this),this.configurator=e.configurator,this.documentStore=e.documentStore,this.changeStore=e.changeStore,this.snapshotEngine=e.snapshotEngine||new xf({configurator:this.configurator,documentStore:this.documentStore,changeStore:this.changeStore})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createDocument=function(t,e){var n=this.configurator.getSchema();if(!n)return e(new ve("SchemaNotFoundError",{message:"Schema not found for "+t.schemaName}));var o=this.configurator.createArticle();this.documentStore.createDocument({schemaName:n.name,schemaVersion:n.version,documentId:t.documentId,version:0,info:t.info},function(t,n){if(t)return e(new ve("CreateError",{cause:t}));var r=new hf;e(null,{documentId:n.documentId,data:r.exportDocument(o),version:0})}.bind(this))},e.prototype.getDocument=function(t,e){this.snapshotEngine.getSnapshot(t,e)},e.prototype.deleteDocument=function(t,e){this.changeStore.deleteChanges(t,function(n){return n?e(new ve("DeleteError",{cause:n})):void this.documentStore.deleteDocument(t,function(t,n){return t?e(new ve("DeleteError",{cause:t})):void e(null,n)})}.bind(this))},e.prototype.documentExists=function(t,e){this.documentStore.documentExists(t,e)},e.prototype.getChanges=function(t,e){this.documentExists(t.documentId,function(n,o){return n||!o?e(new ve("ReadError",{message:o?null:"Document does not exist",cause:n})):void this.changeStore.getChanges(t,e)}.bind(this))},e.prototype.getVersion=function(t,e){this.documentExists(t,function(n,o){return n||!o?e(new ve("ReadError",{message:o?null:"Document does not exist",cause:n})):void this.changeStore.getVersion(t,e)}.bind(this))},e.prototype.addChange=function(t,e){this.documentExists(t.documentId,function(n,o){return n||!o?e(new ve("ReadError",{message:o?null:"Document does not exist",cause:n})):void this.changeStore.addChange(t,function(n,o){return n?e(n):void this.documentStore.updateDocument(t.documentId,{version:o,info:t.documentInfo},function(n){return n?e(n):void this.snapshotEngine.requestSnapshot(t.documentId,o,function(){e(null,o)})}.bind(this))}.bind(this))}.bind(this))},e}(ba),Ef=function(t){this.engine=t.documentEngine,this.path=t.path};Ef.prototype.bind=function(t){t.post(this.path,this._createDocument.bind(this)),t.get(this.path+"/:id",this._getDocument.bind(this)),t.delete(this.path+"/:id",this._deleteDocument.bind(this))},Ef.prototype._createDocument=function(t,e,n){var o=t.body,r={schemaName:o.schemaName,info:o.info};this.engine.createDocument(r,function(t,o){return t?n(t):void e.json(o)})},Ef.prototype._getDocument=function(t,e,n){var o=t.params.id;this.engine.getDocument({documentId:o},function(t,o){return t?n(t):void e.json(o)})},Ef.prototype._deleteDocument=function(t,e,n){var o=t.params.id;this.engine.deleteDocument(o,function(t,o){return t?n(t):void e.json(o)})};var Nf=function(t){this.config=t};Nf.prototype.createDocument=function(t,e){t.documentId||(t.documentId=h());var n=this._documentExists(t.documentId);return n?e(new ve("DocumentStore.CreateError",{message:"Could not create because document already exists."})):void this._createDocument(t)},Nf.prototype.getDocument=function(t,e){var n=this._getDocument(t);return n?void e(null,n):e(new ve("DocumentStore.ReadError",{message:"Document could not be found."}))},Nf.prototype.updateDocument=function(t,e,n){var o=this._documentExists(t);return o?(this._updateDocument(t,e),void n(null,this._getDocument(t))):n(new ve("DocumentStore.UpdateError",{message:"Document does not exist."}))},Nf.prototype.deleteDocument=function(t,e){var n=this._getDocument(t);return n?(this._deleteDocument(t),void e(null,n)):e(new ve("DocumentStore.DeleteError",{message:"Document does not exist."}))},Nf.prototype.documentExists=function(t,e){e(null,this._documentExists(t))},Nf.prototype.seed=function(t,e){return this._documents=t,e&&e(null),this},Nf.prototype._createDocument=function(t){this._documents[t.documentId]=t},Nf.prototype._deleteDocument=function(t){delete this._documents[t]},Nf.prototype._getDocument=function(t){return this._documents[t]},Nf.prototype._updateDocument=function(t,e){var n=this._documents[t];Sp(n,e)},Nf.prototype._documentExists=function(t){return Boolean(this._documents[t])};var If=function(t){this.config=t,this._snapshots={}};If.prototype.getSnapshot=function(t,e){if(!t||!t.documentId)return e(new ve("InvalidArgumentsError",{message:"args require a documentId"}));var n,o=t.documentId,r=t.version,i=this._snapshots[o];if(!i)return e(null,void 0);var s=Object.keys(i);if(0===s.length)return e(null,void 0);if(r){if(n=i[r],!n&&t.findClosest){var a=s.filter(function(t){return parseInt(t,10)<r}),p=Math.max.apply(null,a);n=i[p]}}else{var c=Math.max.apply(null,s);n=i[c]}e(null,n)},If.prototype.saveSnapshot=function(t,e){var n=t.documentId,o=t.version,r=t.data,i=this._snapshots[n];i||(i=this._snapshots[n]={}),i[o]={documentId:n,version:o,data:r},e(null,i[o])},If.prototype.deleteSnaphot=function(t,e,n){var o=this._snapshots[t];if(!o||!o[e])return n(new ve("DeleteError",{message:"Snapshot could not be found"}));var r=this._snapshots[t][e];delete this._snapshots[t][e],n(null,r)},If.prototype.deleteSnapshotsForDocument=function(t,e){var n=this._snapshots[t],o=0;n&&(o=Object.keys(n).length),delete this._snapshots[t],e(null,o)},If.prototype.snapshotExists=function(t,e,n){var o=!1,r=this._snapshots[t];r&&(o=r[e]),n(null,o)},If.prototype.seed=function(t,e){return this._snapshots=t,e&&e(null),this};var Pf=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._createWebSocket=function(){return new window.WebSocket(this.config.wsUrl)},e}(Sa),Tf=i(function(t){function e(t,e,n){for(var o=t.length,r=e+(n?1:-1);n?r--:++r<o;){var i=t[r];if(i!==i)return r}return-1}t.exports=e}),jf=r(Tf),Df=Object.freeze({default:jf}),Af=i(function(t){function e(t,e,o){if(e!==e)return n(t,o);for(var r=o-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}var n=r(Df);t.exports=e}),Mf=r(Af),kf=Object.freeze({default:Mf}),Lf=i(function(t){function e(t,e){var o=t?t.length:0;return!!o&&n(t,e,0)>-1}var n=r(kf);t.exports=e}),Rf=r(Lf),zf=Object.freeze({default:Rf}),Ff=i(function(t){function e(t,e,n){for(var o=-1,r=t?t.length:0;++o<r;)if(n(e,t[o]))return!0;return!1}t.exports=e}),Bf=r(Ff),Hf=Object.freeze({default:Bf}),Uf=i(function(t){function e(t,e){return t.has(e)}t.exports=e}),Vf=r(Uf),qf=Object.freeze({default:Vf}),Jf=i(function(t){function e(){}t.exports=e}),$f=r(Jf),Wf=Object.freeze({default:$f}),Kf=i(function(t){var e=r(Bi),n=r(Wf),o=r(Oi),i=1/0,s=e&&1/o(new e([,-0]))[1]==i?function(t){return new e(t)}:n;t.exports=s}),Xf=r(Kf),Gf=Object.freeze({default:Xf}),Qf=i(function(t){function e(t,e,r){var u=-1,h=o,f=t.length,l=!0,d=[],y=d;if(r)l=!1,h=i;else if(f>=c){var g=e?null:a(t);if(g)return p(g);l=!1,h=s,y=new n}else y=e?[]:d;t:for(;++u<f;){var m=t[u],v=e?e(m):m;if(m=r||0!==m?m:0,l&&v===v){for(var _=y.length;_--;)if(y[_]===v)continue t;e&&y.push(v),d.push(m)}else h(y,v,r)||(y!==d&&y.push(v),d.push(m))}return d}var n=r(ai),o=r(zf),i=r(Hf),s=r(qf),a=r(Gf),p=r(Oi),c=200;t.exports=e}),Yf=r(Qf),Zf=Object.freeze({default:Yf}),tl=i(function(t){function e(t){return t&&t.length?n(t):[]}var n=r(Zf);t.exports=e}),el=r(tl),nl={insertedText:j,deletedText:D,transferAnnotations:A},ol=i(function(t){function e(t){return t===!0||t===!1||n(t)&&s.call(t)==o}var n=r(cn),o="[object Boolean]",i=Object.prototype,s=i.toString;t.exports=e}),rl=r(ol),il=function(t){function e(e){var n=this;t.call(this);var o=this.constructor,r=o.schema;for(var i in r)if(r.hasOwnProperty(i)){var s=r[i],a=void 0!==e[i],p=s.hasOwnProperty("default"),c=s.optional;if(!c&&!p&&!a)throw new Error("Property "+i+" is mandatory for node type "+n.type);a?n[i]=F(s,e[i]):p&&(n[i]=Zc(F(s,s.default)))}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isNode:{}};return n._isNode.get=function(){return!0},e.prototype.dispose=function(){},e.prototype.isInstanceOf=function(t){return e.isInstanceOf(this.constructor,t)},e.prototype.getTypeNames=function(){for(var t=[],e=this.constructor;"node"!==e.type;)t.push(e.type),e=Object.getPrototypeOf(e);return t},e.prototype.getPropertyType=function(t){var e=this.constructor.schema;return e[t].type},e.prototype.toJSON=function(){var t={type:this.type};return Bh(this.constructor.schema,function(e,n){t[e.name]=this[n]}.bind(this)),t},Object.defineProperties(e.prototype,n),e}(ba);il.define=il.defineSchema=function(t){M(this,t)},il.define({type:"node",id:"string"}),Object.defineProperty(il.prototype,"type",{configurable:!1,get:function(){return this.constructor.type},set:function(){throw new Error("read-only")}}),il.isInstanceOf=function(t,e){for(var n=t.type;"node"!==n;){if(n===e)return!0;var o=Object.getPrototypeOf(t.prototype).constructor;if(!o||!o.type)break;t=o,n=t.type}return!1};var sl=function(t){function e(e,n){t.call(this,n),this.document=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isDocumentNode:{}};return n._isDocumentNode.get=function(){return!0},e.prototype.getDocument=function(){return this.document},e.prototype.hasParent=function(){return Boolean(this.parent)},e.prototype.getParent=function(){return this.document.get(this.parent)},e.prototype.hasChildren=function(){return!1},e.prototype.getChildIndex=function(t){return-1},e.prototype.getChildAt=function(t){return null},e.prototype.getChildCount=function(){return 0},e.prototype.getRoot=function(){for(var t=this;t.hasParent();)t=t.getParent();return t},e.prototype.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlightedScope=e,this.highlighted=t,this.emit("highlighted",t))},e.prototype.on=function(t,e,n){var o=B(t);if(o){var r=o[1];if(this.constructor.schema[r]){var i=this.getDocument();i.getEventProxy("path").on([this.id,r],e,n)}}ba.prototype.on.apply(this,arguments)},e.prototype.off=function(t,e,n){var o=this.getDocument(),r=!1;if(e?r=B(e):o.getEventProxy("path").off(t),r){var i=r[1];o.getEventProxy("path").off(t,[this.id,i],n)}ba.prototype.off.apply(this,arguments)},e.prototype.connect=function(t,e){console.warn("DEPRECATED: use Node.on() instead"),Bh(e,function(e,n){this.on(n,e,t)}.bind(this))},e.prototype.disconnect=function(t){console.warn("DEPRECATED: use Node.off() instead"),this.off(t)},e.prototype._onPropertyChange=function(t){var e=[t+":changed"].concat(Array.prototype.slice.call(arguments,1));this.emit.apply(this,e)},e.prototype.isBlock=function(){return this.constructor.isBlock},e.prototype.isText=function(){return this.constructor.isText},e.prototype.isPropertyAnnotation=function(){return this.constructor.isPropertyAnnotation},e.prototype.isInline=function(){return this.constructor.isInline},e.prototype.isContainerAnnotation=function(){return this.constructor.isContainerAnnotation},Object.defineProperties(e.prototype,n),e}(il);sl.isBlock=!1,sl.isText=!1,sl.isPropertyAnnotation=!1,sl.isContainerAnnotation=!1,sl.isInline=!1;var al=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getText=function(){var t=this.getDocument();if(!t)return console.warn("Trying to use an PropertyAnnotation which is not attached to the document."),"";var e=t.get(this.path);return e.substring(this.startOffset,this.endOffset)},e.prototype.canSplit=function(){return!0},e.prototype.isAnchor=function(){return!1},e.prototype.getSelection=function(){return this.getDocument().createSelection({type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset})},e.prototype.updateRange=function(t,e){if(!e.isPropertySelection())throw new Error("Cannot change to ContainerAnnotation.");Op(this.startPath,e.start.path)||t.set([this.id,"path"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)},e}(sl);al.define({type:"annotation",path:["string"],startOffset:"number",endOffset:"number",_content:{type:"string",optional:!0}}),al.isPropertyAnnotation=!0,al.prototype._isAnnotation=!0,al.prototype._isPropertyAnnotation=!0,Object.defineProperties(al.prototype,{startPath:{get:function(){return this.path}},endPath:{get:function(){return this.path}}});var pl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(sl);pl.isBlock=!0;var cl={hasChildren:function(){return!0},getChildrenProperty:function(){throw new Error("ParentNodeMixin.getChildrenProperty is abstract and must be implemented in "+this.type+".")},getChildIndex:function(t){return this[this.getChildrenProperty()].indexOf(t.id)},getChildren:function(){var t=this.getDocument(),e=this[this.getChildrenProperty()];return e.map(function(e){return t.get(e)})},getChildAt:function(t){var e=this[this.getChildrenProperty()];if(t<0||t>=e.length)throw new Error("Array index out of bounds: "+t+", "+e.length);return this.getDocument().get(e[t])},getChildCount:function(){return this[this.getChildrenProperty()].length},getAddressablePropertyNames:function(){return[this.getChildrenProperty()]}},ul=function(t,e){this.pos=t,this.offset=e};ul.prototype.isBefore=function(t,e){return e=Boolean(e),this.pos<t.pos||!(this.pos>t.pos)&&(this.offset<t.offset||!(this.offset>t.offset)&&!e)},ul.prototype.isAfter=function(t,e){return t.isBefore(this,e)},ul.prototype.isEqual=function(t){return this.pos===t.pos&&this.offset===t.offset},ul.prototype.toString=function(){return[this.pos,".",this.offset].join("")};var hl=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this.document&&!this.document.isTransactionDocument&&this.document.on("document:changed",this._onChange,this)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isContainer:{}};return n._isContainer.get=function(){return!0},e.prototype.dispose=function(){this.document.off(this)},e.prototype.getPosition=function(t){if(this.document&&this.document.isTransactionDocument)return this.nodes.indexOf(t);var e=this._getCachedPositions(),n=e[t];return void 0===n&&(n=-1),n},e.prototype.getNodes=function(){var t=this.getDocument(),e=[];return this.nodes.forEach(function(n){var o=t.get(n);o?e.push(o):console.error("Node does not exist: ",n)}),e},e.prototype.getNodeAt=function(t){return this.getDocument().get(this.nodes[t])},e.prototype.show=function(t,e){var n=this.getDocument(),o=arguments[0];bn(o)||o._isNode&&(t=o.id),eu(e)||(e=this.nodes.length),n.update(this.getContentPath(),{insert:{offset:e,value:t}})},e.prototype.hide=function(t){var e=this.getDocument(),n=this.nodes.indexOf(t);n>=0&&e.update(this.getContentPath(),{delete:{offset:n}})},e.prototype.getAddress=function(t){if(!t._isCoordinate)throw new Error("Illegal argument: Container.getAddress(coor) expects a Coordinate instance.");var e,n=t.path[0],o=this.getPosition(n);return e=t.isNodeCoordinate()?t.offset>0?Number.MAX_VALUE:0:t.offset,new ul(o,e)},e.prototype.getLength=function(){return this.nodes.length},e.prototype._onChange=function(t){t.isUpdated(this.getContentPath())&&(this.positions=null)},e.prototype._getCachedPositions=function(){if(!this.positions){var t={};this.nodes.forEach(function(e,n){t[e]=n}),this.positions=t}return this.positions},e.prototype.getContentPath=function(){return[this.id,"nodes"]},Object.defineProperties(e.prototype,n),e}(sl);Sp(hl.prototype,cl),hl.prototype.getChildrenProperty=function(){return"nodes"},hl.define({type:"container",nodes:{type:["id"],default:[]}}),Object.defineProperty(hl.prototype,"length",{get:function(){return console.warn("DEPRECATED: want to get rid of unnecessary properties. Use this.getLength() instead."),this.nodes.length}});var fl=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isAnnotation:{},_isContainerAnnotation:{}};return n._isAnnotation.get=function(){return!0},n._isContainerAnnotation.get=function(){return!0},e.prototype.getText=function(){var t=this.getDocument();return t?uf.getTextForSelection(t,this.getSelection()):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),"")},e.prototype.getSelection=function(){var t=this.getDocument();return t?t.createSelection({type:"container",containerId:this.containerId,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),uh.nullSelection())},e.prototype.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlighted=t,this.highlightedScope=e,this.emit("highlighted",t,e),Bh(this.fragments,function(n){n.emit("highlighted",t,e)}))},e.prototype.updateRange=function(t,e){if(!e.isContainerSelection())throw new Error("Cannot change to ContainerAnnotation.");Op(this.startPath,e.start.path)||t.set([this.id,"startPath"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),Op(this.endPath,e.end.path)||t.set([this.id,"endPath"],e.end.path),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)},e.prototype.getFragments=function(){var t=this,e=[],n=this.getDocument(),o=n.get(this.containerId),r=o.getPathRange(this.startPath,this.endPath);if(1===r.length)e.push(new dl(this,r[0],"property"));else if(r.length>1){e.push(new dl(this,r[0],"start")),e.push(new dl(this,pu(r),"end"));for(var i=1;i<r.length-1;i++)e.push(new dl(t,r[i],"inner"))}return e},e.prototype.getStartAnchor=function(){return this._startAnchor||(this._startAnchor=new ll(this,"isStart")),this._startAnchor},e.prototype.getEndAnchor=function(){return this._endAnchor||(this._endAnchor=new ll(this)),this._endAnchor},Object.defineProperties(e.prototype,n),e}(sl);fl.define({type:"container-annotation",containerId:"string",startPath:["string"],startOffset:"number",endPath:["string"],endOffset:"number"}),fl.isContainerAnnotation=!0;var ll=function(t){function e(e,n){t.call(this,"SKIP"),this.type="container-annotation-anchor",this.anno=e,this.node=e,this.id=e.id,this.containerId=e.containerId,this.isStart=Boolean(n),Object.freeze(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTypeNames=function(){return[this.type]},e.prototype.getPath=function(){return this.isStart?this.node.startPath:this.node.endPath},e.prototype.getOffset=function(){return this.isStart?this.node.startOffset:this.node.endOffset},e}(ch);Object.defineProperties(ll.prototype,{path:{get:function(){return this.getPath()}},offset:{get:function(){return this.getOffset()}}});var dl=function(t){function e(e,n,o){t.call(this),this.type="container-annotation-fragment",this.anno=e,this.id=e.id,this.path=n,this.mode=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTypeNames=function(){return[this.type]},e.prototype.getStartOffset=function(){return"start"===this.mode||"property"===this.mode?this.anno.startOffset:0},e.prototype.getEndOffset=function(){var t=this.anno.getDocument(),e=t.get(this.path),n=e.length;return"end"===this.mode||"property"===this.mode?this.anno.endOffset:n},e}(ba);dl.fragmentation=Number.MAX_VALUE,Object.defineProperties(dl.prototype,{startOffset:{get:function(){return this.getStartOffset()},set:function(){throw new Error("ContainerAnnotationFragment.startOffset is read-only.")}},endOffset:{get:function(){return this.getEndOffset()},set:function(){throw new Error("ContainerAnnotationFragment.endOffset is read-only.")}},highlighted:{get:function(){return this.anno.highlighted},set:function(){throw new Error("ContainerAnnotationFragment.highlighted is read-only.")}}}),fl.Anchor=ll,fl.Fragment=dl;var yl={},gl=function(t,e){this.entries={},this.names=[],this.validator=e,t&&va(t,function(t,e){this.add(e,t)}.bind(this))},ml={_isRegistry:{}};ml._isRegistry.get=function(){return!0},gl.prototype.contains=function(t){return this.entries.hasOwnProperty(t)},gl.prototype.add=function(t,e){if(this.validator&&this.validator(e),yl[t])throw new Error('Illegal key: "'+t+'" is a property of Object which is thus not allowed as a key.');this.contains(t)&&this.remove(t),this.entries[t]=e,this.names.push(t)},gl.prototype.remove=function(t){var e=this.names.indexOf(t);e>=0&&this.names.splice(e,1),delete this.entries[t]},gl.prototype.clear=function(){this.names=[],this.entries={}},gl.prototype.get=function(t){return this.entries[t]},gl.prototype.each=function(t,e){return console.warn("DEPRECATED: use Registry.forEach(cb) instead"),this.forEach(t.bind(e))},gl.prototype.forEach=function(t){for(var e=this,n=0;n<this.names.length;n++){var o=e.names[n],r=t(e.entries[o],o);if(r===!1)break}},gl.prototype.map=function(t){var e=[];return this.forEach(function(n,o){e.push(t(n,o))}),e},gl.prototype.filter=function(t){var e=[];return this.forEach(function(n,o){t(n,o)&&e.push(n)}),e},Object.defineProperties(gl.prototype,ml);var vl=1,_l=-1,bl=-2,wl=function(t){Object.assign(this,t)};wl.prototype.start=function(t,e,n){if(!bn(e))throw new Error("Illegal argument: 'text' must be a String, but was "+e);this._start(t,e,n)},wl.prototype.onText=function(t,e,n){},wl.prototype.onEnter=function(t,e){return null},wl.prototype.onExit=function(t,e,n){},wl.prototype._enter=function(t,e){return t.counter++,this.onEnter(t,e)},wl.prototype._exit=function(t,e,n){this.onExit(t,e,n)},wl.prototype._createText=function(t,e,n){this.onText(t,e,n)},wl.prototype._start=function(t,e,n){for(var o=this,r=H.call(this,n),i=[{context:t,entry:null}],s=0,a=0;a<r.length;a++){var p=r[a],c=e.substring(s,p.pos);c&&o._createText(i[i.length-1].context,c,p),s=p.pos;var u,h,f;if(p.mode===vl||p.mode===bl){for(u=1;u<i.length&&!(p.level<i[u].entry.level);u++);for(h=i.length-1;h>=u;h--)f=i[h].entry,f.length=s-f.pos,o._exit(f,i[h].context,i[h-1].context);for(i.splice(u,0,{entry:p}),h=u;h<i.length;h++)f=i[h].entry,f.pos=s,i[h].context=o._enter(f,i[h-1].context)}if(p.mode===_l||p.mode===bl){for(u=1;u<i.length&&i[u].entry.node!==p.node;u++);for(h=i.length-1;h>=u;h--)f=i[h].entry,f.length=s-f.pos,o._exit(f,i[h].context,i[h-1].context);for(i.splice(u,1),h=u;h<i.length;h++)f=i[h].entry,f.pos=s,i[h].context=o._enter(f,i[h-1].context)}}var l=e.substring(s);l&&this._createText(t,l)},wl.SHOULD_NOT_SPLIT=0,wl.NORMAL=10,wl.ANY=100,wl.ALWAYS_ON_TOP=Number.MAX_VALUE;var Cl=function(t){if(!t.converters)throw new Error("config.converters is mandatory");t.converters._isRegistry?this.converters=t.converters:(this.converters=new gl,t.converters.forEach(function(t){var e;return e="function"==typeof t?new t:t,e.type?void this.converters.add(e.type,e):void console.error("Converter must provide the type of the associated node.",e)}.bind(this))),this.state={doc:null},this.config=Sp({idAttribute:"id"},t),this._el=null,this.$$=this.createElement.bind(this)};Cl.prototype.exportDocument=function(t){return this.convertDocument(t)},Cl.prototype.convertDocument=function(t){throw new Error("This method is abstract")},Cl.prototype.convertContainer=function(t){if(!t)throw new Error("Illegal arguments: container is mandatory.");var e=t.getDocument();this.state.doc=e;var n=[];return t.nodes.forEach(function(t){var o=e.get(t),r=this.convertNode(o);n.push(r)}.bind(this)),n},Cl.prototype.convertNode=function(t){bn(t)?t=this.state.doc.get(t):this.state.doc=t.getDocument();var e=this.getNodeConverter(t);if(t.isPropertyAnnotation()&&(!e||!e.export))return this._convertPropertyAnnotation(t);e||(e=this.getDefaultBlockConverter());var n;return n=e.tagName?this.$$(e.tagName):this.$$("div"),n.attr(this.config.idAttribute,t.id),n=e.export?e.export(t,n,this)||n:this.getDefaultBlockConverter().export(t,n,this)||n},Cl.prototype.convertProperty=function(t,e,n){this.initialize(t,n);var o=this.$$("div").append(this.annotatedText(e));return o.innerHTML},Cl.prototype.annotatedText=function(t){var e=this.state.doc,n=e.get(t),o=e.getIndex("annotations").get(t);return this._annotatedText(n,o)},Cl.prototype.getNodeConverter=function(t){return this.converters.get(t.type)},Cl.prototype.getDefaultBlockConverter=function(){throw new Error("This method is abstract.")},Cl.prototype.getDefaultPropertyAnnotationConverter=function(){throw new Error("This method is abstract.")},Cl.prototype.getDocument=function(){return this.state.doc},Cl.prototype.createElement=function(t){return this._el.createElement(t)},Cl.prototype._annotatedText=function(t,e){var n=this,o=new wl;o.onText=function(t,e){t.children.push(q(e))},o.onEnter=function(t){var e=t.node;return{annotation:e,children:[]}},o.onExit=function(t,e,o){var r=e.annotation,i=n.getNodeConverter(r);i||(i=n.getDefaultPropertyAnnotationConverter());var s;s=i.tagName?this.$$(i.tagName):this.$$("span"),s.attr(this.config.idAttribute,r.id),s.append(e.children),i.export&&(s=i.export(r,s,n)||s),o.children.push(s)}.bind(this);var r={children:[]};return o.start(r,t,e),r.children},Cl.prototype._convertPropertyAnnotation=function(t){var e=this.$$("div").append(this.annotatedText(t.path)),n=e.find("["+this.config.idAttribute+'="'+t.id+'"]');return n};var Sl=function(t){this.arr=t,this.pos=-1},xl={_isArrayIterator:{}};xl._isArrayIterator.get=function(){return!0},Sl.prototype.hasNext=function(){return this.pos<this.arr.length-1},Sl.prototype.next=function t(){this.pos+=1;var t=this.arr[this.pos];return t},Sl.prototype.back=function(){return this.pos>=0&&(this.pos-=1),this},Object.defineProperties(Sl.prototype,xl);var Ol=/^\s+/g,El=/^\s*/g,Nl=/\s+$/g,Il=/\s+/g,Pl=" ",Tl=/[\t\n\r]+/g,jl=function t(e){if(!e.converters)throw new Error("config.converters is mandatory");this.config=Sp({idAttribute:"id"},e),this.schema=e.schema,this.state=null,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[];var n=this.schema,o=n.getDefaultTextType();e.converters.forEach(function(t){var e;if(e="function"==typeof t?new t:t,!e.type)return void console.error("Converter must provide the type of the associated node.",e);if(!e.matchElement&&!e.tagName)return void console.error("Converter must provide a matchElement function or a tagName property.",e);e.matchElement||(e.matchElement=this._defaultElementMatcher.bind(e));var r=n.getNodeClass(e.type);return r?(this._defaultBlockConverter||o!==e.type||(this._defaultBlockConverter=e),this._allConverters.push(e),void(r.isPropertyAnnotation?this._propertyAnnotationConverters.push(e):this._blockConverters.push(e))):void console.error("No node type defined for converter",e.type)}.bind(this)),this.state=new t.State};jl.prototype.reset=function(){this.state.reset()},jl.prototype.createDocument=function(){return this.state.doc=this._createDocument(this.config.schema),this.state.doc},jl.prototype._createDocument=function(t){var e=new this.config.DocumentClass(t);return e},jl.prototype.generateDocument=function(){this.state.doc||(this.state.doc=this.createDocument());var t=this.state.doc;return this._createNodes(),t},jl.prototype._createNodes=function(){var t=this.state,e=t.doc;t.nodes.forEach(function(t){e.get(t.id)&&e.delete(t.id),e.create(t)}),this._createInlineNodes()},jl.prototype._createInlineNodes=function(){var t=this.state,e=t.doc;t.inlineNodes.forEach(function(t){e.get(t.id)&&e.delete(t.id),e.create(t)})},jl.prototype.convertContainer=function(t,e){var n=this,o=this.state;o.container=[],o.containerId=e;for(var r=new Sl(t);r.hasNext();){var i,s=r.next(),a=n._getConverterForElement(s,"block");if(a)i=n._nodeData(s,a.type),o.pushContext(s.tagName,a),i=a.import(s,i,n)||i,o.popContext(),n._createAndShow(i);else if(s.isCommentNode());else if(s.isTextNode()){var p=s.textContent;if(/^\s*$/.exec(p))continue;r.back(),n._wrapInlineElementsIntoBlockElement(r)}else s.isElementNode()&&(r.back(),n._wrapInlineElementsIntoBlockElement(r))}var c={type:"container",id:e,nodes:this.state.container.slice(0)};return this.createNode(c),c},jl.prototype.convertElement=function(t){var e,n=this.state.doc,o=this._convertElement(t);if(n)e=n.create(o);else{var r=this.schema.getNodeClass(o.type);e=new r(n,o)}return e},jl.prototype._convertElement=function(t,e){var n,o=this._getConverterForElement(t,e);if(!o)throw new Error("No converter found for "+t.tagName);n=this._nodeData(t,o.type);var r=this.schema.getNodeClass(n.type);return this.state.pushContext(t.tagName,o),r.isInline?this._convertInlineNode(t,n,o):r.isPropertyAnnotation?this._convertPropertyAnnotation(t,n):n=o.import(t,n,this)||n,this.state.popContext(),this.createNode(n),n},jl.prototype._convertPropertyAnnotation=function(t,e){e.path=[e.id,"_content"],e._content=this.annotatedText(t,e.path),e.startOffset=0,e.endOffset=e._content.length},jl.prototype._convertInlineNode=function(t,e,n){return e.path=[e.id,"content"],e._content="$",e.startOffset=0,e.endOffset=1,e=n.import(t,e,this)},jl.prototype.createNode=function(t){if(this.state.ids[t.id])throw new Error("Node with id alread exists:"+t.id);return this.state.ids[t.id]=!0,this.state.nodes.push(t),t},jl.prototype.show=function(t){this.state.container.push(t.id)},jl.prototype._createAndShow=function(t){this.createNode(t),this.show(t)},jl.prototype._nodeData=function(t,e){var n={type:e,id:this.getIdForElement(t,e)},o=this.schema.getNodeClass(e);return va(o.schema,function(t,e){var o=t.hasOwnProperty("default");o&&(n[e]=Qc(t.default))}),n},jl.prototype.annotatedText=function(t,e,n){var o=this.state;if(e)n&&n.preserveWhitespace&&(o.preserveWhitespace=!0),o.stack.push({path:e,offset:0,text:""});else if(0===o.stack.length)throw new Error("Contract: DOMImporter.annotatedText() requires 'path' for non-reentrant call.",t.outerHTML);
this.state.lastChar="";var r,i=t.getChildNodeIterator();return r=this._annotatedText(i),e&&(o.stack.pop(),o.preserveWhitespace=!1),r},jl.prototype.plainText=function(t){var e=this.state,n=t.textContent;if(e.stack.length>0){var o=pu(e.stack);o.offset+=n.length,o.text+=o.text.concat(n)}return n},jl.prototype.customText=function(t){var e=this.state;if(e.stack.length>0){var n=pu(e.stack);n.offset+=t.length,n.text+=n.text.concat(t)}return t},jl.prototype.nextId=function(t){return this.state.uuid(t)},jl.prototype.getIdForElement=function(t,e){var n=this,o=t.getAttribute(this.config.idAttribute);if(o&&!this.state.ids[o])return o;var r=t.getRoot();for(o=this.nextId(e);this.state.ids[o]||r.find("#"+o);)o=n.nextId(e);return o},jl.prototype.defaultConverter=function t(e,n){this.IGNORE_DEFAULT_WARNINGS||console.warn("This element is not handled by the converters you provided. This is the default implementation which just skips conversion. Override DOMImporter.defaultConverter(el, converter) to change this behavior.",e.outerHTML);var o=this.schema.getDefaultTextType(),t=this._defaultBlockConverter;if(!t)throw new Error("Could not find converter for default type ",o);var r=this._nodeData(e,o);return this.state.pushContext(e.tagName,n),r=t.import(e,r,n)||r,this.state.popContext(),r},jl.prototype._defaultElementMatcher=function(t){return t.is(this.tagName)},jl.prototype._annotatedText=function(t){var e=this,n=this.state,o=pu(n.stack);if(!o)throw new Error("Illegal state: context is null.");for(;t.hasNext();){var r=t.next(),i="";if(r.isTextNode())i=e._prepareText(n,r.textContent),i.length&&(o.text=o.text.concat(i),o.offset+=i.length);else{if(r.isCommentNode())continue;if(r.isElementNode()){var s=e._getConverterForElement(r,"inline");if(!s){e.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",r.outerHTML),e.annotatedText(r);continue}var a=o.offset,p=s.type,c=e._nodeData(r,p);if(s.import){n.stack.push({path:o.path,offset:a,text:""}),n.pushContext(r.tagName,s),c=s.import(r,c,e)||c,n.popContext();var u=e.schema.getNodeClass(p);u.isInline?e.customText(""):e.annotatedText(r);var h=n.stack.pop();o.offset=h.offset,o.text=o.text.concat(h.text)}else e.annotatedText(r);var f=o.offset;c.startOffset=a,c.endOffset=f,c.path=o.path.slice(0),n.inlineNodes.push(c)}else console.warn("Unknown element type. Taking plain text.",r.outerHTML),i=e._prepareText(n,r.textContent),o.text=o.text.concat(i),o.offset+=i.length}}return o.text},jl.prototype._getConverterForElement=function(t,e){var n,o=this;if("block"===e){if(!t.tagName)return null;n=this._blockConverters}else n="inline"===e?this._propertyAnnotationConverters:this._allConverters;for(var r=null,i=0;i<n.length;i++)if(o._converterCanBeApplied(n[i],t)){r=n[i];break}return r},jl.prototype._converterCanBeApplied=function(t,e){return t.matchElement(e,t)},jl.prototype._createElement=function(t){return this._el.createElement(t)},jl.prototype._wrapInlineElementsIntoBlockElement=function(t){for(var e=this,n=this._createElement("div");t.hasNext();){var o=t.next(),r=e._getConverterForElement(o,"block");if(r){t.back();break}n.append(o.clone())}var i=this.defaultConverter(n,this);if(i){if(!i.type)throw new Error("Contract: DOMImporter.defaultConverter() must return a node with type.");this._createAndShow(i)}return i},jl.prototype._createDefaultBlockElement=function(t){var e=this.defaultConverter(t,this);if(e){if(!e.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.",t.outerHTML);e.id=e.id||this.defaultId(t,e.type),this._createAndShow(e)}},jl.prototype._prepareText=function(t,e){if(t.preserveWhitespace)return e;var n=Pl;return e=e.replace(Tl,""),e=t.lastChar===Pl?e.replace(El,n):e.replace(Ol,n),e=e.replace(Nl,n),(this.config.REMOVE_INNER_WS||t.removeInnerWhitespace)&&(e=e.replace(Il,Pl)),t.lastChar=e[e.length-1]||t.lastChar,e},jl.prototype._trimTextContent=function(t){var e,n,o=t.getChildNodes(),r=o[0],i=pu(o);return r&&r.isTextNode()&&(e=r.textContent,n=this._trimLeft(e),r.textContent=n),i&&i.isTextNode()&&(e=i.textContent,n=this._trimRight(e),i.textContent=n),t},jl.prototype._trimLeft=function(t){return t.replace(Ol,"")},jl.prototype._trimRight=function(t){return t.replace(Nl,"")};var Dl=function(){this.reset()};Dl.prototype.reset=function(){this.preserveWhitespace=!1,this.nodes=[],this.inlineNodes=[],this.containerId=null,this.container=[],this.ids={},this.contexts=[],this.stack=[],this.lastChar="",this.skipTypes={},this.ignoreAnnotations=!1,this.uuid=J()},Dl.prototype.pushContext=function(t,e){this.contexts.push({tagName:t,converter:e})},Dl.prototype.popContext=function(){return this.contexts.pop()},Dl.prototype.getCurrentContext=function(){return pu(this.contexts)},jl.State=Dl;var Al="undefined"!=typeof window,Ml=i(function(t){function e(t,e,n,o){for(var r=t.length,i=n+(o?1:-1);o?i--:++i<r;)if(e(t[i],i,t))return i;return-1}t.exports=e}),kl=r(Ml),Ll=Object.freeze({default:kl}),Rl=i(function(t){function e(t,e,r){var a=t?t.length:0;if(!a)return-1;var p=null==r?0:i(r);return p<0&&(p=s(a+p,0)),n(t,o(e,3),p)}var n=r(Ll),o=r(ga),i=r(tp),s=Math.max;t.exports=e}),zl=r(Rl),Fl=Object.freeze({default:zl}),Bl="This method is not implemented.",Hl=function(){};Hl.prototype.getNativeElement=function(){throw new Error(Bl)},Hl.prototype.hasClass=function(t){throw new Error(Bl)},Hl.prototype.addClass=function(t){throw new Error(Bl)},Hl.prototype.removeClass=function(t){throw new Error(Bl)},Hl.prototype.attr=function(){if(1===arguments.length){if(bn(arguments[0]))return this.getAttribute(arguments[0]);Xe(arguments[0])&&va(arguments[0],function(t,e){this.setAttribute(e,t)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this},Hl.prototype.removeAttr=function(t){var e=t.split(/\s+/);return 1===e.length?this.removeAttribute(t):e.forEach(function(t){this.removeAttribute(t)}.bind(this)),this},Hl.prototype.getAttribute=function(t){throw new Error(Bl)},Hl.prototype.setAttribute=function(t,e){throw new Error(Bl)},Hl.prototype.removeAttribute=function(t){throw new Error(Bl)},Hl.prototype.getAttributes=function(){throw new Error(Bl)},Hl.prototype.htmlProp=function(){if(1===arguments.length){if(bn(arguments[0]))return this.getProperty(arguments[0]);Xe(arguments[0])&&va(arguments[0],function(t,e){this.setProperty(e,t)}.bind(this))}else 2===arguments.length&&this.setProperty(arguments[0],arguments[1]);return this},Hl.prototype.getProperty=function(t){throw new Error(Bl)},Hl.prototype.setProperty=function(t,e){throw new Error(Bl)},Hl.prototype.removeProperty=function(t){throw new Error(Bl)},Hl.prototype.getTagName=function(){throw new Error(Bl)},Hl.prototype.setTagName=function(t){throw new Error(Bl)},Hl.prototype.getId=function(){throw new Error(Bl)},Hl.prototype.setId=function(t){throw new Error(Bl)},Hl.prototype.val=function(t){return 0===arguments.length?this.getValue():(this.setValue(t),this)},Hl.prototype.getValue=function(){throw new Error(Bl)},Hl.prototype.setValue=function(t){throw new Error(Bl)},Hl.prototype.css=function(){if(1===arguments.length){if(bn(arguments[0]))return this.getStyle(arguments[0]);if(!Xe(arguments[0]))throw new Error("Illegal arguments.");va(arguments[0],function(t,e){this.setStyle(e,t)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this},Hl.prototype.getStyle=function(t){throw new Error(Bl)},Hl.prototype.setStyle=function(t,e){throw new Error(Bl)},Hl.prototype.text=function t(t){return 0===arguments.length?this.getTextContent():(this.setTextContent(t),this)},Hl.prototype.getTextContent=function(){throw new Error(Bl)},Hl.prototype.setTextContent=function(t){throw new Error(Bl)},Hl.prototype.html=function t(t){return 0===arguments.length?this.getInnerHTML():(this.setInnerHTML(t),this)},Hl.prototype.getInnerHTML=function(){throw new Error(Bl)},Hl.prototype.setInnerHTML=function(t){throw new Error(Bl)},Hl.prototype.getOuterHTML=function(){throw new Error(Bl)},Hl.prototype.on=function(t,e,n,o){if(!bn(t))throw new Error('Illegal argument: "event" must be a String.');if(o=o||{},n&&(o.context=n),o.selector&&!bn(o.selector))throw new Error("Illegal argument: selector must be a string.");if(!e||!Ye(e))throw new Error("Illegal argument: invalid handler function for event "+t);return this.addEventListener(t,e,o),this},Hl.prototype.off=function(t,e){if(1!==arguments.length||bn(t))this.removeEventListener(t,e);else{var n=arguments[0];this.getEventListeners().filter(function(t){return t.context===n}).forEach(function(t){this.removeEventListener(t)}.bind(this))}return this},Hl.prototype.addEventListener=function(t,e,n){throw new Error(Bl)},Hl.prototype.removeEventListener=function(t,e){throw new Error(Bl)},Hl.prototype.getEventListeners=function(){throw new Error(Bl)},Hl.prototype.getNodeType=function(){if(this.isTextNode())return"text";if(this.isCommentNode())return"comment";if(this.isElementNode())return"element";if(this.isDocumentNode())return"document";throw new Error("Unsupported node type")},Hl.prototype.getChildCount=function(){throw new Error(Bl)},Hl.prototype.getChildNodes=function(){throw new Error(Bl)},Hl.prototype.getChildren=function(){throw new Error(Bl)},Hl.prototype.getChildAt=function(t){throw new Error(Bl)},Hl.prototype.getChildIndex=function(t){throw new Error(Bl)},Hl.prototype.getChildNodeIterator=function(){return new Sl(this.getChildNodes())},Hl.prototype.getLastChild=function(){throw new Error(Bl)},Hl.prototype.getFirstChild=function(){throw new Error(Bl)},Hl.prototype.getNextSibling=function(){throw new Error(Bl)},Hl.prototype.getPreviousSibling=function(){throw new Error(Bl)},Hl.prototype.isTextNode=function(){throw new Error(Bl)},Hl.prototype.isElementNode=function(){throw new Error(Bl)},Hl.prototype.isCommentNode=function(){throw new Error(Bl)},Hl.prototype.isDocumentNode=function(){throw new Error(Bl)},Hl.prototype.clone=function(){throw new Error(Bl)},Hl.prototype.createElement=function(t){throw new Error(Bl)},Hl.prototype.createTextNode=function(t){throw new Error(Bl)},Hl.prototype.is=function(t){throw new Error(Bl)},Hl.prototype.getParent=function(){throw new Error(Bl)},Hl.prototype.getRoot=function(){throw new Error(Bl)},Hl.prototype.find=function(t){throw new Error(Bl)},Hl.prototype.findAll=function(t){throw new Error(Bl)},Hl.prototype.append=function(t){var e;if(1===arguments.length){if(!mn(t))return this.appendChild(t),this;e=t}else e=arguments;return e&&Array.prototype.forEach.call(e,this.appendChild.bind(this)),this},Hl.prototype.appendChild=function(t){throw new Error(Bl)},Hl.prototype.insertAt=function(t,e){throw new Error(Bl)},Hl.prototype.insertBefore=function(t,e){throw new Error(Bl)},Hl.prototype.removeAt=function(t){throw new Error(Bl)},Hl.prototype.removeChild=function(t){throw new Error(Bl)},Hl.prototype.replaceChild=function(t,e){throw new Error(Bl)},Hl.prototype.remove=function(){var t=this.getParent();t&&t.removeChild(this)},Hl.prototype.empty=function(){throw new Error(Bl)},Hl.prototype.serialize=function(){return this.outerHTML},Hl.prototype.isInDocument=function(){return!1},Hl.prototype.focus=function(){return this},Hl.prototype.blur=function(){return this},Hl.prototype.click=function(){return this},Hl.prototype.getWidth=function(){return 0},Hl.prototype.getHeight=function(){return 0},Hl.prototype.getOuterHeight=function(t){return 0},Hl.prototype.getOffset=function(){return{top:0,left:0}},Hl.prototype.getPosition=function(){return{top:0,left:0}},Hl.prototype.getElementFactory=function(){return this.createElement.bind(this)};var Ul={id:{configurable:!0,get:function(){return this.getId()},set:function(t){this.setId(t)}},tagName:{configurable:!0,get:function(){return this.getTagName()},set:function(t){this.setTagName(t)}},nodeName:{configurable:!0,get:function(){return this.getTagName()}},nodeType:{configurable:!0,get:function(){return this.getNodeType()},set:function(){throw new Error("ui/DOMElement#nodeType is readonly.")}},textContent:{configurable:!0,get:function(){return this.getTextContent()},set:function(t){this.setTextContent(t)}},innerHTML:{configurable:!0,get:function(){return this.getInnerHTML()},set:function(t){this.setInnerHTML(t)}},outerHTML:{configurable:!0,get:function(){return this.getOuterHTML()},set:function(){throw new Error("ui/DOMElement#outerHTML is readonly.")}},childNodes:{configurable:!0,get:function(){return this.getChildNodes()},set:function(){throw new Error("ui/DOMElement#childNodes is readonly.")}},children:{configurable:!0,get:function(){return this.getChildren()},set:function(){throw new Error("ui/DOMElement#children is readonly.")}},parentNode:{configurable:!0,get:function(){return this.getParent()},set:function(){throw new Error("ui/DOMElement#parentNode is readonly.")}},height:{configurable:!0,get:function(){return this.getHeight()}},width:{configurable:!0,get:function(){return this.getWidth()}}};Hl.prototype._isDOMElement=!0,Hl._propertyNames=Object.keys(Ul),Hl._defineProperties=function(t,e){e=e||Hl._propertyNames,e.forEach(function(e){var n=Ul[e];n&&Object.defineProperty(t.prototype,e,n)})};var Vl=function(t){function e(){t.call(this),this.el=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Hl),ql={getNativeElement:null,hasClass:!1,getAttribute:null,getAttributes:{},getProperty:null,getTagName:"throw",getId:"throw",getValue:null,getStyle:null,getTextContent:"",getInnerHTML:"",getOuterHTML:"",getChildCount:0,getChildNodes:[],getChildren:[],getChildAt:null,getParent:null,getRoot:null,getEventListeners:[],find:null,findAll:[],is:!1,isTextNode:!1,isElementNode:!1,isCommentNode:!1,isDocumentNode:!1,isInDocument:!1,position:null};va(ql,function(t,e){Vl.prototype[e]=function(){if(!this.el){if("throw"===t)throw new Error("This component has not been rendered yet.");return t}return this.el[e].apply(this.el,arguments)}}),["addClass","removeClass","setAttribute","removeAttribute","setProperty","removeProperty","setTagName","setId","setValue","setStyle","setTextContent","setInnerHTML","addEventListener","removeEventListener","appendChild","insertAt","insertBefore","remove","removeAt","removeChild","replaceChild","empty","focus","blur","click"].forEach(function(t){Vl.prototype[t]=function(){if(!this.el)throw new Error("This component has not been rendered yet.");return this.el[t].apply(this.el,arguments),this}}),Hl.Delegator=Vl;var Jl=function(t,e,n){if(!bn(t)||!Ye(e))throw new Error("Illegal arguments: 'eventName' must be a String, and 'handler' must be a Function.");n=n||{};var o=e,r=n.context,i=Boolean(n.capture);r&&(e=e.bind(r)),n.once===!0&&(e=$(this,e)),this.eventName=t,this.originalHandler=o,this.handler=e,this.capture=i,this.context=r,this.options=n,this._el=null},$l={_isDOMEventListener:{}};$l._isDOMEventListener.get=function(){return!0},Object.defineProperties(Jl.prototype,$l),Jl.matches=function(t,e){return t.eventName===e.eventName&&t.originalHandler===e.originalHandler},Hl.EventListener=Jl,Hl._findEventListenerIndex=function(t,e,n){var o=-1;return o=arguments[1]._isDOMEventListener?t.indexOf(arguments[1]):zl(t,Jl.matches.bind(null,{eventName:e,originalHandler:n}))};var Wl=function(){},Kl={_isDOMElement:{}};Kl._isDOMElement.get=function(){return!0},Wl.prototype.isTextNode=function(){return!0},Wl.prototype.getNodeType=function(){return"text"},Wl.prototype.isElementNode=function(){return!1},Wl.prototype.isDocumentNode=function(){return!1},Wl.prototype.isCommentNode=function(){return!1},Object.defineProperties(Wl.prototype,Kl),["getParent","getNextSibling","getPreviousSibling","text","getTextContent","setTextContent","clone"].forEach(function(t){Wl.prototype[t]=Hl.prototype[t]}),Hl.TextNode=Wl;var Xl=function(t){function e(e){t.call(this),console.assert(e instanceof window.Node,"Expecting native DOM node."),this.el=e,e._wrapper=this,this.eventListeners=[],this.htmlProps={}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isBrowserDOMElement:{}};return n._isBrowserDOMElement.get=function(){return!0},e.prototype.getNativeElement=function(){return this.el},e.prototype.hasClass=function(t){return this.el.classList.contains(t)},e.prototype.addClass=function(t){return this.el.classList.add(t),this},e.prototype.removeClass=function(t){return this.el.classList.remove(t),this},e.prototype.getClasses=function(){return this.el.className},e.prototype.setClasses=function(t){return this.el.className=t,this},e.prototype.getAttribute=function(t){return this.el.getAttribute(t)},e.prototype.setAttribute=function(t,e){return this.el.setAttribute(t,e),this},e.prototype.removeAttribute=function(t){return this.el.removeAttribute(t),this},e.prototype.getAttributes=function(){for(var t={},e=this.el.attributes,n=e.length,o=0;o<n;o++){var r=e.item(o);t[r.name]=r.value}return t},e.prototype.getProperty=function(t){return this.el[t]},e.prototype.setProperty=function(t,e){return this.htmlProps[t]=e,this.el[t]=e,this},e.prototype.removeProperty=function(t){return delete this.htmlProps[t],delete this.el[t],this},e.prototype.getTagName=function(){if(this.el.tagName)return this.el.tagName.toLowerCase()},e.prototype.setTagName=function(t){var n,o=this,r=e.createElement(t),i=this.el.attributes,s=i.length;for(n=0;n<s;n++){var a=i.item(n);r.setAttribute(a.name,a.value)}for(var p in this.htmlProps)o.htmlProps.hasOwnProperty(p)&&(r[p]=o.htmlProps[p]);return this.eventListeners.forEach(function(t){r.addEventListener(t.eventName,t.handler,t.capture)}),r.append(this.getChildNodes()),this._replaceNativeEl(r.getNativeElement()),this},e.prototype.getId=function(){return this.el.id},e.prototype.setId=function(t){return this.el.id=t,this},e.prototype.getValue=function(){return this.el.value},e.prototype.setValue=function(t){return this.el.value=t,this},e.prototype.getStyle=function(t){var e=this.getComputedStyle();return e[t]||this.el.style[t]},e.prototype.getComputedStyle=function(){return window.getComputedStyle(this.el)},e.prototype.setStyle=function(t,e){var n={top:!0,bottom:!0,left:!0,right:!0,height:!0,width:!0};return n[t]&&eu(e)&&(e+="px"),this.el.style[t]=e,this},e.prototype.getTextContent=function(){return this.el.textContent},e.prototype.setTextContent=function(t){return this.el.textContent=t,this},e.prototype.getInnerHTML=function(){var t=this.el.innerHTML;if(!bn(t)){for(var e=this.el.ownerDocument.createDocumentFragment(),n=this.el.firstChild;n;n=n.nextSibling)e.appendChild(n.cloneNode(!0));var o=new window.XMLSerializer;t=o.serializeToString(e)}return t},e.prototype.setInnerHTML=function(t){return this.el.innerHTML=t,this},e.prototype.getOuterHTML=function(){var t=this.el.outerHTML;if(!bn(t)){var e=new window.XMLSerializer;t=e.serializeToString(this.el)}return t},e.prototype.addEventListener=function(e,n,o){var r;return r=1===arguments.length&&arguments[0]?arguments[0]:new t.EventListener(e,n,o),r.options.selector&&!r.__hasEventDelegation__&&(r.handler=this._delegatedHandler(r),r.__hasEventDelegation__=!0),this.el.addEventListener(r.eventName,r.handler,r.capture),r._el=this,this.eventListeners.push(r),this},e.prototype._delegatedHandler=function(t){var e=t.handler,n=t.context,o=t.options.selector,r=this.getNativeElement();return function(t){for(var i=t.target;i;){if(K(i,o)){e(new W(n,t.target,t));break}if(i===r)break;i=i.parentNode}}},e.prototype.removeEventListener=function(e,n){var o=null,r=-1;return r=t._findEventListenerIndex(this.eventListeners,e,n),o=this.eventListeners[r],r>-1&&(this.eventListeners.splice(r,1),o._el=null,this.el.removeEventListener(o.eventName,o.handler)),this},e.prototype.removeAllEventListeners=function(){for(var t=this,e=0;e<this.eventListeners.length;e++){var n=t.eventListeners[e];n._el=null,t.el.removeEventListener(n.eventName,n.handler)}this.eventListeners=[]},e.prototype.getEventListeners=function(){return this.eventListeners},e.prototype.getChildCount=function(){return this.el.childNodes.length},e.prototype.getChildNodes=function(){for(var t=[],n=this.el.firstChild;n;n=n.nextSibling)t.push(e.wrapNativeElement(n));return t},e.prototype.getChildren=function(){for(var t=[],n=this.el.firstChild;n;n=n.nextSibling)n.nodeType===window.Node.ELEMENT_NODE&&t.push(e.wrapNativeElement(n));return t},e.prototype.getChildAt=function(t){return e.wrapNativeElement(this.el.childNodes[t])},e.prototype.getChildIndex=function(t){if(!t._isBrowserDOMElement)throw new Error("Expecting a BrowserDOMElement instance.");return Array.prototype.indexOf.call(this.el.childNodes,t.el)},e.prototype.getFirstChild=function(){var t=this.el.firstChild;return t?e.wrapNativeElement(t):null},e.prototype.getLastChild=function(){var t=this.el.lastChild;return t?e.wrapNativeElement(t):null},e.prototype.getNextSibling=function(){var t=this.el.nextSibling;return t?e.wrapNativeElement(t):null},e.prototype.getPreviousSibling=function(){var t=this.el.previousSibling;return t?e.wrapNativeElement(t):null},e.prototype.isTextNode=function(){return this.el.nodeType===window.Node.TEXT_NODE},e.prototype.isElementNode=function(){return this.el.nodeType===window.Node.ELEMENT_NODE},e.prototype.isCommentNode=function(){return this.el.nodeType===window.Node.COMMENT_NODE},e.prototype.isDocumentNode=function(){return this.el.nodeType===window.Node.DOCUMENT_NODE},e.prototype.clone=function t(){var t=this.el.cloneNode(!0);return e.wrapNativeElement(t)},e.prototype.createElement=function(t){var n=this.el.ownerDocument.createElement(t);return e.wrapNativeElement(n)},e.prototype.createTextNode=function(t){var n=this.el.ownerDocument.createTextNode(t);return e.wrapNativeElement(n)},e.prototype.is=function(t){var e=this.el;return!!this.isElementNode()&&K(e,t)},e.prototype.getParent=function(){var t=this.el.parentNode;return t?e.wrapNativeElement(t):null},e.prototype.getRoot=function(){for(var t=this.el,n=t;n;)t=n,n=t.parentNode;return e.wrapNativeElement(t)},e.prototype.find=function(t){var n=null;return this.el.querySelector&&(n=this.el.querySelector(t)),n?e.wrapNativeElement(n):null},e.prototype.findAll=function(t){var n=[];return this.el.querySelectorAll&&(n=this.el.querySelectorAll(t)),Array.prototype.map.call(n,function(t){return e.wrapNativeElement(t)})},e.prototype._normalizeChild=function(t){if(t instanceof window.Node){if(t._wrapper)return t;t=e.wrapNativeElement(t)}if(bn(t)&&(t=this.createTextNode(t)),!t||!t._isBrowserDOMElement)throw new Error("Illegal child type.");return t.el._wrapper||(t.el._wrapper=t),console.assert(t.el._wrapper===t,"The backlink to the wrapper should be consistent"),t.getNativeElement()},e.prototype.appendChild=function(t){var e=this._normalizeChild(t);return this.el.appendChild(e),this},e.prototype.insertAt=function(t,e){var n=this._normalizeChild(e),o=this.el.childNodes;return t>=o.length?this.el.appendChild(n):this.el.insertBefore(n,o[t]),this},e.prototype.insertBefore=function(t,e){if(!e||!e._isBrowserDOMElement)throw new Error('insertBefore(): Illegal arguments. "before" must be a BrowserDOMElement instance.');var n=this._normalizeChild(t);return this.el.insertBefore(n,e.el),this},e.prototype.removeAt=function(t){return this.el.removeChild(this.el.childNodes[t]),this},e.prototype.removeChild=function(t){if(!t||!t._isBrowserDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a BrowserDOMElement instance.");return this.el.removeChild(t.el),this},e.prototype.replaceChild=function(t,e){if(!(e&&t&&e._isBrowserDOMElement&&t._isBrowserDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");return this.el.replaceChild(e.el,t.el),this},e.prototype.empty=function(){for(var t=this.el;t.lastChild;)t.removeChild(t.lastChild);return this},e.prototype.remove=function(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this},e.prototype.serialize=function(){var t=this.el.outerHTML;if(bn(t))return t;var e=new window.XMLSerializer;return e.serializeToString(this.el)},e.prototype.isInDocument=function(){for(var t=this.el;t;){if(t.nodeType===window.Node.DOCUMENT_NODE)return!0;t=t.parentNode}},e.prototype._replaceNativeEl=function(t){console.assert(t instanceof window.Node,"Expecting a native element.");var e=this.el,n=e.parentNode;n&&n.replaceChild(t,e),this.el=t,this.el._wrapper=this},e.prototype._getChildNodeCount=function(){return this.el.childNodes.length},e.prototype.focus=function(){return this.el.focus(),this},e.prototype.blur=function(){return this.el.focus(),this},e.prototype.click=function(){return this.el.click(),this},e.prototype.getWidth=function(){var t=this.el.getClientRects()[0];return t?t.width:0},e.prototype.getHeight=function(){var t=this.el.getClientRects()[0];return t?t.height:0},e.prototype.getOffset=function(){var t=this.el.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},e.prototype.getPosition=function(){return{left:this.el.offsetLeft,top:this.el.offsetTop}},e.prototype.getOuterHeight=function(t){var e=this.el.offsetHeight;if(t){var n=this.getComputedStyle();e+=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)}return e},Object.defineProperties(e.prototype,n),e}(Hl);Hl._defineProperties(Xl,Hl._propertyNames),Xl.createTextNode=function(t){return Xl.wrapNativeElement(window.document.createTextNode(t))},Xl.createElement=function(t){return Xl.wrapNativeElement(window.document.createElement(t))},Xl.parseMarkup=function(t,e,n){var o,r=[];if(!t)return o="xml"===e?(new window.DOMParser).parseFromString("<dummy/>","text/xml"):(new window.DOMParser).parseFromString("<html></html>","text/html"),new Xl(o);var i=new window.DOMParser;if("html"===e?(n=t.search(/<\s*html/i)>=0,o=i.parseFromString(t,"text/html")):"xml"===e&&(o=i.parseFromString(t,"text/xml")),!o)throw new Error("Could not parse DOM string.");var s=o.querySelector("parsererror");if(s)throw new Error("ParserError: could not parse "+t);if("html"===e)if(n)r=[o.querySelector("html")];else{var a=o.querySelector("body");r=a.childNodes}else"xml"===e&&(r=n?[o]:o.childNodes);var p=Array.prototype.map.call(r,function(t){return new Xl(t)});return 1===p.length?p[0]:p};var Gl=function(t){function e(e){t.call(this),console.assert(e instanceof window.Node&&3===e.nodeType,"Expecting native TextNode."),this.el=e,e._wrapper=this;var n=["getParent","getNextSibling","getPreviousSibling","getTextContent","setTextContent","getInnerHTML","setInnerHTML","getOuterHTML","getNativeElement","clone"];n.forEach(function(t){this[t]=Xl.prototype[t]}.bind(this))}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isBrowserDOMElement:{}};return n._isBrowserDOMElement.get=function(){return!0},Object.defineProperties(e.prototype,n),e}(Hl.TextNode);Hl._defineProperties(Gl,["nodeType","textContent","innerHTML","outerHTML","parentNode"]),Xl.TextNode=Gl,Xl.wrapNativeElement=function(t){return t?t._wrapper?t._wrapper:t instanceof window.Node?3===t.nodeType?new Gl(t):new Xl(t):t===window?Xl.getBrowserWindow():void 0:null};var Ql=function(){this.el=window,window.__BrowserDOMElementWrapper__=this,this.eventListeners=[],this.getEventListeners=Xl.prototype.getEventListeners};Ql.prototype.on=function(){return Xl.prototype.on.apply(this,arguments)},Ql.prototype.off=function(){return Xl.prototype.off.apply(this,arguments)},Ql.prototype.addEventListener=function(){return Xl.prototype.addEventListener.apply(this,arguments)},Ql.prototype.removeEventListener=function(){return Xl.prototype.removeEventListener.apply(this,arguments)},Xl.getBrowserWindow=function(){return window.__BrowserDOMElementWrapper__?window.__BrowserDOMElementWrapper__:new Ql(window)};var Yl,Zl;Xl.isReverse=function(t,e,n,o){if(n&&t){Yl||(Yl=window.document.createRange(),Zl=window.document.createRange()),Yl.setStart(t.getNativeElement(),e),Zl.setStart(n.getNativeElement(),o);var r=Yl.compareBoundaryPoints(window.Range.START_TO_START,Zl);if(1===r)return!0}return!1},Xl.getWindowSelection=function(){var t=window.getSelection(),e={anchorNode:Xl.wrapNativeElement(t.anchorNode),anchorOffset:t.anchorOffset,focusNode:Xl.wrapNativeElement(t.focusNode),focusOffset:t.focusOffset};return e};var td=function(t){function e(e){t.call(this),this.el=e,this.$el=me(e),e._wrapper=this,this.htmlProps={}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isCheerioDOMElement:{}};return n._isCheerioDOMElement.get=function(){return!0},e.prototype.getNativeElement=function(){return this.el},e.prototype._wrapNativeElement=function(t){return t._wrapper?t._wrapper:new e(t)},e.prototype.hasClass=function(t){return this.$el.hasClass(t)},e.prototype.addClass=function(t){return this.$el.addClass(t),this},e.prototype.removeClass=function(t){return this.$el.removeClass(t),this},e.prototype.getClasses=function(){return this.$el.attr("class")},e.prototype.setClasses=function(t){return this.$el.attr("class",t),this},e.prototype.getAttribute=function(t){return this.$el.attr(t)},e.prototype.setAttribute=function(t,e){return this.$el.attr(t,e),this},e.prototype.removeAttribute=function(t){return this.$el.removeAttr(t),this},e.prototype.getAttributes=function(){var t=Qc(this.el.attribs);return t},e.prototype.getProperty=function(t){return this.$el.prop(t)},e.prototype.setProperty=function(t,e){return this.htmlProps[t]=e,this.$el.prop(t,e),this},e.prototype.removeProperty=function(t){return delete this.htmlProps[t],delete this.el[t],this},e.prototype.getTagName=function(){return"tag"!==this.el.type?"":this.el.name.toLowerCase()},e.prototype.setTagName=function(t){var e=me._createElement(t,this.el.root),n=me(e);return n.html(this.$el.html()),e.attribs=Sp({},this.el.attribs),this._replaceNativeEl(e),this},e.prototype.getId=function(){return this.$el.attr("id")},e.prototype.setId=function(t){return this.$el.attr("id",t),this},e.prototype.getTextContent=function(){return this.$el.text()},e.prototype.setTextContent=function(t){return this.$el.text(t),this},e.prototype.getInnerHTML=function(){return this.$el.html()},e.prototype.setInnerHTML=function(t){return this.$el.html(t),this},e.prototype.getOuterHTML=function(){return me._serialize(this.el)},e.prototype.getValue=function(){return this.$el.val()},e.prototype.setValue=function(t){return this.$el.val(t),this},e.prototype.getStyle=function(t){return this.$el.css(t)},e.prototype.setStyle=function(t,e){return this.$el.css(t,e),this},e.prototype.addEventListener=function(){return this},e.prototype.removeEventListener=function(){return this},e.prototype.removeAllEventListeners=function(){return this},e.prototype.getEventListeners=function(){return[]},e.prototype.getChildCount=function(){return this.el.children.length},e.prototype.getChildNodes=function(){var t=this.el.children;return t=t.map(function(t){return this._wrapNativeElement(t)}.bind(this))},e.prototype.getChildren=function(){var t=this.el.children;return t=t.filter(function(t){return"tag"===t.type}),t=t.map(function(t){return this._wrapNativeElement(t)}.bind(this))},e.prototype.getChildAt=function(t){return this._wrapNativeElement(this.el.children[t])},e.prototype.getChildIndex=function(t){if(!t._isCheerioDOMElement)throw new Error("Expecting a CheerioDOMElement instance.");return this.el.children.indexOf(t.el)},e.prototype.getFirstChild=function(){var t=this.el.children[0];return t?e.wrapNativeElement(t):null},e.prototype.getLastChild=function(){var t=pu(this.el.children);return t?e.wrapNativeElement(t):null},e.prototype.getNextSibling=function(){var t=this.el.next;return t?e.wrapNativeElement(t):null},e.prototype.getPreviousSibling=function(){var t=this.el.previous;return t?e.wrapNativeElement(t):null},e.prototype.isTextNode=function(){return"text"===this.el.type},e.prototype.isElementNode=function(){return"tag"===this.el.type||"script"===this.el.type},e.prototype.isCommentNode=function(){return"comment"===this.el.type},e.prototype.isDocumentNode=function(){return this.el===this.el.root},e.prototype.clone=function(){var t=this.$el.clone()[0];
return this._wrapNativeElement(t)},e.prototype.createElement=function(t){var e=me._createElement(t,this.el.root);return this._wrapNativeElement(e)},e.prototype.createTextNode=function(t){var e=me._createTextNode(t);return this._wrapNativeElement(e)},e.prototype.is=function(t){return this.$el.is(t)},e.prototype.getParent=function(){var t=this.el.parent;return t?this._wrapNativeElement(t):null},e.prototype.getRoot=function(){for(var t=this.el,e=t;e;)t=e,e=t.parent;return this._wrapNativeElement(t)},e.prototype.find=function(t){var e=this.$el.find(t);return e.length>0?this._wrapNativeElement(e[0]):null},e.prototype.findAll=function(t){var e=this.$el.find(t);return e.length>0?Aa(e,function(t){return this._wrapNativeElement(t)}.bind(this)):[]},e.prototype._normalizeChild=function(t){if(bn(t)&&(t=this.createTextNode(t)),t._wrapper&&(t=t._wrapper),!t||!t._isCheerioDOMElement)throw new Error("Illegal argument: only String and CheerioDOMElement instances are valid.");return console.assert(t.el._wrapper===t,"Expecting a backlink between native element and CheerioDOMElement"),t.getNativeElement()},e.prototype.appendChild=function(t){return t=this._normalizeChild(t),this.el.children.push(t),t.parent=this.el,this},e.prototype.insertAt=function(t,e){e=this._normalizeChild(e);var n=this.el.children;return t>=n.length?n.push(e):n.splice(t,0,e),e.parent=this.el,this},e.prototype.insertBefore=function(t,e){var n=this.el.children.indexOf(e.el);if(n>-1)return this.insertAt(n,t);throw new Error("insertBefore(): reference node is not a child of this element.")},e.prototype.removeAt=function(t){if(t<0||t>=this.el.children.length)throw new Error("removeAt(): Index out of bounds.");var e=this.el.children[t];return e.parent=null,this.el.children.splice(t,1),this},e.prototype.removeChild=function(t){if(!t||!t._isCheerioDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var e=this.el.children.indexOf(t.el);if(e<0)throw new Error("removeChild(): element is not a child.");return this.removeAt(e),this},e.prototype.replaceChild=function(t,e){if(!(e&&t&&e._isCheerioDOMElement&&t._isCheerioDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var n=this.el.children.indexOf(t.el);return n>-1&&(this.removeAt(n),this.insertAt(n,e.el)),this},e.prototype.empty=function(){return this.$el.empty(),this},e.prototype.remove=function(){return this.$el.remove(),this},e.prototype._replaceNativeEl=function(t){var e=me(t);this.$el.replaceWith(e),this.el=t,this.$el=e,this.el._wrapper=this},e.prototype.isInDocument=function(){for(var t=this.el;t;){if(t===t.root)return!0;t=t.parent}return!1},e.prototype.click=function(){this.emit("click")},Object.defineProperties(e.prototype,n),e}(Hl);ba.mixin(td),Hl._defineProperties(td,Hl._propertyNames),td.createTextNode=function(t){return td.wrapNativeElement(me._createTextNode(t))},td.createElement=function(t){return td.wrapNativeElement(me("<"+t+">")[0])},td.parseMarkup=function(t,e){var n,o=[];if(!t)return n="xml"===e?me.parseXML(""):me.parseHTML(""),new td(n);o="xml"===e?me.parseXML(t):me.parseHTML(t);var r=o.map(function(t){return new td(t)});return 1===r.length?r[0]:r},td.wrapNativeElement=function(t){return t._wrapper?t._wrapper:new td(t)};var ed;ed=Al?Xl:td;var nd={};nd.createTextNode=function(t){return ed.createTextNode(t)},nd.createElement=function(t){return ed.createElement(t)},nd._create=function(t){return new ed(t)},nd.getBrowserWindow=function(){return Al?ed.getBrowserWindow():nd.createElement("div")},nd.parseHTML=function(t){return ed.parseMarkup(t,"html")},nd.parseXML=function(t,e){return ed.parseMarkup(t,"xml",e)},nd.wrapNativeElement=function(t){return t?Al&&(t instanceof window.Node||t===window)?Xl.wrapNativeElement(t):t.root&&"root"===t.root.type?td.wrapNativeElement(t):void 0:null},nd.isReverse=function(t,e,n,o){if(Al)return Xl.isReverse(t,e,n,o);throw new Error("Not implemented.")};var od={tagName:"span",export:function(t,e){e.tagName="span",e.attr("data-type",t.type);var n=t.toJSON();Bh(n,function(t,n){"id"!==n&&"type"!==n&&(bn(t)||eu(t)||rl(t))&&e.attr("data-"+n,t)})}},rd={export:function(t,e,n){e.attr("data-type",t.type);var o=t.toJSON();Bh(o,function(o,r){if("id"!==r&&"type"!==r){var i=n.$$("div").attr("property",r);"string"===t.getPropertyType(r)&&o?i.append(n.annotatedText([t.id,r])):i.text(o),e.append(i)}})}},id=function(t){function e(e){t.call(this,Object.assign({idAttribute:"data-id"},e)),this._el=nd.parseHTML("<html></html>")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.exportDocument=function(t){var e=nd.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(t,e)},e.prototype.getDefaultBlockConverter=function(){return rd},e.prototype.getDefaultPropertyAnnotationConverter=function(){return od},e}(Cl),sd=function(t){function e(e){t.call(this,Object.assign({idAttribute:"data-id"},e)),this._el=nd.parseHTML("<html></html>")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.importDocument=function(t){this.reset();var e=nd.parseHTML(t);return this.convertDocument(e),this.generateDocument(),this.state.doc},e.prototype.convertDocument=function(t){throw new Error("This method is abstract")},e}(jl),ad=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(al);ad.isInline=!0;var pd=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTextPath=function(){return[this.id,"content"]},e.prototype.getText=function(){return this.content},e.prototype.isEmpty=function(){return!this.content},e}(sl);pd.isText=!0,pd.define({type:"text",content:"text"});var cd=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(pd);cd.isBlock=!0;var ud={tagName:"annotation",export:function(t,e){e.attr("type",t.type);var n=t.toJSON();va(n,function(t,n){"id"!==n&&"type"!==n&&(bn(t)||eu(t)||rl(t))&&e.attr(n,t)})}},hd={tagName:"block",export:function(t,e,n){e.attr("type",t.type);var o=t.toJSON();va(o,function(o,r){if("id"!==r&&"type"!==r){var i=n.$$(r);"string"===t.getPropertyType(r)?i.append(n.annotatedText([t.id,r])):i.text(o),e.append(i)}})}},fd=function(t){function e(e){t.call(this,Object.assign({idAttribute:"id"},e)),this._el=nd.parseXML("<dummy></dummy>")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefaultBlockConverter=function(){return hd},e.prototype.getDefaultPropertyAnnotationConverter=function(){return ud},e}(Cl),ld=function(t){function e(e){t.call(this,Object.assign({idAttribute:"id"},e)),this._el=nd.parseXML("<dummy></dummy>")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.importDocument=function(t){this.reset();var e=nd.parseXML(t);this.convertDocument(e);var n=this.generateDocument();return n},e}(jl),dd=function(t,e){var n=e.containerId,o=e.path,r=e.direction;if(!n||!o||!r)throw new Error("Insufficient arguments! mandatory fields: `containerId`, `path`, `direction`");var i,s=t.get(n),a=o[0],p=t.get(a),c=s.getPosition(a),u=s.getLength();if("right"===r&&c<u-1){var h=s.nodes[c+1],f=t.get(h);p.isText()&&0===p.getText().length?(X(t,{nodeId:a,containerId:n}),f.isText()?e.selection=t.createSelection(h,0):e.selection=t.createSelection({type:"node",nodeId:h,containerId:n,mode:"full"})):(i=G(t,Sp({},e,{containerId:n,firstNodeId:a,secondNodeId:h})),e.selection=i.selection)}else if("left"===r&&c>0){var l=s.nodes[c-1],d=t.get(l);p.isText()&&0===p.getText().length?(X(t,{nodeId:a,containerId:n}),d.isText()?e.selection=t.createSelection(d.getTextPath(),d.getText().length):e.selection=t.createSelection({type:"node",nodeId:l,containerId:n,mode:"full"})):(i=G(t,Sp({},e,{containerId:n,firstNodeId:l,secondNodeId:a})),e.selection=i.selection)}return e},yd=function(t,e){var n=e.selection;if(!n)throw new Error("'selection' is mandatory.");if(!n.isCollapsed())throw new Error('selection must be collapsed for transformation "deleteCharacter"');return n.isPropertySelection()?gt(t,e):n.isNodeSelection()?mt(t,e):(console.warn("'deleteChar' can not be used with the given selection",n.toString()),e)},gd=function(t,e){var n=e.selection,o=e.text;if(!n)throw new Error("Argument `selection` is mandatory for transformation `insertText`.");if(!o)throw new Error("Argument `text` is mandatory for transformation `insertText`.");if(!n.isPropertySelection()&&!n.isContainerSelection())return console.error("Selection must be a Property- or ContainerSelection."),e;if(!n.isCollapsed())return bt(t,e);void 0===t.get(n.startPath)&&t.set(n.startPath,"");var r=t.update(n.startPath,{insert:{offset:n.startOffset,value:o}});return Z(t,{op:r}),e.selection=t.createSelection(n.startPath,n.startOffset+o.length),e},md=function(t,e){e.text=e.text||"";var n=e.selection;if(!n||n.isNull())return console.error("Can not paste, without selection."),e;var o=Boolean(e.containerId),r=e.doc;if(!r){if(!o)return gd(t,e);e.doc=r=xt(t,e)}if(!n.isCollapsed()){var i=nt(t,e);e.selection=i.selection}var s=r.get(df.SNIPPET_ID).nodes,a=t.getSchema();if(s.length>0){var p=r.get(s[0]);a.isInstanceOf(p.type,"text")&&(e=Ot(t,e),s.shift()),s.length>0&&(e=Et(t,e))}return e},vd=function(t){if(this.config=t||{},this.name=this.config.name,!this.name)throw new Error("'name' is required")},_d={_isCommand:{}};_d._isCommand.get=function(){return!0},vd.prototype.getName=function(){return this.name},vd.prototype.getCommandState=function(t,e){throw new Error("Command.getCommandState() is abstract.")},vd.prototype.execute=function(t,e){throw new Error("Command.execute() is abstract.")},vd.prototype._getDocumentSession=function(t,e){var n=t.documentSession||e.documentSession;if(!n)throw new Error("'documentSession' is required.");return n},vd.prototype._getSelection=function(t){var e=t.selection||t.selectionState.getSelection();if(!e)throw new Error("'selection' is required.");return e},Object.defineProperties(vd.prototype,_d);var bd=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.documentSession;return{disabled:!e.canUndo(),active:!1}},e.prototype.execute=function(t){var e=t.documentSession;return!!e.canUndo()&&(e.undo(),!0)},e}(vd),wd=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.documentSession;return{disabled:!e.canRedo(),active:!1}},e.prototype.execute=function(t){var e=t.documentSession;return!!e.canRedo()&&(e.redo(),!0)},e}(vd),Cd=i(function(t){function e(t,e,o){var r=t.length;return o=void 0===o?r:o,!e&&o>=r?t:n(t,e,o)}var n=r(fu);t.exports=e}),Sd=r(Cd),xd=Object.freeze({default:Sd}),Od=i(function(t){var e="\\ud800-\\udfff",n="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",r="\\ufe0e\\ufe0f",i="\\u200d",s=RegExp("["+i+e+n+o+r+"]");t.exports=s}),Ed=r(Od),Nd=Object.freeze({default:Ed}),Id=i(function(t){function e(t){return t.match(_)}var n="\\ud800-\\udfff",o="\\u0300-\\u036f\\ufe20-\\ufe23",r="\\u20d0-\\u20f0",i="\\ufe0e\\ufe0f",s="["+n+"]",a="["+o+r+"]",p="\\ud83c[\\udffb-\\udfff]",c="(?:"+a+"|"+p+")",u="[^"+n+"]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",f="[\\ud800-\\udbff][\\udc00-\\udfff]",l="\\u200d",d=c+"?",y="["+i+"]?",g="(?:"+l+"(?:"+[u,h,f].join("|")+")"+y+d+")*",m=y+d+g,v="(?:"+[u+a+"?",a,h,f,s].join("|")+")",_=RegExp(p+"(?="+p+")|"+v+m,"g");t.exports=e}),Pd=r(Id),Td=Object.freeze({default:Pd}),jd=i(function(t){function e(t){return function(e){e=s(e);var r=o.test(e)?i(e):void 0,a=r?r[0]:e.charAt(0),p=r?n(r,1).join(""):e.slice(1);return a[t]()+p}}var n=r(xd),o=r(Nd),i=r(Td),s=r(Is);t.exports=e}),Dd=r(jd),Ad=Object.freeze({default:Dd}),Md=i(function(t){var e=r(Ad),n=e("toUpperCase");t.exports=n}),kd=r(Md),Ld=Object.freeze({default:kd}),Rd=i(function(t){function e(t){return o(n(t).toLowerCase())}var n=r(Is),o=r(Ld);t.exports=e}),zd=r(Rd),Fd={},Bd="undefined"!=typeof e?e:window;Bd.hasOwnProperty("Substance")?(console.warn("global.Substance is already defined."),Fd=Bd.Substance):Bd.Substance=Fd;var Hd=Fd,Ud=i(function(t){function e(t){return o(t)||n(t)}var n=r(yn),o=r(vn);t.exports=e}),Vd=r(Ud),qd=Object.freeze({default:Vd}),Jd=i(function(t){function e(t,r,i,s,a){var p=-1,c=t.length;for(i||(i=o),a||(a=[]);++p<c;){var u=t[p];r>0&&i(u)?r>1?e(u,r-1,i,s,a):n(a,u):s||(a[a.length]=u)}return a}var n=r($p),o=r(qd);t.exports=e}),$d=r(Jd),Wd=Object.freeze({default:$d}),Kd=i(function(t){function e(t){var e=t?t.length:0;return e?n(t,o):[]}var n=r(Wd),o=1/0;t.exports=e}),Xd=r(Kd),Gd=i(function(t){function e(t){return null==t}t.exports=e}),Qd=r(Gd),Yd=i(function(t){function e(t){return function(e){return t(e)}}t.exports=e}),Zd=r(Yd),ty=Object.freeze({default:Zd}),ey=i(function(t){function e(t,e,r,u){var h=-1,f=o,l=!0,d=t.length,y=[],g=e.length;if(!d)return y;r&&(e=s(e,a(r))),u?(f=i,l=!1):e.length>=c&&(f=p,l=!1,e=new n(e));t:for(;++h<d;){var m=t[h],v=r?r(m):m;if(m=u||0!==m?m:0,l&&v===v){for(var _=g;_--;)if(e[_]===v)continue t;y.push(m)}else f(e,v,u)||y.push(m)}return y}var n=r(ai),o=r(zf),i=r(Hf),s=r(Ia),a=r(ty),p=r(qf),c=200;t.exports=e}),ny=r(ey),oy=Object.freeze({default:ny}),ry=i(function(t){function e(t,e){return t=Object(t),n(e,function(e,n){return n in t&&(e[n]=t[n]),e},{})}var n=r(lc);t.exports=e}),iy=r(ry),sy=Object.freeze({default:iy}),ay=i(function(t){var e=r($p),n=r(De),o=r(Bp),i=Object.getOwnPropertySymbols,s=i?function(t){for(var r=[];t;)e(r,o(t)),t=n(t);return r}:o;t.exports=s}),py=r(ay),cy=Object.freeze({default:py}),uy=i(function(t){function e(t){return n(t,i,o)}var n=r(Xp),o=r(cy),i=r(vp);t.exports=e}),hy=r(uy),fy=Object.freeze({default:hy}),ly=i(function(t){var e=r(Ia),n=r(oy),o=r(Wd),i=r(sy),s=r(fy),a=r(op),p=r(Bs),c=a(function(t,r){return null==t?{}:(r=e(o(r,1),p),i(t,n(s(t),r)))});t.exports=c}),dy=r(ly),yy=i(function(t){var e=r(oy),n=r(fn),o=r(op),i=o(function(t,o){return n(t)?e(t,o):[]});t.exports=i}),gy=r(yy),my=function(t){function e(e){t.call(this),this.parent=null,this._owner=e,this._ref=null}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isVirtualElement:{}};return n._isVirtualElement.get=function(){return!0},e.prototype.getParent=function(){return this.parent},e.prototype.ref=function t(t){if(!t)throw new Error("Illegal argument");return this._ref=t,this._context&&(this._context.refs[t]=this),this},Object.defineProperties(e.prototype,n),e}(Hl);Hl._defineProperties(my,gy(Hl._propertyNames,"children"));var vy=function(t){function e(e){t.call(this),this._tagName=e,this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null,this.children=[]}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isVirtualHTMLElement:{}};return n._isVirtualHTMLElement.get=function(){return!0},e.prototype.getTagName=function(){return this._tagName},e.prototype.setTagName=function(t){return this._tagName=t,this},e.prototype.hasClass=function(t){return!!this.classNames&&this.classNames.indexOf(t)>-1},e.prototype.addClass=function(t){return this.classNames||(this.classNames=[]),this.classNames.push(t),this},e.prototype.removeClass=function(t){return this.classNames&&(this.classNames=gy(this.classNames,t)),this},e.prototype.removeAttr=function(t){return this.attributes&&(bn(t)?delete this.attributes[t]:this.attributes=dy(this.attributes,t)),this},e.prototype.getAttribute=function(t){if(this.attributes)return this.attributes[t]},e.prototype.setAttribute=function(t,e){return this.attributes||(this.attributes={}),this.attributes[t]=e,this},e.prototype.getAttributes=function(){var t={};return this.attributes&&Sp(t,this.attributes),this.classNames&&(t.class=this.classNames.join(" ")),this.style&&(t.style=Aa(this.style,function(t,e){return e+":"+t}).join(";")),t},e.prototype.getId=function(){return this.getAttribute("id")},e.prototype.setId=function(t){return this.setAttribute("id",t),this},e.prototype.setTextContent=function(t){if(!bn(t))throw new Error("Illegal argument: expecting a string.");return t=t||"",this.empty(),this.appendChild(t),this},e.prototype.setInnerHTML=function(t){return t=t||"",this.empty(),this._innerHTMLString=t,this},e.prototype.getInnerHTML=function(){if(this.hasOwnProperty("_innerHTMLString"))return this._innerHTMLString;throw new Error("Not supported.")},e.prototype.getValue=function(){return this.htmlProp("value")},e.prototype.setValue=function(t){return this.htmlProp("value",t),this},e.prototype.getChildNodes=function(){return this.children},e.prototype.getChildren=function(){return this.children.filter(function(t){return"text"!==t.getNodeType()})},e.prototype.isTextNode=function(){return!1},e.prototype.isElementNode=function(){return!0},e.prototype.isCommentNode=function(){return!1},e.prototype.isDocumentNode=function(){return!1},e.prototype.append=function(){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._append(this.children,arguments),this},e.prototype.appendChild=function(t){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._appendChild(this.children,t),this},e.prototype.insertAt=function(t,e){if(e=this._normalizeChild(e),!e)throw new Error("Illegal child: "+e);if(!e._isVirtualElement)throw new Error("Illegal argument for $$.insertAt():"+e);if(t<0||t>this.children.length)throw new Error("insertAt(): index out of bounds.");return this._insertAt(this.children,t,e),this},e.prototype.insertBefore=function(t,e){var n=this.children.indexOf(e);if(!(n>-1))throw new Error("insertBefore(): reference node is not a child of this element.");return this.insertAt(n,t),this},e.prototype.removeAt=function(t){if(t<0||t>=this.children.length)throw new Error("removeAt(): Index out of bounds.");return this._removeAt(t),this},e.prototype.removeChild=function(t){if(!t||!t._isVirtualElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var e=this.children.indexOf(t);if(e<0)throw new Error("removeChild(): element is not a child.");return this.removeAt(e),this},e.prototype.replaceChild=function(t,e){if(!(e&&t&&e._isVirtualElement&&t._isVirtualElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var n=this.children.indexOf(t);if(n<0)throw new Error("replaceChild(): element is not a child.");return this.removeAt(n),this.insertAt(n,e),this},e.prototype.empty=function(){for(var t=this.children;t.length;){var e=t.pop();e.parent=null}return delete this._innerHTMLString,this},e.prototype.getProperty=function(t){if(this.htmlProps)return this.htmlProps[t]},e.prototype.setProperty=function(t,e){return this.htmlProps||(this.htmlProps={}),this.htmlProps[t]=e,this},e.prototype.removeProperty=function(t){return this.htmlProps&&delete this.htmlProps[t],this},e.prototype.getStyle=function(t){if(this.style)return this.style[t]},e.prototype.setStyle=function(t,e){return this.style||(this.style={}),this.style[t]=e,this},e.prototype.addEventListener=function(t,e,n){var o;return 1===arguments.length&&arguments[0]._isDOMEventListener?o=arguments[0]:(n=n||{},n.context=n.context||this._owner._comp,o=new Hl.EventListener(t,e,n)),this.eventListeners||(this.eventListeners=[]),this.eventListeners.push(o),this},e.prototype.removeEventListener=function(t,e){return this.eventListeners&&Hl._findEventListenerIndex(this.eventListeners,t,e),this},e.prototype.getEventListeners=function(){return this.eventListeners},e.prototype.getNodeType=function(){return"element"},e.prototype.hasInnerHTML=function(){return Boolean(this._innerHTMLString)},e.prototype._normalizeChild=function(t){return bn(t)&&(t=new wy(t)),t},e.prototype._append=function(t,e){if(1===e.length&&!mn(e[0]))return void this._appendChild(t,e[0]);var n;if(mn(e[0]))n=e[0];else{if(!(arguments.length>1))return;n=Array.prototype.slice.call(e,0)}n.forEach(this._appendChild.bind(this,t))},e.prototype._appendChild=function(t,e){if(e=this._normalizeChild(e))return t.push(e),this._attach(e),e},e.prototype._insertAt=function(t,e,n){n&&(t.splice(e,0,n),this._attach(n))},e.prototype._removeAt=function(t,e){var n=t[e];t.splice(e,1),this._detach(n)},e.prototype._attach=function(t){t.parent=this,this._context&&t._owner!==this._owner&&t._ref&&(this._context.foreignRefs[t._ref]=t)},e.prototype._detach=function(t){t.parent=null,this._context&&t._owner!==this._owner&&t._ref&&delete this.context.foreignRefs[t._ref]},e.prototype._mergeHTMLConfig=function(t){t.classNames&&(this.classNames||(this.classNames=[]),this.classNames=this.classNames.concat(t.classNames)),t.attributes&&(this.attributes||(this.attributes={}),Sp(this.attributes,t.attributes)),t.htmlProps&&(this.htmlProps||(this.htmlProps={}),Sp(this.htmlProps,t.htmlProps)),t.style&&(this.style||(this.style={}),Sp(this.style,t.style)),t.eventListeners&&(this.eventListeners||(this.eventListeners=[]),this.eventListeners=this.eventListeners.concat(t.eventListeners))},Object.defineProperties(e.prototype,n),e}(my),_y=function(t){function e(e,n){t.call(this),n=n||{},this.ComponentClass=e,this.props=n,n.children||(n.children=[]),this.children=n.children}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isVirtualComponent:{}};return n._isVirtualComponent.get=function(){return!0},e.prototype.getComponent=function(){return this._comp},e.prototype.getChildren=function(){return this.props.children},e.prototype.getNodeType=function(){return"component"},e.prototype.outlet=function(t){return new by(this,t)},e.prototype._attach=function(t){t._preliminaryParent=this},e.prototype._detach=function(t){t._preliminaryParent=null},e.prototype._copyHTMLConfig=function(){return{classNames:Qc(this.classNames),attributes:Qc(this.attributes),htmlProps:Qc(this.htmlProps),style:Qc(this.style),eventListeners:Qc(this.eventListeners)}},Object.defineProperties(e.prototype,n),e}(vy),by=function(t,e){this.virtualEl=t,this.name=e,Object.freeze(this)};by.prototype._getOutlet=function(){var t=this.virtualEl.props[this.name];return t||(t=[],this.virtualEl.props[this.name]=t),t},by.prototype.append=function(){var t=this._getOutlet();return this.virtualEl._append(t,arguments),this},by.prototype.empty=function(){var t=this.virtualEl.props[this.name];return t.forEach(function(t){this._detach(t)}.bind(this)),t.splice(0,t.length),this};var wy=function(t){function e(e){t.call(this),this.text=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isVirtualTextNode:{}};return n._isVirtualTextNode.get=function(){return!0},Object.defineProperties(e.prototype,n),e}(my);my.Component=_y,my.TextNode=wy,my.createElement=function(){var t,e,n=arguments[0],o=arguments[1];if(bn(n))e="element";else{if(!Ye(n)||!n.prototype._isComponent)throw Qd(n)?new Error("$$(null): provided argument was null or undefined."):new Error("Illegal usage of $$()");e="component"}var r,i,s={},a=[];for(var p in o)if(o.hasOwnProperty(p)){var c=o[p];switch(p){case"class":r=c;break;case"ref":i=c;break;default:"on"===p.slice(0,2)?a.push({name:p.slice(2),handler:c}):s[p]=c}}return"element"===e?(t=new vy(n),t.attr(s)):t=new _y(n,s),t._owner=this.owner,r&&t.addClass(r),i&&t.ref(i),a.forEach(function(e){if(Ye(e.handler))t.on(e.name,e.handler);else{if(!zh(e.handler))throw new Error("Illegal arguments for $$(_,{ on"+e.name+"})");var n=e.handler;t.on(e.name,n.handler,n.context,n)}}),arguments.length>2&&t.append(Xd(Array.prototype.slice.call(arguments,2))),t};var Cy=function(){};Cy.prototype._render=function(t,e,n){var o=$t(t),r=new Cy.State;e&&r.setOldProps(o,e),n&&r.setOldState(o,n);try{jt(r,o,"forceCapture"),o._isVirtualComponent?Dt(r,o._content):Dt(r,o),At(r,o)}finally{r.dispose()}},Cy.prototype._renderChild=function(t,e){var n=new Cy.State;e.parent={_comp:t};try{return jt(n,e),Dt(n,e),e._comp}finally{n.dispose()}};var Sy=function(t,e){this.state=t,this.owner=e.owner,this.refs={},this.foreignRefs={},this.elements=e.elements,this.pos=0,this.updates=e.components.length,this.remaining=this.updates,this.$$=this._createComponent.bind(this)};Sy.prototype._createComponent=function(){var t=this.state,e=this.elements[this.pos++];return!t.isCaptured(e)&&e._isVirtualComponent&&e.parent&&t.isCaptured(e.parent)&&(jt(t,e),this.updates++,this.remaining--),e=my.createElement.apply(this,arguments),e._context=this,e._owner=this.owner,e._attach=function(){},e._detach=function(){},e},Sy.prototype.hasPendingCaptures=function(){return this.updates>0&&this.remaining>0},Sy.prototype.reset=function(){this.pos=0,this.updates=0},Sy.prototype._ancestorsReady=function(t){for(var e=this;t;){if(e.state.isCaptured(t)||t===e.owner||t===e.owner._content)return!0;t=t.parent}return!1},Cy._internal={_capture:jt,_wrap:$t};var xy=function(t){this.owner=t,this.refs={},this.foreignRefs={},this.elements=[],this.components=[],this.$$=this._createComponent.bind(this),this.$$.capturing=!0};xy.prototype._createComponent=function(){var t=my.createElement.apply(this,arguments);return t._context=this,t._owner=this.owner,t._isVirtualComponent&&this.components.push(t),this.elements.push(t),t},Cy.createContext=function(t){var e=$t(t);return new xy(e)};var Oy=function(){this.poluted=[],this.id="__"+h()};Oy.prototype.dispose=function(){var t=this.id;this.poluted.forEach(function(e){delete e[t]})},Oy.prototype.set=function(t,e,n){var o=t[this.id];o||(o={},t[this.id]=o,this.poluted.push(t)),o[e]=n},Oy.prototype.get=function(t,e){var n=t[this.id];if(n)return n[e]},Oy.prototype.setMapped=function(t){this.set(t,"mapped",!0)},Oy.prototype.isMapped=function(t){return Boolean(this.get(t,"mapped"))},Oy.prototype.setRelocated=function(t){this.set(t,"relocated",!0)},Oy.prototype.isRelocated=function(t){return Boolean(this.get(t,"relocated"))},Oy.prototype.setDetached=function(t){this.set(t,"detached",!0)},Oy.prototype.isDetached=function(t){return Boolean(this.get(t,"detached"))},Oy.prototype.setCaptured=function(t){this.set(t,"captured",!0)},Oy.prototype.isCaptured=function(t){return Boolean(this.get(t,"captured"))},Oy.prototype.setNew=function(t){this.set(t,"created",!0)},Oy.prototype.isNew=function(t){return Boolean(this.get(t,"created"))},Oy.prototype.setUpdated=function(t){this.set(t,"updated",!0)},Oy.prototype.isUpdated=function(t){return Boolean(this.get(t,"updated"))},Oy.prototype.setSkipped=function(t){this.set(t,"skipped",!0)},Oy.prototype.isSkipped=function(t){return Boolean(this.get(t,"skipped"))},Oy.prototype.setRendered=function(t){this.set(t,"rendered",!0)},Oy.prototype.isRendered=function(t){return Boolean(this.get(t,"rendered"))},Oy.prototype.setOldProps=function(t,e){this.set(t,"oldProps",e)},Oy.prototype.getOldProps=function(t){return this.get(t,"oldProps")},Oy.prototype.setOldState=function(t,e){this.set(t,"oldState",e)},Oy.prototype.getOldState=function(t){return this.get(t,"oldState")},Cy.State=Oy;var Ey=0,Ny=function(t){function e(e,n){t.call(this),"SKIP"!==arguments[0]&&(this.__id__=Ey++,this.parent=e,this.el=null,this.refs={},this.__foreignRefs__={},this._actionHandlers={},this.context=this._getContext()||{},Object.freeze(this.context),this.props=n||{},Object.freeze(this.props),this.state=this.getInitialState()||{},Object.freeze(this.state))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getChildContext=function(){return this.childContext||{}},e.prototype.getInitialState=function(){return{}},e.prototype.getParent=function(){return this.parent},e.prototype.getRoot=function(){for(var t=this,e=t;e;)t=e,e=t.getParent();return t},e.prototype.getNativeElement=function(){return this.el.getNativeElement()},e.prototype.getLabel=function(t){var e=this.context.labelProvider;if(!e)throw new Error("Missing labelProvider.");return e.getLabel(t)},e.prototype.getComponent=function(t,e){var n=this.getComponentRegistry();if(!n)throw new Error("Missing componentRegistry.");var o=n.get(t);if(!e&&!o)throw new Error("No Component registered with name "+t);return o},e.prototype.getComponentRegistry=function(){return this.context.componentRegistry},e.prototype.render=function(t){return t("div")},e.prototype.mount=function(t){if(!t)throw new Error("Element is required.");return this.el||this._render(),t._isDOMElement||(t=nd.wrapNativeElement(t)),t.appendChild(this.el),t.isInDocument()&&this.triggerDidMount(!0),this},e.prototype.shouldRerender=function(t){return!0},e.prototype.rerender=function(){this._rerender(this.props,this.state)},e.prototype._rerender=function(t,e){this._render(t,e),this.isMounted()||this.didUpdate(t,e)},e.prototype._render=function(t,e){if(this.__isRendering__)throw new Error("Component is rendering already.");this.__isRendering__=!0;try{var n=new Cy;n._render(this,t,e)}finally{delete this.__isRendering__}},e.prototype.triggerDidMount=function(){this.getChildren().forEach(function(t){t.triggerDidMount(!0)}),this.__isMounted__||(this.__isMounted__=!0,this.didMount())},e.prototype.didMount=function(){},e.prototype.didUpdate=function(){},e.prototype.isMounted=function(){return this.__isMounted__},e.prototype.triggerDispose=function(){this.getChildren().forEach(function(t){t.triggerDispose()}),this.dispose(),this.__isMounted__=!1},e.prototype.dispose=function(){},e.prototype._setParent=function(t){this.parent=t,this.context=this._getContext()||{},Object.freeze(this.context)},e.prototype.send=function(t){for(var e=arguments,n=this;n;){if(n._actionHandlers&&n._actionHandlers[t])return n._actionHandlers[t].apply(n,Array.prototype.slice.call(e,1)),!0;n=n.getParent()}return console.warn("Action",t,"was not handled."),!1},e.prototype.handleActions=function(t){return Bh(t,function(t,e){this.handleAction(e,t)}.bind(this)),this},e.prototype.handleAction=function(t,e){if(!t||!e||!Ye(e))throw new Error("Illegal arguments.");e=e.bind(this),this._actionHandlers[t]=e},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){var e=this.props,n=this.state,o=!this.__isSettingProps__&&this.shouldRerender(this.getProps(),t);this.willUpdateState(t),this.state=t||{},Object.freeze(this.state),o?this._rerender(e,n):this.__isSettingProps__||this.didUpdate(e,n)},e.prototype.extendState=function(t){t=Sp({},this.state,t),this.setState(t)},e.prototype.willUpdateState=function(t){},e.prototype.getProps=function(){return this.props},e.prototype.setProps=function(t){var e=this.props,n=this.state,o=this.shouldRerender(t,this.state);this._setProps(t),o?this._rerender(e,n):this.didUpdate(e,n)},e.prototype._setProps=function(t){t=t||{},this.__isSettingProps__=!0;try{this.willReceiveProps(t),this.props=t||{},Object.freeze(t)}finally{delete this.__isSettingProps__}},e.prototype.extendProps=function(t){var e=Sp({},this.props,t);this.setProps(e)},e.prototype.willReceiveProps=function(t){},e.prototype.getChildNodes=function(){if(!this.el)return[];var t=this.el.getChildNodes();return t=t.map(Xt).filter(Qt)},e.prototype.getChildren=function(){if(!this.el)return[];var t=this.el.getChildren();return t=t.map(Xt).filter(Qt)},e.prototype.getChildAt=function(t){var e=this.el.getChildAt(t);return Gt(e)},e.prototype.find=function(t){var e=this.el.find(t);return Xt(e)},e.prototype.findAll=function(t){var e=this.el.findAll(t);return e.map(Xt).filter(Qt)},e.prototype.appendChild=function(t){this.insertAt(this.getChildCount(),t)},e.prototype.insertAt=function(t,e){if(bn(e)&&(e=new my.TextNode(e)),!e._isVirtualElement)throw new Error('Invalid argument: "child" must be a VirtualElement.');
var n=(new Cy)._renderChild(this,e);this.el.insertAt(t,n.el),Kt(this,n)},e.prototype.removeAt=function(t){var e=this.el.getChildAt(t);if(e){var n=Gt(e);Wt(n),this.el.removeAt(t)}},e.prototype.removeChild=function(t){if(!t||!t._isComponent)throw new Error("removeChild(): Illegal arguments. Expecting a Component instance.");Wt(t),this.el.removeChild(t.el)},e.prototype.replaceChild=function(t,e){if(!(e&&t&&e._isComponent&&t._isComponent))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");Wt(t),this.el.replaceChild(e.el,t.el),this.isMounted()&&e.triggerDidMount(!0)},e.prototype.empty=function(){return this.el&&(this.getChildNodes().forEach(function(t){Wt(t)}),this.el.empty()),this},e.prototype.remove=function(){Wt(this),this.el.remove()},e.prototype._getContext=function(){var t={},e=this.getParent();return e&&(t=Sp(t,e.context),e.getChildContext)?Sp(t,e.getChildContext()):t},e.prototype.addEventListener=function(){throw new Error("Not supported.")},e.prototype.removeEventListener=function(){throw new Error("Not supported.")},e.prototype.insertBefore=function(){throw new Error("Not supported.")},e}(Hl.Delegator);Ny.prototype._isComponent=!0,ba.mixin(Ny),Hl._defineProperties(Ny,Hl._propertyNames),Ny.unwrap=Xt,Ny.render=function(t){t=t||{};var e=this,n=new e(null,t);return n._render(),n},Ny.mount=function(t,e){if(1===arguments.length&&(t={},e=arguments[0]),!e)throw new Error("'el' is required.");if(bn(e)){var n=e;if(!Al)throw new Error("This selector is not supported on server side.");e=window.document.querySelector(n)}e._isDOMElement||(e=new nd.wrapNativeElement(e));var o=this,r=new o(null,t);return r.mount(e),r},Object.defineProperty(Ny,"$$",{get:function(){throw new Error(["With Substance Beta 4 we introduced a breaking change.","We needed to turn the former static Component.$$ into a contextualized implementation, which is now served via Component.render($$).","FIX: change your signature of 'this.render()' in all your Components to 'this.render($$)"].join("\n"))}}),Ny.unwrapDOMElement=function(t){return Xt(t)},Ny.getComponentFromNativeElement=function(t){return Xt(nd.wrapNativeElement(t))};var Iy=function(t){function e(e,n){if(t.call(this,"SKIP"),!e._isComponent)throw new Error("Illegal argument: 'parent' must be a Component.");if(!n._isVirtualHTMLElement)throw new Error("Illegal argument: 'virtualComp' must be a VirtualHTMLElement.");this.parent=e,this.context=this._getContext()||{},Object.freeze(this.context)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ny);Iy.prototype._isElementComponent=!0;var Py=function(t){function e(e,n){if(t.call(this,"SKIP"),!e._isComponent)throw new Error("Illegal argument: 'parent' must be a Component.");if(!n._isVirtualTextNode)throw new Error("Illegal argument: 'virtualComp' must be a VirtualTextNode.");this.parent=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setTextContent=function(t){if(!this.el)throw new Error("Component must be rendered first.");if(this.el.textContent!==t){var e=this.el.createTextNode(t);this.el._replaceNativeEl(e.getNativeElement())}},e.prototype.getChildNodes=function(){return[]},e.prototype.getChildren=function(){return[]},e}(Ny);Py.prototype._isTextNodeComponent=!0,Ny.Element=Iy,Ny.TextNode=Py;var Ty=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("button").addClass("sc-button");return this.props.icon&&e.append(this.renderIcon(t)),this.props.label&&e.append(this.renderLabel(t)),this.props.hint&&e.append(this.renderHint(t)),this.props.active&&e.addClass("sm-active"),this.props.style?e.addClass("sm-style-"+this.props.style):e.addClass("sm-style-outline"),this.props.disabled?e.attr("tabindex",-1).attr("disabled",!0):e.attr("tabindex",1),e.append(this.props.children),e},e.prototype.renderIcon=function(t){var e=this.context.iconProvider.renderIcon(t,this.props.icon);return e},e.prototype.renderLabel=function(t){return t("div").addClass("se-label").append(this.getLabel(this.props.label))},e.prototype.renderHint=function(t){return t("div").addClass("se-hint").append(this.getLabel(this.props.hint))},e.prototype.getLabel=function(t){var e=this.context.labelProvider;return e.getLabel(t)},e}(Ny),jy=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isTool:{}};return n._isTool.get=function(){return!0},e.prototype.render=function(t){var e=t("div").addClass("se-tool"),n=this.getClassNames();n&&e.addClass(n);var o=this.getTitle();return o&&(e.attr("title",o),e.attr("aria-label",o)),e.append(this.renderButton(t)),e},e.prototype.renderButton=function(t){var e=t(Ty,{icon:this.props.icon,label:this.props.label,hint:this.props.hint,active:this.props.active,disabled:this.props.disabled,style:this.props.style}).on("click",this.onClick);return e},e.prototype.getClassNames=function(){return""},e.prototype.getTitle=function(){var t=this.context.labelProvider,e=this.props.title||t.getLabel(this.getName());return this.props.mode&&(e=[zd(this.props.mode),e].join(" ")),e},e.prototype.getCommandName=function(){return this.getName()},e.prototype.getName=function(){return this.props.name},e.prototype.onClick=function(t){t.preventDefault(),t.stopPropagation(),this.props.disabled||this.executeCommand()},e.prototype.executeCommand=function(t){this.context.commandManager.executeCommand(this.getCommandName(),Sp({mode:this.props.mode},t))},Object.defineProperties(e.prototype,n),e}(Ny),Dy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.props.tools,n=this.props.commandStates,o=t("div").addClass("sc-tool-group");return o.addClass("sm-target-"+this.props.name),e.forEach(function(e,r){var i=Object.assign({},n[r]);i.name=r,i.icon=r,i.style="outline",o.append(t(e.Class,i))}),o},e}(Ny),Ay={inBrowser:Al,isIE:!1,isFF:!1,isWebkit:!1,version:-1,isWindows:Al&&void 0!==window.navigator&&window.navigator.appVersion&&window.navigator.appVersion.indexOf("Win")!==-1};if("undefined"!=typeof window){var My=window.navigator.userAgent,ky=My.indexOf("MSIE "),Ly=My.indexOf("Trident/"),Ry=My.indexOf("Edge/");ky>0?(Ay.isIE=!0,Ay.version=10):Ly>0?(Ay.isIE=!0,Ay.version=11,Ay.isTrident=!0):Ry>0&&(Ay.isIE=!0,Ay.isEdge=!0,Ay.version=12,parseInt(My.substring(Ry+5,My.indexOf(".",Ry)),10)),Ay.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Ay.isWebkit=!Ay.isFF&&!Ay.isIE}var zy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){nd.getBrowserWindow().on("resize",this.onResize,this),this.props.scrollPane.on("scroll",this.onScroll,this),setTimeout(function(){this.updatePositions()}.bind(this))},e.prototype.dispose=function(){nd.getBrowserWindow().off(this),this.props.scrollPane.off(this)},e.prototype.didUpdate=function(){this.updatePositions()},e.prototype.render=function(t){var e=t("div").addClass("sc-scrollbar").on("mousedown",this.onMouseDown);if(this.props.highlights){var n=[];Bh(this.props.highlights,function(e,o){Bh(e,function(e){n.push(t("div").ref(e).addClass("se-highlight sm-"+o))})}),e.append(t("div").ref("highlights").addClass("se-highlights").append(n))}return e.append(t("div").ref("thumb").addClass("se-thumb")),e},e.prototype.updatePositions=function(){var t=this.props.scrollPane,n=t.getScrollableElement(),o=t.getContentHeight(),r=t.getHeight(),i=t.getScrollPosition(),s=t.getContentElement();this.factor=o/r,this.refs.thumb.css({top:i/this.factor,height:r/this.factor}),this.props.highlights&&Bh(this.props.highlights,function(t){Bh(t,function(t){var o=n.find('*[data-id="'+t+'"]');if(o){var r=te(o.getNativeElement(),s.getNativeElement()),i=r.top/this.factor,a=r.height/this.factor;a<e.overlayMinHeight&&(a=e.overlayMinHeight);var p=this.refs[t];p?this.refs[t].css({top:i,height:a}):console.warn("no ref found for highlight",t)}}.bind(this))}.bind(this))},e.prototype.getScrollableElement=function(){return this.props.scrollPane.getScrollableElement()},e.prototype.onResize=function(){this.rerender()},e.prototype.onScroll=function(){this.updatePositions()},e.prototype.onMouseDown=function(t){t.stopPropagation(),t.preventDefault(),this._mouseDown=!0;var e=nd.getBrowserWindow();e.on("mousemove",this.onMouseMove,this),e.on("mouseup",this.onMouseUp,this);var n=this.el.getOffset().top,o=t.pageY-n,r=this.refs.thumb.el;t.target!==r.getNativeElement()?(this.offset=r.height/2,this.onMouseMove(t)):this.offset=o-r.getPosition().top},e.prototype.onMouseUp=function(){this._mouseDown=!1;var t=nd.getBrowserWindow();t.off("mousemove",this.onMouseMove,this),t.off("mouseup",this.onMouseUp,this)},e.prototype.onMouseMove=function(t){if(this._mouseDown){var e=this.props.scrollPane,n=e.getScrollableElement(),o=this.el.getOffset().top,r=t.pageY-o,i=(r-this.offset)*this.factor;n.setProperty("scrollTop",i)}},e}(Ny);zy.overlayMinHeight=2;var Fy=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this.commandStates=this._getCommandStates()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-overlay-container sm-hidden"),n=this.context.commandManager.getCommandStates(),o=this.props.overlay;return e.append(t(o,{commandStates:n}).ref("overlayContent")),e},e.prototype.didMount=function(){this.context.documentSession.on("didUpdate",this._onSessionDidUpdate,this)},e.prototype.dispose=function(){this.context.documentSession.off(this)},e.prototype.position=function(t){var e=this.refs.overlayContent;e.isVisible()&&(this._position(t),this.el.removeClass("sm-hidden"))},e.prototype._onSessionDidUpdate=function(){this.shouldRerender()&&this.rerender()},e.prototype._getCommandStates=function(){return this.context.commandManager.getCommandStates()},e.prototype._position=function(t){if(t){var e=this.el.htmlProp("offsetWidth"),n=t.rectangle.width;this.el.css("top",t.rectangle.top+t.rectangle.height);var o=t.rectangle.left+n/2-e/2;o=Math.max(o,0);var r=t.rectangle.left+n+t.rectangle.right-e;o=Math.min(o,r),this.el.css("left",o)}},e}(Ny),By=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-gutter-container sm-hidden"),n=this.props.gutter;return n.ref("gutter"),e.append(n),e},e.prototype.didMount=function(){this.context.documentSession.on("didUpdate",this._onSessionDidUpdate,this)},e.prototype.dispose=function(){this.context.documentSession.off(this)},e.prototype.position=function(t){var e=this.el.children[0]._comp;e.isVisible()&&(this._position(t),this.el.removeClass("sm-hidden"))},e.prototype._onSessionDidUpdate=function(){this.shouldRerender()&&this.rerender()},e.prototype._position=function(t){t&&(this.el.css("top",t.rectangle.top+t.rectangle.height-t.rectangle.height/2),this.el.css("left",0))},e}(Ny),Hy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getChildContext=function(){return{scrollPane:this}},e.prototype.didMount=function(){this.refs.scrollbar&&this.props.highlights&&this.props.highlights.on("highlights:updated",this.onHighlightsUpdated,this),this.refs.scrollbar&&this.context.doc.on("document:changed",this.onDocumentChange,this,{priority:-1}),this.handleActions({updateOverlayHints:this._updateOverlayHints})},e.prototype.dispose=function(){this.props.highlights&&this.props.highlights.off(this),this.context.doc.off(this)},e.prototype.render=function(t){var e,n,o=t("div").addClass("sc-scroll-pane");return Ay.isFF&&o.addClass("sm-firefox"),"substance"===this.props.scrollbarType&&(o.addClass("sm-substance-scrollbar"),o.addClass("sm-scrollbar-position-"+this.props.scrollbarPosition),o.append(t(zy,{scrollPane:this}).ref("scrollbar").attr("id","content-scrollbar")),o.append(t("div").ref("scanline").addClass("se-scanline"))),this.props.overlay&&(e=t(Fy,{overlay:this.props.overlay}).ref("overlay")),this.props.gutter&&(n=t(By,{gutter:this.props.gutter}).ref("gutter")),o.append(t("div").ref("scrollable").addClass("se-scrollable").append(t("div").ref("content").addClass("se-content").append(e).append(n).append(this.props.children)).on("scroll",this.onScroll)),o},e.prototype._updateOverlayHints=function(t){var e=this.refs.overlay,n=this.refs.gutter;e&&e.position(t),n&&n.position(t)},e.prototype.onDocumentChange=function(){this.refs.scrollbar.updatePositions()},e.prototype.onHighlightsUpdated=function(t){this.refs.scrollbar.extendProps({highlights:t})},e.prototype.onScroll=function(){var t=this.getScrollPosition(),e=this.refs.scrollable;this.props.onScroll&&this.props.onScroll(t,e),this.props.tocProvider&&this.props.tocProvider.markActiveEntry(this),this.emit("scroll",t,e)},e.prototype.getHeight=function(){var t=this.getScrollableElement();return t.height},e.prototype.getContentHeight=function(){var t=0,e=this.refs.content.el;return e.childNodes.forEach(function(e){t+=e.getOuterHeight()}),t},e.prototype.getContentElement=function(){return this.refs.content.el},e.prototype.getScrollableElement=function(){return this.refs.scrollable.el},e.prototype.getScrollPosition=function(){var t=this.getScrollableElement();return Math.floor(t.getProperty("scrollTop")+1)},e.prototype.getPanelOffsetForElement=function(t){var e=t.el,n=this.refs.content.el.el,o=te(e,n);return o.top},e.prototype.scrollTo=function(t,e){var n=this.getScrollableElement(),o=n.find('*[data-id="'+t+'"]');if(o){var r=this.getPanelOffsetForElement(o),i=!0;if(e){var s=n.height,a=n.getProperty("scrollTop");i=r<a||a+s<r}i&&n.setProperty("scrollTop",r)}else console.warn(t,"not found in scrollable container")},e}(Ny),Uy={name:"scroll-pane",configure:function(t){t.addComponent("scroll-pane",Hy)}},Vy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){if(2!==this.props.children.length)throw new Error("SplitPane only works with exactly two child elements");var e=t("div").addClass("sc-split-pane");"horizontal"===this.props.splitType?e.addClass("sm-horizontal"):e.addClass("sm-vertical");var n=this.props.children[0],o=this.props.children[1];return this.props.sizeB?(o.addClass("se-pane sm-sized"),o.css(this.getSizedStyle(this.props.sizeB)),n.addClass("se-pane sm-auto-fill")):(n.addClass("se-pane sm-sized"),n.css(this.getSizedStyle(this.props.sizeA)),o.addClass("se-pane sm-auto-fill")),e.append(n,o),e},e.prototype.getSizedStyle=function(t){return t&&"inherit"!==t?"horizontal"===this.props.splitType?{height:t}:{width:t}:{}},e}(Ny),qy={name:"split-pane",configure:function(t){t.addComponent("split-pane",Vy)}},Jy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-tabbed-pane"),n=t("div").addClass("se-tabs");return Bh(this.props.tabs,function(e){var o=t("a").addClass("se-tab").attr({href:"#","data-id":e.id}).on("click",this.onTabClicked);e.id===this.props.activeTab&&o.addClass("sm-active"),o.append(t("span").addClass("label").append(e.name)),n.append(o)}.bind(this)),e.append(n),e.append(t("div").addClass("se-tab-content").ref("tabContent").append(this.props.children)),e},e.prototype.onTabClicked=function(t){t.preventDefault();var e=t.currentTarget.dataset.id;this.send("switchTab",e)},e}(Ny),$y={name:"tabbed-pane",configure:function(t){t.addComponent("tabbed-pane",Jy)}},Wy={name:"scrollbar",configure:function(t){t.addComponent("scrollbar",zy)}},Ky=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-grid");return this.props.mobile&&e.addClass("sm-mobile"),e.append(this.props.children),e},e}(Ny),Xy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("se-row");return e.append(this.props.children),e},e}(Ny),Gy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("se-cell");return e.addClass("sm-column-"+this.props.columns),e.append(this.props.children),e},e}(Ny);Ky.Row=Xy,Ky.Cell=Gy;var Qy={name:"grid",configure:function(t){t.addComponent("grid",Ky)}},Yy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-modal");return e.on("click",this._closeModal),this.props.width&&e.addClass("sm-width-"+this.props.width),e.append(t("div").addClass("se-body").append(this.props.children)),e},e.prototype._closeModal=function(t){var e=t.target.classList.contains("sc-modal");e&&this.send("closeModal")},e}(Ny),Zy={name:"modal",configure:function(t){t.addComponent("modal",Yy)}},tg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._onChange=function(){var t=this.context.documentSession,e=this.props.path,n=this.el.val();t.transaction(function(t){t.set(e,n)})},e.prototype.render=function(t){var e;if(this.props.path){var n=this.context.documentSession,o=n.getDocument();e=o.get(this.props.path)}else e=this.props.value;var r=t("input").attr({value:e,type:this.props.type,placeholder:this.props.placeholder}).addClass("sc-input");return this.props.path&&r.on("change",this._onChange),this.props.centered&&r.addClass("sm-centered"),r},e}(Ny),eg={name:"input",configure:function(t){t.addComponent("input",tg)}},ng={name:"button",configure:function(t){t.addComponent("button",Ty)}},og=i(function(t){function e(t,e){return t===e||n(t,e,o(e))}var n=r(rs),o=r(us);t.exports=e}),rg=r(og),ig=i(function(t){function e(t){return function(e,r,s){var a=Object(e);if(r=n(r,3),!o(e))var p=i(e);var c=t(p||e,function(t,e){return p&&(e=t,t=a[e]),r(t,e,a)},s);return c>-1?e[p?p[c]:c]:void 0}}var n=r(ga),o=r(sn),i=r(An);t.exports=e}),sg=r(ig),ag=Object.freeze({default:sg}),pg=i(function(t){var e=r(ag),n=r(Fl),o=e(n);t.exports=o}),cg=r(pg),ug=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTextTypes=function(t){var e=t.surface;return e&&e.isContainerEditor()?e.getTextTypes():[]},e.prototype.getTextType=function(t){var e=this.getTextTypes(t);return cg(e,function(e){return e.name===t.textType})},e.prototype.getCurrentTextType=function(t,e){var n,o=this.getTextTypes(t);return o.forEach(function(t){var o=Qc(t.data);delete o.type,rg(e,o)&&e.type===t.data.type&&(n=t)}),n},e.prototype.getCommandState=function(t){var e,n=t.documentSession.getDocument(),o=t.selection,r=t.surface,i={disabled:!1,textTypes:this.getTextTypes(t)};if(r&&r.isEnabled()&&!o.isNull())if(o.isContainerSelection())i.disabled=!0,i.currentTextType={name:"container-selection"};else if(o.isPropertySelection()){var s=o.getPath();e=n.get(s[0]),e&&(e.isText()&&e.isBlock()&&(i.currentTextType=this.getCurrentTextType(t,e)),i.currentTextType||(i.currentTextType={name:[e.type,s[1]].join(".")},i.disabled=!0))}else o.isNodeSelection()?(e=n.get(o.getNodeId()),i.currentTextType={name:e.type},i.disabled=!0):o.isCustomSelection()&&(i.currentTextType={name:"custom"},i.disabled=!0);else i.disabled=!0;return i},e.prototype.execute=function(t){var e=this.getTextType(t),n=e.data,o=t.surface;return o?(o.transaction(function(t,e){return e.data=n,o.switchType(t,e)}),n):void console.warn("No focused surface. Stopping command execution.")},e}(vd),hg={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32},fg=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this._navIdx=-1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];(o=t.prototype).didMount.apply(this,e),this._focusToggle();var o},e.prototype.render=function(t){var e=this.context.labelProvider,n="No selection";this.props.currentTextType&&(n=this.props.currentTextType.name);var o=t("div").addClass("sc-switch-text-type"),r=t("button").ref("toggle").addClass("se-toggle").attr("title",e.getLabel("switch_text")).append(e.getLabel(n)).on("click",this.toggleAvailableTextTypes);if(this.props.disabled||!this.props.currentTextType?(o.addClass("sm-disabled"),r.attr("tabindex",-1)):r.attr("tabindex",1),o.append(r),this.state.open){o.addClass("sm-open");var i=t("div").addClass("se-options").ref("options");Bh(this.props.textTypes,function(n){var o=t("button").addClass("se-option sm-"+n.name).attr("data-type",n.name).append(e.getLabel(n.name)).on("click",this.handleClick);i.append(o)}.bind(this)),o.append(i),o.on("keydown",this.onKeydown)}return o},e.prototype.didUpdate=function(){this._focusToggle()},e.prototype._focusToggle=function(){this.state.open&&this.refs.toggle.focus()},e.prototype.executeCommand=function(t){this.context.commandManager.executeCommand(this.getCommandName(),{textType:t})},e.prototype.getTextCommands=function(){var t=this.getSurface();return!this.textCommands&&t&&(this.textCommands=t.getTextCommands()),this.textCommands||{}},e.prototype.handleClick=function(t){t.preventDefault(),this.executeCommand(t.currentTarget.dataset.type)},e.prototype.onKeydown=function(t){var e=!1;switch(t.keyCode){case hg.UP:this._nav(-1),e=!0;break;case hg.DOWN:this._nav(1),e=!0;break;case hg.ESCAPE:this.toggleDropdown(),e=!0}e&&(t.preventDefault(),t.stopPropagation())},e.prototype.toggleAvailableTextTypes=function(t){t.preventDefault(),t.stopPropagation(),this.props.disabled||this.toggleDropdown()},e.prototype.toggleDropdown=function(){this._navIdx=-1,this.extendState({open:!this.state.open})},e.prototype._nav=function(t){if(this._navIdx+=t,this._navIdx=Math.max(0,this._navIdx),this._navIdx=Math.min(this._getOptionsCount()-1,this._navIdx),this._navIdx>=0){var e=this.refs.options.children[this._navIdx];e.focus()}},e.prototype._getOptionsCount=function(){return this.refs.options.children.length},e}(jy);fg.command="switch-text-type";var lg={name:"switch-text-type",configure:function(t){t.addCommand("switch-text-type",ug),t.addTool("switch-text-type",fg,{target:"text"})}},dg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass("sc-layout");return e.addClass("sm-width-"+this.props.width),this.props.textAlign&&e.addClass("sm-text-align-"+this.props.textAlign),this.props.noPadding&&e.addClass("sm-no-padding"),e.append(this.props.children),e},e}(Ny),yg={name:"layout",configure:function(t){t.addComponent("layout",dg)}},gg={name:"base",configure:function(t){t.import(lg),t.import(Uy),t.import(qy),t.import($y),t.import(Wy),t.import(Qy),t.import(Zy),t.import(eg),t.import(ng),t.import(yg),t.addComponent("tool-target-text",Dy),t.addComponent("tool-target-document",Dy),t.addCommand("undo",bd),t.addCommand("redo",wd),t.addTool("undo",jy,{target:"document"}),t.addTool("redo",jy,{target:"document"}),t.addIcon("undo",{fontawesome:"fa-undo"}),t.addIcon("redo",{fontawesome:"fa-repeat"}),t.addIcon("edit",{fontawesome:"fa-cog"}),t.addIcon("delete",{fontawesome:"fa-times"}),t.addIcon("expand",{fontawesome:"fa-arrows-h"}),t.addIcon("truncate",{fontawesome:"fa-arrows-h"}),t.addLabel("undo",{en:"Undo",de:"Rckgngig"}),t.addLabel("redo",{en:"Redo",de:"Wiederherstellen"}),t.addLabel("container-selection",{en:"Container",de:"Container"}),t.addLabel("container",{en:"Container",de:"Container"}),t.addLabel("insert-container",{en:"Insert Container",de:"Container einfgen"})}},mg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(cd);mg.type="blockquote";var vg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.getTagName(),n=t(e).attr("data-id",this.props.node.id).addClass(this.getClassNames());return n},e.prototype.getTagName=function(){return"div"},e.prototype.getClassNames=function(){return""},e}(Ny),_g=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){var t=this.props.node;t.on("highlighted",this.onHighlightedChanged,this)},e.prototype.dispose=function(){var t=this.props.node;t.off(this)},e.prototype.render=function(t){var e=t("span").attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&e.addClass("sm-highlighted"),e.append(this.props.children),e},e.prototype.getClassNames=function(){return"sc-"+this.props.node.type},e.prototype.onHighlightedChanged=function(){this.props.node.highlighted?this.el.addClass("sm-highlighted"):this.el.removeClass("sm-highlighted")},e}(Ny),bg=i(function(t){function e(t,e,n){return t===t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}t.exports=e}),wg=r(bg),Cg=Object.freeze({default:wg}),Sg=i(function(t){function e(t,e,r){return t=s(t),r=n(i(r),0,t.length),t.lastIndexOf(o(e),r)==r}var n=r(Cg),o=r(Os),i=r(tp),s=r(Is);t.exports=e}),xg=r(Sg),Og=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this.name=this.props.node.id,this._id=ee(this),this._state={selectionFragment:null},this.handleAction("escape",this._escape),this.ContentClass=this._getContentClass(this.props.node)||t}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isIsolatedNodeComponent:{},__elementTag:{},__slugChar:{}};return n._isIsolatedNodeComponent.get=function(){return!0},n.__elementTag.get=function(){return"div"},n.__slugChar.get=function(){return"|"},e.prototype.getChildContext=function(){return{surfaceParent:this}},e.prototype.getInitialState=function(){var t=this.context.documentSession.getSelectionState();return this._deriveStateFromSelectionState(t)},e.prototype.didMount=function(){t.prototype.didMount.call(this);var e=this.context.documentSession;e.on("update",this.onSessionUpdate,this)},e.prototype.dispose=function(){t.prototype.dispose.call(this);var e=this.context.documentSession;e.off(this)},e.prototype.getClassNames=function(){return"sc-isolated-node"},e.prototype.render=function(e){var n=this.props.node,o=this.ContentClass,r=t.prototype.render.apply(this,arguments);r.tagName=this.__elementTag,r.addClass(this.getClassNames()).addClass("sm-"+this.props.node.type).attr("data-id",n.id);var i=this.isDisabled();this.state.mode?r.addClass("sm-"+this.state.mode):r.addClass("sm-not-selected"),o.noStyle||r.addClass("sm-default-style"),r.on("keydown",this.onKeydown).on("mousedown",this._stopPropagation).on("keypress",this._stopPropagation).on("keyup",this._stopPropagation).on("compositionstart",this._stopPropagation).on("textInput",this._stopPropagation),r.append(e(this.__elementTag).addClass("se-slug").addClass("sm-before").ref("before").append(this.__slugChar));var s=this._getLevel(),a=e(this.__elementTag).addClass("se-container").attr("contenteditable",!1).css({"z-index":2*s});if(o.fullWidth&&a.addClass("sm-full-width"),"cursor"===this.state.mode&&"before"===this.state.position&&a.append(e(this.__elementTag).addClass("se-cursor").addClass("sm-before").attr("contenteditable",!1)),a.append(this.renderContent(e,n)),i){if(a.addClass("sm-disabled"),this.shouldRenderBlocker()){var p=e(this.__elementTag).addClass("se-blocker").css({"z-index":2*s+1});a.append(p)}this.shouldSelectOnClick()&&r.on("click",this.onClick)}return this.context.dragManager&&"focused"!==this.state.mode&&"co-focused"!==this.state.mode&&(r.attr("draggable",!0),r.on("dragstart",this.onDragStart).on("dragenter",this.onDragEnter).on("dragover",this.onDragOver).on("drop",this.onDrop)),"cursor"===this.state.mode&&"after"===this.state.position&&a.append(e(this.__elementTag).addClass("se-cursor").addClass("sm-after").attr("contenteditable",!1)),r.append(a),r.append(e(this.__elementTag).addClass("se-slug").addClass("sm-after").ref("after").append(this.__slugChar)),r},e.prototype.renderContent=function(t,e){var n=this.ContentClass;if(n){var o={node:e,disabled:this.isDisabled(),isolatedNodeState:this.state.mode};return"focused"===this.state.mode&&(o.focused=!0),t(n,o).ref("content")}return console.error("Could not resolve a component for type: "+e.type),t(this.__elementTag)},e.prototype.shouldRenderBlocker=function(){return!0},e.prototype.shouldSelectOnClick=function(){return"focused"!==this.state.mode&&"co-focused"!==this.state.mpde},e.prototype.getId=function(){return this._id},e.prototype.getMode=function(){return this.state.mode},e.prototype.isNotSelected=function(){return!this.state.mode},e.prototype.isSelected=function(){return"selected"===this.state.mode},e.prototype.isCoSelected=function(){return"co-selected"===this.state.mode},e.prototype.isFocused=function(){return"focused"===this.state.mode},e.prototype.isCoFocused=function(){return"co-focused"===this.state.mode},e.prototype._getContentClass=function(t){var e=this.context.componentRegistry,n=e.get(t.type);return n},e.prototype.isDisabled=function(){return!this.state.mode||["co-selected","cursor"].indexOf(this.state.mode)>-1},e.prototype._getSurfaceParent=function(){return this.context.surface},e.prototype._getLevel=function(){for(var t=1,e=this._getSurfaceParent();e;)t++,e=e._getSurfaceParent();return t},e.prototype.onSessionUpdate=function(t){if(t.selection){var e=this.context.documentSession,n=this._deriveStateFromSelectionState(e.getSelectionState());!n&&this.state.mode?this.extendState({mode:null}):n&&n.mode!==this.state.mode&&this.extendState(n)}},e.prototype._deriveStateFromSelectionState=function(t){var e=t.getSelection(),n=e.surfaceId;if(n){var o=this.getId(),r=this.props.node.id,i=this._getSurfaceParent().getId(),s=n===i;if(s){if(e.isNodeSelection()&&e.getNodeId()===r){if(e.isFull())return{mode:"selected"};if(e.isBefore())return{mode:"cursor",position:"before"};if(e.isAfter())return{mode:"cursor",position:"after"}}if(e.isContainerSelection()&&e.containsNodeFragment(r))return{mode:"co-selected"}}else{if(e.isCustomSelection()&&o===n)return{mode:"focused"};if(xg(n,o)){var a=o.split("/"),p=n.split("/"),c=a.length,u=p.length;return u>c&&a[c-1]===p[c-1]?u===c+1?{mode:"focused"}:{mode:"co-focused"}:null}}}},e.prototype.onMousedown=function(t){t.stopPropagation()},e.prototype.onClick=function(t){t.preventDefault(),this._selectNode()},e.prototype.onKeydown=function(t){t.stopPropagation(),t.keyCode===hg.ESCAPE&&"focused"===this.state.mode&&(t.preventDefault(),this._escape())},e.prototype.onDragStart=function(t){this.context.dragManager.onDragStart(t,this)},e.prototype.onDragEnter=function(t){t.preventDefault()},e.prototype.onDragOver=function(t){t.preventDefault()},e.prototype.onDrop=function(t){this.context.dragManager.onDrop(t,this)},e.prototype._escape=function(){this._selectNode()},e.prototype._stopPropagation=function(t){t.stopPropagation()},e.prototype._selectNode=function(){
var t=this.context.surface,e=t.getDocument(),n=this.props.node.id;t.setSelection(e.createSelection({type:"node",containerId:t.getContainerId(),nodeId:n,mode:"full"}))},Object.defineProperties(e.prototype,n),e}(Ny);Og.prototype._isDisabled=Og.prototype.isDisabled,Og.getCoordinate=function(t,e){var n=e.getParent();if(e.isTextNode()&&n.is(".se-slug")){var o=n,r=o.getParent(),i=r.getAttribute("data-id");if(i){var s=o.is("sm-after")?1:0;return new ph([i],s)}console.error("FIXME: expecting a data-id attribute on IsolatedNodeComponent")}return null},Og.getDOMCoordinate=function(t,e){var n;return n=0===e.offset?{container:t.refs.before.getNativeElement(),offset:0}:{container:t.refs.after.getNativeElement(),offset:1}},Og.getDOMCoordinates=function(t){return{start:{container:t.refs.before.getNativeElement(),offset:0},end:{container:t.refs.after.getNativeElement(),offset:1}}};var Eg=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isInlineNodeComponent:{},__elementTag:{},__slugChar:{}};return n._isInlineNodeComponent.get=function(){return!0},n.__elementTag.get=function(){return"span"},n.__slugChar.get=function(){return"\ufeff"},e.prototype.getClassNames=function(){return"sc-inline-node"},e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.attr("data-inline","1"),n},e.prototype._deriveStateFromSelectionState=function(t){var e=t.getSelection(),n=e.surfaceId;if(n){var o=this.getId(),r=this.props.node,i=this._getSurfaceParent().getId(),s=n===i;if(s){if(e.isPropertySelection()&&!e.isCollapsed()&&Op(e.path,r.path)){var a=r.getSelection();if(a.equals(e))return{mode:"selected"};if(e.contains(a))return{mode:"co-selected"}}}else if(xg(n,o)){var p=o.split("/"),c=n.split("/");return c.length>=p.length&&c.length<=p.length+1?{mode:"focused"}:{mode:"co-focused"}}}},e.prototype._selectNode=function(){var t=this.context.surface,e=t.getDocument(),n=this.props.node;t.setSelection(e.createSelection({type:"property",path:n.path,startOffset:n.startOffset,endOffset:n.endOffset}))},Object.defineProperties(e.prototype,n),e}(Og);Eg.getCoordinate=function(t){var e=t.getParent();if(t.isTextNode()&&e.is(".se-slug")){var n=e,o=n.getParent();if(o.is(".sc-inline-node")){var r=Number(o.getAttribute("data-offset")),i=Number(o.getAttribute("data-length")),s=r;n.is("sm-after")&&(s+=i);for(var a;o=o.getParent();){var p=o.getAttribute("data-path");if(p){a=p.split(".");var c=new ph(a,s);return c.__inInlineNode__=!0,c.__startOffset__=r,c.__endOffset__=r+i,c}}}}return null};var Ng=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this._renderContent(t).addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"});return e},e.prototype.getText=function(){return this.getDocument().get(this.props.path)||""},e.prototype.getAnnotations=function(){return this.getDocument().getIndex("annotations").get(this.props.path)},e.prototype._renderContent=function(t){var e=this.getText(),n=this.getAnnotations(),o=t(this.props.tagName||"span");if(n&&n.length>0){var r=new wl({onText:this._renderTextNode.bind(this),onEnter:this._renderFragment.bind(this,t),onExit:this._finishFragment.bind(this)});r.start(o,e,n)}else o.append(e);return o},e.prototype._renderTextNode=function(t,e){e&&e.length>0&&t.append(e)},e.prototype._renderFragment=function(t,e){var n=this.getDocument(),o=this.getComponentRegistry(),r=e.node;if("container-annotation-fragment"===r.type)return t(_g,{doc:n,node:r}).addClass("se-annotation-fragment").addClass(r.anno.getTypeNames().join(" ").replace(/_/g,"-"));if("container-annotation-anchor"===r.type)return t(_g,{doc:n,node:r}).addClass("se-anchor").addClass(r.anno.getTypeNames().join(" ").replace(/_/g,"-")).addClass(r.isStart?"start-anchor":"end-anchor");var i=o.get(r.type)||_g;!r.constructor.isInline||i.isCustom||i.prototype._isInlineNodeComponent||(i=Eg);var s=t(i,{doc:n,node:r});return s},e.prototype._finishFragment=function(t,e,n){n.append(e)},e.prototype.getDocument=function(){return this.props.doc||this.context.doc},e.prototype.getComponentRegistry=function(){return this.props.componentRegistry||this.context.componentRegistry},e}(Ny),Ig=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("span").addClass("se-cursor");if(e.append("\ufeff"),e.append(t("div").addClass("se-cursor-inner")),this.props.collaborator){var n=this.props.collaborator.colorIndex;e.addClass("sm-collaborator-"+n)}else e.addClass("sm-local-user");return e},e}(Ny),Pg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("span").addClass("se-selection-fragment");if(this.props.collaborator){var n=this.props.collaborator.colorIndex;e.addClass("sm-collaborator-"+n)}else e.addClass("sm-local-user");return e.append(this.props.children),e},e}(Ny),Tg=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isTextPropertyComponent:{}};return n._isTextPropertyComponent.get=function(){return!0},e.prototype.didMount=function(){t.prototype.didMount.call(this);var e=this.getSurface();e&&e._registerTextProperty(this)},e.prototype.dispose=function(){t.prototype.dispose.call(this);var e=this.getSurface();e&&e._unregisterTextProperty(this)},e.prototype.render=function(t){var e=this.getPath(),n=this._renderContent(t).addClass("sc-text-property").attr({"data-path":e.join("."),spellCheck:!1}).css({"white-space":"pre-wrap"});return this.context.dragManager&&n.on("dragenter",this.onDragEnter).on("dragover",this.onDragOver).on("drop",this.onDrop),this.props.withoutBreak||n.append(t("br")),n},e.prototype._renderFragment=function(e,n){var o,r=n.node,i=r.id;return"cursor"===r.type?o=e(Ig,{collaborator:r.collaborator}):"selection-fragment"===r.type?o=e(Pg,{collaborator:r.collaborator}):(o=t.prototype._renderFragment.apply(this,arguments),r.constructor.isInline?o.ref(i):this.context.config&&this.context.config.preservativeTextPropertyRendering&&o.ref(i+"@"+n.counter)),o.attr("data-offset",n.pos),o},e.prototype.onDragEnter=function(t){t.preventDefault()},e.prototype.onDragOver=function(t){t.preventDefault()},e.prototype.onDrop=function(t){this.context.dragManager.onDrop(t,this)},e.prototype.getPath=function(){return this.props.path},e.prototype.getText=function(){return this.getDocument().get(this.getPath())},e.prototype.getAnnotations=function(){var t=this.getPath(),e=this.getDocument().getIndex("annotations").get(t),n=this.props.fragments;return n&&(e=e.concat(n)),e},e.prototype.getDocument=function(){return this.props.doc||this.context.doc},e.prototype.getController=function(){return this.props.controller||this.context.controller},e.prototype.getSurface=function(){return this.props.surface||this.context.surface},e.prototype.isEditable=function(){return this.getSurface().isEditable()},e.prototype.isReadonly=function(){return this.getSurface().isReadonly()},e.prototype.getDOMCoordinate=function(t){return this._getDOMCoordinate(this.el,t)},e.prototype._finishFragment=function(t,e,n){e.attr("data-length",t.length),n.append(e)},e.prototype._getDOMCoordinate=function(t,e){var n,o=this,r=0;if(0===e)return{container:t.getNativeElement(),offset:0};for(var i=t.getFirstChild();i;i=i.getNextSibling(),r++)if(i.isTextNode()){if(n=i.textContent.length,n>=e)return{container:i.getNativeElement(),offset:e};e-=n}else if(i.isElementNode()){var s=i.getAttribute("data-length");if(!s)return console.error("FIXME: Can not map to DOM coordinates."),null;if(n=parseInt(s,10),n>=e){if(i.attr("data-inline")){var a=i.getNextSibling();return a&&a.isTextNode()?{container:a.getNativeElement(),offset:0}:{container:t.getNativeElement(),offset:t.getChildIndex(i)+1}}return o._getDOMCoordinate(i,e,r)}e-=n}},Object.defineProperties(e.prototype,n),e}(Ng);Tg.getCoordinate=function(t,e,n){var o=ne(t,e,n);if(!o)return null;e=o.node,n=o.offset;var r=oe(o.node,o.offset);return eu(r)?new ph(o.path,r):null};var jg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.append(e(Tg,{path:[this.props.node.id,"content"]})),n},e}(vg),Dg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.addClass("sc-blockquote")},e}(jg),Ag={type:"blockquote",tagName:"blockquote",import:function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])},export:function(t,e,n){e.append(n.annotatedText([t.id,"content"]))}},Mg={name:"blockquote",configure:function(t){t.addNode(mg),t.addComponent(mg.type,Dg),t.addConverter("html",Ag),t.addConverter("xml",Ag),t.addTextType({name:"blockquote",data:{type:"blockquote"}}),t.addLabel("blockquote",{en:"Blockquote",de:"Blockzitat"})},Blockquote:mg,BlockquoteComponent:Dg,BlockquoteHTMLConverter:Ag},kg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(al);kg.type="code";var Lg={type:"code",tagName:"code"},Rg=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(t.apply(this,e),!this.config.nodeType)throw new Error("'nodeType' is required")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getAnnotationType=function(){return this.config.nodeType},e.prototype.getAnnotationData=function(){return{}},e.prototype.isDisabled=function(t){return!(t&&!t.isNull()&&t.isAttached()&&!t.isCustomSelection()&&!t.isNodeSelection()&&!t.isContainerSelection())},e.prototype.canCreate=function(t,e){return 0===t.length&&!e.isCollapsed()},e.prototype.canFuse=function(t,e){return t.length>=2&&!e.isCollapsed()},e.prototype.canDelete=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return e.isInsideOf(n)},e.prototype.canExpand=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return e.overlaps(n)&&!e.isInsideOf(n)},e.prototype.canTruncate=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return(e.isLeftAlignedWith(n)||e.isRightAlignedWith(n))&&!e.contains(n)&&!e.isCollapsed()},e.prototype.getCommandState=function(t){var e=this._getSelection(t);if(this.isDisabled(e))return{disabled:!0};var n=this._getAnnotationsForSelection(t),o={disabled:!1,active:!1,mode:null};return this.canCreate(n,e)?o.mode="create":this.canFuse(n,e)?o.mode="fuse":this.canTruncate(n,e)?(o.active=!0,o.mode="truncate"):this.canExpand(n,e)?o.mode="expand":this.canDelete(n,e)?(o.active=!0,o.mode="delete"):o.disabled=!0,o},e.prototype.execute=function(t){var e=t.commandState;if(e.disabled)return!1;switch(e.mode){case"create":return this.executeCreate(t);case"fuse":return this.executeFuse(t);case"truncate":return this.executeTruncate(t);case"expand":return this.executeExpand(t);case"delete":return this.executeDelete(t);default:return console.warn("Command.execute(): unknown mode",e.mode),!1}},e.prototype.executeCreate=function(t){var e=this._getAnnotationsForSelection(t);this._checkPrecondition(t,e,this.canCreate);var n=this._applyTransform(t,function(e){var n=this.getAnnotationData();return n.type=this.getAnnotationType(),dt(e,{node:n,selection:t.selection})}.bind(this));return{mode:"create",anno:n}},e.prototype.executeFuse=function(t){var e=this._getAnnotationsForSelection(t);this._checkPrecondition(t,e,this.canFuse);var n=this._applyTransform(t,function(t){var n=_t(t,{annos:e});return{result:n.node}});return{mode:"fuse",anno:n}},e.prototype.executeTruncate=function(t){var e=this._getAnnotationsForSelection(t),n=e[0];return this._checkPrecondition(t,e,this.canTruncate),this._applyTransform(t,function(e){return Pt(e,{selection:t.selection,anno:n})}),{mode:"truncate",anno:n}},e.prototype.executeExpand=function(t){var e=this._getAnnotationsForSelection(t),n=e[0];return this._checkPrecondition(t,e,this.canExpand),this._applyTransform(t,function(e){vt(e,{selection:t.selection,anno:n})}),{mode:"expand",anno:n}},e.prototype.executeDelete=function(t){var e=this._getAnnotationsForSelection(t),n=e[0];return this._checkPrecondition(t,e,this.canDelete),this._applyTransform(t,function(t){return t.delete(n.id)}),{mode:"delete",annoId:n.id}},e.prototype._checkPrecondition=function(t,e,n){var o=this._getSelection(t);if(!n.call(this,e,o))throw new Error("AnnotationCommand: can't execute command for selection "+o.toString())},e.prototype._getAnnotationsForSelection=function(t){return t.selectionState.getAnnotationsForType(this.getAnnotationType())},e.prototype._applyTransform=function(t,e){var n=this._getSelection(t),o=this._getDocumentSession(t),r=t.surface;t.selection=n;var i;if(!n.isNull())return o.transaction(function(o){o.before.selection=n,r&&(o.before.surfaceId=r.getId());var s=e(o,t);return s&&(i=s.result),s}),i},e}(vd),zg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.addClass("sm-annotation-tool"),n},e.prototype.renderButton=function(e){var n=t.prototype.renderButton.call(this,e);return n.append(this.renderMode(e)),n},e.prototype.renderMode=function(t){var e=this.props.mode,n=t("div").addClass("se-mode"),o=this.context.iconProvider.renderIcon(t,e);return o&&n.append(o),n},e}(jy),Fg={name:"code",configure:function(t){t.addNode(kg),t.addConverter("html",Lg),t.addConverter("xml",Lg),t.addComponent("code",_g),t.addCommand("code",Rg,{nodeType:kg.type}),t.addTool("code",zg,{target:"annotations"}),t.addIcon("code",{fontawesome:"fa-code"}),t.addLabel("code",{en:"Code",de:"Code"})},Code:kg,CodeHTMLConverter:Lg},Bg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(al);Bg.type="emphasis",Bg.fragmentation=wl.ANY;var Hg={type:"emphasis",tagName:"em",matchElement:function(t){return t.is("em, i")}},Ug={name:"emphasis",configure:function(t,e){t.addNode(Bg),t.addConverter("html",Hg),t.addConverter("xml",Hg),t.addComponent("emphasis",_g),t.addCommand("emphasis",Rg,{nodeType:Bg.type}),t.addTool("emphasis",zg,{target:e.toolTarget||"annotations"}),t.addIcon("emphasis",{fontawesome:"fa-italic"}),t.addLabel("emphasis",{en:"Emphasis",de:"Betonung"})},Emphasis:Bg,EmphasisHTMLConverter:Hg},Vg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(sl);Vg.define({type:"image",src:{type:"string",default:"http://"},previewSrc:{type:"string",optional:!0}});var qg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){t.prototype.didMount.call(this);var e=this.props.node;e.on("src:changed",this.rerender,this),e.on("upload:started",this.onUploadStarted,this),e.on("upload:progress",this.onUploadProgress,this),e.on("upload:finished",this.onUploadFinished,this)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.props.node.off(this)},e.prototype.render=function(e){var n=t.prototype.render.call(this,e);if(n.addClass("sc-image"),n.append(e("img").attr({src:this.props.node.src}).ref("image")),this.state.uploading){var o=e("div").addClass("se-progress-bar").ref("progressBar").append("Uploading: "+ie(this.state.progress));n.append(o)}return n},e.prototype.onUploadStarted=function(){this.setState({uploading:!0,progress:0})},e.prototype.onUploadProgress=function(t){this.setState({uploading:!0,progress:t})},e.prototype.onUploadFinished=function(){this.setState({})},e}(vg),Jg={type:"image",tagName:"img",import:function(t,e){e.src=t.attr("src"),e.previewSrc=t.attr("data-preview-src")},export:function(t,e){e.attr("src",t.src),t.previewSrc&&e.attr("data-preview-src",t.previewSrc)}},$g={type:"image",tagName:"image",import:function(t,e){e.src=t.attr("src"),e.previewSrc=t.attr("preview-src")},export:function(t,e){e.attr("src",t.src),t.previewSrc&&e.attr("preview-src",t.previewSrc)}},Wg=function(t){function e(){t.call(this,{name:"insert-image"})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.selection,n=t.surface,o={disabled:!0,active:!1};return e&&!e.isNull()&&!e.isCustomSelection()&&n&&n.isContainerEditor()&&(o.disabled=!1),o},e.prototype.execute=function(t,e){var n=this.getCommandState(t);if(!n.disabled){var o=t.documentSession,r=t.selection,i=t.surface,s=e.fileClient,a=t.files;if(i.isContainerEditor()){var p=i.getDocument(),c=p.createSnippet(),u=a.map(function(t){var e=c.create({type:"image"});return c.show(e),{file:t,nodeId:e.id}});return i.transaction(function(t){return t.before.selection=r,md(t,{selection:r,containerId:i.getContainerId(),doc:c})}),u.forEach(function(t){var e=t.nodeId,n=t.file,r=p.get(e);r.emit("upload:started");var i=s.uploadFile(n,function(t,n){t&&(n="error");var r=p.get(e);r&&(r.emit("upload:finished"),o.transaction(function(t){t.set([e,"src"],n)}))});i.on("progress",function(t){r.emit("upload:progress",t)})}),{status:"file-upload-process-started"}}}},e}(vd),Kg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getClassNames=function(){return"sc-insert-image-tool"},e.prototype.renderButton=function(e){var n=t.prototype.renderButton.call(this,e),o=e("input").attr("type","file").ref("input").on("change",this.onFileSelect);return[n,o]},e.prototype.onClick=function(){this.refs.input.click()},e.prototype.onFileSelect=function(t){var e=t.currentTarget.files;this.executeCommand({files:Array.prototype.slice.call(e)})},e}(jy),Xg=function(){},Gg={_isDragAndDropHandler:{}};Gg._isDragAndDropHandler.get=function(){return!0},Xg.prototype.dragStart=function(t,e){},Xg.prototype.drop=function(t,e){},Xg.prototype.dragEnd=function(t,e){},Object.defineProperties(Xg.prototype,Gg);var Qg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drop=function(t,e){var n=t.target,o=n.surface,r=n.selection,i=t.data.files;if(o&&r&&i&&0!==i.length&&(i=i.filter(function(t){return xg(t.type,"image")}),0!==i.length))return e.commandManager.executeCommand(Wg.type,{surface:o,selection:r,files:i}),!0},e}(Xg),Yg={name:"image",configure:function(t){t.addNode(Vg),t.addComponent("image",qg),t.addConverter("html",Jg),t.addConverter("xml",$g),t.addCommand("insert-image",Wg),t.addTool("insert-image",Kg),t.addIcon("insert-image",{fontawesome:"fa-image"}),t.addLabel("image",{en:"Image",de:"Bild"}),t.addLabel("insert-image",{en:"Insert image",de:"Bild einfgen"}),t.addDragAndDrop(Qg)},ImageNode:Vg,ImageComponent:qg,ImageHTMLConverter:Jg,InsertImageCommand:Wg,InsertImageTool:Kg,DropImage:Qg},Zg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getWrappedNode=function(){return this.getDocument().get(this.wrappedNode)},e}(ad);Zg.define({type:"inline-wrapper",wrappedNode:"id"});var tm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getClassNames=function(){return"sc-inline-wrapper sc-inline-node"},e.prototype.renderContent=function(t){var e,n=this.props.node,o=n.getDocument(),r=o.get(n.wrappedNode);if(r){var i=this.context.componentRegistry,s=i.get(r.type);s?e=t(s,{disabled:this.isDisabled(),node:r}).ref("wrappedNode"):console.error("No component registered for node type"+r.type)}else console.error("Could not find wrapped node: "+n.wrappedNode);return e},e}(Eg),em={type:"inline-wrapper",matchElement:function(t,e){var n=e._getConverterForElement(t,"block");return Boolean(n)},import:function(t,e,n){e.id=n.nextId("inline-wrapper");var o=n.state;o.popElementContext(),o.pushElementContext(o.getCurrentElementContext().tagName),e.wrappedNode=n.convertElement(t).id},export:function(t,e,n){return n.convertNode(t.wrappedNode)}},nm={name:"inline-wrapper",configure:function(t,e){t.addNode(Zg),t.addComponent(Zg.type,tm),e.converters&&e.converters.forEach(function(e){t.addConverter(e,em)})},InlineWrapper:Zg,InlineWrapperComponent:tm,InlineWrapperConverter:em},om=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(cd);om.type="paragraph";var rm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.addClass("sc-paragraph")},e}(jg),im={type:"paragraph",tagName:"p",import:function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])},export:function(t,e,n){e.append(n.annotatedText([t.id,"content"]))}},sm={name:"paragraph",configure:function(t){t.addNode(om),t.addComponent(om.type,rm),t.addConverter("html",im),t.addConverter("xml",im),t.addTextType({name:"paragraph",data:{type:"paragraph"}}),t.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"}),t.addLabel("paragraph.content",{en:"Paragraph",de:"Paragraph"})},Paragraph:om,ParagraphComponent:rm,ParagraphHTMLConverter:im},am=function(t){function e(){t.call(this,{name:"save"})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.documentSession.isDirty();return{disabled:!e,active:!1}},e.prototype.execute=function(t){var e=t.documentSession;return e.save(),{status:"saving-process-started"}},e}(vd),pm={name:"persistence",configure:function(t){t.addCommand("save",am),t.addTool("save",jy,{target:"document"}),t.addIcon("save",{fontawesome:"fa-save"}),t.addLabel("save",{en:"Save",de:"Speichern"})},SaveCommand:am},cm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(al);cm.type="strong",cm.fragmentation=wl.ANY;var um={type:"strong",tagName:"strong",matchElement:function(t){return t.is("strong, b")}},hm={name:"strong",configure:function(t,e){e=e||{},t.addNode(cm),t.addConverter("html",um),t.addConverter("xml",um),t.addComponent("strong",_g),t.addCommand("strong",Rg,{nodeType:"strong"}),t.addTool("strong",zg,{target:e.toolTarget||"annotations"}),t.addIcon("strong",{fontawesome:"fa-bold"}),t.addLabel("strong",{en:"Strong emphasis",de:"Starke Betonung"})},Strong:cm,StrongHTMLConverter:um},fm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(al);fm.type="subscript",fm.fragmentation=wl.ANY;var lm={type:"subscript",tagName:"sub"},dm={name:"subscript",configure:function(t){t.addNode(fm),t.addConverter("html",lm),t.addConverter("xml",lm),t.addComponent("subscript",_g),t.addCommand("subscript",Rg,{nodeType:"subscript"}),t.addTool("subscript",zg,{target:"annotations"}),t.addIcon("subscript",{fontawesome:"fa-subscript"}),t.addLabel("subscript",{en:"Subscript",de:"Tiefgestellt"})},Subscript:fm,SubscriptHTMLConverter:lm},ym=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(al);ym.type="superscript",ym.fragmentation=wl.ANY;var gm={type:"superscript",tagName:"sup"},mm={name:"superscript",configure:function(t){t.addNode(ym),t.addConverter("html",gm),t.addConverter("xml",gm),t.addComponent("superscript",_g),t.addCommand("superscript",Rg,{nodeType:"superscript"}),t.addTool("superscript",zg,{target:"annotations"}),t.addIcon("superscript",{fontawesome:"fa-superscript"}),t.addLabel("superscript",{en:"Superscript",de:"Hochgestellt"})},Superscript:ym,SuperscriptHTMLConverter:gm},vm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(cd);vm.define({type:"heading",level:{type:"number",default:1}});var _m=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.addClass("sc-heading sm-level-"+this.props.node.level)},e}(jg),bm={type:"heading",matchElement:function(t){return/^h\d$/.exec(t.tagName)},import:function(t,e,n){e.level=Number(t.tagName[1]),e.content=n.annotatedText(t,[e.id,"content"])},export:function(t,e,n){e.tagName="h"+t.level,e.append(n.annotatedText([t.id,"content"]))}},wm={name:"heading",configure:function(t){t.addNode(vm),t.addComponent(vm.type,_m),t.addConverter("html",bm),t.addConverter("xml",bm),t.addTextType({name:"heading1",data:{type:"heading",level:1}}),t.addTextType({name:"heading2",data:{type:"heading",level:2}}),t.addTextType({name:"heading3",data:{type:"heading",level:3}}),t.addLabel("heading1",{en:"Heading 1",de:"berschrift 1"}),t.addLabel("heading2",{en:"Heading 2",de:"berschrift 2"}),t.addLabel("heading3",{en:"Heading 3",de:"berschrift 3"})},Heading:vm,HeadingComponent:_m,HeadingHTMLConverter:bm},Cm={appliesTo:["paragraph"],execute:function(t,e){if(this.appliesTo.indexOf(t.node.type)===-1)return!1;var n=/^#\s/.exec(t.text);if(n){var o=e.surfaceManager.getSurface(t.selection.surfaceId);return o.transaction(function(e,o){var r=e.createSelection(t.path,0,n[0].length);nt(e,{selection:r});var i=It(e,{selection:t.selection,containerId:o.containerId,data:{type:"heading",level:1}});if("type"===t.action)return{selection:e.createSelection(i.node.getTextPath(),0)}}),!0}}},Sm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(cd);Sm.type="codeblock";var xm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.call(this,e);return n.addClass("sc-codeblock")},e}(jg),Om={type:"codeblock",tagName:"pre",import:function(t,e,n){var o=t.find("code");o&&(e.content=n.annotatedText(o,[e.id,"content"],{preserveWhitespace:!0}))},export:function(t,e,n){var o=n.$$;e.append(o("code").append(n.annotatedText([t.id,"content"])))}},Em={name:"codeblock",configure:function(t){t.addNode(Sm),t.addComponent("codeblock",xm),t.addConverter("html",Om),t.addConverter("xml",Om),t.addTextType({name:"codeblock",data:{type:"codeblock"}}),t.addLabel("codeblock",{en:"Codeblock",de:"Codeblock"})},Codeblock:Sm,CodeblockComponent:xm,CodeblockHTMLConverter:Om},Nm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(al);Nm.define({type:"link",title:{type:"string",optional:!0},url:{type:"string",default:""}}),Nm.fragmentation=wl.SHOULD_NOT_SPLIT;var Im=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];(r=t.prototype).didMount.apply(this,e);var o=this.props.node;o.on("properties:changed",this.rerender,this);var r},e.prototype.dispose=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];(r=t.prototype).dispose.apply(this,e);var o=this.props.node;o.off(this);var r},e.prototype.render=function(e){var n=t.prototype.render.call(this,e);n.tagName="a",n.attr("href",this.props.node.url);var o=[this.props.node.url];return this.props.node.title&&o.push(this.props.node.title),n.attr("title",o.join(" | "))},e}(_g),Pm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canFuse=function(){return!1},e.prototype.canDelete=function(){return!1},e}(Rg),Tm={type:"link",tagName:"a",import:function(t,e){e.url=t.attr("href"),e.title=t.attr("title")},export:function(t,e){e.attr({href:t.url,title:t.title})}},jm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getUrlPath=function(){var t=this.constructor.urlPropertyPath;return[this.props.node.id].concat(t)},e.prototype._openLink=function(){var t=this.context.documentSession.getDocument();window.open(t.get(this.getUrlPath()),"_blank")},e.prototype.render=function(t){var e=this.getComponent("input"),n=this.getComponent("button"),o=t("div").addClass("sc-edit-link-tool"),r=this.getUrlPath();return o.append(t(e,{type:"url",path:r,placeholder:"Paste or type a link url"}),t(n,{icon:"open-link",style:this.props.style}).attr("title",this.getLabel("open-link")).on("click",this._openLink),t(n,{icon:"delete",style:this.props.style}).attr("title",this.getLabel("delete-link")).on("click",this.onDelete)),o},e.prototype.onDelete=function(t){t.preventDefault();var e=this.props.node,n=this.context.surfaceManager,o=n.getFocusedSurface();o.transaction(function(t,n){return t.delete(e.id),n})},e}(jy);jm.urlPropertyPath=["url"];var Dm=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(t.apply(this,e),!this.config.nodeType)throw new Error("'nodeType' is required")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=this._getSelection(t),n=this._getAnnotationsForSelection(t),o={disabled:!0};return 1===n.length&&e.isPropertySelection()&&(o.disabled=!1,o.node=n[0]),o},e.prototype.execute=function(t){},e.prototype._getAnnotationsForSelection=function(t){return t.selectionState.getAnnotationsForType(this.config.nodeType)},e}(vd),Am={name:"link",configure:function(t,e){t.addNode(Nm),t.addComponent("link",Im),t.addConverter("html",Tm),t.addConverter("xml",Tm),t.addCommand("link",Pm,{nodeType:"link"}),t.addCommand("edit-link",Dm,{nodeType:"link"}),t.addTool("link",zg,{target:e.toolTarget||"annotations"}),t.addTool("edit-link",jm,{target:"overlay"}),t.addIcon("link",{fontawesome:"fa-link"}),t.addIcon("open-link",{fontawesome:"fa-external-link"}),t.addLabel("link",{en:"Link",de:"Link"}),t.addLabel("open-link",{en:"Open Link",de:"Link ffnen"}),t.addLabel("delete-link",{en:"Remove Link",de:"Link lschen"})},Link:Nm,LinkComponent:Im,LinkCommand:Pm,EditLinkTool:jm},Mm=function(t){function e(e){t.call(this,e),this._initialize()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._initialize=function(){this.create({type:"container",id:"body",nodes:[]})},e}(df),km={name:"prose-editor",configure:function(t){t.defineSchema({name:"prose-article",ArticleClass:Mm,defaultTextType:"paragraph"}),t.import(gg),t.import(sm),t.import(wm),t.import(Em),t.import(Mg),t.import(Ug),t.import(hm),t.import(dm),t.import(mm),t.import(Fg),t.import(Am)}},Lm=function(t,e){if(!t.documentSession)throw new Error("DocumentSession required.");this.documentSession=t.documentSession,this.context=Sp({},t,{doc:this.documentSession.getDocument()}),this.commandRegistry=new gl,va(e,function(t){if(!t._isCommand)throw new Error("Expecting instances of ui/Command.");this.commandRegistry.add(t.name,t)}.bind(this)),this.documentSession.on("update",this.updateCommandStates,this,{priority:-10}),this.updateCommandStates()};Lm.prototype.dispose=function(){this.documentSession.off(this);
},Lm.prototype.updateCommandStates=function(){var t={},e=this.getCommandContext(),n=this._getCommandParams();this.commandRegistry.forEach(function(o){t[o.getName()]=o.getCommandState(n,e)}),Op(this.commandStates,t)||(this.commandStates=t)},Lm.prototype.executeCommand=function(t,e){var n=this.commandRegistry.get(t);if(!n)return void console.warn("command",t,"not registered");var o=this.commandStates[t],r=Sp(this._getCommandParams(),e,{commandState:o}),i=n.execute(r,this.getCommandContext());return void 0===i&&console.warn("command ",t,"must return either an info object or true when handled or false when not handled"),i},Lm.prototype.getCommandStates=function(){return this.commandStates},Lm.prototype.getCommandContext=function(){return this.context},Lm.prototype._getCommandParams=function(){var t=this.context.documentSession,e=t.getSelectionState(),n=e.getSelection(),o=this.context.surfaceManager.getFocusedSurface();return{documentSession:t,selectionState:e,surface:o,selection:n}};var Rm=function(t,e){this.context=t,this.macros=e,this.context.documentSession.on("update",this.onUpdate,this)};Rm.prototype.onUpdate=function(t,e){t.change&&this.executeMacros(t,e)},Rm.prototype.executeMacros=function(t,e){var n=this,o=t.change;if(o){var r,i,s,a,p=this.context.documentSession.getDocument();if("type"===e.action){var c=o.ops[0];a=c.path,r=a[0],i=p.get(r),s=p.get(a);for(var u={action:e.action,node:i,path:a,text:s,selection:this.context.documentSession.getSelection()},h=0;h<this.macros.length;h++){var f=n.macros[h],l=f.execute(u,n.context);if(l)break}}}};var zm=["keydown","keyup","keypress","mousedown","mouseup","copy"],Fm=function(t,e){this.documentSession=t,this.surfaceManager=e,this.listeners=[],this.initialize()};Fm.prototype.initialize=function(){if(Al){var t=nd.wrapNativeElement(window.document);zm.forEach(function(e){t.on(e,this._dispatch.bind(this,e),this)}.bind(this))}},Fm.prototype.dispose=function(){if(Al){var t=nd.wrapNativeElement(window.document);t.off(this)}},Fm.prototype.addEventListener=function(t,e,n){if(!n.id)throw new Error("GlobalEventHandler can only be used with option 'id'");var o=new Hl.EventListener(t,e,n);this.listeners.push(o)},Fm.prototype.removeEventListener=function(t){var e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)},Fm.prototype.getEventListeners=function(){return this.listeners},Fm.prototype._getActiveListener=function(t){var e=this,n=this.documentSession,o=n.getSelection();if(o)for(var r=o.surfaceId,i=0;i<this.listeners.length;i++){var s=e.listeners[i];if(s.eventName===t&&s.options.id===r)return s}},Fm.prototype._dispatch=function(t,e){var n=this._getActiveListener(t);n&&n.handler(e)},Fm.prototype.on=Hl.prototype.on,Fm.prototype.off=Hl.prototype.off;var Bm=function(t){this.documentSession=t,this.surfaces={},this._state={focusedSurfaceId:null,fragments:{},selection:null,collaborators:{}},this.documentSession.on("update",this.onSessionUpdate,this),this.documentSession.on("didUpdate",this.onSessionDidUpdate,this,{priority:-1e6})};Bm.prototype.dispose=function(){this.documentSession.off(this)},Bm.prototype.getSurface=function(t){if(t)return this.surfaces[t]},Bm.prototype.getFocusedSurface=function(){if(this._state.focusedSurfaceId)return this.getSurface(this._state.focusedSurfaceId)},Bm.prototype.registerSurface=function(t){this.surfaces[t.getId()]=t},Bm.prototype.unregisterSurface=function(t){t.off(this);var e=t.getId(),n=this.surfaces[e];if(n===t){var o=this.getFocusedSurface();delete this.surfaces[e],t&&o===t&&(this._state.focusedSurfaceId=null)}},Bm.prototype.onSessionUpdate=function(t){function e(t){var e=a[t];return e||(e={},a[t]=e),e}function n(t,e){var n=t.getFragments();return e&&(n=n.map(function(t){return t.collaborator=e,t})),n}function o(t,o,r){var s=t?t.surfaceId:null,a=o?o.surfaceId:null,p="local-user";r&&(p=r.collaboratorId),s&&s!==a&&(e(s)[p]=[],i[s]=!0),a&&(e(a)[p]=n(o,r),i[a]=!0)}var r=this._state,i={};if(t.selection){var s=this.surfaces[t.selection.surfaceId];r.focusedSurfaceId=t.selection.surfaceId,s&&!s.isDisabled()?s._focus():t.selection.isCustomSelection()&&Al&&(window.getSelection().removeAllRanges(),window.document.activeElement.blur())}t.change&&va(this.surfaces,function(e,n){e._checkForUpdates(t.change)&&(i[n]=!0)});var a=r.fragments||{};t.selection&&(o(r.selection,t.selection),r.selection=t.selection),t.collaborators&&va(t.collaborators,function(t,e){var n,i,s=r.collaborators[e];s&&(n=s.selection),t&&(i=t.selection),n&&n.equals(i)||o(n,i,t),r.collaborators[e]={collaboratorId:e,selection:i}}),i=Object.keys(i),i.forEach(function(t){var e=this.surfaces[t];if(e){var n=a[t];e.extendProps({fragments:Qc(n)})}}.bind(this))},Bm.prototype.onSessionDidUpdate=function(t,e){if(!e.skipSelection){var n=this.getFocusedSurface();n&&!n.isDisabled()&&(n.focus(),n.rerenderDOMSelection(),n._sendOverlayHints())}};var Hm=function(t,e){this.context=e,this.dndHandlers=t,this._source=null};Hm.prototype.dispose=function(){var t=nd.wrapNativeElement(window.document);t.off(this)},Hm.prototype.onDragStart=function(t,e){var n=this;t.dataTransfer.effectAllowed="all",t.dataTransfer.setData("text/html",t.target.outerHTML),t.stopPropagation(),this._source={component:e};for(var o=0;o<this.dndHandlers.length;o++){var r=n.dndHandlers[o];r.dragStart(n._source,n.context)}},Hm.prototype.onDragEnter=function(t,e){t.stopPropagation()},Hm.prototype.onDragOver=function(t,e){t.preventDefault(),t.stopPropagation()},Hm.prototype.onDrop=function(t,e){var n=this;t.preventDefault(),t.stopPropagation();var o,r,i={source:this._source,target:ae(t,e),data:se(t)};for(o=0;o<this.dndHandlers.length;o++){r=n.dndHandlers[o];var s=r.drop(i,n.context);if(s)break}for(o=0;o<this.dndHandlers.length;o++)r=n.dndHandlers[o],r.dragEnd(i,n.context)},Hm.prototype._getData=function(t){var e=t.dataTransfer;if(e)return{types:e.types,items:Array.prototype.slice.call(e.items),files:Array.prototype.slice.call(e.files)}};var Um=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this._initialize(this.props)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];(o=t.prototype).render.apply(this,e);var o},e.prototype.didMount=function(){this.documentSession.on("didUpdate",this.documentSessionUpdated,this)},e.prototype.willReceiveProps=function(t){var e=t.documentSession,n=e&&e!==this.documentSession;n&&(this._dispose(),this._initialize(t))},e.prototype.dispose=function(){this._dispose()},e.prototype._dispose=function(){this.surfaceManager.dispose(),this.commandManager.dispose(),this.globalEventHandler.dispose(),this.dragManager.dispose(),this.documentSession.off(this),this.empty()},e.prototype.getChildContext=function(){return{controller:this,iconProvider:this.iconProvider,documentSession:this.documentSession,doc:this.doc,componentRegistry:this.componentRegistry,surfaceManager:this.surfaceManager,commandManager:this.commandManager,tools:this.tools,labelProvider:this.labelProvider,converterRegistry:this.converterRegistry,globalEventHandler:this.globalEventHandler,editingBehavior:this.editingBehavior,dragManager:this.dragManager}},e.prototype._initialize=function(t){var e=t.configurator,n=e.getCommands();if(!t.documentSession)throw new Error("DocumentSession instance required");this.documentSession=t.documentSession,this.doc=this.documentSession.getDocument(),this.componentRegistry=e.getComponentRegistry(),this.tools=e.getTools(),this.surfaceManager=new Bm(this.documentSession),this.commandManager=new Lm(this.getCommandContext(),n),this.dragManager=new Hm(e.createDragHandlers(),{documentSession:this.documentSession,surfaceManager:this.surfaceManager,commandManager:this.commandManager}),this.macroManager=new Rm(this.getMacroContext(),e.getMacros()),this.iconProvider=e.getIconProvider(),this.converterRegistry=e.getConverterRegistry(),this.globalEventHandler=new Fm(this.documentSession,this.surfaceManager),this.editingBehavior=e.getEditingBehavior(),this.labelProvider=e.getLabelProvider()},e.prototype.getCommandContext=function(){return{documentSession:this.documentSession,surfaceManager:this.surfaceManager}},e.prototype.getMacroContext=function(){return{documentSession:this.documentSession,surfaceManager:this.surfaceManager}},e.prototype.documentSessionUpdated=function(){throw new Error("This method is abstract")},e}(Ny),Vm=function(){this._merge={},this._mergeComponents={},this._break={}};Vm.prototype.defineMerge=function(t,e,n){return this._merge[t]||(this._merge[t]={}),this._merge[t][e]=n,this},Vm.prototype.canMerge=function(t,e){return this._merge[t]&&this._merge[t][e]},Vm.prototype.getMerger=function(t,e){return this._merge[t][e]},Vm.prototype.defineComponentMerge=function(t,e){this._mergeComponents[t]=e},Vm.prototype.canMergeComponents=function(t){return this._mergeComponents[t]},Vm.prototype.getComponentMerger=function(t){return this._mergeComponents[t]},Vm.prototype.defineBreak=function(t,e){return this._break[t]=e,this},Vm.prototype.canBreak=function(t){return this._break[t]},Vm.prototype.getBreaker=function(t){return this._break[t]};var qm=i(function(t){function e(t){return void 0===t}t.exports=e}),Jm=r(qm),$m=function(t){function e(n){if(e._addConverters(n),!n.schema)throw new Error("Missing argument: config.schema is required.");t.call(this,n),this.IGNORE_DEFAULT_WARNINGS=!0,Sp(n,{trimWhitespaces:!0,REMOVE_INNER_WS:!0}),this._isWindows=Ay.isWindows,this._emptyDoc=this._createDocument(this.schema)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.importDocument=function(t){var e,n;if(this._isWindows){var o=/<!--StartFragment\-->(.*)<!--EndFragment-->/.exec(t);o&&(t=o[1])}if(t.search(/meta name=.substance./)>=0){n=nd.parseHTML(t);var r=n.find('meta[name="substance"]');if(r){var i=atob(r.attr("content"));i=decodeURIComponent(i);try{return this.importFromJSON(i)}catch(t){console.error(t)}}}if(n=nd.parseHTML(t),mn(n)?(e=this._createElement("body"),e.append(n)):e=n.find("body"),e||(e=this._createElement("body"),e.append(n)),e=this._fixupGoogleDocsBody(e),!e)return console.warn("Invalid HTML."),null;this.reset(),this.convertBody(e);var s=this.generateDocument();return s},e.prototype._fixupGoogleDocsBody=function(t){if(t){var e=t.find("b");return e&&/^docs-internal/.exec(e.id)?e:t}},e.prototype.importFromJSON=function(t){var e=this.createDocument(),n=JSON.parse(t),o=new hf;return o.importDocument(e,n),e},e.prototype.convertBody=function(t){this.convertContainer(t.childNodes,df.SNIPPET_ID)},e.prototype._wrapInlineElementsIntoBlockElement=function(t){for(var e=this,n=this._createElement("p");t.hasNext();){var o=t.next(),r=e._getConverterForElement(o,"block");if(r){t.back();break}n.append(o.clone())}n.attr("data-id",df.TEXT_SNIPPET_ID);var i=this.defaultConverter(n,this);if(i){if(!i.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.");this._createAndShow(i)}return i},e.prototype.createDocument=function(){return this._emptyDoc.createSnippet()},e.prototype._getUnsupportedNodeConverter=function(){},e}(sd),Wm={"catch-all-block":{type:"paragraph",matchElement:function(t){return t.is("div")},import:function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])}}};$m._addConverters=function(t){if(t.converters){var e=new gl;t.converters.forEach(function(t,n){e.add(n,t)}),va(Wm,function(t,n){e.add(n,t)}),t.converters=e}};var Km=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.exportDocument=function(t){this.state.doc=t;var e,n=this.convertDocument(t);e=1===n.length&&n[0].attr("data-id")===df.TEXT_SNIPPET_ID?n[0].innerHTML:n.map(function(t){return t.outerHTML}).join("");var o=new hf,r=JSON.stringify(o.exportDocument(t)),i=["<meta name='substance' content='",btoa(r),"'>"].join("");return"<html><head>"+i+"</head><body>"+e+"</body></html>"},e.prototype.convertDocument=function(t){var e=t.get(df.SNIPPET_ID);if(!e)throw new Error('Illegal clipboard document: could not find container "'+df.SNIPPET_ID+'"');return this.convertContainer(e)},e}(id),Xm=function(t,e){this.surface=t;var n=t.getDocument(),o=n.getSchema(),r=[];e.converterRegistry&&(r=e.converterRegistry.get("html")||[]);var i={schema:o,DocumentClass:n.constructor,converters:r};this.htmlImporter=new $m(i),this.htmlExporter=new Km(i)};Xm.prototype.getSurface=function(){return this.surface},Xm.prototype.attach=function(t){t.on("copy",this.onCopy,this),t.on("cut",this.onCut,this),Ay.isIE&&!Ay.isEdge?t.on("beforepaste",this.onBeforePasteShim,this):t.on("paste",this.onPaste,this)},Xm.prototype.detach=function(t){t.off(this)},Xm.prototype.onCopy=function(t){var e=this._copy();Xm.clipboardData=e,Hd.clipboardData=e,Hd._clipboardData=t.clipboardData,t.clipboardData&&e.doc&&(t.preventDefault(),t.clipboardData.setData("text/plain",e.text),Ay.isIE||Ay.isEdge||t.clipboardData.setData("text/html",e.html))},Xm.prototype.onCut=function(t){t.preventDefault(),this.onCopy(t);var e=this.getSurface();e&&e.transaction(function(t,n){return e.delete(t,n)})},Xm.prototype.onPaste=function(t){for(var e=t.clipboardData,n={},o=0;o<e.types.length;o++)n[e.types[o]]=!0;t.preventDefault(),t.stopPropagation();var r,i;if(n["text/plain"]&&(r=e.getData("text/plain")),n["text/html"]&&(i=e.getData("text/html")),Ay.isEdge&&Hd.clipboardData&&Hd.clipboardData.text===r?i=Hd.clipboardData.html:Hd.clipboardData={text:r,html:i},Ay.isFF&&!i)return void this._pastePlainText(r);if(i)if(Xm.NO_CATCH)this._pasteHtml(i,r);else try{this._pasteHtml(i,r)}catch(t){this._pastePlainText(r)}else this._pastePlainText(r)},Xm.prototype._pastePlainText=function(t){var e=this.getSurface();e.transaction(function(n,o){return o.text=t,e.paste(n,o)})},Xm.prototype.onBeforePasteShim=function(){var t=this.getSurface();if(t){var e=this._createPasteBin(),n=e.getNativeElement();n.focus();var o=window.document.createRange();o.setStart(n.firstChild,0),o.setEnd(n.firstChild,1);var r=window.getSelection();r.removeAllRanges(),r.addRange(o)}},Xm.prototype._createPasteBin=function(){var t=this.surface.el.createElement("div").attr("contenteditable",!0).attr("tabindex",-1).css({position:"fixed",opacity:"0.0",bottom:"-1000px"}).append(" ").on("beforepaste",function(t){t.stopPropagation()}).on("paste",function(e){this.onPasteShim(t),e.stopPropagation()}.bind(this));return this.surface.el.appendChild(t),t},Xm.prototype.onPasteShim=function(t){window.setTimeout(function(){var e=t.innerHTML,n=t.textContent;if(t.remove(),Hd.clipboardData={text:n,html:e},Xm.NO_CATCH)this._pasteHtml(e,n);else try{this._pasteHtml(e,n)}catch(t){this._pastePlainText(n)}}.bind(this))},Xm.prototype._copy=function(){var t=this.getSurface(),e=t.getSelection(),n=t.getDocument(),o=null,r="",i="";return e.isCollapsed()||(r=uf.getTextForSelection(n,e)||"",o=t.copy(n,e),i=this.htmlExporter.exportDocument(o)),{doc:o,html:i,text:r}},Xm.prototype._pasteHtml=function(t,e){var n=this.getSurface();if(n){var o=this.htmlImporter.importDocument(t);return o?(n.transaction(function(t,r){return r.text=e,r.doc=o,n.paste(t,r)}),!0):void 0}},Xm.clipboardData={doc:null,html:"",text:""};var Gm=function(t){this.surface=t,this._wrange=window.document.createRange()};Gm.prototype.getSelection=function(t){var e=this.mapDOMSelection(t),n=this.surface.getDocument();return n.createSelection(e)},Gm.prototype.getSelectionForDOMRange=function(t){var e=this.mapDOMRange(t),n=this.surface.getDocument();return n.createSelection(e)},Gm.prototype.setSelection=function(t){var e=window.getSelection();if(t.isNull()||t.isCustomSelection())return void this.clear();var n,o;if(t.isPropertySelection()||t.isContainerSelection()){if(n=this._getDOMCoordinate(t.start),!n)return console.warn("FIXME: selection seems to be invalid."),void this.clear();if(t.isCollapsed())o=n;else if(o=this._getDOMCoordinate(t.end),!o)return console.warn("FIXME: selection seems to be invalid."),void this.clear()}else if(t.isNodeSelection()){var r=this.surface.find('*[data-id="'+t.getNodeId()+'"]');if(!r)return console.error("Could not find component with id",t.getNodeId()),void this.clear();if(r._isIsolatedNodeComponent){var i=Og.getDOMCoordinates(r);t.isFull()?(n=i.start,o=i.end):n=o=t.isBefore()?i.start:i.end}else{var s=r.el;n={container:s.getNativeElement(),offset:0},o={container:s.getNativeElement(),offset:s.getChildCount()},t.isBefore()?o=n:t.isAfter()&&(n=o)}}var a;if(a=e.rangeCount>0?e.getRangeAt(0):this._wrange,e.removeAllRanges(),t.isCollapsed())a.setStart(n.container,n.offset),a.setEnd(n.container,n.offset),e.addRange(a);else if(t.isReverse()){var p=n;n=o,o=p,a.setStart(n.container,n.offset),a.setEnd(n.container,n.offset),e.addRange(a),e.extend(o.container,o.offset)}else a.setStart(n.container,n.offset),a.setEnd(o.container,o.offset),e.addRange(a)},Gm.prototype._getDOMCoordinate=function(t){var e,n=null;return t.isNodeCoordinate()?(e=this.surface.find('*[data-id="'+t.getNodeId()+'"]'),e&&(n=e._isIsolatedNodeComponent?Og.getDOMCoordinate(e,t):{container:e.getNativeElement(),offset:t.offset})):(e=this.surface._getTextPropertyComponent(t.path),e&&(n=e.getDOMCoordinate(t.offset))),n},Gm.prototype.mapDOMRange=function(t){return this._getRange(nd.wrapNativeElement(t.startContainer),t.startOffset,nd.wrapNativeElement(t.endContainer),t.endOffset)},Gm.prototype.mapDOMSelection=function(t){var e,n=window.getSelection();if(0===n.rangeCount)return null;var o=nd.wrapNativeElement(n.anchorNode);if(n.isCollapsed){var r=this._getCoordinate(o,n.anchorOffset,t);if(!r)return null;e=r.__inIsolatedBlockNode__?he(r.path[0],this.getContainerId()):r.__inInlineNode__?ue(new ph(r.path,r.__startOffset__),new ph(r.path,r.__endOffset__),!1,this.getContainerId()):ue(r,r,!1,this.getContainerId())}else if(o.isElementNode()&&o.is(".sc-surface"))e=this._getEnclosingRange(n.getRangeAt(0));else{var i=nd.wrapNativeElement(n.focusNode);e=this._getRange(o,n.anchorOffset,i,n.focusOffset)}return e},Gm.prototype.clear=function(){window.getSelection().removeAllRanges()},Gm.prototype.collapse=function(t){var e,n=window.getSelection();n.rangeCount>0&&(e=n.getRangeAt(0),e.collapse("left"===t),n.removeAllRanges(),n.addRange(e))},Gm.prototype.getContainerId=function(){return this.surface.isContainerEditor()?this.surface.getContainerId():null},Gm.prototype._getRange=function(t,e,n,o){var r,i=this._getCoordinate(t,e);r=t===n&&e===o?i:this._getCoordinate(n,o);var s=nd.isReverse(t,e,n,o);return i&&r?ue(i,r,s,this.getContainerId()):null},Gm.prototype._getCoordinate=function(t,e,n){var o=this.surface.el,r=null;return r||(r=Eg.getCoordinate(t,e),r&&(r.__inInlineNode__=!0)),r||(r=Tg.getCoordinate(o,t,e)),r||(r=Og.getCoordinate(o,t,e),r&&(r.__inIsolatedBlockNode__=!0)),r||(r=this._searchForCoordinate(t,e,n)),r},Gm.prototype._searchForCoordinate=function(t,e,n){var o=this;n=n||{},n.direction=n.direction||"right";var r=n.direction;if(t.isElementNode()){var i=t.getChildCount();e=Math.max(0,Math.min(i,e));for(var s=t.getChildAt(e);s;){var a=void 0;if("right"===r){if(s.isElementNode()&&(a=s.getAttribute("data-path")?s:s.find("*[data-path]")))return new ph(ce(a),0);s=s.getNextSibling()}else{if(s.isElementNode()){if(s.getAttribute("data-path"))a=s;else{var p=s.findAll("*[data-path]");a=pu(p)}if(a){var c=ce(a),u=o.surface.getDocument(),h=u.get(c);return new ph(c,h.length)}}s=s.getPreviousSibling()}}}if(t!==this.surface.el){var f=t.getParent(),l=f.getChildIndex(t);return"right"===r&&l++,this._searchForCoordinate(f,l,n)}return null},Gm.prototype._getEnclosingRange=function(t){var e=t.cloneContents(),n=e.querySelectorAll("*[data-path]");if(0===n.length)return null;var o,r=this.surface.getDocument(),i=n[0],s=n[n.length-1],a=ce(i);if(i===s)return o=r.get(a),new gh(new ph(a,0),new ph(a,o.length),(!1));var p=ce(s);return o=r.get(p),new gh(new ph(a,0),new ph(p,o.length),(!1))};var Qm=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){return t("pre").addClass("content-node unsupported").attr({"data-id":this.props.node.id,contentEditable:!1}).append(JSON.stringify(this.props.node.properties,null,2))},e}(Ny),Ym=function(t){function e(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];if(t.apply(this,n),this.documentSession=this.props.documentSession||this.context.documentSession,!this.documentSession)throw new Error("No DocumentSession provided");if(this.name=this.props.name,!this.name)throw new Error("Surface must have a name.");if(this.name.indexOf("/")>-1)throw new Error("Surface.name must not contain '/'");this._surfaceId=ee(this),this.clipboard=new Xm(this,{converterRegistry:this.context.converterRegistry}),this.domSelection=null,this.domObserver=null,Al&&(this.documentEl=nd.wrapNativeElement(window.document)),this.undoEnabled=!0,this.textTypes=this.props.textTypes,this._textProperties={},this._state={skipNextFocusEvent:!1,skipNextObservation:!1,isDirty:!1,dirtyProperties:{},fragments:{},cursorFragment:null},e.prototype._deriveInternalState.call(this,this.props)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isSurface:{}};return n._isSurface.get=function(){return!0},e.prototype.getChildContext=function(){return{surface:this,surfaceParent:this,doc:this.getDocument()}},e.prototype.didMount=function(){this.context.surfaceManager&&this.context.surfaceManager.registerSurface(this),!this.isReadonly()&&Al&&(this.domSelection=new Gm(this)),this.documentSession.on("update",this._onSessionUpdate,this)},e.prototype.dispose=function(){this.documentSession.off(this),this.domSelection=null,this.domObserver&&this.domObserver.disconnect(),this.context.surfaceManager&&this.context.surfaceManager.unregisterSurface(this)},e.prototype.willReceiveProps=function(t){e.prototype._deriveInternalState.call(this,t)},e.prototype.didUpdate=function(t,e){this._update(t,e)},e.prototype.render=function(t){var e=this.props.tagName||"div",n=t(e).addClass("sc-surface").attr("spellCheck",!1).attr("tabindex",2);return this.isDisabled()||(this.isEditable()&&(n.on("keydown",this.onKeyDown),Ay.isIE||n.on("compositionstart",this.onCompositionStart),Al&&window.TextEvent&&!Ay.isIE?n.on("textInput",this.onTextInput):n.on("keypress",this.onTextInputShim)),this.isReadonly()||(n.on("mousedown",this.onMouseDown),n.on("focus",this.onNativeFocus),n.on("blur",this.onNativeBlur),this.clipboard.attach(n)),this.context.dragManager&&n.on("drop",this.onDrop)),n},e.prototype.renderNode=function(t,e){var n=this.getDocument(),o=this.getComponentRegistry(),r=o.get(e.type);return r||(console.error("Could not resolve a component for type: "+e.type),r=Qm),t(r,{doc:n,node:e}).ref(e.id)},e.prototype.getComponentRegistry=function(){return this.context.componentRegistry||this.props.componentRegistry},e.prototype.getName=function(){return this.name},e.prototype.getId=function(){return this._surfaceId},e.prototype.isDisabled=function(){return this.props.disabled},e.prototype.isEditable=function(){return"full"===this.props.editing||void 0===this.props.editing},e.prototype.isSelectable=function(){return"selection"===this.props.editing||"full"===this.props.editing},e.prototype.isReadonly=function(){return"readonly"===this.props.editing},e.prototype.getElement=function(){return this.el},e.prototype.getController=function(){return this.context.controller},e.prototype.getDocument=function(){return this.documentSession.getDocument()},e.prototype.getDocumentSession=function(){return this.documentSession},e.prototype.isEnabled=function(){return!this.state.disabled},e.prototype.isContainerEditor=function(){return!1},e.prototype.getContainerId=function(){return null},e.prototype.transaction=function(t,e){var n=this.documentSession,o=this.getId();return n.transaction(function(e,n){return e.before.surfaceId=o,t(e,n)},e)},e.prototype.getSelection=function(){return this.documentSession.getSelection()},e.prototype.setSelection=function(t){t&&!t.isNull()&&(t.surfaceId=this.getId(),t.containerId=t.containerId||this.getContainerId()),this._setSelection(t)},e.prototype.blur=function(){this.el&&this.el.blur()},e.prototype.focus=function(){this.isDisabled()||(Ay.isFF&&(this.domSelection.clear(),this.el.getNativeElement().blur()),this._focus())},e.prototype.rerenderDOMSelection=function(){if(!this.isDisabled()&&Al){var t=this.getSelection();t.surfaceId===this.getId()&&this.domSelection.setSelection(t)}},e.prototype.getDomNodeForId=function(t){return this.el.getNativeElement().querySelector('*[data-id="'+t+'"]')},e.prototype.selectAll=function(){var t=this.getDocument(),e=this.getSelection();if(e.isPropertySelection()){var n=e.path,o=t.get(n);e=t.createSelection({type:"property",path:n,startOffset:0,endOffset:o.length}),this.setSelection(e)}},e.prototype.insertText=function(t,e){var n=e.selection;if(n.isPropertySelection()||n.isContainerSelection())return gd(t,e)},e.prototype.delete=function(t,e){var n=e.selection;return n.isCollapsed()?n.isPropertySelection()||n.isNodeSelection()?yd(t,e):void 0:nt(t,e)},e.prototype.break=function(t,e){return this.softBreak(t,e)},e.prototype.softBreak=function(t,e){return e.text="\n",this.insertText(t,e)},e.prototype.copy=function(t,e){var n=ct(t,{selection:e});return n.doc},e.prototype.paste=function(t,e){if(e.text)return this.insertText(t,e)},e.prototype.onKeyDown=function(t){var e=this.context.commandManager;if(229!==t.which){switch(t.keyCode){case hg.LEFT:case hg.RIGHT:return this._handleLeftOrRightArrowKey(t);case hg.UP:case hg.DOWN:return this._handleUpOrDownArrowKey(t);case hg.ENTER:return this._handleEnterKey(t);case hg.SPACE:return this._handleSpaceKey(t);case hg.BACKSPACE:case hg.DELETE:return this._handleDeleteKey(t);case hg.HOME:case hg.END:return this._handleHomeOrEndKey(t);case hg.PAGEUP:case hg.PAGEDOWN:return this._handlePageUpOrDownKey(t)}var n=!1;(t.ctrlKey||t.metaKey)&&65===t.keyCode?(this.selectAll(),n=!0):this.undoEnabled&&90===t.keyCode&&(t.metaKey||t.ctrlKey)?(t.shiftKey?e.executeCommand("redo"):e.executeCommand("undo"),n=!0):66===t.keyCode&&(t.metaKey||t.ctrlKey)?(e.executeCommand("strong"),n=!0):73===t.keyCode&&(t.metaKey||t.ctrlKey)?(e.executeCommand("emphasis"),n=!0):75===t.keyCode&&(t.metaKey||t.ctrlKey)&&(e.executeCommand("link"),n=!0),n&&(t.preventDefault(),t.stopPropagation())}},e.prototype.onTextInput=function(t){t.preventDefault(),t.stopPropagation(),t.data&&(this._state.skipNextObservation=!0,this.transaction(function(e,n){return this.domSelection&&this.domSelection.clear(),n.text=t.data,this.insertText(e,n)}.bind(this),{action:"type"}))},e.prototype.onCompositionStart=function(){this._state.skipNextObservation=!0},e.prototype.onTextInputShim=function(t){if(!(0===t.which||0===t.charCode||t.keyCode===hg.TAB||t.keyCode===hg.ESCAPE||Boolean(t.metaKey)||Boolean(t.ctrlKey)^Boolean(t.altKey))){var e=String.fromCharCode(t.which);return this._state.skipNextObservation=!0,t.shiftKey||(e=e.toLowerCase()),e.length>0?(this.transaction(function(t,n){return this.domSelection&&this.domSelection.clear(),n.text=e,this.insertText(t,n)}.bind(this),{action:"type"}),t.preventDefault(),void t.stopPropagation()):(t.preventDefault(),void t.stopPropagation())}},e.prototype.onMouseDown=function(t){if(!(Ay.isIE&&Ay.version<12)&&t.detail>=3){var e=this.getSelection();if(e.isPropertySelection())return this._selectProperty(e.path),t.preventDefault(),void t.stopPropagation();if(e.isContainerSelection())return this._selectProperty(e.startPath),t.preventDefault(),void t.stopPropagation()}1===t.which&&(this._state.skipNextFocusEvent=!0,this.documentEl&&this.documentEl.on("mouseup",this.onMouseUp,this,{once:!0}))},e.prototype.onMouseUp=function(){setTimeout(function(){if(this.domSelection){var t=this.domSelection.getSelection();this.setSelection(t)}}.bind(this))},e.prototype.onDomMutations=function(t){return this._state.skipNextObservation?void(this._state.skipNextObservation=!1):void console.info("We want to enable a DOM MutationObserver which catches all changes made by native interfaces (such as spell corrections, etc). Lookout for this message and try to set Surface.skipNextObservation=true when you know that you will mutate the DOM.",t)},e.prototype.onDrop=function(t){this.context.dragManager.onDrop(t,this)},e.prototype.onNativeBlur=function(){var t=this._state;t.hasNativeFocus=!1},e.prototype.onNativeFocus=function(){var t=this._state;t.hasNativeFocus=!0},e.prototype._deriveInternalState=function(t){var e=this._state,n=e.fragments;n&&va(n,function(t,n){this._getComponentForKey(n)&&this._markAsDirty(e,n)}.bind(this));var o=t.fragments;o&&this._deriveFragments(o)},e.prototype._deriveFragments=function(t){var e=this._state;e.cursorFragment=null;var n={};this._forEachFragment(t,function(t,o){var r=t.path.toString();if(t.key=r,this._getComponentForKey(r)){if("cursor"===t.type&&"local-user"===o)return void(e.cursorFragment=t);var i=n[r];i||(i=[],n[r]=i),i.push(t),this._markAsDirty(e,r)}}.bind(this)),e.fragments=n},e.prototype._forEachFragment=function(t,e){va(t,function(t,n){t.forEach(function(t){e(t,n)})})},e.prototype._checkForUpdates=function(t){var e=this._state;return Object.keys(t.updated).forEach(function(t){this._getComponentForKey(t)&&this._markAsDirty(e,t)}.bind(this)),e.isDirty},e.prototype._update=function(t,e){this._updateContentEditableState(e),this._updateProperties()},e.prototype._updateContentEditableState=function(t){if("co-focused"===t.mode&&this.el.off("mousedown",this._enableContentEditable,this),this.isEditable()){if(this.state.mode!==t.mode)switch(this.state.mode){case"co-focused":this.el.setAttribute("contenteditable",!1),this.el.on("mousedown",this._enableContentEditable,this);break;default:this.el.setAttribute("contenteditable",!0)}}else this.el.setAttribute("contenteditable",!1)},e.prototype._enableContentEditable=function(){this.el.setAttribute("contenteditable",!0)},e.prototype._updateProperties=function(){for(var t=this,e=this._state,n=Object.keys(e.dirtyProperties),o=0;o<n.length;o++)t._updateProperty(n[o]);e.isDirty=!1,e.dirtyProperties={}},e.prototype._markAsDirty=function(t,e){t.isDirty=!0,t.dirtyProperties[e]=!0},e.prototype._updateProperty=function(t){var e=this._state,n=this._hasNativeFocus()?null:e.cursorFragment,o=e.fragments[t]||[];n&&n.key===t&&(o=o.concat([n]));var r=this._getComponentForKey(t);r&&r.extendProps({fragments:o})},e.prototype._onSessionUpdate=function(t){if(t.selection){var e=this._deriveModeFromSelection(t.selection);this.state.mode!==e&&this.extendState({mode:e})}},e.prototype._deriveModeFromSelection=function(t){var e,n=t.surfaceId,o=this.getId();return xg(n,o)&&(e=n.length===o.length?"focused":"co-focused"),e},e.prototype._getSurfaceParent=function(){return this.context.surfaceParent},e.prototype._getComponentForKey=function(t){return this._textProperties[t]},e.prototype._focus=function(){this._state.hasNativeFocus=!0,this.el&&!Ay.isWebkit&&(this._state.skipNextFocusEvent=!0,this.el.focus(),this._state.skipNextFocusEvent=!1)},e.prototype._handleLeftOrRightArrowKey=function(t){t.stopPropagation();var e=t.keyCode===hg.LEFT?"left":"right",n=this.getDocumentSession().getSelectionState(),o=n.getSelection();return n.isInlineNodeSelection()&&!t.shiftKey?(t.preventDefault(),void this.setSelection(o.collapse(e))):void window.setTimeout(function(){if(this.isMounted()){var e={direction:t.keyCode===hg.LEFT?"left":"right"};this._updateModelSelection(e)}}.bind(this))},e.prototype._handleUpOrDownArrowKey=function(t){t.stopPropagation(),window.setTimeout(function(){if(this.isMounted()){var e={direction:t.keyCode===hg.UP?"left":"right"};this._updateModelSelection(e)}}.bind(this))},e.prototype._handleHomeOrEndKey=function(t){t.stopPropagation(),window.setTimeout(function(){if(this.isMounted()){var e={direction:t.keyCode===hg.HOME?"left":"right"};this._updateModelSelection(e)}}.bind(this))},e.prototype._handlePageUpOrDownKey=function(t){t.stopPropagation(),window.setTimeout(function(){if(this.isMounted()){
var e={direction:t.keyCode===hg.PAGEUP?"left":"right"};this._updateModelSelection(e)}}.bind(this))},e.prototype._handleSpaceKey=function(t){t.preventDefault(),t.stopPropagation(),this.transaction(function(t,e){return this.domSelection.clear(),e.text=" ",this.insertText(t,e)}.bind(this),{action:"type"})},e.prototype._handleEnterKey=function(t){t.preventDefault(),t.stopPropagation(),t.shiftKey?this.transaction(function(t,e){return this.softBreak(t,e)}.bind(this),{action:"break"}):this.transaction(function(t,e){return this.break(t,e)}.bind(this),{action:"break"})},e.prototype._handleDeleteKey=function(t){t.preventDefault(),t.stopPropagation();var e=t.keyCode===hg.BACKSPACE?"left":"right";this.transaction(function(t,n){return n.direction=e,this.delete(t,n)}.bind(this),{action:"delete"})},e.prototype._hasNativeFocus=function(){return Boolean(this._state.hasNativeFocus)},e.prototype._setSelection=function(t){!t.isNull()&&t.surfaceId===this.getId()&&Ay.isFF&&this._focus(),this.documentSession.setSelection(t)},e.prototype._updateModelSelection=function(t){var e=this.domSelection.getSelection(t);this.setSelection(e)},e.prototype._selectProperty=function(t){var e=this.getDocument(),n=e.get(t);this.setSelection(e.createSelection(t,0,n.length))},e.prototype._registerTextProperty=function(t){var e=t.getPath();this._textProperties[e]=t},e.prototype._unregisterTextProperty=function(t){var e=t.getPath();this._textProperties[e]===t&&delete this._textProperties[e]},e.prototype._getTextPropertyComponent=function(t){return this._textProperties[t]},e.prototype._renderNode=function(t,e){var n=this.getDocument(),o=n.get(e),r=this.context.componentRegistry||this.props.componentRegistry,i=r.get(o.type);return i||(console.error("Could not resolve a component for type: "+o.type),i=Qm),t(i,{doc:n,node:o})},e.prototype._prepareArgs=function(t){},e.prototype.getSelectionFromEvent=function(t){if(this.domSelection){var n=e.getDOMRangeFromEvent(t),o=this.domSelection.getSelectionForDOMRange(n);return o.surfaceId=this.getId(),o}},e.prototype.setSelectionFromEvent=function(t){var e=this.getSelectionFromEvent(t);e?(this._state.skipNextFocusEvent=!0,this.setSelection(e)):console.error("Could not create a selection from event.")},e.prototype.getBoundingRectangleForSelection=function(){var t=this.getSelection();if(this.isDisabled()||!t||t.isNull()||t.isNodeSelection()||t.isCustomSelection())return{};var e;e=this.context.scrollPane?this.context.scrollPane.refs.content.el.el:document.body;var n,o=window.getSelection();if(o.rangeCount>0&&(n=o.getRangeAt(0)),n&&n.collapsed){var r=document.createElement("span");this._state.skipNextObservation=!0,r.appendChild(window.document.createTextNode("")),n.insertNode(r);var i=te(r,e),s=r.parentNode;return this._state.skipNextObservation=!0,s.removeChild(r),s.normalize(),Ay.isFF&&this.rerenderDOMSelection(),i}var a=this.el.el;if(t.isCollapsed()){var p=a.querySelector(".se-cursor");return p?te(p,e):{}}var c=a.querySelectorAll(".se-selection-fragment");return c.length>0?te(c,e):(console.warn("FIXME: there should be a rendered selection fragments element."),{})},e.prototype._sendOverlayHints=function(){var t=this.getBoundingRectangleForSelection();this.send("updateOverlayHints",{rectangle:t})},Object.defineProperties(e.prototype,n),e}(Ny);Ym.getDOMRangeFromEvent=function(t){var e,n=t.clientX,o=t.clientY;if(document.body.createTextRange)e=document.body.createTextRange(),e.moveToPoint(n,o);else if(!Jm(document.createRange))if(Jm(t.rangeParent))if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(n,o);e=document.createRange(),e.setStart(r.offsetNode,r.offset),e.collapse(!0)}else document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(n,o));else e=document.createRange(),e.setStart(t.rangeParent,t.rangeOffset),e.collapse(!0);return e};var Zm=function(t){function e(n,o){if(o.containerId=o.containerId||o.node.id,o.name=o.name||o.containerId||o.node.id,t.call(this,n,o),this.containerId=this.props.containerId,!bn(this.containerId))throw new Error("Property 'containerId' is mandatory.");var r=this.getDocument();if(this.container=r.get(this.containerId),!this.container)throw new Error("Container with id "+this.containerId+" does not exist.");this.editingBehavior=this.context.editingBehavior||new Vm,e.prototype._deriveInternalState.call(this,this.props)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_isContainerEditor:{}};return n._isContainerEditor.get=function(){return!0},e.prototype.shouldRerender=function(t){return t.disabled!==this.props.disabled},e.prototype.willReceiveProps=function(n){t.prototype.willReceiveProps.apply(this,arguments),e.prototype._deriveInternalState.call(this,n)},e.prototype.didMount=function(){t.prototype.didMount.apply(this,arguments),this.container.on("nodes:changed",this.onContainerChange,this)},e.prototype.dispose=function(){t.prototype.dispose.apply(this,arguments),this.container.off(this)},e.prototype.render=function(e){var n=t.prototype.render.call(this,e),o=this.getDocument(),r=this.getContainerId(),i=o.get(r);return i||console.warn("No container node found for ",r),n.addClass("sc-container-editor container-node "+r).attr({spellCheck:!1,"data-id":r}),this.isEmpty()?n.append(e("a").attr("href","#").append("Start writing").on("click",this.onCreateText)):i.getNodes().forEach(function(t){n.append(this._renderNode(e,t).ref(t.id))}.bind(this)),this.props.disabled||(n.addClass("sm-enabled"),n.setAttribute("contenteditable",!0)),n},e.prototype._renderNode=function(e,n){if(!n)throw new Error("Illegal argument");if(n.isText())return t.prototype.renderNode.call(this,e,n);var o=this.context.componentRegistry,r=o.get(n.type);return r.prototype._isIsolatedNodeComponent?e(r,{node:n}).ref(n.id):e(Og,{node:n}).ref(n.id)},e.prototype._deriveInternalState=function(t){var e=this._state;!t.hasOwnProperty("enabled")||t.enabled?e.enabled=!0:e.enabled=!1},e.prototype._handleUpOrDownArrowKey=function(t){t.stopPropagation();var e=t.keyCode===hg.UP?"left":"right",n=this.getDocumentSession().getSelectionState(),o=n.getSelection();if(o.isNodeSelection()&&o.isFull()&&!t.shiftKey)this.domSelection.collapse(e);else if(!Ay.isIE&&!o.isCollapsed()&&!t.shiftKey){var r=this.getDocument();"left"===e?this.setSelection(r.createSelection(o.start.path,o.start.offset)):this.setSelection(r.createSelection(o.end.path,o.end.offset))}window.setTimeout(function(){this.isMounted()&&this._updateModelSelection({direction:e})}.bind(this))},e.prototype._handleLeftOrRightArrowKey=function(e){e.stopPropagation();var n=e.keyCode===hg.LEFT?"left":"right",o=this.getDocumentSession().getSelectionState(),r=o.getSelection();return r.isNodeSelection()&&r.isFull()&&!e.shiftKey?(e.preventDefault(),void this.setSelection(r.collapse(n))):void t.prototype._handleLeftOrRightArrowKey.call(this,e)},e.prototype._handleEnterKey=function(e){var n=this.getDocumentSession().getSelection();n.isNodeSelection()&&n.isFull()?(e.preventDefault(),e.stopPropagation()):t.prototype._handleEnterKey.apply(this,arguments)},e.prototype.isContainerEditor=function(){return!0},e.prototype.getContainerId=function(){return this.containerId},e.prototype.getContainer=function(){return this.getDocument().get(this.getContainerId())},e.prototype.isEmpty=function(){var t=this.getContainer();return t&&0===t.nodes.length},e.prototype.isEditable=function(){return t.prototype.isEditable.call(this)&&!this.isEmpty()},e.prototype.extendBehavior=function(t){t.register(this.editingBehavior)},e.prototype.getTextTypes=function(){return this.textTypes||[]},e.prototype.getTextCommands=function(){var t={};return this.commandRegistry.each(function(e){e.constructor.textTypeName&&(t[e.getName()]=e)}),t},e.prototype.break=function(t,e){return st(t,e)},e.prototype.insertNode=function(t,e){if(e.selection.isPropertySelection()||e.selection.isContainerSelection())return St(t,e)},e.prototype.switchType=function(t,e){if(e.selection.isPropertySelection())return It(t,e)},e.prototype.selectAll=function(){var t=this.getDocument(),e=t.get(this.getContainerId());if(0!==e.nodes.length){var n=e.nodes[0],o=pu(e.nodes),r=t.createSelection({type:"container",containerId:e.id,startPath:[n],startOffset:0,endPath:[o],endOffset:1});this.setSelection(r)}},e.prototype.selectFirst=function(){var t=this.getDocument(),e=this.getContainer().nodes;if(0===e.length)return void console.warn("ContainerEditor.selectFirst(): Container is empty.");var n,o=t.get(e[0]);n=o.isText()?t.createSelection(o.getTextPath(),0):t.createSelection(this.getContainerId(),[o.id],0,[o.id],1),this.setSelection(n)},e.prototype.paste=function(t,e){if(e.selection.isPropertySelection()||e.selection.isContainerSelection())return md(t,e)},e.prototype.onContainerChange=function(t){for(var e=this,n=this.getDocument(),o=Cy.createContext(this),r=o.$$,i=this.getContainer(),s=i.getContentPath(),a=0;a<t.ops.length;a++){var p=t.ops[a];if("update"===p.type&&p.path[0]===s[0]){var c=p.diff;if("insert"===c.type){var u=c.getValue(),h=n.get(u),f=void 0;f=h?e._renderNode(r,h):r("div"),e.insertAt(c.getOffset(),f)}else"delete"===c.type&&e.removeAt(c.getOffset())}}},e.prototype.onCreateText=function(t){t.preventDefault();var e;this.transaction(function(t){var n=t.get(this.props.containerId),o=t.getSchema().getDefaultTextType(),r=t.create({id:h(o),type:o,content:""});n.show(r.id),e=t.createSelection({type:"property",path:[r.id,"content"],startOffset:0,endOffset:0})}.bind(this)),this.rerender(),this.setSelection(e)},e.prototype.transaction=function(t,e){var n=this.documentSession,o=this.getId(),r=this.getContainerId();return n.transaction(function(e,n){var i=e.before.selection;i&&!i.isNull()&&(i.containerId=i.containerId||r),e.before.surfaceId=o,n.containerId=this.getContainerId(),n.editingBehavior=this.editingBehavior;var s=t(e,n);if(s)return i=s.selection,i&&!i.isNull()&&(i.containerId=r),s}.bind(this),e)},Object.defineProperties(e.prototype,n),e}(Ym);Zm.isContainerEditor=!0;var tv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass(this.getClassNames()),n=this.getActiveTools();if(n.length>0){var o=t("div").addClass("se-active-tools");n.forEach(function(e){o.append(t(e.Class,e.toolProps).ref(e.toolProps.name))}),e.append(o)}return e},e.prototype.getActiveTools=function(){var t=this,e=this.props.commandStates,n=this.context.tools,o=n.get("overlay"),r=[];return o.forEach(function(n,o){var i=Object.assign({},e[o],{name:o,icon:o,style:t.getToolStyle(o)});i.disabled||r.push({Class:n.Class,toolProps:i})}),r},e.prototype.isVisible=function(){return this.getActiveTools().length>0},e.prototype.getToolStyle=function(){throw new Error("this method is abstract")},e.prototype.getClassNames=function(){throw new Error("this method is abstract")},e}(Ny),ev=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getToolStyle=function(){return"outline-dark"},e.prototype.getClassNames=function(){return"sc-prose-editor-overlay-tools"},e}(tv),nv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t("div").addClass(this.getClassNames()),n=this.props.commandStates,o=this.context.componentRegistry,r=this.context.tools;return r.forEach(function(r,i){if("overlay"!==i){var s=o.get("tool-target-"+i);s||(s=Dy);var a=t(s,{name:i,tools:r,commandStates:n});e.append(a)}}),e},e.prototype.getClassNames=function(){return"sc-toolbar"},e}(Ny),ov=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.componentRegistry.get("split-pane"),n=t("div").addClass("sc-prose-editor"),o=this._renderToolbar(t),r=this._renderEditor(t),i=this.componentRegistry.get("scroll-pane"),s=t(i,{scrollbarPosition:"right",overlay:ev}).append(r).ref("contentPanel");return n.append(t(e,{splitType:"horizontal"}).append(o,s)),n},e.prototype._renderToolbar=function(t){var e=this.commandManager.getCommandStates();return t(nv,{commandStates:e}).ref("toolbar")},e.prototype._renderEditor=function(t){var e=this.props.configurator;return t(Zm,{disabled:this.props.disabled,documentSession:this.documentSession,node:this.doc.get("body"),commands:e.getSurfaceCommandNames(),textTypes:e.getTextTypes()}).ref("body")},e.prototype.documentSessionUpdated=function(){var t=this.refs.toolbar;if(t){var e=this.commandManager.getCommandStates();t.setProps({commandStates:e})}},e}(Um),rv=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(t.apply(this,e),!this.config.nodeType)throw new Error("Every InlineInlineNodeCommand must have a nodeType")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.selection,n={disabled:!e.isPropertySelection(),active:!1};return n},e.prototype.execute=function(t){var e=this.getCommandState(t);if(!e.disabled){var n=t.surface;return n&&n.transaction(function(t,e){return this.insertInlineNode(t,e)}.bind(this)),!0}},e.prototype.insertInlineNode=function(t,e){return e.node=this.createNodeData(t,e),Ct(t,e)},e.prototype.createNodeData=function(t,e){return{type:this.config.nodeType}},e}(vd),iv=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(t.apply(this,e),!this.config.nodeType)throw new Error("Every AnnotationCommand must have a nodeType")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.selection,n={disabled:!0,active:!1},o=this._getAnnotationsForSelection(t);return 1===o.length&&o[0].getSelection().equals(e)&&(n.disabled=!1,n.node=o[0]),n},e.prototype.execute=function(t){},e.prototype._getAnnotationsForSelection=function(t){return t.selectionState.getAnnotationsForType(this.config.nodeType)},e}(vd),sv=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this.pages={},this.handleActions({navigate:this.navigate})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getInitialState=function(){return{route:void 0,mobile:this._isMobile()}},e.prototype.didMount=function(){if(Al){var t=nd.getBrowserWindow();t.on("resize",this._onResize,this)}this.router=this.getRouter(),this.router.on("route:changed",this._onRouteChanged,this);var e=this.router.readRoute();this.navigate(e,{replace:!0})},e.prototype.dispose=function(){this.router.off(this),this.router.dispose()},e.prototype.navigate=function(t,e){this.extendState({route:t}),this.router.writeRoute(t,e)},e.prototype._onRouteChanged=function(t){this.navigate(t,{replace:!0})},e.prototype._isMobile=function(){if(Al)return window.innerWidth<700},e.prototype._onResize=function(){this._isMobile()?this.state.mobile||this.extendState({mobile:!0}):this.state.mobile&&this.extendState({mobile:!1})},e.prototype._getPage=function(){return this.state.route.page||this.getDefaultPage()},e.prototype._getPageClass=function(){var t=this._getPage();return this.pages[t]},e.prototype._getPageProps=function(){var t=Zc(this.state.route);return delete t.page,t.mobile=this.state.mobile,t},e.prototype.addPage=function(t,e){this.pages[t]=e},e.prototype.renderPage=function(t){var e=this._getPageClass(),n=this._getPage();return t(e,this._getPageProps()).ref(n)},e.prototype.render=function(t){var e=t("div").addClass("sc-responsive-application");return void 0===this.state.route?e:(e.append(this.renderPage(t)),e)},e}(Ny),av=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){return t("i").addClass("fa "+this.props.icon)},e}(Ny),pv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.didMount=function(){var t=this.context.tocProvider;t.on("toc:updated",this.onTOCUpdated,this)},e.prototype.dispose=function(){var t=this.context.tocProvider;t.off(this)},e.prototype.render=function(t){for(var e=this,n=this.context.tocProvider,o=n.activeEntry,r=this.getComponent("scroll-pane"),i=t("div").addClass("se-toc-entries").ref("tocEntries"),s=n.getEntries(),a=0;a<s.length;a++){var p=s[a],c=p.level,u=t("a").addClass("se-toc-entry").addClass("sm-level-"+c).attr({href:"#","data-id":p.id}).ref(p.id).on("click",e.handleClick).append(t(av,{icon:"fa-caret-right"}),p.name);o===p.id&&u.addClass("sm-active"),i.append(u)}var h=t("div").addClass("sc-toc").append(t(r).ref("panelEl").append(i));return h},e.prototype.getDocument=function(){return this.context.doc},e.prototype.onTOCUpdated=function(){this.rerender()},e.prototype.handleClick=function(t){var e=t.currentTarget.dataset.id;t.preventDefault(),this.send("tocEntrySelected",e)},e}(Ny),cv=i(function(t){function e(t,e){return n(e,function(e){return t[e]})}var n=r(Ia);t.exports=e}),uv=r(cv),hv=Object.freeze({default:uv}),fv=i(function(t){function e(t){return t?n(t,o(t)):[]}var n=r(hv),o=r(An);t.exports=e}),lv=r(fv),dv=Object.freeze({default:lv}),yv=i(function(t){function e(t,e,r,c){t=o(t)?t:a(t),r=r&&!c?s(r):0;var u=t.length;return r<0&&(r=p(u+r,0)),i(t)?r<=u&&t.indexOf(e,r)>-1:!!u&&n(t,e,r)>-1}var n=r(kf),o=r(sn),i=r(wn),s=r(tp),a=r(dv),p=Math.max;t.exports=e}),gv=r(yv),mv=function(t){function e(e,n){t.call(this,e,n),this.document=e,this.config=n,this.entries=this.computeEntries(),this.entries.length>0?this.activeEntry=this.entries[0].id:this.activeEntry=null,this.document.on("document:changed",this.handleDocumentChange,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){var t=this.getDocument();t.disconnect(this)},e.prototype.handleDocumentChange=function(t){for(var e=this.getDocument(),n=!1,o=this.constructor.tocTypes,r=0;r<t.ops.length;r++){var i=t.ops[r],s=void 0;if(i.isCreate()||i.isDelete()){var a=i.getValue();if(s=a.type,gv(o,s)){n=!0;break}}else{var p=i.path[0],c=e.get(p);if(c&&gv(o,c.type)){n=!0;break}}}n&&(this.entries=this.computeEntries(),this.emit("toc:updated"))},e.prototype.computeEntries=function(){var t=this.getDocument(),e=this.config,n=[],o=t.get(e.containerId).nodes;return Bh(o,function(e){var o=t.get(e);"heading"===o.type&&n.push({id:o.id,name:o.content,level:o.level,node:o})}),n},e.prototype.getEntries=function(){return this.entries},e.prototype.getDocument=function(){return this.document},e.prototype.markActiveEntry=function(t){var e=t.getContentElement(),n=t.getContentHeight(),o=t.getHeight(),r=t.getScrollPosition(),i=r+o,s=r,a=2*i-n,p=Math.max(s,a),c=this.computeEntries();if(0!==c.length){for(var u=c[0].id,h=c.length-1;h>=0;h--){var f=c[h],l=e.find('[data-id="'+f.id+'"]');if(!l)return void console.warn("Not found in Content panel",f.id);var d=t.getPanelOffsetForElement(l);if(p>=d){u=f.id;break}}this.activeEntry!==u&&(this.activeEntry=u,this.emit("toc:updated"))}},e}(ba);mv.tocTypes=["heading"];var vv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.props.tools,n=this.props.commandStates,o=t("div").addClass("sc-tool-dropdown");if(o.addClass("sm-target-"+this.props.name),o.append(this.renderButton(t)),this.state.open){var r=[];e.forEach(function(e,o){var i=Object.assign({},n[o]);i.name=o,i.label=o,i.style="plain-dark",r.push(t(e.Class,i))}),o.append(t("div").addClass("se-options").append(t("div").addClass("se-arrow"),t("div").addClass("se-content").append(r)))}return o},e.prototype.renderButton=function(t){var e=t(Ty,{label:this.props.name,active:this.state.open,disabled:this.props.disabled,style:this.props.style}).on("click",this.onClick);return e},e.prototype.onClick=function(){var t=!this.state.open;this.setState({open:t})},e}(Ny),_v=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(vg),bv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCommandState=function(t){var e=t.selection,n={disabled:!0,active:!1};return e&&!e.isNull()&&e.isPropertySelection()&&(n.disabled=!1),n},e.prototype.execute=function(t){var e=t.commandState;if(!e.disabled){var n=t.surface;return n&&n.transaction(function(t,e){return this.insertNode(t,e)}.bind(this)),!0}},e.prototype.insertNode=function(t,e){return e.node=this.createNodeData(t,e),St(t,e)},e.prototype.createNodeData=function(t,e){throw new Error("InsertNodeCommand.createNodeData() is abstract.")},e}(vd),wv=function(t){function e(e){t.call(this),this.doc=e,this._highlights={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){return this._highlights},e.prototype.set=function(t){var e=this._highlights,n=this.doc;va(t,function(t,o){var r=e[o]||[],i=gy(r,t),s=gy(t,r);va(i,function(t){var e=n.get(t);e&&e.setHighlighted(!1,o)}),va(s,function(t){var e=n.get(t);e&&e.setHighlighted(!0,o)})}),this._highlights=t,this.emit("highlights:updated",t)},e}(ba),Cv=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this.__isStarted__=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.start=function(){var t=nd.getBrowserWindow();t.on("hashchange",this._onHashChange,this),this.__isStarted__=!0},e.prototype.readRoute=function(){return this.__isStarted__||this.start(),this.parseRoute(this.getRouteString())},e.prototype.writeRoute=function(t,e){e=e||{};var n=this.stringifyRoute(t);n?this._writeRoute(n,e):this.clearRoute(e)},e.prototype.dispose=function(){var t=nd.getBrowserWindow();t.off(this)},e.prototype.parseRoute=function(t){return e.routeStringToObject(t)},e.prototype.stringifyRoute=function(t){return e.objectToRouteString(t)},e.prototype.getRouteString=function(){return window.location.hash.slice(1)},e.prototype._writeRoute=function(t,e){this.__isSaving__=!0;try{e.replace?window.history.replaceState({},"","#"+t):window.history.pushState({},"","#"+t)}finally{this.__isSaving__=!1}},e.prototype.clearRoute=function(t){this._writeRoute("",t)},e.prototype._onHashChange=function(){if(!this.__isSaving__){if(this.__isLoading__)return void console.error("FIXME: router is currently applying a route.");this.__isLoading__=!0;try{var t=this.getRouteString(),e=this.parseRoute(t);this.emit("route:changed",e)}finally{this.__isLoading__=!1}}},e}(ba);Cv.objectToRouteString=function(t){var e=[];return Bh(t,function(t,n){e.push(n+"="+t)}),e.join(",")},Cv.routeStringToObject=function(t){var e={};if(!t)return e;var n=t.split(",");return n.forEach(function(t){var n=t.split("=");if(2!==n.length)throw new Error("Illegal route.");e[n[0].trim()]=n[1].trim()}),e};var Sv=function(t){function e(e,n){if(n.name=n.name||n.path.join("."),t.call(this,e,n),!n.path)throw new Error("Property 'path' is mandatory.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(e){var n=t.prototype.render.apply(this,arguments);return n.addClass("sc-text-property-editor"),this.props.disabled||(n.addClass("sm-enabled"),n.setAttribute("contenteditable",!0)),n.append(e(Tg,{tagName:this.props.tagName||"div",path:this.props.path,withoutBreak:this.props.withoutBreak})),n},e.prototype.selectAll=function(){var t=this.getDocument(),e=this.props.path,n=t.get(e),o=t.createSelection({type:"property",path:e,startOffset:0,endOffset:n.length});this.setSelection(o)},e}(Ym),xv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.register=function(t){var e=t.prototype.type;if("string"!=typeof e||""===e)throw console.error("#### nodeClazz",t),new Error("Node names must be strings and must not be empty");if(!t.prototype._isNode)throw new Error("Nodes must be subclasses of Substance.Data.Node");if(this.contains(e))throw new Error("Node class is already registered: "+e);this.add(e,t)},e}(gl),Ov=function(t,e){this.name=t,this.version=e,this.nodeRegistry=new xv,this.tocTypes=[],this.addNodes(this.getBuiltIns())};Ov.prototype.addNodes=function(t){t&&Bh(t,function(t){t.prototype._isNode?this.addNode(t):console.error("Illegal node class: ",t)}.bind(this))},Ov.prototype.addNode=function(t){this.nodeRegistry.register(t),t.tocType&&this.tocTypes.push(t.type)},Ov.prototype.getNodeClass=function(t){return this.nodeRegistry.get(t)},Ov.prototype.getBuiltIns=function(){return[]},Ov.prototype.isInstanceOf=function(t,e){var n=this.getNodeClass(t);return!!n&&il.isInstanceOf(n,e)},Ov.prototype.each=function(){this.nodeRegistry.each.apply(this.nodeRegistry,arguments)},Ov.prototype.getTocTypes=function(){return this.tocTypes},Ov.prototype.getDefaultTextType=function(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")},Ov.prototype.getNodeSchema=function(t){var e=this.getNodeClass(t);return e?e.schema:(console.error("Unknown node type ",t),null)};var Ev=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefaultTextType=function(){throw new Error("DocumentSchema.getDefaultTextType() is abstract and must be overridden.")},e.prototype.isAnnotationType=function(t){var e=this.getNodeClass(t);return e&&e.prototype._isPropertyAnnotation},e.prototype.getBuiltIns=function(){return[sl,al,hl,fl]},e}(Ov),Nv=function(t){function e(e){t.call(this,e,function(t){if(!t.prototype._isComponent)throw new Error("Component registry: wrong type. Expected a ComponentClass. Was: "+String(t))})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(gl),Iv=function(t){this.map={},va(t,function(t,e){var n=t.fontawesome;n&&this.addIcon(e,n)}.bind(this))};Iv.prototype.renderIcon=function(t,e){var n=this.map[e];if(n)return t(av,{icon:n})},Iv.prototype.addIcon=function(t,e){this.map[t]=e};var Pv=function(t,e){this.lang=e||"en",this.labels=t};Pv.prototype.getLabel=function(t){var e=this.labels[this.lang];return e?e[t]||t:t};var Tv=function(){this.config={schema:{},nodes:{},components:{},converters:{},importers:{},exporters:{},commands:{},tools:new Map,textTypes:[],editingBehaviors:[],macros:[],dndHandlers:[],icons:{},labels:{}}};Tv.prototype.defineSchema=function(t){this.config.schema=t},Tv.prototype.addNode=function(t){var e=t.type;if(!e)throw new Error("A NodeClass must have a type.");if(this.config.nodes[e])throw new Error("NodeClass with this type name is already registered: "+name);this.config.nodes[e]=t},Tv.prototype.addConverter=function(t,e){var n=this.config.converters[t];if(n||(n={},this.config.converters[t]=n),!e.type)throw new Error("A converter needs an associated type.");n[e.type]=e},Tv.prototype.addImporter=function(t,e){this.config.importers[t]=e},Tv.prototype.addExporter=function(t,e){this.config.exporters[t]=e},Tv.prototype.addComponent=function(t,e){if(this.config.components[t])throw new Error(t+" already registered");if(!e)throw new Error("Provided nil for component "+t);if(!e.prototype._isComponent)throw new Error("ComponentClass must be a subclass of ui/Component.");this.config.components[t]=e},Tv.prototype.addCommand=function(t,e,n){if(!bn(t))throw new Error("Expecting 'name' to be a String");if(!e)throw new Error("Provided nil for command "+t);if(!e.prototype._isCommand)throw new Error("Expecting 'CommandClass' to be of type ui/Command.");this.config.commands[t]={name:t,CommandClass:e,options:n||{}}},Tv.prototype.addTool=function(t,e,n){if(n=n||{},!bn(t))throw new Error("Expecting 'name' to be a String");if(!e)throw new Error("Provided nil for tool "+t);if(!e||!e.prototype._isTool)throw new Error("Expecting 'ToolClass' to be of type ui/Tool. name:");var o=n.target;!o&&n.overlay?o="overlay":o||(o="default"),this.config.tools.has(o)||this.config.tools.set(o,new Map),this.config.tools.get(o).set(t,{name:t,Class:e,options:n||{}})},Tv.prototype.addIcon=function(t,e){var n=this.config.icons[t];n||(n={},this.config.icons[t]=n),Object.assign(n,e)},Tv.prototype.addLabel=function(t,e){bn(e)?(this.config.labels.en||(this.config.labels.en={}),this.config.labels.en[t]=e):va(e,function(e,n){this.config.labels[n]||(this.config.labels[n]={}),this.config.labels[n][t]=e}.bind(this))},Tv.prototype.addSeed=function(t){this.config.seed=t},Tv.prototype.addTextType=function(t,e){this.config.textTypes.push({spec:t,options:e||{}})},Tv.prototype.addEditingBehavior=function(t){this.config.editingBehaviors.push(t)},Tv.prototype.addMacro=function(t){this.config.macros.push(t)},Tv.prototype.addDragAndDrop=function(t){if(!t.prototype._isDragAndDropHandler)throw new Error("Only instances of DragAndDropHandler are allowed.");this.config.dndHandlers.push(t)},Tv.prototype.import=function(t,e){return t.configure(this,e||{}),this},Tv.prototype.getConfig=function(){return this.config},Tv.prototype.getStyles=function(){return this.config.styles},Tv.prototype.getSchema=function(){var t=this.config.schema,e=new Ev(t.name,"1.0.0");return e.getDefaultTextType=function(){return t.defaultTextType},e.addNodes(this.config.nodes),e},Tv.prototype.createArticle=function(t){var e=this.config.schema,n=this.getSchema(),o=new e.ArticleClass(n);return t&&t(o),o},Tv.prototype.createImporter=function(t){var e=this.config.importers[t],n={schema:this.getSchema(),converters:this.getConverterRegistry().get(t),DocumentClass:this.config.schema.ArticleClass};return new e(n)},Tv.prototype.createExporter=function(t){var e=this.config.exporters[t],n={schema:this.getSchema(),converters:this.getConverterRegistry().get(t)};return new e(n)},Tv.prototype.getTools=function(){return this.config.tools},Tv.prototype.getComponentRegistry=function(){var t=new Nv;return va(this.config.components,function(e,n){t.add(n,e)}),t},Tv.prototype.getCommands=function(){return Aa(this.config.commands,function(t,e){return new t.CommandClass(Object.assign({name:e},t.options))})},Tv.prototype.getSurfaceCommandNames=function(){var t=this.getCommands(),e=t.map(function(t){return t.type});return e},Tv.prototype.getConverterRegistry=function(){if(!this.converterRegistry){var t=new gl;va(this.config.converters,function(e,n){t.add(n,new gl(e))}),this.converterRegistry=t}return this.converterRegistry},Tv.prototype.getSeed=function(){return this.config.seed},Tv.prototype.getTextTypes=function(){return this.config.textTypes.map(function(t){return t.spec})},Tv.prototype.getIconProvider=function(){return new Iv(this.config.icons)},Tv.prototype.getLabelProvider=function(){return new Pv(this.config.labels)},Tv.prototype.getEditingBehavior=function(){var t=new Vm;return this.config.editingBehaviors.forEach(function(e){e.register(t)}),t},Tv.prototype.getMacros=function(){return this.config.macros},Tv.prototype.createDragHandlers=function(){return this.config.dndHandlers.map(function(t){return new t})};var jv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.create=function(t){var e=this.get(t);if(!e)throw new Error("No class registered by that name: "+t);var n=Array.prototype.slice.call(arguments,1),o=Object.create(e.prototype);return e.apply(o,n),o},e}(gl),Dv=function(t){var e=t.get("body");t.create({id:"p1",type:"paragraph",content:"0123456789"}),e.show("p1"),t.create({id:"p2",type:"paragraph",content:"0123456789"}),e.show("p2")},Av=function(t){function e(){t.call(this),
this.connections={},this.messages=[],this._log=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.start=function(){this._interval=setInterval(this._processMessage.bind(this),100)},e.prototype.stop=function(){clearInterval(this._interval)},e.prototype.flush=function(){for(var t=this;this.messages.length;)t._processMessage()},e.prototype.clear=function(){this.messages=[]},e.prototype.tick=function(){this._processMessage()},e.prototype.connectServer=function(t){if(this.connections[t.serverId])throw new Error("Server already registered:"+t.serverId);this.connections[t.serverId]={type:"server",serverId:t.serverId,server:t,sockets:{}}},e.prototype.connectClientSocket=function(t){var e=t.serverId,n=t.clientId,o=this.connections[e];if(!o||"server"!==o.type)throw new Error("Can not connect to server. Unknown server id.");this.connections[t.clientId]={type:"client",socket:t},o.server.handleConnectionRequest(n)},e.prototype.disconnectClientSocket=function(t){var e=t.serverId,n=t.clientId,o=this.connections[e];if(!o||"server"!==o.type)throw new Error("Unknown server id.");o.server.handleDisconnectRequest(n),delete this.connections[t.clientId]},e.prototype.connectServerSocket=function(t){var e=this.connections[t.serverId];if(!e)throw new Error("Server is not connected:"+t.serverId);e.sockets[t.clientId]=t},e.prototype.disconnectServerSocket=function(t){var e=this.connections[t.serverId];if(!e)throw new Error("Server is not connected:"+t.serverId);delete e.sockets[t.clientId]},e.prototype.pushMessage=function(t){this.messages.push(t),this._log.push(t),this.emit("messages:updated",this.messages)},e.prototype._processMessage=function(){var t=this.messages.shift();if(t){this.emit("messages:updated",this.messages);var e,n=t.from,o=t.to,r=this.connections[o];e="server"===r.type?r.sockets[n]:r.socket,e?e._onMessage(t.data):console.error("Could not deliver message:",t),this.emit("message:sent",t)}},e}(ba),Mv=0,kv=function(t){function e(e,n,o){t.call(this),this.__id__=Mv++,this.messageQueue=e,this.serverId=n,this.clientId=o,this._isSimulated=!0,this.readyState=1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.connect=function(){this.messageQueue.connectServerSocket(this)},e.prototype._onMessage=function(t){this.emit("message",t)},e.prototype.send=function(t){var e={from:this.serverId,to:this.clientId};t&&(e.data=t),this.messageQueue.pushMessage(e)},e}(ba),Lv=function(t){function e(e){t.call(this),this.messageQueue=e.messageQueue,this.serverId=e.serverId||"server",this.clients={},this._isSimulated=!0,e.manualConnect||this.connect()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.connect=function(){this.messageQueue.connectServer(this)},e.prototype.handleConnectionRequest=function(t){var e=new kv(this.messageQueue,this.serverId,t);this.messageQueue.connectServerSocket(e),this.clients[t]=e,this.emit("connection",e)},e.prototype.handleDisconnectRequest=function(t){var e=this.clients[t];this.messageQueue.disconnectServerSocket(e),e.emit("close",e),delete this.clients[t]},e}(ba),Rv=0,zv=function(t){function e(e){t.call(this),this.__id__=Rv++,this.messageQueue=e.messageQueue,this.clientId=e.clientId||h(),this.serverId=e.serverId||"server",this.readyState=3,this._isSimulated=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.connect=function(){this.messageQueue.connectClientSocket(this),this.readyState=1,this.triggerOpen()},e.prototype.disconnect=function(){this.messageQueue.disconnectClientSocket(this),this.readyState=3,this.triggerClose()},e.prototype.addEventListener=function(t,e){this["on"+t]&&console.warn("on"+t," is already set. Overriding handler."),this["on"+t]=e},e.prototype.triggerOpen=function(){this.onopen&&this.onopen()},e.prototype.triggerClose=function(){this.onclose&&this.onclose()},e.prototype.removeEventListener=function(t){delete this["on"+t]},e.prototype._onMessage=function(t){this.onmessage({data:t})},e.prototype.send=function(t){var e={from:this.clientId,to:this.serverId};t&&(e.data=t),this.messageQueue.pushMessage(e)},e}(ba),Fv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._createWebSocket=function(){var t=new zv(this.config);return t},e.prototype.connect=function(){this._connect()},e.prototype.disconnect=function(){this._disconnect()},e.prototype._connect=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];(o=t.prototype)._connect.apply(this,e),this.ws.connect();var o},e.prototype._disconnect=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];this.ws.disconnect()(o=t.prototype)._disconnect.apply(this,e);var o},e.prototype._onConnectionClose=function(){this.emit("close")},e.prototype.serializeMessage=function(t){return t},e.prototype.deserializeMessage=function(t){return t},e}(Sa),Bv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.serializeMessage=function(t){return t},e.prototype.deserializeMessage=function(t){return t},e}(jh),Hv=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(this,e),this._incomingMessages=[],this._outgoingMessages=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._onMessage=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];this.config.logging&&this._incomingMessages.push(e[0]),(o=t.prototype)._onMessage.apply(this,e);var o},e.prototype._onSend=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];this.config.logging&&(this._outgoingMessages=[],this._outgoingMessages.push(e[0])),(o=t.prototype)._onSend.apply(this,e);var o},e.prototype.dumpIncomingMessages=function(){return JSON.stringify(this._incomingMessages,null,"  ")},e.prototype.dumpOutgoingMessages=function(){return JSON.stringify(this._outgoingMessages,null,"  ")},e.prototype.serializeMessage=function(t){return t},e.prototype.deserializeMessage=function(t){return t},e.prototype.serializeChange=function(t){return t.toJSON()},e.prototype.deserializeChange=function(t){return Eh.fromJSON(t)},e}(wf),Uv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(sl);Uv.define({type:"meta",title:"text"});var Vv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(sl);Vv.define({type:"test-node",boolVal:{type:"boolean",default:!1},stringVal:{type:"string",default:""},arrayVal:{type:["array","string"],default:[]},objectVal:{type:"object",default:{}}}),Vv.isBlock=!0;var qv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(fl);qv.type="test-container-anno";var Jv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(sl);Jv.define({type:"structured-node",title:"text",body:"text",caption:"text"}),Jv.isBlock=!0;var $v=new Ev("test-article","1.0.0");$v.getDefaultTextType=function(){return"paragraph"},$v.addNodes([Uv,om,vm,Bg,cm,Nm,Vg,Sm,Vv,qv,Jv,Zg]);var Wv=function(t){function e(){t.call(this,$v),this.create({type:"meta",id:"meta",title:"Untitled"}),this.create({type:"container",id:"body",nodes:[]})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDocumentMeta=function(){return this.get("meta")},e}(df),Kv=le(new Wv,Dv),Xv=le(new Wv,function(t){Dv(t),de(t,{path:["p1","content"],pos:1,text:"!"}),de(t,{path:["p1","content"],pos:3,text:"???"})}),Gv={"test-doc":Kv,"test-doc-2":Xv},Qv={"test-doc":{documentId:"test-doc",schemaName:"prose-article",schemaVersion:"1.0.0",version:1},"test-doc-2":{documentId:"test-doc-2",schemaName:"prose-article",schemaVersion:"1.0.0",version:3}};n.ChangeStore=_e,n.ClientConnection=Sa,n.CollabClient=Oa,n.CollabEngine=Nh,n.CollabServer=jh,n.CollabSession=wf,n.DocumentClient=Cf,n.DocumentEngine=Of,n.DocumentServer=Ef,n.DocumentStore=Nf,n.SnapshotEngine=xf,n.SnapshotStore=If,n.WebSocketConnection=Pf,n.annotationHelpers=nl,n.Annotation=al,n.BlockNode=pl,n.Container=hl,n.ContainerAnnotation=fl,n.PropertyAnnotation=al,n.Document=df,n.DocumentChange=Eh,n.documentHelpers=uf,n.DocumentIndex=$h,n.DocumentNode=sl,n.DocumentSession=bf,n.DOMExporter=Cl,n.DOMImporter=jl,n.Fragmenter=wl,n.HTMLExporter=id,n.HTMLImporter=sd,n.InlineNode=ad,n.JSONConverter=hf,n.NodeIndex=qh,n.TextBlock=cd,n.TextNode=pd,n.Selection=uh,n.XMLExporter=fd,n.XMLImporter=ld,n.breakNode=st,n.copySelection=ct,n.createAnnotation=dt,n.deleteCharacter=yd,n.deleteNode=X,n.deleteSelection=nt,n.expandAnnotation=vt,n.fuseAnnotation=_t,n.insertInlineNode=Ct,n.insertNode=St,n.insertText=gd,n.mergeNodes=dd,n.pasteContent=md,n.replaceText=bt,n.switchTextType=It,n.truncateAnnotation=Pt,n.updateAnnotations=Z,n.BasePackage=gg,n.BlockquotePackage=Mg,n.CodePackage=Fg,n.EmphasisPackage=Ug,n.ImagePackage=Yg,n.InlineWrapperPackage=nm,n.ParagraphPackage=sm,n.PersistencePackage=pm,n.StrongPackage=hm,n.SubscriptPackage=dm,n.SuperscriptPackage=mm,n.HeadingPackage=wm,n.HeadingMacro=Cm,n.SwitchTextTypeTool=fg,n.SwitchTextTypeCommand=ug,n.ProseEditorPackage=km,n.ProseEditor=ov,n.ProseArticle=Mm,n.ProseEditorOverlayTools=ev,n.LinkPackage=Am,n.EditLinkTool=jm,n.Link=Nm,n.LinkCommand=Pm,n.LinkComponent=Im,n.InsertInlineNodeCommand=rv,n.EditInlineNodeCommand=iv,n.InlineNodeComponent=Eg,n.Button=Ty,n.ScrollPanePackage=Uy,n.ScrollPane=Hy,n.SplitPanePackage=qy,n.SplitPane=Vy,n.ScrollbarPackage=Wy,n.Scrollbar=zy,n.LayoutPackage=yg,n.Layout=dg,n.GridPackage=Qy,n.Grid=Ky,n.TabbedPanePackage=$y,n.TabbedPane=Jy,n.ModalPackage=Zy,n.Modal=Yy,n.InputPackage=eg,n.Input=tg,n.ResponsiveApplication=sv,n.TOC=pv,n.TOCProvider=mv,n.ToolDropdown=vv,n.Tool=jy,n.Toolbar=nv,n.ToolGroup=Dy,n.Surface=Ym,n.AbstractEditor=Um,n.AnnotationCommand=Rg,n.EditAnnotationCommand=Dm,n.AnnotationComponent=_g,n.AnnotationTool=zg,n.BlockNodeComponent=_v,n.Command=vd,n.Component=Ny,n.ContainerEditor=Zm,n.DefaultDOMElement=nd,n.FontAwesomeIcon=av,n.InsertNodeCommand=bv,n.Highlights=wv,n.OverlayTools=tv,n.RenderingEngine=Cy,n.Router=Cv,n.TextBlockComponent=jg,n.TextPropertyComponent=Tg,n.TextPropertyEditor=Sv,n.UnsupportedNodeComponent=Qm,n.ArrayIterator=Sl,n.Configurator=Tv,n.EventEmitter=ba,n.Factory=jv,n.inBrowser=Al,n.makeMap=fe,n.keys=hg,n.platform=Ay,n.Registry=gl,n.request=P,n.SubstanceError=ve,n.substanceGlobals=Hd,n.TreeIndex=Uh,n.uuid=h,n.twoParagraphs=Dv,n.MessageQueue=Av,n.TestWebSocketServer=Lv,n.TestWebSocketConnection=Fv,n.TestCollabServer=Bv,n.TestCollabSession=Hv,n.changeStoreSeed=Gv,n.documentStoreSeed=Qv,n.createTestDocumentFactory=ge,n.ProseEditorConfigurator=Tv}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"substance-cheerio":1}],3:[function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var r=t("./package/editor/Editor"),i=o(r),s=t("./package/viewer/Viewer"),a=o(s);angular.module("angular-substance-editor",[]).controller("Controller",["$scope",function(t){}]).directive("substance",["SubstanceService",function(t){return{restrict:"A",scope:{optionsxx:"="},link:function(e,n,o){if("editor"==o.type){var r=new i.default(t);r.render()}if("viewer"==o.type){var s=new a.default(t);s.render()}},template:"<substanceEditor></substanceEditor>"}}])},{"./package/editor/Editor":4,"./package/viewer/Viewer":7}],4:[function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=t("substance"),s={name:"angular-substance",configure:function(t){t.import(i.ProseEditorPackage),t.import(i.ImagePackage),t.import(i.PersistencePackage)}},a=function(){function t(e){o(this,t),this.substanceService=e}return r(t,[{key:"render",value:function(){var t=(new i.Configurator).import(s),e=t.createArticle(this.substanceService.loadDocument),n=new i.DocumentSession(e,{saveHandler:this.substanceService});i.ProseEditor.mount({documentSession:n,configurator:t},"substanceEditor")}}]),t}();n.default=a},{substance:2}],5:[function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==("undefined"==typeof e?"undefined":a(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof e?"undefined":a(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0});var p=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),c=t("./ToolbarViewer"),u=o(c),h=t("substance"),f=function(t){function e(){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),p(e,[{key:"render",value:function(t){var e=this.componentRegistry.get("split-pane"),n=t("div").addClass("sc-prose-editor"),o=this._renderToolbar(t),r=this._renderEditor(t),i=this.componentRegistry.get("scroll-pane"),s=t(i,{scrollbarPosition:"right",overlay:h.ProseEditorOverlayTools}).append(r).ref("contentPanel");return n.append(t(e,{splitType:"horizontal"}).append(o,s)),n}},{key:"_renderToolbar",value:function(t){return t(u.default,{commandStates:{}}).ref("toolbar")}},{key:"_renderEditor",value:function(t){var e=this.props.configurator;return t(h.ContainerEditor,{disabled:!0,documentSession:this.documentSession,node:this.doc.get("body"),commands:e.getSurfaceCommandNames(),textTypes:e.getTextTypes()}).ref("body")}}]),e}(h.ProseEditor);n.default=f},{"./ToolbarViewer":6,substance:2}],6:[function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==("undefined"==typeof e?"undefined":s(e))&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof e?"undefined":s(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),p=t("substance"),c=function(t){function e(){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,t),a(e,[{key:"render",value:function(t){var e=t("div").addClass(this.getClassNames());return e}},{key:"getClassNames",value:function(){return"sc-toolbar"}}]),e}(p.Component);n.default=c},{substance:2}],7:[function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=t("substance"),a=t("./DocumentViewer"),p=o(a),c={name:"angular-substance",configure:function(t){t.import(s.ProseEditorPackage)}},u=function(){function t(e){r(this,t),this.substanceService=e}return i(t,[{key:"render",value:function(){var t=(new s.Configurator).import(c),e=t.createArticle(this.substanceService.loadDocument),n=new s.DocumentSession(e);p.default.mount({documentSession:n,configurator:t},"substanceEditor")}}]),t}();n.default=u},{"./DocumentViewer":5,substance:2}]},{},[3]);